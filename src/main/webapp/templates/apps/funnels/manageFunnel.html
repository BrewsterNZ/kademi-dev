<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Manage Funnels</title>
    </head>
    <body>
        <h1>$page.title</h1>
        <p class="lead">Leads = $page.leads.size()</p>

        <div class="well">
            <xmp>$page.funnelXml</xmp>
        </div>

        <a href="/repositories/$page.name/" class="btn btn-primary">Edit funnel.xml</a>

        <table class="table table-responsive">
            <thead>
                <tr>
                    <th>TrackingID</th>
                    <th>Email</th>
                    <th>Last attained</th>
                    <th>Awaiting goal</th>
                    <th>Created date</th>
                    <th>Last attained date</th>
                    <th>Stage</th>
                    <th>Source</th>
                    <th>Assigned to</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                #foreach( $leadPage in $page.children.ofType.lead )
                #set($lead = $leadPage.lead)
                <tr>
                    <td>$!lead.trackingId</td>
                    <td>$!lead.profile.email</td>
                    <td>$!lead.lastAttainedGoal</td>
                    <td>$!lead.currentGoal</td>
                    <td>$lead.createDate</td>
                    <td>$lead.lastAttainedDate</td>
                    <td>$!lead.stageName</td>
                    <td>$!lead.source</td>
                    <td>$!lead.assignedToProfile.formattedName</td>
                    <td>
                        <button data-leadid="$lead.id" type="button" class="btn btn-danger btn-del-lead"><i class="fa fa-trash"></i></button>
                    </td>
                </tr>
                #end
            </tbody>
        </table>

        <script type="text/javascript">
            $(function () {
                $('body').on('click', '.btn-del-lead', function (e) {
                    e.preventDefault();

                    var btn = $(this);
                    var tr = btn.closest('tr');
                    var leadId = btn.data('leadid');
                    confirmDelete(leadId, 'this lead', function () {
                        tr.remove();
                    });
                });
            });
        </script>
    </body>
</html>