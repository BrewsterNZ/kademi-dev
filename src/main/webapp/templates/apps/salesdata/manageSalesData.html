<html xmlns="http://www.w3.org/1999/xhtml">    <head>        <title>Manage Products</title>        <style>            .panel-heading .btn-series {                vertical-align: top;                position: relative;                top: -3px;            }        </style>    </head>    <body class="">        <p class="">            <a class="btn btn-sm btn-success" href="new"><i class="fa fa-plus"></i> New Sales Data Series</a>            <a class="btn btn-sm btn-info btn-add-category" href="#"><i class="fa fa-plus"></i> Add new category</a>        </p>        <div id="groups-folders">            <div id="folder-wrapper" class="panel-folder">                #foreach($cat in $page.categories)                #set($seriesInFolder = $page.getChildrenInCategory($cat).ofType("series"))                <div id="$cat.id" class="panel panel-default category">                    <div class="panel-heading" data-toggle="collapse" data-parent="#folder-wrapper" data-target="#cat_${cat.id}">                        <i class="clip-folder"></i>                        <span class="folder-name clickable">$cat.title</span>                        <div class="btn-group btn-group-xs">                            <button data-toggle="dropdown" class="btn btn-sm btn-default btn-squared dropdown-toggle" type="button">                                <span class="caret"></span>                            </button>                            <ul role="menu" class="dropdown-menu">                                <li><a href="$cat.id" data-catname="$cat.name" class="btn-rename-category">Rename this category</a></li>                                <li class="divider"></li>                                <li><a href="$cat.id" data-catname="$cat.name" class="btn-delete-category">Delete this category</a></li>                            </ul>                        </div>                        <div class="panel-tools">                            <div class="btn-series">                                <a class="btn btn-info btn-sm"><span class="series-count">$seriesInFolder.size()</span> Series </a>                            </div>                        </div>                    </div>                    <div id="cat_${cat.id}" class="collapse">                        <div id="productsTableContainer" class="panel-body">                            <div class="table-responsive">                                <table class="table table-striped table-hover">                                    <colgroup>                                        <col style="width: 50px;"/>                                        <col />                                        <col />                                        <col />                                        <col />                                        <col style="width: 120px;" />                                    </colgroup>                                    <thead>                                        <tr>                                            <th>Status</th>                                            <th>Sales series</th>                                            <th>Group</th>                                            <th>Collection period</th>                                            <th>No. items</th>                                            <th class="action">Action</th>                                        </tr>                                    </thead>                                    <tbody>                                        #foreach($series in $seriesInFolder)                                        #genRows($series)                                        #end                                    </tbody>                                </table>                            </div>                        </div>                    </div>                </div>                #end            </div>        </div>        <div class="panel panel-default">            <div id="seriesTableContainer" class="panel-body">                <div class="table-responsive">                    <table class="table table-striped table-hover">                        <colgroup>                            <col style="width: 50px;"/>                            <col />                            <col />                            <col />                            <col />                            <col style="width: 120px;" />                        </colgroup>                        <thead>                            <tr class="series-row">                                <th>Status</th>                                <th>Sales series</th>                                <th>Group</th>                                <th>Collection period</th>                                <th>No. items</th>                                <th class="action">Action</th>                            </tr>                        </thead>                        <tbody>                            #foreach($series in $page.children.ofType.series)                            #if(!$series.category)                            #genRows($series)                            #end                            #end                        </tbody>                    </table>                </div>            </div>        </div>        <script type="text/javascript">            $(function () {                var c = {};                $(".series-row").draggable({                    helper: "clone",                    revert: "invalid",                    axis: "y",                    start: function (event, ui) {                        c.helper = ui.helper;                    }                });                $(".category").droppable({                    accept: ".series-row",                    greedy: true,                    drop: function (event, ui) {                        var row = ui.draggable.css({position: "relative", top: "", left: ""});                        var seriesName = row.data("seriesname");                        var categoryID = $(this).attr("id");                        categoryAjax(seriesName, "changeCategory=changeCategory&categoryID=" + categoryID, seriesName, function (name, resp) {                            //window.location.reload();                        });                        $(this).find("tbody").append(row);                        $(c.helper).remove();                    }                });                $("#seriesTableContainer").droppable({                    accept: ".series-row",                    greedy: true,                    drop: function (event, ui) {                        var row = ui.draggable.css({position: "relative", top: "", left: ""});                        var seriesName = row.data("seriesname");                        categoryAjax(seriesName, "changeCategory=changeCategory", seriesName, function (name, resp) {                            //window.location.reload();                        });                        $(this).find("tbody").append(row);                        $(c.helper).remove();                    }                });                $("body").on('click', '.btn-rename-category', function (e) {                    e.preventDefault();                    var catTitle = $(this).data("catname");                    catID = $(this).attr("href");                    var categoryTitle = prompt("Please enter a category title", catTitle);                    if (categoryTitle != null || categoryTitle != "") {                        categoryAjax(categoryTitle, "updateCategory=updateCategory&categoryTitle=" + categoryTitle + "&categoryID=" + catID, null, function (name, resp) {                            window.location.reload();                        });                    }                });                                $("body").on('click', '.btn-delete-category', function (e) {                    e.preventDefault();                    catID = $(this).attr("href");                    var catTitle = $(this).data("catname");                    var categoryTitle = confirm("Are you sure you want to delete " + catTitle);                    if (categoryTitle) {                        categoryAjax(categoryTitle, "deleteCategory=deleteCategory&categoryID=" + catID, null, function (name, resp) {                            window.location.reload();                        });                    }                });                $("form.referral-settings").forms({                    callback: function () {                        Msg.info("Updated settings")                    }                });                $('body').on('click', '.btn-add-category', function (e) {                    var categoryTitle = prompt("Please enter a category title", "");                    if (categoryTitle != null || categoryTitle != "") {                        categoryAjax(categoryTitle, "createCategory=createCategory&categoryTitle=" + categoryTitle, null, function (name, resp) {                            window.location.reload();                        });                    }                });                $('body').on('click', 'a.delete-series', function (e) {                    e.preventDefault();                    var link = $(e.target).closest('a');                    var href = link.attr('href');                    confirmDelete(href, href, function () {                        link.closest('tr').remove();                    });                });            });            function categoryAjax(name, data, url, callback) {                $.ajax({                    type: 'POST',                    url: window.location.pathname + (url || ""),                    data: data,                    success: function (resp) {                        $('body').trigger('ajaxLoading', {                            loading: false                        });                        if (callback) {                            callback(name, resp);                        }                    },                    error: function (resp) {                        log('error', resp);                        $('body').trigger('ajaxLoading', {                            loading: false                        });                        if (resp.status === 400) {                            alert('Sorry, the category could not be created. Please check if a category with that name already exists');                        } else {                            alert('There was a problem creating the folder');                        }                    }                });            }        </script>        #macro(genRows $series)        <tr class="series-row" data-seriesname="$series.name">            <td>                #if($series.series.enabled)                <i class="fa fa-check-circle text-success"></i>                #else                <i class="glyphicon glyphicon-pencil text-muted"></i>                #end                                                       </td>            <td><a href='$series.name'>$series.title</a></td>            <td>$!series.salesGroupName</td>            <td>$series.period</td>            <td>$series.numItems</td>            <td class="action">                <div class="btn-group btn-group-sm">                    <a href="$series.name" class="btn btn-sm btn-primary btn-sm"> <i class="fa fa-edit"></i> Edit                    </a>                    <button class="btn btn-sm btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">                        <span class="caret"></span>                    </button>                    <ul class="dropdown-menu pull-right" role="menu">                        <li role="presentation">                            <a role="menuitem" tabindex="-1" href="$series.name" class="delete-series"><i class="fa fa-times"></i> Delete</a>                        </li>                    </ul>                </div>                                                                                           </td>        </tr>        #end    </body></html>