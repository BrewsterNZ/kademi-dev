<html xmlns="http://www.w3.org/1999/xhtml">    <head>        <title>Manage Sales Data Series</title>    </head>    <body class="">        <form name="frmDetails" action="$page.href" method="post" class="form-horizontal record-form manage-data-record">            <div class="pull-right page-action">                <div class="btn-group">                    <button type="submit" role="button" class="btn btn-success">                        <i class="fa fa-save"></i>                        Save                    </button>                </div>            </div>            <h1>$page.record.amount for $!page.record.salesBy.formattedName</h1>            <p class='lead'>Series: $page.record.series.title / Record ID: $page.record.id</p>            <div class="clearfix"></div>            <br/>            <div class="form-group">                <label class="control-label col-md-2" for="amount">Amount</label>                <div class="col-md-4">                    <input type="text" name="amount" id="amount" value="$!page.record.amount" placeholder="" class="required form-control" required="true" />                </div>            </div>            <div class="form-group">                <label class="control-label col-md-2" for="salesBy">Sales by</label>                <div class="col-md-4">                    <input type="text" data-text="$!page.record.salesBy.entityName" name="salesBy" id="salesBy" value="$!page.record.salesBy.entityName" placeholder="" class="required form-control" required="true" />                </div>                <label class="control-label col-md-2" for="salesTeam">Sales team</label>                <div class="col-md-4">                    <input type="text" data-text="$!page.record.salesTeam.entityName" name="salesTeam" id="salesTeam" value="$!page.record.salesTeam.entityName" placeholder="" class="form-control" />                    <small><i>Optional</i></small>                </div>            </div>            <div class="form-group">                <label class="control-label col-md-2" for="periodFrom">Sale date</label>                <div class="col-md-4">                    <div class="input-group">                        <input type="text" name="periodFrom" data-format="DD/MM/YYYY HH:mm" value="$!formatter.formatDateTime($page.record.periodFrom, $rootFolder.organisation.timezone)" class="form-control DateTime" />                        <span class="input-group-addon"> <i class="fa fa-calendar"></i> </span>                    </div>                </div>                <label class="control-label col-md-2" for="dateEntered">Date entered</label>                <div class="col-md-4">                    <div class="input-group">                        <input type="text" name="dateEntered" data-format="DD/MM/YYYY HH:mm" value="$!formatter.formatDateTime($page.record.dateEntered, $rootFolder.organisation.timezone)" class="form-control DateTime" />                        <span class="input-group-addon"> <i class="fa fa-calendar"></i> </span>                    </div>                </div>            </div>            <div class="form-group">                <label class="control-label col-md-2" for="productSku">Product SKU</label>                <div class="col-md-4">                    <input type="text" name="productSku" value="$!page.record.productSku" class="form-control" />                    #if( $formatter.isEmpty($page.record.productSku) )                    #else                    #set( $psku = $page.record.findProductSku() )                    #if( $psku )                    <a class="btn btn-sm btn-info" href="/products/$psku.product.id">$psku.product.title</a>                    #else                    <span class="label label-danger">Product not found</span>                    #end                    #end                </div>            </div>            <hr/>            <h2>Custom fields</h2>            #set( $series = $page.record.series )            #foreach( $cnt in [1,3,5,7,9] )            <div class="form-group">                <label class="control-label col-md-2" for="field$cnt">                    <i class="text-muted">#$cnt</i>                    $!page.record.series.findFieldName($cnt)                </label>                <div class="col-md-4">                    <input type="text" name="field$cnt" id="field$cnt" value="$!page.record.fieldValue($cnt)" placeholder="" class="form-control" />                </div>                #set( $nextField = $cnt + 1)                <label class="control-label col-md-2" for="field$nextField">                    <i class="text-muted">#$nextField</i>                    $!page.record.series.findFieldName($nextField)                </label>                <div class="col-md-4">                    <input type="text" name="field$nextField" id="field$nextField" value="$!page.record.fieldValue($nextField)" placeholder="" class="form-control" />                </div>            </div>            #end            <hr/>            <div class="form-group">                <label class="control-label col-md-2" for="amount">Tag 1</label>                <div class="col-md-4">                    <input type="text" name="tag1" id="tag1" value="$!page.record.tag1" placeholder="" class="form-control" />                </div>                <label class="control-label col-md-2" for="amount">Tag 2</label>                <div class="col-md-4">                    <input type="text" name="tag2" id="tag2" value="$!page.record.tag2" placeholder="" class="form-control" />                </div>            </div>            <div class="form-group">                <label class="control-label col-md-2" for="amount">Tag 3</label>                <div class="col-md-4">                    <input type="text" name="tag3" id="tag3" value="$!page.record.tag3" placeholder="" class="form-control" />                </div>                <label class="control-label col-md-2" for="amount">Tag 4</label>                <div class="col-md-4">                    <input type="text" name="tag4" id="tag4" value="$!page.record.tag4" placeholder="" class="form-control" />                </div>            </div>            <div class="form-group">                <label class="control-label col-md-2" for="amount">Tag 5</label>                <div class="col-md-4">                    <input type="text" name="tag5" id="tag5" value="$!page.record.tag5" placeholder="" class="form-control" />                </div>            </div>        </form>        <hr/>        <h2>Points allocations</h2>        <div class="alert alert-danger col-md-6 pull-right">            <p>Click "Reset rewards" to remove any points credits or debits generated from this sale, and reset its                status to 'not processed'.                <br/>                You can then run points allocation again for the data series and this sale will be re-processed and new credits or debits awarded.                <br/>            </p>            <form method="POST" action="$page.href" id="form-reset-rewards">                <input type="hidden" name="resetRewards" value="true"/>                <button class="btn btn-primary" type="submit">                    <i class="fa fa-exclamation-triangle"></i>                    Reset rewards                </button>            </form>        </div>        <p>This shows points allocations linked to this sales record. Note this might not be complete if you're using single points            records from multiple sales records.</p>        <table class="table table-striped">            <thead>                <tr>                    <th>Created</th>                    <th>Source</th>                    <th>Calculated points</th>                    <th>Currently awarded points</th>                </tr>            </thead>            <tbody>                #foreach($alloc in $page.pointsAllocations)                <tr>                    <td>$formatter.formatDate($alloc.createdDate, $page.organisation.timezone)</td>                    <td>$alloc.source.title</td>                    <td>$alloc.pointsAmount</td>                    <td>                        #if( $alloc.points )                        $alloc.points.numPoints                        #elseif( $alloc.pointsDebit )                        (- $alloc.pointsDebit.numPoints)                        #else                        Nil                        #end                    </td>                    <td>                        #if( $alloc.points )                        <a href="/manageUsers/$alloc.points.issuedTo.id/">$alloc.points.issuedTo.formattedName</a>                        #elseif( $alloc.pointsDebit )                        <a href="/manageUsers/$alloc.pointsDebit.issuedTo.id/">$alloc.pointsDebit.issuedTo.formattedName</a>                        #else                        -                        #end                    </td>                </tr>                #end            </tbody>        </table>        <script type="text/javascript">            $(function () {                $(".record-form").forms({                    onSuccess: function () {                        Msg.info("Saved");                    }                });                $("#form-reset-rewards").forms({                    onSuccess: function () {                        Msg.info("Rewards reset");                        window.location.reload();                    }                });            });        </script>    </body></html>