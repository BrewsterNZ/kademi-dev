<html xmlns="http://www.w3.org/1999/xhtml">    <head>        <title>Manage Products</title>        <style>            .panel-heading .btn-series {                vertical-align: top;                position: relative;                top: -3px;            }        </style>    </head>    <body class="">        <button class="btn btn-danger" id="btnShowDeletePeriods">Delete KPI periods..</button>        <br/>        <div style="display: none" id="deletePeriodsContainer">            <div class="alert alert-danger">                <h3>Delete KPI Periods</h3>                <p>Before deleting KPI periods please ensure:</p>                <ul>                    <li>You have deleted any points awarded by those KPIs</li>                    <li>Remaining KPI periods are contiguous, ie no gaps</li>                    <li>If data series are populated with triggers from points award from this KPI, you should have deleted those records</li>                </ul>                <br/>                <button class="btn btn-danger" id="btnDeletePeriods">Delete selected KPI periods</button>            </div>        </div>        <table class="table table-bordered">            <colgroup>                <col style="width: 15%"/>                <col style="width: 15%"/>                <col style="width: 10%"/>                <col style="width: 60%"/>            </colgroup>            #set( $startOfYear = $formatter.yearStart )            <tbody id="kpisTableBody">                #foreach($series in $page.find("/sales").children.ofType.series )                <tr>                    <td rowspan="2" colspan="2">                        <h3><a href="$series.href">$series.title</a></h3>                    </td>                </tr>                #showProgress( $page.lastDataDate(  $series ), "info" )                #set( $kpis = $series.child("kpis").children )                #if( $kpis.isEmpty() )                <tr>                    <td colspan="2">No KPIs</td>                </tr>                #else                #foreach($kpi in $kpis)                <tr>                    <td rowspan="3">                        <a href="$kpi.href">$kpi.name</a>                        <br/>                        $kpi.kpi.periodMultiples $kpi.kpi.frequency                    </td>                    <td rowspan="3" >                        #foreach( $group in $kpi.selectedGroups )                        <div class="label label-info">$group.name</div>                        #end                    </td>                </tr>                <tr>                    #set( $periods = $kpi.kpi.findPeriodsSince( $startOfYear ) )                    #if( $periods.size() > 0 )                    <td>$periods.size() periods</td>                    <td colspan="2">                        <div style="position: relative; height: 40px">                            #foreach($period in $periods )                            #showPeriod($period)                            #end                        </div>                    </td>                    #else                    <td colspan="3"><span class="text-muted">No periods have been processed yet</span></td>                    #end                </tr>                #showProgress($page.lastPeriodDateWithRewards( $kpi.kpi ), "success" )                #end                #end                #end            </tbody>        </table>        #macro( showPeriod $period )        #set( $days = $formatter.durationDays( $period.startDate, $period.endDate ) )        #set( $perc = $formatter.toPercent($days, 365) )        #set( $startDays = $formatter.durationDays( $formatter.yearStart, $period.startDate ) )        #set( $percLeft = $formatter.toPercent($startDays, 365) )        #set( $color = "warning" )        #if( $period.rewardsIssuedDate )        #set( $color = "success" )        #end        <div class="label label-$color" style="position: absolute; width: $perc; left: $percLeft; border: solid lightgrey 1px" title="ending $period.endDate" >            <label>                <input type="checkbox" value="$period.id" name="deletePeriodId" />                $formatter.formatDate( $period.endDate )            </label>        </div>        #end        #macro( showProgress $date $color )        <tr>            #if( $date )            #set( $days = $formatter.durationDays( $formatter.yearStart, $date ) )            #set( $perc = $formatter.toPercent($days, 365) )            <td style="width: 150px">                Rewards issued                $formatter.formatAge( $date )            </td>            <td>                <div style="">                    <div title="$date" class="progress-bar progress-bar-$color" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: $perc; height: 20px">                        <span class="">$perc</span>                    </div>                </div>            </td>            #else            <td colspan="3">                <span class="text-muted">No rewards have been allocated yet</span>            </td>            <td></td>            #end        </tr>        #end        <script type="text/javascript">            $(function (e) {                $("#btnShowDeletePeriods").click(function() {                    $("#deletePeriodsContainer").show(500);                });                $("#btnDeletePeriods").click(function (e) {                    e.preventDefault();                    var checks = $("input[name=deletePeriodId]:checked");                    if (checks.length > 0) {                        if( confirm("Are you sure you want to delete " + checks.length + " periods?") ) {                            doDeletePeriods(checks);                        }                    } else {                        Msg.error("Please select KPI periods to delete");                    }                });            });            function doDeletePeriods(checks) {                $.ajax({                    type: 'POST',                    url: window.location.pathname,                    dataType: "json",                    data: checks.serialize(),                    success: function (data) {                        flog("response", data);                        if (!data.status) {                            Msg.error("Failed to delete periods: " + data.mssages);                        } else {                            Msg.info("Deleted periods");                            $("#kpisTableBody").reloadFragment();                        }                    },                    error: function (resp) {                        flog("error", resp);                        Msg.error("An error occured deleting KPI periods");                    }                });            }        </script>    </body></html>