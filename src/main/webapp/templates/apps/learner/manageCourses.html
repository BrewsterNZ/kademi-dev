<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>$page.title</title>
        <link href="manageCourses.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="manageCourses.js">//</script>
        <script type="text/javascript" src="/static/js/managePublishing.js">//</script>
        <script type="text/javascript" src="/templates/themes/admin/prompt.js">//</script>
    </head>
    <body>
        <section id="manageCourse" class="MainContent">
            <article class="Note">This page will allow you to create and edit the flow of modules and control how your users progress through your learning content. Simply click the + button to add a new item, drag an item up or down to reposition it or click on the down arrow in an item for more options.</article>
            <section class="Control ClearFix">
                <div class="DropdownControl publishing">
                    <div class="DropdownWrapper">
                        #set($currentBranch = $page.closest("branch"))
                        <span>
                            <b>Editing version:</b> 
                            $currentBranch.name
                            #if( $currentBranch.live )
                            <strong class="islive">LIVE</strong>
                            #else
                            <a href="${currentBranch.href}publish" class="publish">PUBLISH</a>
                            #end

                        </span> 
                        <a href="#" class="Control"><span class="Hidden">Change version</span></a>
                    </div>
                    <div class="DropdownContent Hidden">
                        <div class="Content">
                            <ul class="Program branches">
                                #foreach($b in $page.closest("branch").parent.children.ofType.branch)
                                <li>
                                    <a href="#" class="copy" title="Copy this to a new version"><span>Copy</span></a>                                    
                                    #if( $b.live )
                                    <strong class="islive">LIVE</strong>
                                    #else
                                    <a href="#" class="hide" title="Hide this version. Can be restored from the manage versions screen"><span>Hide</span></a>
                                    #end

                                    <a href="${b.href}manageModules"  class="branch">
                                        $b.name
                                    </a> 
                                </li>
                                #end
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="DropdownControl">
                    <div class="DropdownWrapper">
                        <span><b>Website:</b> $page.closest("website").name</span> 
                        <a href="#" class="Control"><span class="Hidden">Change website</span></a>
                    </div>
                    <div class="DropdownContent Program Hidden">
                        <div class="Content ClearFix">
                            <section rel="program">
                                <ul class="Program">
                                    #foreach($w in $page.closest("website").parent.children)
                                    <li><a href="${w.href}manageCourses">$w.name</a></li>
                                    #end
                                </ul>
                            </section>
                        </div>
                    </div>
                </div>

                #set($program = $page.closest("program"))
                #set($programs = $page.closest("programs"))
                <div class="DropdownControl NoLabel selectProgram">                    
                    <div class="DropdownWrapper"> 
                        <span><b>Program:</b> $!program.title</span> <a href="#" class="Control"><span class="Hidden">Change program</span></a> 
                    </div>
                    <div class="DropdownContent Program Hidden">
                        <div class="Content ClearFix">
                            <section>
                                <ul class="Program">
                                    #foreach($otherProg in $programs.children.ofType.program)
                                    <li>
                                        <a href="${otherProg.href}">$otherProg.title</a>
                                        <aside>
                                            <a class="EditProgram" title="Edit program" href="#"><span class="Hidden">Edit program</span></a> 
                                            <a class="DeleteProgram" title="Delete program" href="$otherProg.href"><span class="Hidden">Delete program</span></a>
                                        </aside>
                                    </li> 
                                    #end
                                </ul>
                                <button class="Btn Add AddProgram">ADD PROGRAM</button>
                            </section>
                        </div>
                    </div>
                </div>
                <!--
                #if($page.program)
                <button id="publish" class="Btn Cancel">Publish changes</button>
                #end
                -->
            </section>
            #if($page.program)
            <section class="Content">
                <header>
                    <h3>Courses</h3>
                    <h3>Modules</h3>
                </header>
                <section>
                    <table>
                        <tr>
                            <td>						
                                <div class="Course ClearFix">
                                    <ul>                                        
                                        #foreach($course in $program.children.ofType.course)
                                        <li>
                                            <a href="$course.href">$course.name - $course.title</a>
                                            <aside>
                                                <a href="" class="Move" title="Move up or down">Move up or down</a> 
                                                <a href="" class="Dialogue DialogueCourse" title="Show dialogue menu">Show dialogue menu</a>
                                            </aside>
                                        </li>
                                        #end
                                    </ul>
                                    <button class="SmallBtn Add NoText AddCourse" title="Add course"><span>Add</span></button>
                                </div>
                            </td>
                            <td id="modulePanel">
                                <div class="Module ClearFix">                                    
                                    #set($levels = $page.closest("course").children.ofType.folder.sortByField("order").groupByField("level") )
                                    <ul>                                        
                                        #foreach($level in $levels.values())
                                        #foreach($module in $level)
                                        <li data-author-notes="$!module.notes" id="$module.name">
                                            <span>$module.name - $module.title</span>
                                            <aside> 
                                                <a href="" class="Move" title="Move up or down"><span class="Hidden">Move up or down</span></a> 
                                                <a href="" class="Dialogue DialogueModule" title="Show dialogue menu"><span class="Hidden">Show dialogue menu</span></a> 
                                            </aside>                                                                                        
                                        </li>
                                        #end
                                        <li class="Splitter">
                                            <span>Level Splitter</span>
                                            <aside> 
                                                <a href="" class="Move" title="Move up or down"><span class="Hidden">Move up or down</span></a> 
                                                <a href="" class="Dialogue DialogueModule" title="Show dialogue menu"><span class="Hidden">Show dialogue menu</span></a> 
                                            </aside>                                            
                                        </li>
                                        #end                                                    
                                    </ul>
                                    <button class="SmallBtn Add NoText AddModule" title="Add module"><span>Add</span></button>
                                </div>

                            </td>
                        </tr>
                    </table>
                </section>
            </section>
            #end
        </section>

        <div id="programModal" class="Modal">
            <header>
                <h3>Program Details</h3>
                <a class="Close" href="#" title="Close"><span class="Hidden">Close</span></a>
            </header>
            <div class="ModalContent">
                <form action="${parentOrg.path}/programs/" method="POST">
                    <input type="hidden" value="" name="programName" />
                    <div class="pageMessage">.</div>
                    <table>
                        <tr>
                            <th><label for="name">Enter program name</label></th>
                            <td><input type="text" name="programTitle" id="programTitle" maxlength="30" value="" placeholder="Program name" class="required simpleChars" /></td>
                        </tr>
                        <tr>
                            <th><label for="note">Enter author notes</label></th>
                            <td><textarea name="programNotes" id="programNotes" placeholder="Author notes" maxlength="255" cols="2" rows="2"></textarea></td>
                        </tr>
                        <tr>
                            <td colspan="2" class="Btn">
                                <button>Submit</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>

        <div id="courseModal" class="Modal">
            <header>
                <h3>Course Details</h3>
                <a class="Close" href="#" title="Close"><span class="Hidden">Close</span></a>
            </header>
            <div class="ModalContent">
                <form action="." method="POST">
                    <div class="pageMessage">.</div>
                    <table>
                        <tr>
                            <th><label for="name">Enter course title</label></th>
                            <td><input type="text" name="courseTitle" id="courseTitle" maxlength="30" value="" placeholder="Course name" class="required" /></td>
                        </tr>
                        <tr>
                            <th><label for="note">Enter author notes</label></th>
                            <td><textarea name="courseNotes" id="courseNotes" placeholder="Author notes" maxlength="" cols="2" rows="2"></textarea></td>
                        </tr>
                        <tr>
                            <th><label for="note">Course description</label></th>
                            <td><textarea name="courseDescription" id="courseDescription" placeholder="Displayed to users" maxlength="" cols="4" rows="2"></textarea></td>
                        </tr>                        
                        <tr>
                            <td colspan="2" class="Btn">
                                <button>Submit</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>

        <div id="moduleModal" class="Modal">
            <header>
                <h3>Module Details</h3>
                <a class="Close" href="#" title="Close"><span class="Hidden">Close</span></a>
            </header>
            <div class="ModalContent">
                <form action="." method="POST">
                    <div class="pageMessage">.</div>
                    <table>
                        <tr>
                            <th><label for="name">Enter module code</label></th>
                            <td><input type="text" name="moduleName" id="moduleName" maxlength="30" value="" placeholder="Module code" class="required" /></td>
                        </tr>                        
                        <tr>
                            <th><label for="name">Enter module title</label></th>
                            <td><input type="text" name="moduleTitle" id="moduleTitle" maxlength="30" value="" placeholder="Module title" class="required" /></td>
                        </tr>
                        <tr>
                            <th><label for="note">Enter author notes</label></th>
                            <td><textarea name="moduleNotes" id="moduleNotes" placeholder="Author notes" maxlength="255" cols="2" rows="2"></textarea></td>
                        </tr>
                        <tr>
                            <td colspan="2" class="Btn">
                                <button>Submit</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>    

        <!--
        <div id="addesProgramNotes" class="Modal">
            <header>
                <h3>Program added</h3>
                <a class="Close" href="#" title="Close"><span class="Hidden">Close</span></a>
            </header>
            <div class="ModalContent">
                <h3>You've created a program, next steps</h3>
                <ul>
                    <li>Create a course (click the + below).</li>
                    <li>Add modules to the course. A module is like a lecture or a class, it should be completable in a single sitting</li>
                    <li>Enrol one or more user groups from the manage groups page <a style="float: right" href="${page.closest('organisation').href}/groups/">Manage groups</a></li>
                </ul>
            </div>
        </div>            
        -->

        #set($programs = $page.closest("programs"))
        <script type="text/javascript">
            jQuery(function() {
                initManageCourse("${programs.href}", "$!{program.href}");
            });
        </script>
    </body>
</html>