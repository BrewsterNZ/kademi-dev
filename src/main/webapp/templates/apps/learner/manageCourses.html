<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>$page.title</title>
        <link href="manageCourses.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="manageCourses.js">//</script>
        <script type="text/javascript" src="/static/js/managePublishing.js">//</script>
        <script type="text/javascript" src="/templates/themes/admin/prompt.js">//</script>
    </head>
    <body class="manage-course">
        #set($currentBranch = $page.closest("branch"))
        <div class="btn-group publishing pull-right">
            #if( $currentBranch.live )
            <a href="../manageBranches" class="islive btn btn-danger">
                <i class="fa fa-gear"></i>
                LIVE
            </a>
            #else
            <a href="${currentBranch.href}publish" class="publish btn btn-success">
                <i class="glyphicon glyphicon-ok-sign"></i>
                PUBLISH
            </a>
            <a href="../manageBranches" class="btn btn-primary">
                <i class="fa fa-gear"></i>
                Manage versions
            </a>
            #end

            <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#">
                <b>Editing version:</b>
                $currentBranch.name
                <span class="caret"></span>
            </a>
            <ul role="menu" class="dropdown-menu branches">
                #foreach($b in $page.closest("branch").parent.children.ofType.branch)
                <li role="presentation" style="min-width: 300px">

                    <a href="#" class="copy btn btn-primary pull-right" title="Copy this to a new version"><i class="fa fa-copy"></i></a>
                    #if( $b.live )

                    #else
                    <a href="${b.href}" class="hide-branch pull-right btn btn-warning" title="Hide this version. Can be restored from the manage versions screen"><i class="clip-eye"></i></a>
                    #end
                    <a href="${b.href}" class="branch noclear">
                        $b.name
                    </a>

                </li>
                <li class="divider"></li>
                #end
            </ul>
        </div>

        <div class="btn-group">
            <a target='_blank' href='${page.externalUrl}' class='btn btn-success'>
                <i class="fa fa-arrow-circle-right"></i>
                View website
            </a>
            <div class="btn-group">
                <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#">
                    <b>Change website:</b> $page.closest("website").name
                    <span class="caret"></span>
                </a>
                <ul role="menu" class="dropdown-menu">
                    #foreach($w in $page.closest("website").parent.children)
                    <li><a href="${w.href}">$w.name</a></li>
                    <li class="divider"></li>
                    #end
                </ul>
            </div>
        </div>

        <hr/>

        <div id="manage-course">
	        <p class="alert alert-info">This page will allow you to create and edit the flow of modules and control how your users progress through your learning content. Simply click the + button to add a new item, drag an item up or down to reposition it or click on the down arrow in an item for more options.</p>
        </div>

        <section id="manageCourse" class="MainContent">
	        #set($program = $page.closest("program"))
	        #set($programs = $page.closest("programs"))
	        <div class="btn-group programs-wrapper">
		        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			        <span><b>Program:</b> $!program.title</span> <span class="caret"></span>
		        </button>
		        <ul class="dropdown-menu programs-list" role="menu">
			        #foreach($otherProg in $programs.children.ofType.program)
			        <li class="program clearfix">
				        <aside class="pull-right">
					        <a class="btn btn-xs btn-default btn-edit-program" title="Edit program" href="#"><i class="glyphicon glyphicon-edit"></i></a>
					        <a class="btn btn-xs btn-default btn-delete-program" title="Delete program" href="$otherProg.href"><i class="glyphicon glyphicon-remove"></i></a>
				        </aside>
				        <a href="${otherProg.href}">$otherProg.title</a>
			        </li>
			        #end
			        <li class="clearfix last">
				        <a class="btn-add-program" role="button" href="#"><i class="fa fa-plus fa-white"></i> Add new program</a>
			        </li>
		        </ul>
	        </div><br /><br />

            #if($page.program)
	        <div class="row">
		        <div class="col-md-6">
			        <div class="panel panel-default">
				        <div class="panel-heading">
					        <i class="fa fa-book"></i>
					        Courses
					        <div class="panel-tools">
						        <a href="#" class="btn btn-xs btn-link panel-collapse collapses">
						        </a>
						        <a href="#" class="btn btn-xs btn-link panel-close">
							        <i class="fa fa-times"></i>
						        </a>
					        </div>
				        </div>
				        <div class="panel-body clearfix">
							<ul class="todo courses-list">
								#foreach($course in $program.children.ofType.course)
								<li class="course clearfix">
									<aside class="pull-right">
										<button class="btn btn-xs btn-default btn-move-course" title="Move up or down"><i class="glyphicon glyphicon-sort"></i></button>
										<div class="btn-group">
											<button class="btn btn-xs btn-default btn-edit-course" role="button" href="$org.href">Edit details</button>
											<button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown">
												<span class="caret"></span>
											</button>
											<ul class="dropdown-menu pull-right" role="menu">
												<li><a href="${course.href}?format=pdf" target="_blank">Export to PDF</a></li>
												<li><a href="${course.href}?format=text" target="_blank">Export to text</a></li>
												<li class="divider"></li>
												<li><a class="btn-delete-course" href="${org.href}">Delete this course</a></li>
											</ul>
										</div>
									</aside>
									<a class="todo-actions" href="$course.href"><i class="fa fa-book"></i>$course.name - $course.title</a>
								</li>
								#end
							</ul>
					        <p class="pull-right"><a href="#" role="button" class="btn btn-xs btn-default btn-add-course"><i class="fa fa-plus fa-white"></i> Add new course</a></p>
				        </div>
			        </div>
		        </div>
		        <div class="col-md-6">
			        <div class="panel panel-default">
				        <div class="panel-heading">
					        <i class="fa fa-file-o"></i>
					        Modules
					        <div class="panel-tools">
						        <a href="#" class="btn btn-xs btn-link panel-collapse collapses">
						        </a>
						        <a href="#" class="btn btn-xs btn-link panel-close">
							        <i class="fa fa-times"></i>
						        </a>
					        </div>
				        </div>
				        <div class="panel-body">
							<ul class="todo">
								#set($levels = $page.closest("course").children.ofType.folder.sortByField("order").groupByField("level") )
								<ul>
									#foreach($level in $levels.values())
									#foreach($module in $level)
									<li data-author-notes="$!module.notes" id="$module.name">
										<span>$module.name - $module.title</span>
										<aside>
											<a href="" class="Move" title="Move up or down"><span class="Hidden">Move up or down</span></a>
											<a href="" class="Dialogue DialogueModule" title="Show dialogue menu"><span class="Hidden">Show dialogue menu</span></a>
										</aside>
									</li>
									#end
									<li class="Splitter">
										<span>Level Splitter</span>
										<aside>
											<a href="" class="Move" title="Move up or down"><span class="Hidden">Move up or down</span></a>
											<a href="" class="Dialogue DialogueModule" title="Show dialogue menu"><span class="Hidden">Show dialogue menu</span></a>
										</aside>
									</li>
									#end
								</ul>
							</ul>
				        </div>
			        </div>
		        </div>
	        </div>

            <section class="Content">
                <header>
                    <h3>Courses</h3>
                    <h3>Modules</h3>
                </header>
                <section>
                    <table>
                        <tr>
                            <td>
                                <div class="Course ClearFix">
                                    <ul>
                                        #foreach($course in $program.children.ofType.course)
                                        <li>
                                            <a href="$course.href">$course.name - $course.title</a>
                                            <aside>
                                                <a href="" class="Move" title="Move up or down">Move up or down</a>
                                                <a href="" class="Dialogue DialogueCourse" title="Show dialogue menu">Show dialogue menu</a>
                                            </aside>
                                        </li>
                                        #end
                                    </ul>
                                    <button class="SmallBtn Add NoText AddCourse" title="Add course"><span>Add</span></button>
                                </div>
                            </td>
                            <td id="modulePanel">
                                <div class="Module ClearFix">
                                    #set($levels = $page.closest("course").children.ofType.folder.sortByField("order").groupByField("level") )
                                    <ul>
                                        #foreach($level in $levels.values())
                                        #foreach($module in $level)
                                        <li data-author-notes="$!module.notes" id="$module.name">
                                            <span>$module.name - $module.title</span>
                                            <aside>
                                                <a href="" class="Move" title="Move up or down"><span class="Hidden">Move up or down</span></a>
                                                <a href="" class="Dialogue DialogueModule" title="Show dialogue menu"><span class="Hidden">Show dialogue menu</span></a>
                                            </aside>
                                        </li>
                                        #end
                                        <li class="Splitter">
                                            <span>Level Splitter</span>
                                            <aside>
                                                <a href="" class="Move" title="Move up or down"><span class="Hidden">Move up or down</span></a>
                                                <a href="" class="Dialogue DialogueModule" title="Show dialogue menu"><span class="Hidden">Show dialogue menu</span></a>
                                            </aside>
                                        </li>
                                        #end
                                    </ul>
                                    <button class="SmallBtn Add NoText AddModule" title="Add module"><span>Add</span></button>
                                </div>

                            </td>
                        </tr>
                    </table>
                </section>
            </section>
            #end
        </section>

        <div id="programModal" class="Modal">
            <header>
                <h3>Program Details</h3>
                <a class="Close" href="#" title="Close"><span class="Hidden">Close</span></a>
            </header>
            <div class="ModalContent">
                <form action="${parentOrg.path}/programs/" method="POST">
                    <input type="hidden" value="" name="programName" />
                    <div class="pageMessage">.</div>
                    <table>
                        <tr>
                            <th><label for="name">Enter program name</label></th>
                            <td><input type="text" name="programTitle" id="programTitle" maxlength="30" value="" placeholder="Program name" class="required simpleChars" /></td>
                        </tr>
                        <tr>
                            <th><label for="note">Enter author notes</label></th>
                            <td><textarea name="programNotes" id="programNotes" placeholder="Author notes" maxlength="255" cols="2" rows="2"></textarea></td>
                        </tr>
                        <tr>
                            <td colspan="2" class="Btn">
                                <button>Submit</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>

        <div id="courseModal" class="Modal">
            <header>
                <h3>Course Details</h3>
                <a class="Close" href="#" title="Close"><span class="Hidden">Close</span></a>
            </header>
            <div class="ModalContent">
                <form action="." method="POST">
                    <div class="pageMessage">.</div>
                    <table>
                        <tr>
                            <th><label for="name">Enter course title</label></th>
                            <td><input type="text" name="courseTitle" id="courseTitle" maxlength="30" value="" placeholder="Course name" class="required" /></td>
                        </tr>
                        <tr>
                            <th><label for="note">Enter author notes</label></th>
                            <td><textarea name="courseNotes" id="courseNotes" placeholder="Author notes" maxlength="" cols="2" rows="2"></textarea></td>
                        </tr>
                        <tr>
                            <th><label for="note">Course description</label></th>
                            <td><textarea name="courseDescription" id="courseDescription" placeholder="Displayed to users" maxlength="" cols="4" rows="2"></textarea></td>
                        </tr>
                        <tr>
                            <td colspan="2" class="Btn">
                                <button>Submit</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>

        <div id="moduleModal" class="Modal">
            <header>
                <h3>Module Details</h3>
                <a class="Close" href="#" title="Close"><span class="Hidden">Close</span></a>
            </header>
            <div class="ModalContent">
                <form action="." method="POST">
                    <div class="pageMessage">.</div>
                    <table>
                        <tr>
                            <th><label for="name">Enter module code</label></th>
                            <td><input type="text" name="moduleName" id="moduleName" maxlength="30" value="" placeholder="Module code" class="required" /></td>
                        </tr>
                        <tr>
                            <th><label for="name">Enter module title</label></th>
                            <td><input type="text" name="moduleTitle" id="moduleTitle" maxlength="30" value="" placeholder="Module title" class="required" /></td>
                        </tr>
                        <tr>
                            <th><label for="note">Enter author notes</label></th>
                            <td><textarea name="moduleNotes" id="moduleNotes" placeholder="Author notes" maxlength="255" cols="2" rows="2"></textarea></td>
                        </tr>
                        <tr>
                            <td colspan="2" class="Btn">
                                <button>Submit</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>

        <!--
        <div id="addesProgramNotes" class="Modal">
            <header>
                <h3>Program added</h3>
                <a class="Close" href="#" title="Close"><span class="Hidden">Close</span></a>
            </header>
            <div class="ModalContent">
                <h3>You've created a program, next steps</h3>
                <ul>
                    <li>Create a course (click the + below).</li>
                    <li>Add modules to the course. A module is like a lecture or a class, it should be completable in a single sitting</li>
                    <li>Enrol one or more user groups from the manage groups page <a style="float: right" href="${page.closest('organisation').href}/groups/">Manage groups</a></li>
                </ul>
            </div>
        </div>
        -->

        #set($programs = $page.closest("programs"))
        <script type="text/javascript">
            jQuery(function() {
                initManageCourse("${programs.href}", "$!{program.href}");
            });
        </script>
    </body>
</html>