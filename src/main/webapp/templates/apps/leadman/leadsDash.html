#parse("/theme/apps/leadman/leadManIncludes.html")
<style>
    .infoBox {
        height: 100px;
        padding-bottom: 10px;
    }
    .infoBox h1 {
        margin-top: 0;
    }
    .leadContactMethods a {
        margin-right: 10px;
    }
    .leadActions {
        position: absolute;
        bottom: 0;
        right: 0;
    }
    .leadContactMethods {
        position: absolute;
        bottom: 0;
        left: 20px;
    }
    .lead {
        margin-bottom: 40px;
    }
    .leadInner {
        max-height: 200px;
    }

    @media (max-width: 767px) {
        .infoBox{
            height: 140px;
        }
    }
</style>

#set( $kpis = $page.find("/sales").availableKpis )

<div class="fw-boxed hidden-xs">
    <div class="panel panel-default">
        <div class="row">
            <div class="col-md-4">
                <div class="row text-muted m0">
                    <div data-ripple="" class="col-xs-6 col-md-6 bb br pv-xxl infoBox" >
                        <h1 class="text-strong">$leadsPage.numMyLeads</h1>
                        <div class="text-right text-sm text-muted">Active Leads</div>
                    </div>
                    <div data-ripple="" class="col-xs-6 col-md-6 bb br pv-xxl infoBox" >
                        <h1 class="text-strong">$leadsPage.myDueTasks.size()</h1>
                        <div class="text-right text-sm text-muted">Tasks due</div>
                    </div>
                    <div data-ripple="" class="col-xs-6 col-md-6 bb-lg br pv-xxl infoBox" >
                        <h1 class="text-strong">
                            $ $formatter.formatUnits($leadsPage.myLeadsEstimatedValue)
                        </h1>
                        <div class="text-right text-sm text-muted">Pipeline value</div>
                    </div>
                    <div data-ripple="" class="col-xs-6 col-md-6 bb-lg br pv-xxl infoBox" >
                        #set( $closed = $leadsPage.closedDeals(30) )
                        #if( $closed.value )
                        <h1 class="text-strong">
                            $ $formatter.formatUnits($closed.value)
                        </h1>
                        <div class="text-right text-sm text-muted">$closed.num closed last 30 days</div>
                        #else
                        <h1 class="text-thin">None</h1>
                        <div class="text-right text-sm text-muted">last 30 days</div>
                        #end

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="row">
                    <div class="col-sm-6 col-xs-12">
                        <div class="p">
                            <div class="row row-flush text-center">
                                <div class="col-xs-6">
                                    #set($taskStats = $page.find('/leads/').taskStatus)
                                    <p class="mt-lg">Task completion </p>
                                    <div data-percent="$taskStats.percentage" data-line-width="20" class="easypie"><span>$taskStats.percentage%</span></div>
                                </div>
                                <div class="col-xs-6">
                                    <p class="mt-lg">Conversion rate</p>
                                    <div data-percent="22" data-line-width="20" class="easypie"><span>22</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-xs-12">
                        <div class="p">
                            #foreach( $kpi in $kpis )
                            #set( $color = "danger" )
                            #set( $color = $kpi.progressLevel.levelName )
                            #set( $perc = $kpi.getProgressOfLevelPerc("success") )

                            <span class="pull-right">$formatter.toDecimal($perc,1)%</span>
                            $kpi.title

                            <div class="progress progress-xs">
                                <div style="width: ${perc}%" class="progress-bar progress-bar-${color}"></div>
                            </div>
                            #end
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="">


    <br/>

    <div role="tabpanel" id="all_contacts" class="tab-pane animation-fade active">
        #set( $leads = $leadsPage.myLeads )

        <ul class="list-group leadsList" id="dashLeadsList">
            #foreach($lead in $leads)
            <li class="list-group-item">
                #showLead($lead)
            </li>
            #end
        </ul>
        #if( $leads.size() > 0 )

        #else
        <p class="lead">Couldnt find any leads</p>
        #end
    </div>


</div>


<script src="/static/dotdotdot/1.7.4/jquery.dotdotdot.min.js" type="text/javascript">//</script>
<script type="text/javascript">
    $(function () {
        flog("dotdotdot", $(".leadInner"));
        $(".leadInner").dotdotdot({
            //	configuration goes here
        });

        $('#leadQuery').keyup(function () {
            typewatch(function () {
                flog('do search');
                doLeadSearch($('#leadQuery').val());
            }, 500);
        });

        var pieOptions = {
            animate: {
                duration: 700,
                enabled: true
            },
            barColor: '#2095f2',
            scaleColor: false,
            lineWidth: 10,
            lineCap: 'circle'
        };

        $('.easypie').easyPieChart(pieOptions);

        function doLeadSearch(q) {
            var href = window.location.pathname + "?q=" + q
            $("#leadsBody").reloadFragment({
                url: href,
                whenComplete: function () {
                    window.history.pushState("", href, href);
                    $('abbr.timeago').timeago();
                }
            });
        }
    });
</script>

