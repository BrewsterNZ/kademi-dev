<html xmlns="http://www.w3.org/1999/xhtml">
    #parse("/theme/masterTemplate.html")
    <head>
        #@themeHeader( "View lead" )
        <script src="/static/reload-fragment/1.0.1/jquery.reload-fragment-1.0.1.js" type="text/javascript" >//</script>
        <link rel="stylesheet" href="/static/timeline/timeline.css">
        #end
    </head>
    <body class='add-container'>
        #@themeBody()

        <div class="">
            <div style="background:url(/images/profile.jpg) center center; background-size:cover;" class="unwrap">
                <div class="container container-lg p-lg">
                    <div class="pull-right">

                        <div class="btn-group">
                            <button class="btn btn-primary btn-lg" data-target="#newLeadModal" data-toggle="modal">Create a new lead</button>
                        </div>
                    </div>
                    <div class="media mt-lg">
                        <div class="media-left media-middle"><a href=""><img src="/images/user/02.jpg" class="media-object thumb96 img-circle"></a></div>
                        <div class="media-body text-white">
                            <h2 class="mv-lg media-heading">$page.title</h2>
                        </div>
                    </div>
                    <div class="text-right text-white pb-lg">
                        <p class="m0"><strong>Average lead score 87%</strong></p>
                        <p class="m0"><strong>Total deals value: $50k</strong></p>
                    </div>
                </div>
            </div>
            <div class="container container-lg">
                <div class="row">
                    <div class="col-lg-3">
                        <div class="panel">
                            <div class="panel-body">
                                <h3>John Doe</h3>
                                <p>Designer</p>
                                <p>It is a long established fact that a reader will be distracted.</p>
                            </div>
                        </div>
                        <div class="panel">
                            <div class="panel-body">
                                <h6><span><em class="fa fa-twitter mr"></em>@jdoe</span></h6>
                                <h6><span class="mr"><em class="fa fa-clock-o mr"></em>10:05 PM</span><span class="mr"><em class="fa fa-calendar mr"></em>10/11/15</span><span class="mr"><em class="fa fa-map-marker mr"></em>BA</span></h6>
                                <h6><span><em class="fa fa-eye mr"></em>10 feb at 10:00 AM</span></h6>
                            </div>
                        </div>
                        <div class="panel">
                            <div class="panel-heading no-shadow">Recent contacts</div>
                            <div class="panel-body">
                                <ul class="list-block">
                                    <li class="media">
                                        <div class="pull-left">
                                            <!-- Contact avatar-->
                                            <div class="point-pin"><a href=""><img src="/images/user/05.jpg" alt="Image" class="media-object img-circle thumb32"></a>
                                                <div class="point point-success point-lg"></div>
                                            </div>
                                        </div>
                                        <!-- Contact info-->
                                        <div class="media-body">
                                            <div class="media-heading"><a href="">Juan Sims</a><br><small class="text-muted">Designeer</small></div>
                                        </div>
                                    </li>
                                    <!-- END User status-->
                                    <!-- START User status-->
                                    <li class="media">
                                        <div class="pull-left">
                                            <!-- Contact avatar-->
                                            <div class="point-pin"><a href=""><img src="/images/user/06.jpg" alt="Image" class="media-object img-circle thumb32"></a>
                                                <div class="point point-success point-lg"></div>
                                            </div>
                                        </div>
                                        <!-- Contact info-->
                                        <div class="media-body">
                                            <div class="media-heading"><a href="">Maureen Jenkins</a><br><small class="text-muted">Designeer</small></div>
                                        </div>
                                    </li>
                                    <!-- END User status-->
                                    <!-- START User status-->
                                    <li class="media">
                                        <div class="pull-left">
                                            <!-- Contact avatar-->
                                            <div class="point-pin"><a href=""><img src="images/user/07.jpg" alt="Image" class="media-object img-circle thumb32"></a>
                                                <div class="point point-danger point-lg"></div>
                                            </div>
                                        </div>
                                        <!-- Contact info-->
                                        <div class="media-body">
                                            <div class="media-heading"><a href="">Billie Dunn</a><br><small class="text-muted">Designeer</small></div>
                                        </div>
                                    </li>
                                    <!-- END User status-->
                                    <!-- START User status-->
                                    <li class="media">
                                        <div class="pull-left">
                                            <!-- Contact avatar-->
                                            <div class="point-pin"><a href=""><img src="images/user/08.jpg" alt="Image" class="media-object img-circle thumb32"></a>
                                                <div class="point point-warning point-lg"></div>
                                            </div>
                                        </div>
                                        <!-- Contact info-->
                                        <div class="media-body">
                                            <div class="media-heading"><a href="">Tomothy Roberts</a><br><small class="text-muted">Designer</small></div>
                                        </div>
                                    </li>
                                    <!-- END User status-->
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9">
                        <div class="panel">
                            <div class="panel-body">
                                <ul role="tablist" class="nav nav-tabs">
                                    <li role="presentation" class="active"><a href="#activity" aria-controls="activity" role="tab" data-toggle="tab">Activity</a></li>
                                    <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Profile</a></li>
                                    <li role="presentation"><a href="#tasks" aria-controls="tasks" role="tab" data-toggle="tab">Tasks</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div id="activity" role="tabpanel" class="tab-pane fade in active">
                                        <div class="row">
                                            <div class="container">
                                                <div class="page-header">
                                                    <h1 id="timeline">Timeline</h1>
                                                </div>
                                                <ul class="timeline">
                                                    #set( $month = "" )
                                                    #set( $lastMonth = "" )
                                                    #foreach( $action in $page.timelineItems )
                                                    #set( $month = $formatter.getMonthName($action.actionDate) )
                                                    #if( $month != $lastMonth )
                                                    <li class="tldateLi"><div class="tldate"><span>$month $formatter.getYear($action.actionDate)</span></div></li>
                                                    #end
                                                    #set( $lastMonth = $month )
                                                    <li class="$formatter.ifTrue($action.inbound, '', 'timeline-inverted')">
                                                        <div class="timeline-badge $action.category"><i class="fa $action.itemType"></i></div>
                                                        <div class="timeline-panel">
                                                            <div class="timeline-heading">
                                                                #if( $action.actionDate)
                                                                <small class="text-muted pull-right"><i class="glyphicon glyphicon-time"></i> <abbr title="$formatter.formatDateISO8601($action.actionDate)" class="info timeago">$action.actionDate</abbr></small>
                                                                #end
                                                                <h4 class="timeline-title">$action.itemTitle</h4>
                                                            </div>
                                                            <div class="timeline-body">
                                                                <p>$action.actionDesc</p>
                                                                #if($action.path)
                                                                <p>
                                                                    <a href="$action.path" class="btn btn-sm btn-info pull-right">
                                                                        View <i class="fa fa-arrow-circle-right"></i>
                                                                    </a>
                                                                </p>
                                                                #end
                                                            </div>
                                                        </div>
                                                    </li>
                                                    #end

                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="profile" role="tabpanel" class="tab-pane fade">
                                        <h4 class="page-header">Contact information</h4>
                                        <div class="row">
                                            <form method="post" action="$page.href" class="form-horizontal" id="leadDetails">
                                                <div class="modal-body">
                                                    #set( $p = $page.leadProfile )
                                                    <div class="form-group">
                                                        <label class="control-label col-md-2" for="nickName">Customer</label>
                                                        <div class="col-md-3">
                                                            <input type="text" name="nickName" id="nickName" class="form-control" placeholder="nickName" value="$!p.nickName" />
                                                        </div>
                                                        <div class="col-md-3">
                                                            <input type="text" name="firstName" id="firstName" class="form-control" placeholder="First name" value="$!p.firstName" />
                                                        </div>
                                                        <div class="col-md-4">
                                                            <input type="text" name="surName" id="surName" class="form-control" placeholder="Surname" value="$!p.surName" />
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2" for="newUserEmail">Contact</label>
                                                        <div class="col-md-5">
                                                            <input type="text" name="email" id="email" class="form-control" placeholder="Email" value="$!p.email" />
                                                        </div>
                                                        <div class="col-md-5">
                                                            <input type="text" name="phone" id="phone" class="form-control" placeholder="Phone" value="$!p.phone" />
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2" for="notes">Notes</label>
                                                        <div class="col-md-10">
                                                            <textarea name="notes" class="form-control" style="height: 100px">$!page.description</textarea>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="control-label col-md-2" for="notes">Deal amount</label>
                                                        <div class="col-md-5">
                                                            <input name="dealAmount" class="form-control" value="$!page.dealAmount"/>
                                                            <i>Enter the estimated value of this deal</i>
                                                        </div>

                                                    </div>

                                                    #if( $page.completed)
                                                    #else
                                                    <div class="form-group">
                                                        <div class="col-md-10 col-md-offset-10">
                                                            <button class="btn btn-sm btn-default" type="reset">Reset</button>

                                                            <button class="btn btn-primary" type="submit">Save details</button>

                                                        </div>
                                                    </div>
                                                    #end
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    <div id="tasks" role="tabpanel" class="tab-pane fade">
                                        <div class="task-item-list">
                                            <div id="accordion" role="tablist" aria-multiselectable="true" class="panel-group">
                                                <div class="panel panel-default">
                                                    #foreach($task in $page.children)
                                                    <div id="headingOne" role="tab" class="panel-heading">
                                                        <h4 class="panel-title clearfix task-item">
                                                            <div class="pull-left"><span class="inline checkbox c-checkbox">
                                                                    <label>
                                                                        <input type="checkbox"><span class="fa fa-check"></span>
                                                                    </label></span></div>
                                                            <div class="pull-left">
                                                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                                                    <span class="task-title">$task.title</span>
                                                                </a>
                                                            </div>
                                                            <div class="pull-left"><span class="task-edit fa fa-pencil"></span></div>
                                                            <div class="pull-right"><span class="close"><em class="fa fa-times"></em></span></div>
                                                        </h4>
                                                    </div>
                                                    <div id="collapseOne" role="tabpanel" aria-labelledby="headingOne" class="panel-collapse collapse in">
                                                        <div class="panel-body">
                                                            #if( $task.is("open") )
                                                            <div class="btn-group pull-right">
                                                                <button class="btn btn-danger btn-lg" title="Cancel task">
                                                                    <span class="fa fa-remove"></span>
                                                                </button>
                                                                #if( $task.reminders.size() > 0 )
                                                                <div>
                                                                    <span class="fa fa-bell"></span>
                                                                </div>
                                                                #end
                                                                <button class="btn btn-success btn-lg" title="Mark task as completed">
                                                                    <span class="fa fa-check"></span>
                                                                </button>
                                                            </div>
                                                            #end
                                                            Due in <abbr title="$formatter.formatDateISO8601($task.dueDate)" class="timeago">$task.dueDate</abbr>
                                                            -
                                                            $task.taskDescription
                                                        </div>
                                                    </div>
                                                    #end
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="fw-boxed">
            <div class="panel panel-default">

            </div>
        </div>


        <hr/>



        <div class="modal fade" id="newTaskModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="">Create a task</h4>
                    </div>
                    <form method="post" action="$page.href" class="form-horizontal">
                        <div class="modal-body">

                            <div class="form-group">
                                <label class="control-label col-md-3" for="dueDate">dueDate</label>
                                <div class="col-md-9">
                                    <input type="text" name="dueDate" id="dueDate" class="required form-control" placeholder="dueDate" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-3" for="taskDescription">taskDescription</label>
                                <div class="col-md-9">
                                    <input type="text" name="taskDescription" id="taskDescription" class="required form-control" placeholder="taskDescription" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-3" for="taskDescription">Reminder</label>
                                <div class="col-md-9">
                                    <select name="reminderDays">
                                        <option value="">No reminder</option>
                                        <option value="0">On the due date</option>
                                        <option value="-1">Day earlier</option>
                                        <option value="-7">Week earlier</option>
                                        <option value="1">Day after</option>
                                        <option value="7">Week after</option>
                                    </select>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-sm btn-default" data-dismiss="modal" type="button">Close</button>

                            <button class="btn btn-primary" type="submit">Create and view</button>
                        </div>
                    </form>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>

        <div class="modal fade" id="closeDealModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="">Deal closed successfully</h4>
                    </div>
                    <form method="post" action="$page.href" class="form-horizontal">
                        <input type="hidden" name="closeDeal"/>
                        <div class="modal-body">

                            <div class="form-group">
                                <label class="control-label col-md-3" for="closedDate">Closed Date</label>
                                <div class="col-md-9">
                                    <input type="text" name="closedDate" id="closedDate" class="required form-control" placeholder="closedDate" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-3" for="dealAmount">Sale amount</label>
                                <div class="col-md-9">
                                    <input type="text" name="dealAmount" id="dealAmount" class="required form-control" placeholder="dealAmount" />
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal" type="button">Exit</button>

                            <button class="btn btn-success" type="submit">Mark deal as closed</button>
                        </div>
                    </form>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>

        <div class="modal fade" id="cancelDealModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="">Deal closed successfully</h4>
                    </div>
                    <form method="post" action="$page.href" class="form-horizontal">
                        <input type="hidden" name="closeDeal"/>
                        <div class="modal-body">
                            <p>Cancel this lead if you are sure it will not go ahead. The lead will be marked as closed without a sale.</p>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal" type="button">Exit</button>

                            <button class="btn btn-primary" type="submit">Cancel this lead</button>
                        </div>
                    </form>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>

        <script type="text/javascript">
            $(function () {
                var form = $("#leadDetails");
                $('abbr.timeago').timeago();
                form.forms({
                    callback: function (resp) {
                        Msg.info('Saved');
                        reloadTable();
                    }
                });
                var closeDealModal = $("#closeDealModal");
                closeDealModal.find("form").forms({
                    callback: function (resp) {
                        Msg.info('Deal marked as closed');
                        //window.location.reload();
                    }
                });
                var cancelDealModal = $("#cancelDealModal");
                cancelDealModal.find("form").forms({
                    callback: function (resp) {
                        Msg.info('Lead cancelled');
                        //window.location.reload();
                    }
                });
                $("#assignToMenu").on("click", "a", function (e) {
                    e.preventDefault();
                    var name = $(e.target).attr("href");
                    assignTo(name);
                });
            });
            function reloadTable() {
                $("#tasksTableBody").reloadFragment({
                    whenComplete: function () {
                        $('abbr.timeago').timeago();
                    }
                });
            }

            function assignTo(name) {
                $.ajax({
                    type: 'POST',
                    url: window.location.pathname,
                    data: {
                        assignToName: name
                    },
                    dataType: 'json',
                    success: function (resp) {
                        if (resp && resp.status) {
                            Msg.info("Assigned");
                            $("#assignedBlock").reloadFragment();
                        } else {
                            Msg.error("Sorry, we couldnt change the assignment");
                        }
                    },
                    error: function (resp) {
                        flog('error', resp);
                        Msg.error('Sorry couldnt set the visibility ' + resp);
                    }
                });
            }
        </script>
        #end
    </body>
</html>