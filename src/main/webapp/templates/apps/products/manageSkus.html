<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Inventory Management</title>
    </head>
    <body>
        <p>
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-sm btn-success newLocation" data-toggle="modal" data-target="#addLocationModal"><i class="fa fa-plus"></i> Product</button>
            </div>
            <button type="button" class="btn btn-sm btn-danger deleteLocation pull-right"><i class="glyphicon glyphicon-trash"></i> Delete</button>
        </p>

        <div class="panel panel-default">
            <div id="productsTableContainer" class="panel-body">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Title</th>
                            #foreach( $pp in $page.allProductParams)
                            <th>$pp</th>
                            #end
                            <th>SKU</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        #foreach($product in $page.products)
                        #foreach($variant in $page.variants($product))
                        <tr>
                            <td><a href="/products/$product.id">$product.title</a></td>
                            #foreach( $pp in $page.allProductParams)
                            <th>$!variant.value($pp)</th>
                            #end
                            <td>
                                <input class="input-sku" type="text" data-product="$product.id" data-options="$variant.options" value="$!variant.sku" />
                            </td>
                        </tr>
                        #end
                        #end
                    </tbody>
                </table>
            </div>
        </div>


        <script type="text/javascript">
            $(function () {
                $("#productsTableBody").on("change", ".input-sku", function (e) {
                    var target = $(e.target);
                    var newSku = target.val();
                    var productId = target.data("product");
                    var options = target.data("options");
                    updateSku(productId, options, newSku);
                });
            });
            function updateSku(productId, options, newSku) {
                $.ajax({
                    type: 'POST',
                    url: window.href,
                    data: {
                        productId : productId,
                        options : options,
                        sku : newSku
                    },
                    dataType: "json",
                    success: function (resp) {
                        Msg.info("updated");
                    },
                    error: function (resp) {
                        Msg.error("An error occured setting the SKU");
                    }
                });
            }
        </script>
    </body>
</html>
