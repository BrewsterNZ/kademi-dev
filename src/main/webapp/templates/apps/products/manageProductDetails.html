<html xmlns="http://www.w3.org/1999/xhtml">    <head>        <title>Manage Products</title>        <style>            .delete-image {                position: absolute;                top: 10px;                right: 25px;            }            .image-selected {                position: absolute;                top: 10px;                right: 25px;                display: block !important;            }        </style>    </head>    <body class="">        #portlets("beforeManageProductDetails")        <div class="tabbable">            <ul class="nav nav-tabs tab-bricky" id="myTab">                <li role="presentation" class="active"><a data-toggle="tab" href="#panel_details"><i class="green fa fa-home"></i> Details</a></li>                <li role="presentation"><a data-toggle="tab" href="#variants"><i class="green fa fa-list"></i> Variants</a></li>            </ul>            <div class="tab-content">                <div id="panel_details" class="tab-pane active">                    <form action="." method="POST" enctype="multipart/form-data" class="updateProduct form-horizontal" role="form">                        <input type="hidden" name="action" value="update"/>                        <div class="form-group">                            <div class="errorHandler alert alert-danger no-display pageMessage">.</div>                        </div>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="name">Name/Code</label>                            <div class="col-sm-6">                                <input type="text" class="form-control required" id="productName" name="name" value="$page.product.name" />                            </div>                            <div class="col-sm-4">                                <button type="submit" class="btn btn-lg btn-success pull-right">                                    <span class="fa fa-save"></span>                                    Save                                </button>                            </div>                        </div>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="title">Title</label>                            <div class="col-sm-10 col-lg-4">                                <input type="text" class="form-control required" name="title" value="$page.product.title"/>                            </div>                            <label class="col-sm-2 control-label" for="supplier">Supplier</label>                            <div class="col-sm-10 col-lg-4">                                <select class="form-control" name="supplier">                                    <option value=""></option>                                    $formatter.option($page.organisation.orgId, $page.organisation.formattedName, $page.product.supplier.orgId)                                    #foreach($childOrg in $page.organisation.childOrgs)                                    #if(!$childOrg.deleted)                                    $formatter.option($childOrg.orgId, $childOrg.formattedName, $page.product.supplier.orgId)                                    #end                                    #end                                </select>                            </div>                        </div>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="baseCost">Base Cost</label>                            <div class="col-sm-4">                                <input type="text" class="form-control" name="baseCost" value="$!page.product.baseCost"/>                            </div>                            <label class="col-sm-2 control-label" for="baseCost">Freight Cost</label>                            <div class="col-sm-4">                                <input type="text" class="form-control" name="freightCost" value="$!page.product.freightCost"/>                            </div>                        </div>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="notes">Product Details</label>                            <div class="col-sm-9">                                <textarea id="notes" name="notes" class="htmleditor" cols="100" rows="5">$!page.product.notes</textarea>                                #portlets("insideManageProductDetails")                            </div>                        </div>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="canOrderChk">Related Item</label>                            <div class="col-sm-9">                                <select class="form-control" name="relatedAppId" id="relatedAppIdSelect">                                    <option value="">[No related item]</option>                                    #foreach($app in $page.relatedProductApps)                                    $formatter.option($app.instanceId, $page.appTitle($app), $page.relatedAppId)                                    #end                                </select>                                <span class="text-muted">If this product relates to another item, like a calendar event, select the app which provides it</span>                            </div>                        </div>                        <div id="relatedAppWrap">                            #if( $page.relatedAppId )                            $page.renderRelatedItem                            #end                        </div>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="canOrderChk">Allow Ordering?</label>                            <div class="col-sm-9">                                <div class="checkbox">                                    <label>                                        $formatter.checkbox("canOrderChk", "canOrder", $page.product.canOrder)                                        If ticked users will be given ordering options                                        <br/>                                        <span class="text-warning">Deprecated - use the e-commerce app instead</span>                                    </label>                                </div>                            </div>                        </div>                        <div class="ordering">                            <h4 class="title">Order Form</h4>                            <hr />                            <div class="form-group">                                <label class="col-sm-2 control-label" for="orderForm">Order Form</label>                                <div class="col-sm-9">                                    <textarea class="form-control" name="orderForm">$!{page.orderFormHtml}</textarea>                                    <i>Enter the form html above</i>                                </div>                            </div>                            <div class="form-group">                                <label class="col-sm-2 control-label" for="orderColumns">CSV Columns</label>                                <div class="col-sm-9">                                    <input type="text" name="orderColumns" id="orderColumns" class="form-control" value="$!page.product.orderColumns"/>                                </div>                            </div>                            <div class="form-group">                                <label class="col-sm-2 control-label" for="canOrderQuantityChk">Quantity?</label>                                <div class="col-sm-9">                                    <div class="checkbox">                                        <label>                                            $formatter.checkbox("canOrderQuantityChk", "canOrderQuantity", $page.product.canOrderQuantity)                                            If ticked users will be prompted for a quantity when ordering                                        </label>                                    </div>                                </div>                            </div>                        </div>                        <div class="form-group">                            <div class="col-sm-offset-2 col-sm-9">                                <button type="submit" class="btn btn-lg btn-success">                                    <span class="fa fa-save"></span>                                    Save product                                </button>                            </div>                        </div>                    </form>                    <hr/>                    <div class="panel panel-default">                        <div class="panel-heading">                            <i class="clip-pictures"></i>Product images                        </div>                        <div class="panel-body">                            <div class="row">                                <div class="col-xs-4 col-md-2">                                    <button id="btn-change-ava" class="btn btn-success">Add image</button>                                </div>                                <div id="product-images">                                    #foreach($href in $page.imageHrefs)                                    <div class="col-xs-6 col-md-3 product-image-thumb">                                        <a href="$href" target="_blank" class="thumbnail"><img src="$href/alt-150-150.png"/></a>                                        <a class="delete-image btn btn-xs btn-danger" href="$href">                                            <span class="fa fa-times"></span>                                        </a>                                    </div>                                    #end                                </div>                            </div>                        </div>                    </div>                    <hr/>                    #portlets("afterManageProductDetails")                </div>                <div id="variants" class="tab-pane">                    <button class="btn btn-success add-variant-type">Add variant type</button>                    <hr/>                    <div id="variantsList">                        #foreach($pp in $page.productParameters)                        <div class="panel panel-default product-parameter" data-product-parameter-id="$pp.id">                            <div class="panel-heading">                                <i class="clip-pictures"></i>$pp.title                            </div>                            <div class="panel-body">                                <div class="row">                                    <a href="pp-$pp.id" title="$pp.title" class="btn btn-danger btn-delete-variant-type pull-right" style="margin-right: 15px">                                        <span class="glyphicon glyphicon-remove-circle"></span>                                        Delete                                    </a>                                    <div class="col-xs-4 col-md-2">                                        <button class="btn btn-success btn-add-variant">                                            <span class="glyphicon glyphicon-plus-sign"></span>                                            Add variant                                        </button>                                    </div>                                    <div class="col-xs-4 col-md-2">                                    </div>                                </div>                                <table class="table table-striped">                                    <colgroup>                                        <col width="100px"/>                                        <col/>                                        <col/>                                        <col/>                                        <col style="width: 100px"/>                                    </colgroup>                                    <thead>                                        <tr>                                            <th>Image</th>                                            <th>Name</th>                                            <th>Title</th>                                            <th>Cost</th>                                            <th></th>                                        </tr>                                    </thead>                                    <tbody id="product-variants-body">                                        #foreach($opt in $pp.parameterOptions)                                        <tr>                                            <td>                                                #if($opt.imageHash)                                                <div class="col-md-12 product-image-thumb">                                                    <a data-optid="$opt.id" href="/_hashes/files/$opt.imageHash"  class="thumbnail image-change">                                                        <img src="/_hashes/files/$opt.imageHash/alt-150-150.png" class="responsive" style="max-height: 80px; max-width: 80px;"/>                                                    </a>                                                </div>                                                <button data-optid="$opt.id" class="btn btn-xs btn-warning btn-option-img-del"><i class="fa fa-trash"></i> Remove Image</button>                                                #else                                                <div class="btn-group btn-group-sm">                                                    <button type="button" title="Select Image" data-optid="$opt.id" class="btn btn-success btn-option-img"><i class="fa fa-image"></i></button>                                                    <button type="button" title="Upload Image" data-optid="$opt.id" class="btn btn-success btn-option-img-upload"><i class="fa fa-upload"></i></button>                                                </div>                                                #end                                            </td>                                            <td class="variant-name">$opt.name</td>                                            <td class="variant-title">$opt.title</td>                                            <td class="variant-cost">$!opt.cost</td>                                            <td>                                                <a class="btn btn-default btn-edit-variant" type="button" href="$opt.id">                                                    <span class="fa fa-cog"></span>                                                </a>                                                <a title="$opt.title" class="btn btn-danger btn-delete-variant" type="button" href="pp-${pp.id}/$opt.id">                                                    <span class="glyphicon glyphicon-remove-circle"></span>                                                </a>                                            </td>                                        </tr>                                        #end                                    </tbody>                                </table>                            </div>                        </div>                        #end                    </div>                </div>            </div>        </div>        <div id="modal-product-option" class="modal modal-sm fade" aria-hidden="true" tabindex="-1">            <form method="POST" class="form-horizontal" action="$page.href">                <div class="modal-header">                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>                    <h4 class="modal-title">Product option</h4>                </div>                <div class="modal-body">                    <input type="hidden" name="productParameterId"/>                    <input type="hidden" name="productOptionId"/>                    <div class="form-group">                        <label class="control-label col-md-3">Code</label>                        <div class="col-md-9">                            <input type="text" name="name" class="simpleChars required form-control" />                        </div>                    </div>                    <div class="form-group">                        <label class="control-label col-md-3">Title</label>                        <div class="col-md-9">                            <input type="text" name="title" class="required form-control" />                        </div>                    </div>                    <div class="form-group">                        <label class="control-label col-md-3">Cost</label>                        <div class="col-md-9">                            <input type="text" name="cost" class="numeric form-control" />                        </div>                    </div>                </div>                <div class="modal-footer">                    <button class="btn btn-sm btn-default" data-dismiss="modal" type="button">Close</button>                    <button class="btn btn-sm btn-success" type="submit">Save</button>                </div>            </form>        </div>        <div id="modal-option-img" class="modal modal-sm fade" aria-hidden="true" tabindex="-1">            <form method="POST" class="form-horizontal" action="$page.href">                <div class="modal-header">                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>                    <h4 class="modal-title">Option Image</h4>                </div>                <div class="modal-body">                    <input type="hidden" name="productOptionImgUrl"/>                    <input type="hidden" name="productOptionId"/>                    <div class="form-group">                        #foreach($href in $page.imageHrefs)                        <div class="col-xs-6 col-md-3 product-image-thumb">                            <a href="$href" class="thumbnail select-opt-img"><img src="$href/alt-150-150.png"/></a>                            <a class="btn-image-selected btn btn-xs btn-success" style="display: none;" href="$href">                                <span class="fa fa-check"></span>                            </a>                        </div>                        #end                    </div>                </div>                <div class="modal-footer">                    <button class="btn btn-sm btn-default" data-dismiss="modal" type="button">Close</button>                    <button class="btn btn-sm btn-success" type="submit">Save</button>                </div>            </form>        </div>        <script type="text/javascript" src="/static/bootstrap-upcrop-image/1.0/bootstrap-upcrop-image.js">//</script>        <script type="text/javascript" src="/static/js/jquery.milton-upload.js"></script>        <script type="text/javascript" src="/theme/apps/products/manageProductDetails.js"></script>        <script type="text/javascript">            $(function () {                initProductDetails();                $(document).on('change', '#relatedAppIdSelect', function (e) {                    $('form.updateProduct').trigger('submit');                });                $(document).on('change', '[name=relatedItemId]', function (e) {                    $('form.updateProduct').trigger('submit');                });                $("body").on("click", ".btn-delete-variant-type", function (e) {                    e.preventDefault();                    var id = $(this).attr("href");                    var name = $(this).attr("title");                    confirmDelete(id, name, function () {                        Msg.success('Variant type deleted');                        reloadVariantList();                    });                });                $("body").on("click", ".btn-delete-variant", function (e) {                    e.preventDefault();                    var id = $(this).attr("href");                    var name = $(this).attr("title");                    confirmDelete(id, name, function () {                        Msg.success('Variant deleted');                        reloadVariantList();                    });                });                $('body').on('click', '.btn-option-img', function (e) {                    e.preventDefault();                    var btn = $(this);                    var optid = btn.data('optid');                    $('#modal-option-img').find('input[name=productOptionId]').val(optid);                    $('#modal-option-img').modal('show');                });                $('body').on('click', '.select-opt-img', function (e) {                    e.preventDefault();                    $('#modal-option-img').find('.btn-image-selected ').removeClass('image-selected');                    var img = $(this);                    img.closest('div').find('.btn-image-selected ').addClass('image-selected');                    var href = img.attr('href');                    var form = img.closest('form');                    form.find('input[name=productOptionImgUrl]').val(href);                });                $('body').on('click', '.image-change', function (e) {                    e.preventDefault();                    var btn = $(this);                    var optid = btn.data('optid');                    $('#modal-option-img').find('input[name=productOptionId]').val(optid);                    $('#modal-option-img').modal('show');                });                $('#modal-option-img').find('form').forms({                    callback: function (resp) {                        $('#modal-option-img').modal('hide');                        reloadVariantList();                    }                });                $('body').on('hidden.bs.modal', '#modal-option-img', function () {                    $('#modal-option-img').find('input[name=productOptionId]').val(null);                    $('#modal-option-img').find('.btn-image-selected ').removeClass('image-selected');                });            });        </script>    </body></html>