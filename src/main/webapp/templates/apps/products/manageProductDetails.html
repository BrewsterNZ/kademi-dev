<html xmlns="http://www.w3.org/1999/xhtml">    <head>        <title>Manage Products</title>        <style>            .delete-image {                position: absolute;                top: 10px;                right: 25px;            }            .image-selected {                position: absolute;                top: 10px;                right: 25px;                display: block !important;            }        </style>    </head>    <body class="">        #portlets("beforeManageProductDetails")                <div>            <span class="label label-info pull-right">$page.numOrders orders</span>            <h2>$page.product.title</h2>        </div>        <div class="categories-wrapper" id="categoriesContainer">            <div class="dropdown pull-left" style="margin-right: 15px">                <a data-toggle="dropdown" class="dropdown-toggle" href="#" style="text-decoration: none;">                    <i class="clip-plus-circle fa-2x"></i>                </a>                <ul class="dropdown-menu">                    <li class="dropdown-header"><strong>Quick add</strong></li>                    #genCategories($page.categoryBeans)                </ul>            </div>                        #macro(genCategories $categories)                #foreach($cat in $categories)                    #set( $size = $cat.childCategories.size())                    <li class="addCategory">                        <a href="$cat.name">                            $formatter.firstNotNull("$formatter.padWith('-', '', $cat.level) $cat.title", "$formatter.padWith('-', '', $cat.level) $cat.name")                        </a>                    </li>                    #if( $size > 0 )                        #genCategories($cat.childCategories)                    #end                #end            #end                        <div id="product-category" class="blocks-wrapper">                #set( $cats = $page.categories )                #if( $cats.size() > 0 )                    #foreach($cat in $page.categories)                        #showCategoryTag( $cat, "info" )                    #end                #else                    <span class='label label-warning'>This product is not in any categories</span>                #end            </div>            <div style="clear: both"></div>        </div>        <div style="clear: both"></div>        <div class="tabbable">            <ul class="nav nav-tabs tab-bricky" id="myTab">                <li role="presentation" class="active"><a data-toggle="tab" href="#panel_details"><i class="green fa fa-home"></i> Details</a></li>                <li role="presentation"><a data-toggle="tab" href="#panel-brief"><i class="green fa fa-edit"></i> Brief</a></li>                <li role="presentation"><a data-toggle="tab" href="#panel-content"><i class="green fa fa-edit"></i> Content</a></li>                <li role="presentation"><a data-toggle="tab" href="#variants"><i class="green fa fa-list"></i> Ordering options</a></li>            </ul>            <div class="tab-content">                <div id="panel_details" class="tab-pane active">                    <form action="." method="POST" enctype="multipart/form-data" class="updateProduct form-horizontal" role="form" data-source-type="Product" data-source-id="$page.name">                        <input type="hidden" name="action" value="update" />                        <div class="form-group">                            <div class="errorHandler alert alert-danger no-display pageMessage">.</div>                        </div>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="title">Title</label>                            <div class="col-sm-10 col-lg-4">                                <input type="text" class="form-control required translatable" name="title" data-source-field="title" value="$page.translate('title')" />                            </div>                            <div class="col-sm-6">                                <button type="submit" class="btn btn-lg btn-success pull-right">                                    <span class="fa fa-save"></span>                                    Save                                </button>                            </div>                        </div>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="name">Product Code</label>                            <div class="col-sm-4">                                <input type="text" class="form-control required" id="productName" name="name" value="$page.product.name" />                                <i>This identifies the product itself. Use SKU's to identify each variant</i>                            </div>                            <label class="col-sm-2 control-label" for="supplier">Supplier</label>                            <div class="col-sm-10 col-lg-4">                                <select class="form-control" name="supplier">                                    <option value=""></option>                                    $formatter.option($page.organisation.orgId, $page.organisation.formattedName, $page.product.supplier.orgId)                                    #foreach($childOrg in $page.supplierOrgs)                                        $formatter.option($childOrg.orgId, $childOrg.formattedName, $page.product.supplier.orgId)                                    #end                                </select>                            </div>                        </div>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="webName">Web Name</label>                            <div class="col-sm-10 col-lg-4">                                <input type="text" class="form-control simpleChars" data-orig="$!page.product.webName" name="webName" value="$!page.product.webName" />                                <small>                                    Optional. Enter a name for the product which will form part of its address. This is good for SEO                                    <br />                                    Example: gundam-001. Link on website will be /products/gundam-001 instead of /products/123123. SEO purpose only                                </small>                            </div>                        </div>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="baseCost">Base Cost</label>                            <div class="col-sm-4">                                <input type="text" class="form-control" name="baseCost" value="$!page.product.baseCost" />                            </div>                            <label class="col-sm-2 control-label" for="baseCost">Freight Cost</label>                            <div class="col-sm-4">                                <input type="text" class="form-control" name="freightCost" value="$!page.product.freightCost" />                            </div>                        </div>                        <hr/>                        <div class="form-group">                            <label class="col-sm-2 control-label" for="canOrderChk">Related Item</label>                            <div class="col-sm-4">                                <select class="form-control" name="relatedAppId" id="relatedAppIdSelect">                                    <option value="">[No related item]</option>                                    #foreach($app in $page.relatedProductApps)                                        $formatter.option($app.instanceId, $page.appTitle($app), $page.relatedAppId)                                    #end                                </select>                                <span class="text-muted">If this product relates to another item, like a calendar event, select the app which provides it</span>                            </div>                        </div>                        <div id="relatedAppWrap">                            #if( $page.relatedAppId )                            $page.renderRelatedItem                            #end                        </div>                        <div class="form-group">                            <div class="col-sm-offset-2 col-sm-9">                                <button type="submit" class="btn btn-lg btn-success">                                    <span class="fa fa-save"></span>                                    Save product                                </button>                            </div>                        </div>                    </form>                    <hr />                    <div class="panel panel-default">                        <div class="panel-heading">                            <i class="clip-pictures"></i>Product images                        </div>                        <div class="panel-body">                            <div class="row">                                <div class="col-xs-4 col-md-2">                                    <button id="btn-change-ava" class="btn btn-success">Add image</button>                                </div>                                <div id="product-images">                                    #foreach($href in $page.imageHrefs)                                        <div class="col-xs-6 col-md-3 product-image-thumb">                                            <a href="$href" target="_blank" class="thumbnail"><img src="$href/alt-150-150.png" /></a>                                            <a class="delete-image btn btn-xs btn-danger" href="$href">                                                <span class="fa fa-times"></span>                                            </a>                                        </div>                                    #end                                </div>                            </div>                        </div>                    </div>                    <hr />                    #portlets("afterManageProductDetails")                </div>                #set ($productsRepo = $page.find("/repositories/products").live.href)                <div id="panel-brief" class="tab-pane">                    #set( $editor = $page.editor )                    #set( $editorClass = 'contenteditor')                    #if ($editor == 'html')                        #set( $editorClass = 'htmleditor')                    #end                    <form action="." method="POST" enctype="multipart/form-data" class="updateProductBrief form-horizontal" role="form">                        <p class="text-right">                            <button type="submit" class="btn btn-sm btn-success">Save brief</button>                        </p>                        <input type="hidden" name="action" value="update" />                        <div class="form-group">                            <label class="col-sm-12" for="brief">Brief</label>                            <div class="col-sm-12 editor-wrapper">                                <textarea id="brief" name="brief" data-base-path="$!productsRepo" data-page-path="$!productsRepo" class="$editorClass" cols="100" rows="5" autocomplete="off">$!page.product.brief</textarea>                                #portlets("insideManageProductDetails")                            </div>                        </div>                    </form>                </div>                <div id="panel-content" class="tab-pane">                    #set( $editor = $page.editor )                    #set( $editorClass = 'contenteditor')                    #if ($editor == 'html')                        #set( $editorClass = 'htmleditor')                    #end                    <form action="." method="POST" enctype="multipart/form-data" class="updateProductContent form-horizontal" role="form">                        <p class="text-right">                            <button type="submit" class="btn btn-sm btn-success">Save content</button>                        </p>                        <input type="hidden" name="action" value="update" />                        <div class="form-group">                            <label class="col-sm-12" for="notes">Content</label>                            <div class="col-sm-12 editor-wrapper">                                <textarea id="notes" name="notes" data-base-path="$!productsRepo" data-page-path="$!productsRepo" class="$editorClass" cols="100" rows="5" autocomplete="off">$!page.product.notes</textarea>                                #portlets("insideManageProductDetails")                            </div>                        </div>                    </form>                </div>                <div id="variants" class="tab-pane">                    <button class="btn btn-success add-variant-type">Add variant type</button>                    <button class="btn btn-success add-field">Add field</button>                    <hr />                    <div id="variantsList">                        #foreach($pp in $page.productParameters)                            <div class="panel panel-default product-parameter" data-product-parameter-id="$pp.id">                                <div class="panel-heading">                                    <i class="clip-pictures"></i>$pp.title                                </div>                                <div class="panel-body">                                    <div class="row">                                        <a href="pp-$pp.id" title="$pp.title" class="btn btn-danger btn-delete-variant-type pull-right" style="margin-right: 15px">                                            <span class="glyphicon glyphicon-remove-circle"></span>                                            Delete                                        </a>                                        <div class="col-xs-4 col-md-2">                                            <button class="btn btn-success btn-add-variant">                                                <span class="glyphicon glyphicon-plus-sign"></span>                                                Add variant                                            </button>                                        </div>                                        <div class="col-xs-4 col-md-2">                                        </div>                                    </div>                                    <table class="table table-striped">                                        <colgroup>                                            <col width="100px" />                                            <col />                                            <col />                                            <col />                                            <col style="width: 100px" />                                        </colgroup>                                        <thead>                                            <tr>                                                <th>Image</th>                                                <th>Name</th>                                                <th>Title</th>                                                <th>Cost</th>                                                <th></th>                                            </tr>                                        </thead>                                        <tbody id="product-variants-body">                                            #foreach($opt in $pp.parameterOptions)                                                <tr>                                                    <td>                                                        #if($opt.imageHash)                                                            <div class="col-md-12 product-image-thumb">                                                                <a data-optid="$opt.id" href="/_hashes/files/$opt.imageHash" class="thumbnail image-change">                                                                    <img src="/_hashes/files/$opt.imageHash/alt-150-150.png" class="responsive" style="max-height: 80px; max-width: 80px;" />                                                                </a>                                                            </div>                                                            <button data-optid="$opt.id" class="btn btn-xs btn-warning btn-option-img-del"><i class="fa fa-trash"></i> Remove Image                                                            </button>                                                        #else                                                            <div class="btn-group btn-group-sm">                                                                <button type="button" title="Select Image" data-optid="$opt.id" class="btn btn-success btn-option-img">                                                                    <i class="fa fa-image"></i></button>                                                                <button type="button" title="Upload Image" data-optid="$opt.id" class="btn btn-success btn-option-img-upload">                                                                    <i class="fa fa-upload"></i></button>                                                            </div>                                                        #end                                                    </td>                                                    <td class="variant-name">$opt.name</td>                                                    <td class="variant-title">$opt.title</td>                                                    <td class="variant-cost">$!opt.cost</td>                                                    <td>                                                        <a class="btn btn-default btn-edit-variant" type="button" href="$opt.id">                                                            <span class="fa fa-cog"></span>                                                        </a>                                                        <a title="$opt.title" class="btn btn-danger btn-delete-variant" type="button" href="pp-${pp.id}/$opt.id">                                                            <span class="glyphicon glyphicon-remove-circle"></span>                                                        </a>                                                    </td>                                                </tr>                                            #end                                        </tbody>                                    </table>                                </div>                            </div>                        #end                        #foreach($pp in $page.productFields)                            <div class="panel panel-default product-parameter" data-product-parameter-id="$pp.id">                                <div class="panel-heading">                                    <i class="clip-question"></i>$pp.title                                </div>                                <div class="panel-body">                                    <div class="row">                                        <div class="col-md-12">                                            <a href="pp-$pp.id" title="$pp.title" class="btn btn-danger btn-delete-variant-type pull-right" style="margin-right: 15px">                                                <span class="glyphicon glyphicon-remove-circle"></span>                                                Delete                                            </a>                                            <input type="text" name="fieldDef-$pp.id" value="$pp.fieldDef" class="form-control" style="width: 60%" />                                        </div>                                    </div>                                </div>                            </div>                        #end                    </div>                </div>            </div>        </div>        <div id="modal-product-option" class="modal fade" aria-hidden="true" tabindex="-1">            <div class="modal-dialog modal-sm">                <div class="modal-content">                    <form method="POST" class="form-horizontal" action="$page.href">                        <div class="modal-header">                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>                            <h4 class="modal-title">Product option</h4>                        </div>                        <div class="modal-body">                            <input type="hidden" name="productParameterId" />                            <input type="hidden" name="productOptionId" />                            <div class="form-group">                                <label class="control-label col-md-3">Code</label>                                <div class="col-md-9">                                    <input type="text" name="name" class="simpleChars required form-control" />                                </div>                            </div>                            <div class="form-group">                                <label class="control-label col-md-3">Title</label>                                <div class="col-md-9">                                    <input type="text" name="title" class="required form-control" />                                </div>                            </div>                            <div class="form-group">                                <label class="control-label col-md-3">Cost</label>                                <div class="col-md-9">                                    <input type="text" name="cost" class="numeric form-control" />                                </div>                            </div>                        </div>                        <div class="modal-footer">                            <button class="btn btn-sm btn-default" data-dismiss="modal" type="button">Close</button>                            <button class="btn btn-sm btn-success" type="submit">Save</button>                        </div>                    </form>                </div>            </div>        </div>        <div id="modal-option-img" class="modal fade" aria-hidden="true" tabindex="-1">            <div class="modal-dialog modal-sm">                <div class="modal-content">                    <form method="POST" class="form-horizontal" action="$page.href">                        <div class="modal-header">                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>                            <h4 class="modal-title">Option Image</h4>                        </div>                        <div class="modal-body">                            <input type="hidden" name="productOptionImgUrl" />                            <input type="hidden" name="productOptionId" />                            <div class="form-group">                                #foreach($href in $page.imageHrefs)                                    <div class="col-xs-6 col-md-3 product-image-thumb">                                        <a href="$href" class="thumbnail select-opt-img"><img src="$href/alt-150-150.png" /></a>                                        <a class="btn-image-selected btn btn-xs btn-success" style="display: none;" href="$href">                                            <span class="fa fa-check"></span>                                        </a>                                    </div>                                #end                            </div>                        </div>                        <div class="modal-footer">                            <button class="btn btn-sm btn-default" data-dismiss="modal" type="button">Close</button>                            <button class="btn btn-sm btn-success" type="submit">Save</button>                        </div>                    </form>                </div>            </div>        </div>        #macro( showCategoryTag $c $type )            <span class="block category alert alert-$type">                <span class="block-name" title="$c.name">                    <a href="/categories/$c.name/">                        $formatter.firstNotNull($c.title, $c.name)                    </a>                </span>                <a href="$c.name" class="btn btn-xs text-muted btn-delete-category" title="Delete category"><i href="$m.name" class="fa fa-times"></i></a>            </span>        #end        <script type="text/javascript" src="/static/bootstrap-upcrop-image/1.0/bootstrap-upcrop-image.js">//</script>        <script type="text/javascript" src="/static/js/jquery.milton-upload.js"></script>        <script type="text/javascript" src="/theme/apps/products/manageProductDetails.js"></script>        #if ($editor != 'html')        <script type="text/javascript" src="/static/jquery.contentEditor/1.0.0/jquery.contentEditor-1.0.0.js"></script>        #end        <script type="text/javascript">            $(function () {                var allGroups = {                    #foreach ($group in $page.find("/").allGroups)                    '$group.name': #if ($group.title) '$group.title' #else '$group.name' #end,                    #end                };                initProductDetails("${editor}", allGroups);            });        </script>    </body></html>