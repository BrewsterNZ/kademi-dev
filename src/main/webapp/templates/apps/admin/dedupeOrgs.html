<html>    <head>        <title>Find and fix duplicate orgs</title>        <link href="viewOrg.css" rel="stylesheet" type="text/css" />    </head>    <body class="viewOrg">        <div class="alert alert-info">            This page lets you find organisations with duplicates names (aka org title), and then merge them.        </div>        <form method="POST" action="$page.href" id="mergeForm">            #if( $page.duplicates.size() > 0 )            <div class="alert alert-warning">                <button class="btn btn-warning pull-right btn-lg">                    <span class="fa fa-exclamation"></span>                    Merge selected                </button>                <p>Found $page.duplicates.size() duplicate sets of organisations.</p>                <p>Merging will move users from merge sources into the merge destination, and then delete the source organisations. Users                    will still have all of their data associated with them</p>                <div class="clearfix"></div>            </div>            #end            <div class="btn-group">                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                    Merge destination :                    #if( $request.params.destMode )                    $request.params.destMode                    #else                    Earliest                    #end                    <span class="caret"></span>                </button>                <ul class="dropdown-menu">                    <li><a href="$page.href?destMode=oldest">Earliest created</a></li>                    <li><a href="$page.href?destMode=newest">Most recently created</a></li>                    <li><a href="$page.href?destMode=numericId">Numeric ID</a></li>                </ul>            </div>            <br/>            <br/>            <div class="table-responsive">                <table class="table table-hover table-bordered table-striped" id="userSearchResults">                    <colgroup>                        <col />                        <col />                        <col />                        <col />                        <col />                    </colgroup>                    <thead>                        <tr>                            <th>Title</th>                            <th>Count</th>                            <th>Merge dest</th>                            <th>Dest created</th>                            <th>Merge from</th>                            <th>                                <input type="checkbox" class="chk-all" />                            </th>                        </tr>                    </thead>                    <tbody id="dups-body">                        #foreach($dup in $page.duplicates)                        <tr>                            #set( $loopId = $foreach.count )                            <td>$dup.title</td>                            <td>$dup.count</td>                            <td>                                #if( $dup.firstDup )                                <a class="btn btn-sm btn-success" href="/organisations/$dup.firstDup.id/edit">$dup.firstDup.orgId : $dup.firstDup.title</a>                                <input type="hidden" name="merge.dest.$loopId" value="$dup.firstDup.id"/>                                #else                                <span class="label label-warning">No org matches selected mode</span>                                #end                            </td>                            <td>$!dup.firstDup.createdDate</td>                            <td>                                #foreach($otherDup in $dup.otherDups)                                <a class="btn btn-sm btn-info" href="/organisations/$otherDup.id/edit">$otherDup.orgId : $otherDup.title</a>                                <input type="hidden" name="merge.source.$loopId" value="$otherDup.id"/>                                #end                            </td>                            <td>                                #if( $dup.firstDup )                                <input type="checkbox" name="merge.enabled.$loopId" value="true" />                                #end                            </td>                        </tr>                        #end                    </tbody>                </table>            </div>        </form>        <script type="text/javascript">            $(function () {                flog("init merge forms", $("#mergeForms"));                $("#mergeForm").forms({                    onSuccess: function (resp) {                        if (resp.status) {                            Msg.info("Merged ok " + resp.messages);                            $("#dups-body").reloadFragment();                        } else {                            Msg.warning("An error occured " + resp.messages);                        }                    }                });            });        </script>    </body></html>