<html>    <head>        <title>Profile</title>        <link href="profile.css" rel="stylesheet" type="text/css" />        <link href="manageUser.css" rel="stylesheet" type="text/css" />        <script type="text/javascript" src="profile.js">//</script>        <script type="text/javascript" src="manageUser.js">//</script>        <script type="text/javascript" src="/static/bootstrap-upcrop-image/1.0/bootstrap-upcrop-image.js">//</script>        <style>            .summary-panel {                height: 200px;            }        </style>    </head>    <body class="profile">        #set($groups = $page.groups)        <div class="tabbable">            <ul class="nav nav-tabs tab-bricky">                <li><a data-toggle="tab" href="#summary">Summary</a></li>                <li><a data-toggle="tab" href="#general">Profile</a></li>                <li><a data-toggle="tab" href="#webactivity">Web Activity</a></li>                #foreach( $pair in $page.appTabs)                <li><a data-toggle="tab" href="#${pair.portletId}">$pair.title</a></li>                #end            </ul>            <div class="tab-content">                <div id="summary" class="tab-pane">                    <h2>$page.profile.formattedName</h2>                    #foreach($m in $page.children.ofType.membership)                    #if( $m.groupType == "P" )                    <div class="label label-success" style="margin-right: 5px">                        <i class="clip-users"></i>                        <span class="block-name">$m.groupName in $m.orgName</span>                    </div>                    #elseif( $m.groupType == "S" )                    <div class="label label-info" style="margin-right: 5px">                        <i class="fa fa-trophy"></i>                        <span class="block-name" title="$m.groupName in $m.orgName">$m.groupName</span>                    </div>                    #elseif( $m.groupType == "M" )                    <div class="label label-info" style="margin-right: 5px">                        <i class="fa fa-envelope"></i>                        <span class="block-name" title="$m.groupName in $m.orgName">$m.groupName</span>                    </div>                    #else                    <div class="label label-info" style="margin-right: 5px">                        <span class="block-name" title="$m.groupName in $m.orgName">$m.groupName</span>                    </div>                    #end                    #end                    <hr/>                    <div class="row " id="profile-panels">                        #foreach( $pair in $page.appPanels)                        <div class="col-sm-6 col-md-4" col-lg-4>                            <div class="thumbnail text-center summary-panel">                                <h2><a href="#$pair.profileTab.portletId">$pair.title</a></h2>                                #portlets( $pair.portletId )                            </div>                        </div>                        #end                    </div>                </div>                <div id="general" class="tab-pane">                    <div class="row ">                        <div class="col-md-6">                            <div class="panel panel-default">                                <div class="panel-heading">                                    <i class="clip-file-2"></i>                                    Update profile details                                </div>                                <div class="panel-body">                                    <fieldset class="name">                                        <div><b>Please update your details below then click the 'Save' button.</b></div>                                        <hr />                                        <form action="." method="POST" enctype="multipart/form-data" class="form-horizontal">                                            <div class="form-group">                                                <label for="" class="control-label col-md-3">UserId:</label>                                                <div class="col-md-9">                                                    <div class="input-group">                                                        <input type="text" class="form-control" disabled="disabled" value="$page.profile.name" />                                                        <span class="input-group-btn">                                                            <button class="btn btn-default change-userid" type="button">Change</button>                                                        </span>                                                    </div>                                                </div>                                            </div>                                            <div class="form-group">                                                <label for="nickName" class="control-label col-md-3">Nickname:</label>                                                <div class="col-md-9">                                                    <input type="text" name="nickName" id="nickName" class="form-control required" value="$!page.profile.nickName" />                                                </div>                                            </div>                                            <div class="form-group">                                                <label for="email" class="control-label col-md-3">Email:</label>                                                <div class="col-md-9">                                                    <input type="text" name="email" id="email" class="form-control required" value="$!page.profile.email" />                                                </div>                                            </div>                                            <div class="form-group">                                                <label for="phone" class="control-label col-md-3">Phone</label>                                                <div class="col-md-9">                                                    <input type="text" class="form-control" name="phone" id="phone" value="$!page.profile.phone" />                                                </div>                                            </div>                                            <div class="form-group">                                                <label for="firstName" class="control-label col-md-3">First name</label>                                                <div class="col-md-9">                                                    <input type="text" name="firstName" id="firstName" class="form-control" value="$!page.profile.firstName" />                                                </div>                                            </div>                                            <div class="form-group">                                                <label for="surName" class="control-label col-md-3">Surname</label>                                                <div class="col-md-9">                                                    <input type="text" name="surName" id="surName" class="form-control" value="$!page.profile.surName" />                                                </div>                                            </div>                                            <div class="form-group">                                                <label for="birthDate" class="control-label col-md-3">Birth Date</label>                                                <div class="col-md-9">                                                    <div class="input-group">                                                        <input type="text" name="birthDate" id="birthDate" placeholder="Birth Date" data-format="DD/MM/YYYY" value="$!formatter.formatDate($page.profile.birthDate)" class="form-control DateTime" />                                                        <span class="input-group-addon"> <i class="fa fa-calendar"></i> </span>                                                    </div>                                                </div>                                            </div>                                            <div class="form-group">                                                <div class="col-md-12">                                                    <button class="btn btn-sm btn-primary pull-right" type="submit">Save</button>                                                </div>                                            </div>                                        </form>                                    </fieldset>                                </div>                            </div>                            <div class="panel panel-default">                                <div class="panel-heading">                                    <i class="clip-pictures"></i>Update photo                                </div>                                <div class="panel-body profile-photo">                                    <div class="clearfix">                                        <img src="$page.photoHref" class="img-thumbnail profile-photo" />                                        <div>                                            <p>Update your profile image below. This must be less then 10Mb</p>                                            <button id="btn-change-ava" class="btn btn-success">Change avatar</button>                                        </div>                                    </div>                                </div>                            </div>                            <div class="panel panel-default">                                <div class="panel-heading">                                    <i class="clip-file-2"></i>                                    Custom fields                                </div>                                <div class="panel-body">                                    <fieldset class="name">                                        <div><b>Below are custom fields for particular groups</b></div>                                        <table class="table table-striped">                                            <thead>                                            <th>Group</th>                                            <th>Property</th>                                            <th>Value</th>                                            </thead>                                            <tbody>                                                #foreach($m in $page.memberships)                                                #foreach($field in $m.fields.nvPairs)                                                <tr>                                                    <td>$m.groupEntity.name</td>                                                    <td>$field.name</td>                                                    <td>$field.propValue</td>                                                </tr>                                                #end                                                #end                                            </tbody>                                        </table>                                    </fieldset>                                </div>                            </div>                        </div>                        <div class="col-md-6">                            <div class="panel panel-default">                                <div class="panel-heading">                                    #if( $page.hasPassword )                                    <i class="clip-key"></i>Update password                                    #else                                    <i class="clip-key"></i>Create password                                    #end                                </div>                                <div class="panel-body">                                    <div class="changePassword">                                        <fieldset>                                            <div>Enter a new and confirmed password below and click the 'Save' button.</div>                                            <hr />                                            <form action="." method="POST" class="form-horizontal">                                                <div class="form-group">                                                    <label for="password" class="control-label col-md-3">New password:</label>                                                    <div class="col-md-9">                                                        <input type="password" name="password" id="password" class="form-control required allow-dodgy-password" value="" />                                                    </div>                                                </div>                                                <div class="form-group">                                                    <label for="confirmPassword" class="control-label col-md-3">Confirm password:</label>                                                    <div class="col-md-9">                                                        <input type="password" name="confirmPassword" id="confirmPassword" class="form-control required allow-dodgy-password" value="" />                                                    </div>                                                </div>                                                <div class="form-group">                                                    <div class="col-md-12">                                                        <button class="btn btn-sm btn-primary pull-right" type="submit">Save</button>                                                    </div>                                                </div>                                            </form>                                        </fieldset>                                        #if( $page.passwordSetDate )                                        <p>                                            <span class='label label-default'>Password was set at: $formatter.formatDateTime($page.passwordSetDate)</span>                                        </p>                                        #end                                    </div>                                </div>                            </div>                            #if($page.hasPassword)                            <div class="panel panel-default">                                <div class="panel-heading">                                    <i class="clip-key"></i>Remove password                                </div>                                <div class="panel-body">                                    <div class="changePassword">                                        <fieldset>                                            <div>Clear the user's password. This will completely and permanently remove all credentials.</div>                                            <hr />                                            <p class="clearfix">                                                <button type="button" class="btn btn-sm btn-danger btn-remove-creds">                                                    <i class="fa fa-times"></i> Clear password                                                </button>                                            </p>                                        </fieldset>                                    </div>                                </div>                            </div>                            #end                            <div class="panel panel-default">                                <div class="panel-heading">                                    <i class="clip-users"></i>Group memberships                                </div>                                <div class="panel-body">                                    <p class="clearfix">                                        <button type="button" class="btn btn-sm btn-success btn-add-group"><i class="fa fa-plus"></i> New membership</button>                                    </p>                                    <div>Group memberships convey permissions, and apply to a user within organisation. A user may have many                                        different group memberships in many different organisations                                    </div>                                    <hr />                                    <div class="memberships-wrapper">                                        <div id="user-membership" class="blocks-wrapper memberships-list">                                            #foreach($m in $page.children.ofType.membership)                                            #if( $m.groupType == "P" )                                            <span class="block membership alert alert-success">                                                <i class="clip-users"></i>                                                <span class="block-name" title="$m.groupName in $m.orgName, created $formatter.formatDateTime($m.createdDate)"><b>$m.groupName</b> in $m.orgName</span>                                                <a href="$m.name" class="btn btn-xs btn-danger btn-delete-membership" title="Delete membership for group $m.groupName in $m.orgName"><i href="$m.name" class="fa fa-times"></i></a>                                            </span>                                            #elseif( $m.groupType == "S" )                                            <span class="block membership">                                                <i class="fa fa-trophy"></i>                                                <span class="block-name" title="$m.groupName in $m.orgName, created $formatter.formatDateTime($m.createdDate)">$m.groupName</span>                                                <a href="$m.name" class="btn btn-xs btn-danger btn-delete-membership" title="Delete membership for group $m.groupName in $m.orgName"><i href="$m.name" class="fa fa-times"></i></a>                                            </span>                                            #elseif( $m.groupType == "M" )                                            <span class="block membership">                                                <i class="fa fa-envelope"></i>                                                <span class="block-name" title="$m.groupName in $m.orgName, created $formatter.formatDateTime($m.createdDate)">$m.groupName</span>                                                <a href="$m.name" class="btn btn-xs btn-danger btn-delete-membership" title="Delete membership for group $m.groupName in $m.orgName"><i href="$m.name" class="fa fa-times"></i></a>                                            </span>                                            #end                                            #end                                        </div>                                    </div>                                </div>                            </div>                        </div>                    </div>                    <div class="row">                        <div class="col-md-8">                            #portlets("adminProfile")                        </div>                        <div class="col-md-4">                        </div>                    </div>                </div>                <div id="webactivity" class="tab-pane">                    <div class="row">                        <div class="col-md-8 col-sm-12">                            <div class="panel panel-default">                                <div class="panel-heading">                                    <i class="clip-stats"></i>                                    Viewed web pages <small><em>(max 100)</em></small>                                </div>                                <div class="panel-body">                                    <div class="table-responsive">                                        <table class="table table-striped table-hover table-condensed">                                            <thead>                                                <tr>                                                    <th>Type</th>                                                    <th>Page</th>                                                    <th>Date</th>                                                    <th>From</th>                                                </tr>                                            </thead>                                            <tbody>                                                #foreach($log in $page.logs)                                                <tr>                                                    <td id="$log.id">                                                        #if( $log.reqMethod == "POST" )                                            <acronym title="Form submission">                                                <div class="label label-warning">                                                    <span class=" glyphicon glyphicon-pencil"></span>                                                </div>                                            </acronym>                                            #else                                            <acronym title="View web page"><span class=" glyphicon glyphicon-globe"></span></acronym>                                            #end                                            </td>                                            <td><a href="http://${log.reqHost}$log.url">${log.reqHost}$log.url</a></td>                                            <td><abbr title="$formatter.formatDateISO8601($log.reqDate)" class="timeago">$log.reqDate</abbr></td>                                            <td><a href="$log.referrer">$!formatter.getFileName( $log.referrer )</a></td>                                            </tr>                                            #end                                            </tbody>                                        </table>                                    </div>                                </div>                            </div>                        </div>                        <div class="col-md-4 col-sm-12">                            <div class="panel panel-default">                                <div class="panel-heading">                                    <i class="clip-stats"></i>                                    Form submits and actions <small><em>(max 1000)</em></small>                                </div>                                <div class="panel-body">                                    <div class="table-responsive">                                        <table class="table table-striped table-hover table-condensed">                                            <thead>                                                <tr>                                                    <th>Page</th>                                                    <th>Date</th>                                                </tr>                                            </thead>                                            <tbody>                                                #foreach($log in $page.actions)                                                <tr>                                                    <td><a href="#$log.id">$log.url</a></td>                                                    <td><abbr title="$formatter.formatDateISO8601($log.reqDate)" class="timeago">$log.reqDate</abbr></td>                                                </tr>                                                #end                                            </tbody>                                        </table>                                    </div>                                </div>                            </div>                        </div>                    </div>                </div>                #foreach( $pair in $page.appTabs)                <!-- start $pair.portletId -->                <div id="$pair.portletId" class="tab-pane">                    #portlets( $pair.portletId )                </div>                <!-- end $pair.portletId -->                #end            </div>        </div>        <div class="modal modal-md fade" id="modal-membership" tabindex="-1" aria-hidden="true">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                <h4 class="modal-title">Group membership</h4>            </div>            <div class="modal-body">                #if($groups.isEmpty())                <p class="alert alert-error">                    <a class="close" data-dismiss="alert" role="button">&times;</a>                    You must create at least one group in this or a parent organisation before you can add users.                </p>                #else                <form method="POST" action="." class="form-horizontal">                    <div class="groups">                        <p>Please select a group and an organisation to make this user a member of</p>                        <div class="form-group">                            <div class="col-md-12">                                <input type="text" class="form-control required" autocomplete="off" name="orgTitle" id="orgTitle" value="$page.organisation.formattedName" />                                <input type="hidden" class="required" autocomplete="off" name="orgId" id="orgId" value="$page.organisation.id" />                            </div>                            <div id="org-search">                                <div class="table-responsive">                                    <table class="table table-striped table-hover table-condensed">                                        #if( $page.orgSearchResults.isEmpty() )                                        <tbody>                                            <tr>                                                <td>No matching organisations found</td>                                            </tr>                                        </tbody>                                        #else                                        <thead>                                            <tr>                                                <th>Id</th>                                                <th>Title</th>                                            </tr>                                        </thead>                                        <tbody>                                            #foreach($org in $page.orgSearchResults)                                            <tr>                                                <td><a href="$org.id">$org.orgId</a></td>                                                <td><a href="$org.id">$!org.title</a></td>                                            </tr>                                            #end                                        <tbody>                                            #end                                    </table>                                </div>                            </div>                        </div>                        <div class="memberships-wrapper">                            <div class="row blocks-wrapper memberships-list">                                #foreach($group in $groups)                                #set($id = "radGroup_" + $group.name)                                <div class="col-md-3">                                    <span class="block membership" title="$group.name">                                        <label class="block-name" for="$id">$formatter.radio($id, "group", false, $group.name) $group.name</label>                                    </span>                                </div>                                #end                            </div>                        </div>                    </div>                </form>                #end            </div>            <div class="modal-footer">                <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Close</button>                #if(!$groups.isEmpty())                <button type="button" data-type="form-submit" class="btn btn-sm btn-primary">Save</button>                #end            </div>        </div>        <script type="text/javascript" src="/static/js/jquery.milton-upload.js"></script>        <script type="text/javascript">            $(function () {                initProfile();                initChangeUserId();                initRemoveCreds();                jQuery("abbr.timeago").timeago();                $('#btn-change-ava').upcropImage({                    buttonContinueText: 'Save',                    url: window.location.pathname, // this is actually the default value anyway                    onCropComplete: function (resp) {                        flog("onCropComplete:", resp, resp.nextHref);                        $(".profile-photo img").attr("src", resp.nextHref);                    },                    onContinue: function (resp) {                        flog("onContinue:", resp, resp.result.nextHref);                        $.ajax({                            url: window.location.pathname,                            type: 'POST',                            dataType: 'json',                            data: {                                uploadedHref: resp.result.nextHref,                                applyImage: true                            },                            success: function (resp) {                                if (resp.status) {                                    $(".profile-photo img").attr("src", resp.nextHref);                                } else {                                    alert("Sorry, an error occured updating your profile image");                                }                            },                            error: function () {                                alert('Sorry, we couldn\'t save your profile image.');                            }                        });                    }                });            });        </script>    </body></html>