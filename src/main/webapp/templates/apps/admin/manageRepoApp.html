<html>
    <head>
        <title>Manage Repo App</title>
        <link rel="stylesheet" href="/theme/assets/plugins/dropzone/downloads/css/dropzone.css"/>
        <link rel="stylesheet" href="/static/jasny-bootstrap/css/jasny-bootstrap.min.css">
        <style>
            .gallery-img{
                display: block;
                //width:400px;
                height:150px;
                width: auto;
                height: auto;
            }

            .gallery-img img{
                max-width:400px;
                max-height:150px;
            }
            .star-rating{
                color: #555555;
                cursor: default;
            }
        </style>
    </head>
    <body>
        #set($marketItem = false)
        #set($marketItem = $page.marketPlaceItem)
        <div class="tabbable">
            <ul id="myTab" class="nav nav-tabs tab-bricky">
                <li class="active">
                    <a href="#details" data-toggle="tab"><i class="fa fa-home"></i> Details</a>
                </li>
                #if($marketItem)
                <li>
                    <a href="#reviews" data-toggle="tab"><i class="fa fa-star-o"></i> Reviews</a>
                </li>
                <li>
                    <a href="#market" data-toggle="tab"><i class="fa fa-cog"></i> Market Place</a> 
                </li>
                #end
            </ul>

            <div class="tab-content">
                <div class="tab-pane active" id="details">
                    #if(!$marketItem)
                    <button type="button" data-toggle="modal" data-target="#makeMarketItem" class="btn btn-sm btn-success pull-right"><i class="fa fa-shopping-cart"></i> Create Market Place Item</button>
                    #end
                    <form action="." method="POST" enctype="multipart/form-data" class="form-horizontal">
                        <input type="hidden" name="details" value="details"/>
                        <div class="form-group">
                            <div class="errorHandler alert alert-danger no-display pageMessage">.</div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="appName">Name</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control required simpleChars" id="appName" name="appName" value="$page.app.appName" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="title">Title</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control required" name="title" value="$page.title" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="notes">Summary</label>
                            <div class="col-sm-9">
                                <textarea id="notes" name="notes" class="form-control limited" maxLength="200" cols="100" rows="5">$!page.app.notes</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="price">App Provider</label>
                            <div class="col-sm-9">
                                $formatter.checkbox("appProvider", "appProvider", $page.app.appProvider)
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="price">Theme Provider</label>
                            <div class="col-sm-9">
                                $formatter.checkbox("themeProvider", "themeProvider", $page.app.themeProvider)
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-9">
                                <button type="submit" class="btn btn-sm btn-primary">Save</button>
                            </div>
                        </div>
                    </form>
                </div>

                #if($marketItem)
                <div class="tab-pane" id="reviews">
                    <div class="row">
                        #set($reviews = $marketItem.appRatings)
                        #if(!$reviews || $reviews.empty)
                        <div class="col-md-12">
                            No ratings have been submitted
                        </div>
                        #else
                        #foreach($review in $reviews)
                        <div class="col-md-12">
                            <hr/>
                            #genRating($review.rating)
                            $review.reviewedBy.formattedName from $review.organisation.formattedName
                            <span class="pull-right"><abbr title="$review.reviewedOn" class="timeago">$formatter.formatDateISO8601($review.reviewedOn)</abbr></span>
                            <p>$review.review</p>
                        </div>
                        #end
                        #end
                    </div>
                </div>

                <div class="tab-pane" id="market">
                    <form action="." method="POST" enctype="multipart/form-data" class="form-horizontal">
                        <input type="hidden" name="marketDetails" value="true"/>
                        <div class="pull-right" id="marketButtons">
                            #if(!$marketItem.published)
                            <button type="button" class="btn btn-info publishApp"><i class="fa fa-check"></i> Publish</button>
                            #else
                            <button type="button" class="btn btn-info rePublishApp"><i class="fa fa-refresh"></i> Re-Publish</button>
                            <button type="button" class="btn btn-danger unPublishApp"><i class="fa fa-times"></i> Un-Publish</button>
                            #end
                            <button type="submit" class="btn btn-success"><i class="fa fa-save"></i> Save</button>
                        </div>
                        <div class="clearfix">
                        </div>
                        <br/>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="price">Price</label>
                            <div class="col-sm-9">
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon1">$</span>
                                    <input type="number" min="0" step="0.01" class="form-control numeric" name="price" value="$!marketItem.price" />
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="brief">Short Brief</label>
                            <div class="col-sm-9">
                                <textarea id="brief" name="brief" class="form-control limited" maxLength="200" cols="100" rows="5">$!marketItem.brief</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="description">Description</label>
                            <div class="col-sm-9">
                                <textarea id="description" name="description" class="htmleditor toolbar-Lite" cols="100" rows="5">$!marketItem.description</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Banner</label>
                            <div class="col-sm-9">
                                <div class="fileinput fileinput-new" data-provides="fileinput">
                                    <div class="fileinput-new thumbnail" style="width: 533px; height: 200px;">
                                        <img src="/theme/apps/marketplace/no_banner.png" alt="No Banner">
                                    </div>
                                    <div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 533px; max-height: 200px;"></div>
                                    <div>
                                        <span class="btn btn-light-grey btn-file">
                                            <span class="fileinput-new"><i class="fa fa-image"></i> Select image</span>
                                            <span class="fileinput-exists"><i class="fa fa-image"></i> Change</span>
                                            <input type="file" name="bannerImg">
                                        </span>
                                        <a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput"><i class="fa fa-times"></i> Remove</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Logo</label>
                            <div class="col-sm-9">
                                <div class="fileinput fileinput-new" data-provides="fileinput">
                                    <div class="fileinput-new thumbnail" style="width: 320px; height: 150px;">
                                        <img src="/theme/apps/marketplace/no_logo.png" alt="No Logo">
                                    </div>
                                    <div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 320px; max-height: 150px;"></div>
                                    <div>
                                        <span class="btn btn-light-grey btn-file">
                                            <span class="fileinput-new"><i class="fa fa-image"></i> Select image</span>
                                            <span class="fileinput-exists"><i class="fa fa-image"></i> Change</span>
                                            <input type="file" name="logoImg">
                                        </span>
                                        <a href="#" class="btn btn-danger fileinput-exists" data-dismiss="fileinput"><i class="fa fa-times"></i> Remove</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Screenshots</label>
                            <div class="col-sm-9" id="screenshot-div">
                                <div style="margin-bottom: 5px;">
                                    <button class="btn btn-sm btn-success" data-toggle="modal" data-target="#modal-image-upload">
                                        <i class="fa fa-plus"></i> Add screenshots
                                    </button>
                                </div>
                                <div class="panel panel-default" id="screenshots-panel">
                                    <div class="panel-body">
                                        <div class="row">
                                            <div id="screenshots">
                                                #foreach($i in $page.screenshots)
                                                <div class="col-md-3 col-sm-4 gallery-img">
                                                    <div class="wrap-image" data-href="$i.name">
                                                        <a class="group1 cboxElement" href="$i.name" title="$i.name">
                                                            <img src="$i.name" alt="" class="img-responsive">
                                                        </a>
                                                        <div class="tools tools-bottom">
                                                            <a href="$i.name" data-title="$i.name" class="delete-screenshot pull-right" title="Delete $i.name">
                                                                <i class="fa fa-trash"></i>
                                                            </a>
                                                        </div>                                                
                                                    </div>
                                                </div>
                                                #end                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                #end
            </div>
        </div>

        <div id="modal-image-upload" class="modal modal-md fade" aria-hidden="true" tabindex="-1">
            <div class="modal-header">
                <button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>
                <h4 class="modal-title">Upload images</h4>
            </div>
            <div class="modal-body">
                <form action="$page.href" class="dropzone dropzone-fullwidth" id="uploadImageDropzone">
                    <input type="hidden" name="uploadScreenshots" value="true"/>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-sm btn-default" data-dismiss="modal" type="button">Close</button>
            </div>
        </div>
        #if(!$marketItem)
        <div id="makeMarketItem" class="modal modal-md fade" aria-hidden="true">
            <div class="modal-header">
                <button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>
                <h4 class="modal-title">Create Market Item</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" method="POST" action=".">
                    <input type="hidden" name="createMarketItem" value="true"/>
                    <div class="form-group">
                        <label for="newName" class="col-sm-3 control-label">Unique name</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control regex required" required="required" name="uniqueName" data-regex="^[a-zA-Z0-9-]+$" />
                            <span class="help-block"><small>Simple characters only, no punctuation, dots, etc, all lower case, not a domain name</small></span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-sm btn-primary" data-type="form-submit">Create</button>
            </div>
        </div>
        #end

        <script src="/theme/assets/plugins/jquery-inputlimiter/jquery.inputlimiter.1.3.1.min.js">//
        </script>

        <script src="/static/jasny-bootstrap/js/jasny-bootstrap.min.js" type="text/javascript">//
        </script>
        <script src="/theme/assets/plugins/dropzone/downloads/dropzone.min.js">//
        </script>
        <script src="/theme/assets/js/pages-gallery.js">//
        </script>
        <script type="text/javascript" src="/theme/apps/admin/manageRepoApp.js">//
        </script>
        <script>
            $(function () {
                initManageRepoApp();
                        #if (!$marketItem)
                        initCreateMarketItem();
                        #end
            });
        </script>
        #macro(genRating $rating)
        <p class="star-rating" title="$rating/5 stars">
            #foreach($i in [0..4])
            #set($a = $rating - $i)
            #if($a > 0.5)
            <span class="fa fa-star"></span>
            #elseif($a == 0.5)
            <span class="fa fa-star-half-o"></span>
            #else
            <span class="fa fa-star-o"></span>
            #end
            #end
        </p>
        #end
    </body>
</html>
