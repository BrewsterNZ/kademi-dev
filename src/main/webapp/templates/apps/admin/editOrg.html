<html>    <head>        <title>Edit organisation details</title>        <script type="text/javascript" src="/static/chosen/1.1.0/chosen.jquery.js">//</script>        <link rel="stylesheet" href="/static/chosen/1.1.0/chosen.css"/>    </head>    <body class="viewOrg">        <form method="post" action="$request.absolutePath" class="form-horizontal org-details">            <div class="row">                <div class="col-md-8">                    <div id="form-body">                        <div class="panel panel-default">                            <div class="panel-heading">                                Organisation details                            </div>                            <div class="panel-body">                                <div class="form-group">                                    <label for="orgTitle" class="control-label col-md-2">Org ID</label>                                    <div class="col-md-8">                                        <input type="text" value="$!page.organisation.orgId" class="form-control required" name="orgId" id="orgId" placeholder="Your unique ID for the organisation" />                                        <p>This is used to uniquely identify the organisation database, and should never change.It <b>should not be the name</b>, because you may need to change the organisation name</p>                                    </div>                                </div>                                <div class="form-group">                                    <label for="orgTitle" class="control-label col-md-2">Name</label>                                    <div class="col-md-8">                                        <input type="text" value="$!page.organisation.title" class="form-control required" name="title" id="orgTitle" placeholder="User friendly name for the organisation" />                                        <p>This should be the user friendly name of the organisation, such as Human Resources for a department, or ACME Gift Store - London, for a retail store</p>                                    </div>                                </div>                                <div class="form-group">                                    <label for="orgTypeName" class="control-label col-md-2">Type</label>                                    <div class="col-md-5">                                        <select name="orgTypeName" class="form-control" id="orgTypeName">                                            <option value="">[None]</option>                                            #foreach($orgType in $page.orgTypes)                                            $formatter.option($orgType.name, $orgType.displayName, $page.orgType.name)                                            #end                                        </select>                                        <a href="/orgTypes">Edit organisation types</a>                                    </div>                                </div>                                <div class="form-group">                                    <label for="orgPhone" class="control-label col-md-2">Email</label>                                    <div class="col-md-4">                                        <input type="text" value="$!page.organisation.email" class="form-control" name="email" id="orgEmail" />                                    </div>                                    <label for="orgPhone" class="control-label col-md-2">Phone</label>                                    <div class="col-md-4">                                        <input type="text" value="$!page.organisation.phone" class="form-control" name="phone" id="orgPhone" />                                    </div>                                </div>                            </div>                        </div>                        <div class="panel panel-default">                            <div class="panel-heading">                                Physical location                            </div>                            <div class="panel-body">                                <div class="form-group">                                    <label for="orgAddress" class="control-label col-md-2">Address</label>                                    <div class="col-md-8">                                        <input type="text" value="$!page.organisation.address" class="form-control" name="address" id="orgAddress" />                                    </div>                                </div>                                <div class="form-group">                                    <label for="orgAddress2" class="control-label col-md-2">Address Line2</label>                                    <div class="col-md-8">                                        <input type="text" value="$!page.organisation.addressLine2" class="form-control" name="addressLine2" id="orgAddress2" />                                    </div>                                </div>                                <div class="form-group">                                    <label for="orgState" class="control-label col-md-2">State</label>                                    <div class="col-md-4">                                        <input type="text" value="$!page.organisation.addressState" class="form-control" name="addressState" id="orgState" />                                    </div>                                    <label for="orgPostcode" class="control-label col-md-2">Postcode</label>                                    <div class="col-md-4">                                        <input type="text" value="$!page.organisation.postcode" class="form-control" name="postcode" id="orgPostcode" />                                    </div>                                </div>                                <div class="form-group">                                    <label for="country" class="control-label col-md-2">Country</label>                                    <div class="col-md-8">                                        <select name="country" class="form-control chosen-select" id="country">                                            <option value="">[No country selected]</option>                                            #foreach($cc in $formatter.countryCodes.list)                                            $formatter.option( $cc.alpha2Code, $cc.englishShortName, $page.organisation.country )                                            #end                                        </select>                                    </div>                                </div>                                <div class="form-group">                                    <label class="control-label col-md-2" for="location">Timezone</label>                                    <div class="col-md-8">                                        <select name="timezone" class="form-control chosen-select">                                            <option value="">[No timezone selected]</option>                                            #foreach($tzId in $page.timezoneIdList)                                            $formatter.option( $tzId, $tzId, $page.organisation.timezone )                                            #end                                        </select>                                        <small>This will be used as the default for any calendar events you create</small>                                    </div>                                </div>                                <div class="form-group">                                    <label for="orgState" class="control-label col-md-2">Lattitude</label>                                    <div class="col-md-4">                                        <input type="text" value="$!page.organisation.lat" class="form-control" name="lat" />                                    </div>                                    <label for="orgPostcode" class="control-label col-md-2">Longitude</label>                                    <div class="col-md-4">                                        <input type="text" value="$!page.organisation.lng" class="form-control" name="lng" />                                    </div>                                </div>                                <button class="btn btn-primary btnSearchAddress" type="button">Search for address</button>                                <br/>                                <div id="map" style="width: 100%; height: 300px"></div>                            </div>                        </div>                        #if( !$page.extraFields.isEmpty() )                        <div class="panel panel-default">                            <div class="panel-heading">                                Custom fields                            </div>                            <div class="panel-body">                            #set($fields = $page.extraFields)                            #foreach($field in $fields.keySet())                                <div class="control-group form-group">                                    <label class="control-label col-md-3 control-label" for="field_${field.name}">$field.text</label>                                    <div class="controls col-md-8">                                        $field.html( $fields[$field] )                                    </div>                                </div>                            #end                            </div>                        </div>                        #end                    </div>                    <div class="form-group">                        <div class="col-md-12">                            <button type="submit" class="btn btn-success btn-lg pull-right">Save</button>                        </div>                    </div>                </div>                <div class="col-md-3">                    <h3>Administration domain</h3>                    <p>Set an administration domain value here if you want this organisation to have                        its own administration dashboard, so it can have its own administrators</p>                    <p>The value you enter must be unique across all of Kademi, and will be used to form                        an admin dashboard address like <b>mydomain</b>.kademi.olhub.com</p>                    <div class="form-group">                        <label class="control-label col-md-5" for="orgTitle">Admin Domain</label>                        <div class="col-md-7">                            <input id="adminDomain" value="$!page.organisation.adminDomain" class="form-control regex" type="text" placeholder="Unique in all of Kademi. Used to identify the admin console" data-message="Admin Domain needs to be simple characters only. All lower case, no spaces and no special chatacters." name="adminDomain" data-regex="^(?:(?!-)[a-z0-9-]{1,63}(?!-)|)$">                        </div>                    </div>                </div>            </div>        </form>        <script type="text/javascript">            $(function () {                var oldId = $("#orgId").val();                $(".org-details").forms({                    callback: function (resp) {                        flog("saved", resp);                        Msg.info("Saved OK");                        var newId = $("#orgId").val();                        if (oldId !== newId) {                            window.location = "../" + newId + "/edit";                        } else {                            $("#form-body").reloadFragment({                                whenComplete: function () {                                    $(".chosen-select").chosen({                                        search_contains: true                                    });                                    initMap();                                }                            });                        }                    }                });                $(".chosen-select").chosen({                    search_contains: true                });                $("body").on("click", ".btnSearchAddress", function (e) {                    e.preventDefault();                    search();                });            });        </script>        <script type="text/javascript">            var map;            var infowindow;            var orgLat = null;            var orgLng = null;            #if ($page.organisation.lat) orgLat = $page.organisation.lat; #end            #if ($page.organisation.lat) orgLng = $page.organisation.lng; #end        </script>        <script type="text/javascript">            function initMap() {                var orgLoc = {}; //lat: -33.867, lng: 151.195                if (orgLat && orgLng) {                    orgLoc.lat = orgLat;                    orgLoc.lng = orgLng;                    flog("use coords", orgLoc);                    map = new google.maps.Map(document.getElementById('map'), {                        center: orgLoc,                        zoom: 15                    });                    createMarker(orgLoc);                } else {                    flog("no coords");                    var orgLoc = {lat: -33.867, lng: 151.195};                    map = new google.maps.Map(document.getElementById('map'), {                        center: orgLoc,                        zoom: 15                    });                }            }            function search() {                var service = new google.maps.places.PlacesService(map);                var q = $("#orgAddress").val() + "," + $("#orgAddress2").val() + "," + $("#country").val();                flog("search", q);                service.textSearch({                    query : q                }, callback);            }            function callback(results, status) {                flog("callback" ,results, status);                if (status === google.maps.places.PlacesServiceStatus.OK) {                    var first = results[0];                    firstLoc = first.geometry.location;                    flog("callback, set center", firstLoc);                    map.setCenter(firstLoc);                    for (var i = 0; i < results.length; i++) {                        createMarker(results[i].geometry.location);                    }                }            }            function createMarker(loc) {                var marker = new google.maps.Marker({                    map: map,                    position: loc                });                google.maps.event.addListener(marker, 'click', function () {                    flog("clicked", marker.getPosition());                    var pos = marker.getPosition();                    map.setCenter(marker.getPosition());                    $("input[name=lat]").val( pos.lat );                    $("input[name=lng]").val( pos.lng );                    orgLat = Number($("input[name=lat]").val());                    orgLng = Number($("input[name=lng]").val());                });            }        </script>        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDS53FPtVGJPvZvrzh2sLcfPUQYS3gsh0c&libraries=places&callback=initMap" async defer></script>    </body></html>