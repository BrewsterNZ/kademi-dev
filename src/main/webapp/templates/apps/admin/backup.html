<html>    <head>        <title>Backup and Restore</title>        <link rel="stylesheet" href="/theme/assets/plugins/dropzone/downloads/css/dropzone.css"/>        <link href="/static/jquery-tree/jquery.tree.min.css" rel="stylesheet" type="text/css"/>        <style>            .loader {                display: none;                width: 100%;                height: 500px;                z-index: 9999;                background: url('/templates/ajax-loader.gif') 50% 50% no-repeat rgb(249,249,249);            }            .icon {                width: 60px;                text-align: center;            }            .icon i {                font-size: 30px;            }            .btn-file {                position: relative;                overflow: hidden;            }            .btn-file input[type=file] {                position: absolute;                top: 0;                right: 0;                min-width: 100%;                min-height: 100%;                font-size: 100px;                text-align: right;                filter: alpha(opacity=0);                opacity: 0;                background: red;                cursor: inherit;                display: block;            }            .file-input {                background-color: white !important;                cursor: text !important;            }        </style>    </head>    <body class="">        <h1>Backup and Restore</h1>        <form class="form-horizontal" id="options">            <div class="row">                #foreach($appOptions in $page.options.entrySet())                <div class="col-md-12">                    <!-- <label>$appOptions.key</label> -->                    <div class="checkbox">                        #foreach($a in $appOptions.value.entrySet())                        <label class="checkbox-inline">                            <input type="checkbox" class="option" name="option_$a.value" value="true" checked="checked"> $a.key                        </label>                        #end                    </div>                </div>                #end            </div>        </form>        <a id="downloadBtn" href="backup.json" download="backup.json" class="btn btn-md btn-success"><i class="fa fa-download"></i> Download backup</a>        <button class="btn btn-mg btn-success" id="btn-restore" type="button" data-toggle="modal" data-target="#modal-upload-file"><i class="fa fa-upload"></i> Restore backup</button>        <div id="modal-upload-file" class="modal fade" aria-hidden="true" tabindex="-1">            <div class="modal-dialog">                <div class="modal-content">                    <div class="modal-header">                        <button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>                        <h4 class="modal-title">Upload File</h4>                    </div>                    <div class="modal-body">                        <form action="backup.json" method="POST" class="form-horizontal" enctype="multipart/form-data">                            <div class="form-group">                                <input type="hidden" id="restoreFile" name="restoreFile" value="" />                                <label class="col-md-3 control-label">File</label>                                <div class="col-md-8">                                    <div class="input-group">                                <span class="input-group-btn">                                    <span class="btn btn-primary btn-file">                                        Browse&hellip; <input name="backup" type="file"/>                                    </span>                                </span>                                        <input type="text" class="form-control file-input" readonly>                                    </div>                                </div>                            </div>                            <div class="form-group">                                <label class="col-md-3 control-label" for="adminUrl">Admin Domain URL</label>                                <div class="col-md-8">                                    <input class="form-control required href" id="adminUrl" type="text" name="adminUrl"/>                                </div>                            </div>                            <div class="form-group">                                <label class="col-md-3 control-label" for="username">Username</label>                                <div class="col-md-8">                                    <input class="form-control required" id="username" type="text" name="username" />                                </div>                            </div>                            <div class="form-group">                                <label class="col-md-3 control-label" for="password">Password</label>                                <div class="col-md-8">                                    <input class="form-control required" id="password" type="password" name="password" />                                </div>                            </div>                        </form>                    </div>                    <div class="modal-footer">                        <button class="btn btn-sm btn-default" data-dismiss="modal" type="button">Close</button>                        <button type="button" class="btn btn-sm btn-primary" data-type="form-submit">Upload</button>                    </div>                </div>            </div>        </div>        <script src="/static/jquery-tree/jquery.tree.min.js" type="text/javascript">//</script>        <script type="text/javascript">            $(function () {                $('body').on('click', '#downloadBtn', function (e) {                    if ($('#options [type=checkbox].option:checked').length < 1) {                        e.preventDefault();                        Msg.warning("Please select at least one category to backup");                    } else {                        Msg.info('Processing Backup');                        var options = $('#options [type=checkbox].option');                        var params = [];                        options.each(function (count, item) {                            var t = $(item);                            var checked = t.is(":checked");                            if (checked) {                                params.push({                                    name: t.attr('name'),                                    value: checked                                });                            }                        });                        var encodedParams = $.param(params);                        $('#downloadBtn').attr('href', 'backup.json?' + encodedParams)                    }                });                initUpload();            });            function initUpload() {                var modal = $('#modal-upload-file');                var modalForm = modal.find('form');                modalForm.forms({                    beforePostForm: function (form, config, data) {                        var options = $('#options [type=checkbox].option');                        options.each(function (count, item) {                            var t = $(item);                            var checked = t.is(":checked");                            if (checked) {                                data.append(t.attr('name'), checked);                            }                        });                        return data;                    },                    onSuccess: function (resp) {                        Msg.success(resp.messages);                    }                });                $(document).on('change', '.btn-file :file', function () {                    var input = $(this),                            numFiles = input.get(0).files ? input.get(0).files.length : 1,                            label = input.val().replace(/\\/g, '/').replace(/.*\//, '');                    input.trigger('fileselect', [numFiles, label]);                });                $('.btn-file :file').on('fileselect', function (event, numFiles, label) {                    var input = $(this).parents('.input-group').find(':text'),                            log = numFiles > 1 ? numFiles + ' files selected' : label;                    if (input.length) {                        input.val(log);                    } else {                        if (log)                            alert(log);                    }                });            }        </script>    </body></html>