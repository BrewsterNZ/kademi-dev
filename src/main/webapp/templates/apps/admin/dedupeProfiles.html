<html>    <head>        <title>Find and fix duplicate orgs</title>        <link href="viewOrg.css" rel="stylesheet" type="text/css" />    </head>    <body class="viewOrg">        <div class="alert alert-info">            This page lets you find profiles with duplicated identifiers (eg name, email, or custom field)        </div>        <form method="POST" action="$page.href" id="mergeForm">            #if( $page.duplicates.size() > 0 )            <div class="alert alert-warning">                <button class="btn btn-warning pull-right btn-lg">                    <span class="fa fa-exclamation"></span>                    Merge selected                </button>                <p>Found $page.duplicates.size() duplicate sets of profiles.</p>                <p>Merging will move data from merge sources into the merge destination, and then delete the source profiles. Users                    will still have all of their data associated with them on the destination profile, such as sales records, emails, journeys, etc.</p>                <div class="clearfix"></div>            </div>            #end            <div class="btn-group">                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                    Merge destination :                    #if( $request.params.destMode )                    $request.params.destMode                    #else                    Earliest                    #end                    <span class="caret"></span>                </button>                <ul class="dropdown-menu">                    <li><a href="$page.href?matchId=$!request.params.matchId&destMode=oldest">Earliest created</a></li>                    <li><a href="$page.href?matchId=$!request.params.matchId&destMode=newest">Most recently created</a></li>                    <li><a href="$page.href?matchId=$!request.params.matchId&destMode=numericId">Numeric ID</a></li>                </ul>            </div>            <div class="btn-group">                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                    Match mode :                    #if( $request.params.matchId )                    $request.params.matchId                    #else                    Email                    #end                    <span class="caret"></span>                </button>                <ul class="dropdown-menu">                    #foreach( $matchMethod in $page.matchMethods)                    <li><a href="$page.href?matchId=$matchMethod.id&destMode=$!request.params.destMode">$matchMethod.description</a></li>                    #end                </ul>            </div>            <br/>            <br/>            <div class="table-responsive">                <table class="table table-hover table-bordered table-striped" id="userSearchResults">                    <colgroup>                        <col />                        <col />                        <col />                        <col />                        <col />                    </colgroup>                    <thead>                        <tr>                            <th>$page.selectedMethod.name</th>                            <th>Count</th>                            <th>Merge dest</th>                            <th>Dest created</th>                            <th>Merge from</th>                            <th>                                <input type="checkbox" class="chk-all" />                            </th>                        </tr>                    </thead>                    <tbody id="dups-body">                        #foreach($dup in $page.duplicates)                        <tr>                            #set( $loopId = $foreach.count )                            <td>                                #if( $dup.dupValue.class.simpleName == "Pair" )                                $!dup.dupValue.object1 $!dup.dupValue.object2                                #else                                $dup.dupValue                                #end                            </td>                            <td>$dup.count</td>                            <td>                                #if( $dup.firstDup )                                <a class="btn btn-sm btn-success" href="/manageUsers/$dup.firstDup.id/">$dup.firstDup.formattedName</a>                                <input type="hidden" name="merge.dest.$loopId" value="$dup.firstDup.id"/>                                #else                                <span class="label label-warning">No profile matches selected mode</span>                                #end                            </td>                            <td>$!dup.firstDup.createdDate</td>                            <td>                                #foreach($otherDup in $dup.otherDups)                                <a class="btn btn-sm btn-info" href="/manageUsers/$otherDup.id/">$otherDup.formattedName</a>                                <input type="hidden" name="merge.source.$loopId" value="$otherDup.id"/>                                #end                            </td>                            <td>                                #if( $dup.firstDup )                                <input type="checkbox" name="merge.enabled.$loopId" value="true" />                                #end                            </td>                        </tr>                        #end                    </tbody>                </table>            </div>        </form>        <script type="text/javascript">            $(function () {                flog("init merge forms", $("#mergeForms"));                $("#mergeForm").forms({                    onSuccess: function (resp) {                        if (resp.status) {                            Msg.info("Merged ok " + resp.messages);                            $("#dups-body").reloadFragment();                        } else {                            Msg.warning("An error occured " + resp.messages);                        }                    }                });            });        </script>    </body></html>