<html>    <head>        <title>Organisations map</title>        <link rel="stylesheet" type="text/css" href="/static/bootstrap-select/1.10.0/dist/css/bootstrap-select.min.css" />    </head>    <body class="viewOrg">        <div id="org-types-template" style="display: none;">            <select multiple="multiple" class="selectpicker" name="orgType" title=" - Select Organisation Types - ">                #foreach($orgType in $page.find("/orgTypes/").children)                    <option value="$orgType.name">$orgType.title</option>                #end            </select>        </div>        <div id="org-map"></div>        <script type="text/javascript" src="/static/jquery.scrollTo/2.1.2/jquery.scrollTo.min.js"></script>        <script type="text/javascript" src="/static/jquery.orgFinder/1.0.1/jquery.orgFinder-1.0.1.js"></script>        <script type="text/javascript" src="/static/bootstrap-select/1.10.0/dist/js/bootstrap-select.min.js"></script>        <script type="text/javascript">            var orgTypes = [];            #foreach($orgType in $page.find("/orgTypes/").children)                orgTypes.push({                    title: '$orgType.title',                    value: '$orgType.name'                });            #end        </script>        <script type="text/javascript">            $(function () {                var firstTime = true;                $('#org-map').orgFinder({                    searchUrl: '/organisations/',                    googleAPIKey: 'AIzaSyDS53FPtVGJPvZvrzh2sLcfPUQYS3gsh0c',                    initQuery: '$!params.q',                    initLatLng: [-33.867, 151.195],                    initZoomLevel: 15,                    orgTypes: orgTypes,                    searchInType: true,                    typeDelayTime: 500,                    template:                    '<form role="form" class="form-horizontal form-search org-finder-search dropdown" action="" style="margin-bottom: 15px;">' +                    '    <div class="input-group">' +                    '        <input type="text" name="q" class="form-control" placeholder="Enter keyword to search..." value="" id="q" autocomplete="off" />' +                    '        <span class="input-group-btn">' +                    '            <select name="orgType"></select>' +                    '            <button class="btn btn-default" type="button" data-type="clearer" data-target="#q">' +                    '                <i class="fa fa-times"></i>' +                    '            </button>' +                    '        </span>' +                    '    </div>' +                    '    <div class="dropdown-menu org-finder-list" style="overflow-y: auto; max-height: 250px; display: none; width: 60%;"></div>' +                    '</form>' +                    '<div class="embed-responsive embed-responsive-16by9" style="padding-bottom: 40%">' +                    '    <div class="embed-responsive-item org-finder-map"></div>' +                    '</div>',                    renderItemContent: function (orgData) {                        var itemContent = '';                        itemContent += '<h4 style="margin: 0;">' + (orgData.orgTypeDisplayName || orgData.title ) + '</h4>';                        if (orgData.phone) {                            itemContent += '<p><strong>Phone:</strong> ' + orgData.phone + '</p>';                        }                        if (orgData.email) {                            itemContent += '<p class=list-group-item-text"><strong>Email:</strong> <a href="mailto:' + orgData.email + '">' + orgData.email + '</a></p>';                        }                        if (orgData.address) {                            itemContent += '<p><strong>Address:</strong> ' + orgData.address + '</p>';                        }                        if (orgData.addressLine2) {                            itemContent += '<p class=list-group-item-text"><strong>Address Line 2:</strong> ' + orgData.addressLine2 + '</p>';                        }                        if (orgData.addressState) {                            itemContent += '<p><strong>State:</strong> ' + orgData.addressState + '</p>';                        }                        if (orgData.country) {                            itemContent += '<p><strong>Country:</strong> ' + orgData.country + '</p>';                        }                        if (orgData.postcode) {                            itemContent += '<p><strong>Postcode:</strong> ' + orgData.postcode + '</p>';                        }                        return '<li><a>' + itemContent + '</a></li>';                    },                    onSearch: function (query) {                        history.pushState(null, 'Organisations map', window.location.pathname + '?q=' + encodeURIComponent(query.trim()));                    },                    onSearched: function (query, resp) {                        if (resp && resp.status && resp.data && resp.data[0]) {                            // Do nothing                        } else {                            this.itemsWrapper.html('<li class="disabled"><a>No result</a></li>');                        }                        if (firstTime) {                            $('.org-finder-list').css('display', 'none');                            firstTime = false;                        } else {                            this.itemsWrapper.css('display', query.trim() === '' ? 'none' : 'block');                        }                    },                    onReady: function () {                        var orgFinder = this;                        orgFinder.doSearch('$!params.q');                        $('#q').on('keydown', function () {                            var query = $(this).val() || '';                            if (query.trim() === '') {                                query = '';                            }                            typewatch(function () {                                orgFinder.doSearch(query);                            }, 500);                        });                    },                    onSelect: function () {                        this.itemsWrapper.css('display', 'none');                    }                });                $(window).on('keydown', function (e) {                    if (e.keyCode === keymap.ESC) {                        $('.org-finder-list').css('display', 'none');                    }                });            });        </script>    </body></html>