<html xmlns="http://www.w3.org/1999/xhtml">    <head>        <title>Stream Search</title>        <style>            pre {                white-space: pre-wrap; /* CSS 3 */                white-space: -moz-pre-wrap; /* Mozilla, since 1999 */                white-space: -pre-wrap; /* Opera 4-6 */                white-space: -o-pre-wrap; /* Opera 7 */                word-wrap: break-word; /* Internet Explorer 5.5+ */                padding: 0;                margin: 0;            }            #streamItemDetails {                overflow-x: hidden;                overflow-y: auto;            }            #streamItemDetails.affix {                top: 50px;            }            .other.active .messages {                background: rgb(255, 140, 0);                color: #fff;            }            .other.active .messages a {                color: #fff;                font-weight: bold;            }            .other.active .messages:after {                display: none;            }        </style>    </head>    <body class="">        <div class="panel panel-default">            <div class="panel-heading">                <i class="fa fa-bar-chart-o"></i>                Activity Stream Search            </div>            <div class="panel-body">                <div class="row">                    <div class="col-sm-6">                        <div class="input-group">                            <label for="searchQuery" class="input-group-addon">Search</label>                            <input type="text" placeholder="Search for" id="searchQuery" name="search" class="form-control"/>                        </div>                    </div>                </div>                <hr/>                <div class="row">                    <div class="col-lg-4">                        <div id="results">                            <div id="streamBody">                                <ol class="discussion">                                    <li class="text-center">                                        <i class="fa fa-spinner fa-spin" style="font-size: 24px"></i>                                    </li>                                </ol>                            </div>                        </div>                    </div>                    <div class="col-lg-8">                        <div id="streamItemDetails" class="affix" data-spy="affix" data-offset-top="243"></div>                    </div>                </div>                <div class="clearfix"></div>            </div>        </div>        <script type="text/javascript" src="/static/uri/1.15.1/URI.js">//</script>        <script id="entry-template" type="text/html">            <ol class="discussion">                {{#each hits.hits}}                <li class="other">                    <div class="avatar">                        {{#unless fields.fullName}}                        <img class="img img-circle" src="/templates/apps/user/profile.png" alt=""/>                        {{else}}                        <img class="img img-circle" src="/users/{{fields.userName}}/pic" alt=""/>                        {{/unless}}                        <br/>                        <a href="/manageUsers/{{fields.userId}}/" class="avatar-name" title="{{fields.fullName}}">{{fields.fullName}}</a>                    </div>                    <div class='messages'>                        <p>                            <a href="/stream/{{_id}}" class="label label-{{fields.category}} streamItem"                               style="margin-right: 10px; font-size: 18px">                                <span class="{{itemTypeIcon fields.itemType}}"></span>                            </a>                            {{fields.actionDesc}} <a href="{{itemHref}}">{{fields.itemTitle}}</a>                        </p>                        <p>                            <a href="/stream/{{itemId}}" class="time timeago" title="{{dateFromLong fields.eventDate}}">{{fields.eventDate}}</a>                        </p>                    </div>                </li>                {{/each}}            </ol>        </script>        <div id="streamItemTemplate" class="hide">            <h3>{{actionDesc}}</h3>            <table class="table table-striped">                <tr>                    <th>item</th>                    <td>{{itemTitle}}</td>                </tr>                <tr>                    <th>Exception</th>                    <td>{{data.exception}}</td>                </tr>                <tr>                    <th>Request</th>                    <td>{{jsonAsText data.request}}</td>                </tr>                <tr>                    <th>Message</th>                    <td>{{data.message}}</td>                </tr>                <tr>                    <th>Stack Trace</th>                    <td>                        <pre>{{#each data.stackTrace}}{{.}}        {{/each}}</pre>                    </td>                </tr>            </table>        </div>        <script src="/theme/apps/stream/jquery.stream.js"></script>        <script type="text/javascript">            $(function () {                var win = $(window);                var streamDetails = $('#streamItemDetails');                streamDetails.on({                    'affix.bs.affix': function () {                        flog('affix');                        streamDetails.height(win.height() - $('.navbar-fixed-top').height() - 108);                    },                    'affix-top.bs.affix': function () {                        flog('affix-top');                        streamDetails.height(win.height() - streamDetails.parent().offset().top);                    }                });                win.on('resize', function () {                    streamDetails.css('width', streamDetails.parent().width());                }).trigger('resize');                var reportRange = $('#dateRange');                var searchQuery = $("#searchQuery");                var streamBody = $("#streamBody");                var streamItemTemplateSource = $("#streamItemTemplate").html();                var streamItemTemplate = Handlebars.compile(streamItemTemplateSource);                Handlebars.registerHelper('jsonAsText', function (data) {                    return JSON.stringify(data);                });                streamBody.on("click", ".streamItem", function (e) {                    e.preventDefault();                    streamBody.find('.discussion .other').removeClass('active');                    var a = $(this);                    var href = a.attr("href");                    a.closest('.other').addClass('active');                    $.get(href, function (resp) {                        var doc = $(resp);                        var newItem = doc.find("#streamItemDetails");                        $("#streamItemDetails").html(newItem);                    });                });                function doStreamSearch() {                    var uri = URI(window.location);                    var arr = reportRange.val().split('-');                    var startDate = '';                    var finishDate = '';                    if (arr.length > 0) {                        startDate = arr[0].trim();                    }                    if (arr.length > 1) {                        finishDate = arr[1];                    }                    uri.setSearch("search", searchQuery.val());                    uri.setSearch("startDate", startDate);                    uri.setSearch("finishDate", finishDate);                    history.pushState(null, null, uri.toString());                    uri.path("/stream");                    var searchHref = uri.toString();                    flog("nav", searchHref);                    $("#streamBody").stream("load", searchHref);                }                searchQuery.keyup(function () {                    typewatch(function () {                        flog("do search");                        doStreamSearch();                    }, 500);                });                streamBody.stream();                var uri = URI(window.location);                uri.path("/stream");                var searchHref = uri.toString();                streamBody.stream("load", searchHref);            });        </script>    </body></html>