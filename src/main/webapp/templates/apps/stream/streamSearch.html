<html xmlns="http://www.w3.org/1999/xhtml">    <head>        <title>Stream Search</title>    </head>    <body class="">        <div class="panel panel-default">            <div class="panel-heading">                <i class="fa fa-bar-chart-o"></i>                Activity Stream Search            </div>            <div class="panel-body">                <div class="row">                    <div class="col-sm-6">                        <div class="input-group date-range">                            <label for="dateRange" class="input-group-addon">Time</label>                            <input type="text" id="dateRange" placeholder="Choose a date range" value="" class="form-control" />                        </div>                    </div>                    <div class="col-sm-6">                        <div class="input-group">                            <label for="searchQuery" class="input-group-addon">Search</label>                            <input type="text" placeholder="Search for" id="searchQuery" name="search" class="form-control" />                        </div>                    </div>                </div>                <hr />                <div class="row">                    <div class="col-lg-6">                        <div id="results">                            <div id="streamBody">                                <ol class="discussion">                                    <li class="text-center">                                        <i class="fa fa-spinner fa-spin" style="font-size: 24px"></i>                                    </li>                                </ol>                            </div>                        </div>                    </div>                    <div class="col-lg-6">                        <div id="streamItemDetails">                        </div>                    </div>                </div>                <div class="clearfix"></div>            </div>        </div>        <script type="text/javascript" src="/static/uri/1.15.1/URI.js">//</script>        <script id="entry-template"  type="text/html">            <ol class="discussion" >                {{#each hits.hits}}                <li class="other">                    <div class="avatar">                        {{#unless fields.fullName}}                            <img class="img img-circle" src="/templates/apps/user/profile.png" alt="" />                        {{else}}                            <img class="img img-circle" src="/users/{{fields.userName}}/pic" alt="" />                        {{/unless}}                        <br/>                        <a href="/manageUsers/{{fields.userId}}/" class="avatar-name" title="{{fields.fullName}}">{{fields.fullName}}</a>                    </div>                    <div class='messages'>                        <p>                            <a href="/stream/{{_id}}" class="label label-{{fields.category}} streamItem" style="margin-right: 10px; font-size: 18px">                                <span class="{{itemTypeIcon fields.itemType}}"></span>                            </a>                            {{fields.actionDesc}} <a href="{{itemHref}}">{{fields.itemTitle}}</a>                        </p>                        <p>                            <a href="/stream/{{itemId}}" class="time timeago" title="{{dateFromLong fields.eventDate}}">{{fields.eventDate}}</a>                        </p>                    </div>                </li>                {{/each}}            </ol>        </script>        <div id="streamItemTemplate" class="hide">            <h3>{{actionDesc}}</h3>            <table class="table table-striped">                <tr>                    <th>item</th>                    <td>{{itemTitle}}</td>                </tr>                <tr>                    <th>data</th>                    <td>{{jsonAsText data}}</td>                </tr>            </table>        </div>        <script src="/theme/apps/stream/jquery.stream.js"></script>        <script type="text/javascript">            $(function () {                var reportRange = $('#dateRange');                var searchQuery = $("#searchQuery");                var streamItemTemplateSource = $("#streamItemTemplate").html();                var streamItemTemplate = Handlebars.compile(streamItemTemplateSource);                Handlebars.registerHelper('jsonAsText', function (data) {                    return JSON.stringify(data);                });                $("#streamBody").on("click", ".streamItem", function (e) {                    e.preventDefault();                    var href = $(e.target).closest("a").attr("href");                    $.get(href, function (resp) {                        var data = resp._source;                        flog("item", data);                        var html = streamItemTemplate(data);                        $("#streamItemDetails").html(html);                    });                });                function doStreamSearch() {                    var uri = URI(window.location);                    var arr = reportRange.val().split('-');                    var startDate = '';                    var finishDate = '';                    if (arr.length > 0) {                        startDate = arr[0].trim();                    }                    if (arr.length > 1) {                        finishDate = arr[1];                    }                    uri.setSearch("search", searchQuery.val());                    uri.setSearch("startDate", startDate);                    uri.setSearch("finishDate", finishDate);                    history.pushState(null, null, uri.toString());                    uri.path("/stream");                    var searchHref = uri.toString();                    flog("nav", searchHref);                    $("#streamBody").stream("load", searchHref);                }                reportRange.exist(function () {                    reportRange.daterangepicker({                        format: 'DD/MM/YYYY', // YYYY-MM-DD                        ranges: {                            'Last 7 Days': [moment().subtract('days', 6), moment()],                            'Last 30 Days': [moment().subtract('days', 29), moment()],                            'This Month': [moment().startOf('month'), moment().endOf('month')],                            'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')],                            'This Year': [moment().startOf('year'), moment()],                        },                    },                            function (start, end) {                                flog('onChange', start, end);                                doStreamSearch();                            }                    );                });                $("#searchQuery").keyup(function () {                    typewatch(function () {                        flog("do search");                        doStreamSearch();                    }, 500);                });                $("#streamBody").stream();                var uri = URI(window.location);                uri.path("/stream");                var searchHref = uri.toString();                $("#streamBody").stream("load", searchHref);            });        </script>    </body></html>