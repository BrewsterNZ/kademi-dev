
#if (!$groups)
    #set ($groups = '')
#end
#set($selectedOrgId = "")

#set( $orgCookie = $request.getCookie("selectedOrg") )
#if( $orgCookie )
    #set($selectedOrgId = $orgCookie.getValue())
#else

#end

#if ($profile)
    #set ($orgList = $formatter.newArrayList())
    #foreach($membership in $profile.allMemberships())
        #if ($groups.contains($membership.groupName) && !$orgList.contains($membership.org))
            #call($orgList.add($membership.org))
        #end
    #end

    #set ($selectedOrg = $rootFolder.orgData.childOrg( $selectedOrgId ) )

    <div class="org-selector">
        <div class="dropdown">
            <div class="input-group">
                <input type="text" class="form-control selectOrgSearch" aria-label="Select an organisation" value="$!selectedOrg.title" />
                <input type="hidden" name="searchOrgId"/>
                <div class="input-group-btn">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Select
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu orgSelectorWrap" aria-labelledby="dropdownMenuOrgSelector">
                        #if( $orgList.isEmpty() )
                        <li>No selections available</li>
                        #else
                        <li><a data-orgId="" href="javascript:void (0)"><i class="fa fa-check" style="visibility: hidden"></i>Clear selection</a></li>
                        #foreach( $m in $orgList)
                        #if ($selectedOrg.orgId == $m.orgId)
                        <li><a href="javascript:void (0)"><i class="fa fa-check text-success"></i> $m.title</a></li>
                        #else
                        <li><a data-orgId="$!m.orgId" href="javascript:void (0)"><i class="fa fa-check" style="visibility: hidden"></i> $m.title</a></li>
                        #end
                        #end
                        #end
                    </ul>
                </div><!-- /btn-group -->
            </div><!-- /input-group -->
        </div>
    </div>
#else
#end


#macro( call $foo )#if($foo)#**##end#end