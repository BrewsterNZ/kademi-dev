
#if (!$groups)
    #set ($groups = '')
#end
#set($selectedOrgId = "")

#set( $orgCookie = $request.getCookie("selectedOrg") )
#if( $orgCookie )
    #set($selectedOrgId = $orgCookie.getValue())
#else

#end


#if ($profile)
    #set ($orgList = $formatter.newArrayList())
    #foreach($membership in $profile.allMemberships())
        #if ($groups.contains($membership.groupName) && !$orgList.contains($membership.org))
            #call($orgList.add($membership.org))
            #if ($selectedOrgId == $membership.org.orgId)
                #set ($selectedOrg = $membership.org)
            #end
        #end
    #end
<div class="org-selector">
    <div class="dropdown">
        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenuOrgSelector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            #if( $selectedOrg )
                $selectedOrg.title
            #else
                [All organisations]
            #end
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu orgSelectorWrap" aria-labelledby="dropdownMenuOrgSelector">
            #if( $orgList.isEmpty() )
            <li>No selections available</li>
            #else
            <li><a data-orgId="" href="javascript:void (0)"><i class="fa fa-check" style="visibility: hidden"></i>Clear selection</a></li>
            #foreach( $m in $orgList)
                #if ($selectedOrg.orgId == $m.orgId)
                    <li><a href="javascript:void (0)"><i class="fa fa-check text-success"></i> $m.title</a></li>
                #else
                    <li><a data-orgId="$!m.orgId" href="javascript:void (0)"><i class="fa fa-check" style="visibility: hidden"></i> $m.title</a></li>
                #end
            #end
            #end
        </ul>
    </div>
</div>
#else
#end


#macro( call $foo )#if($foo)#**##end#end