<html>    <head>        <title>Profile</title>        <link href="profile.css" rel="stylesheet" type="text/css" />        <script type="text/javascript" src="/theme/apps/user/changeOrg.js">//</script>        <script type="text/javascript" src="/static/bootstrap-upcrop-image/1.0/bootstrap-upcrop-image.js">//</script>    </head>    <body class="profile">                <div class="container">            <h3>My Profile</h3>            <div class="row row-fluid">                <div class="span6 col-md-6">                                        <div class="details well">                        <form action="$request.absolutePath" method="POST" enctype="multipart/form-data" class="profile form-horizontal form-horizontal-narrow" role="form">                            <h4>Update your details</h4>                            <p class="pageMessage alert alert-danger" style="display: none">                            </p>                            <fieldset class="name">                                <legend>Please update your details below then click the 'Save' button.</legend>                                <div class="control-group form-group row">                                    <label class="control-label col-md-3" for="nickName">Nickname</label>                                    <div class="controls col-md-8">                                        <input type="text" name="nickName" id="nickName" required="true" class="required form-control" value="$!page.profile.nickName"/>                                    </div>                                </div>                                <div class="control-group form-group">                                    <label class="control-label col-md-3" for="nickName">Email</label>                                    <div class="controls col-md-8">                                        <input type="text" id="email" name="email" required="true" class="required form-control" value="$!page.profile.email" />                                                            </div>                                </div>                                <div class="control-group form-group">                                    <label class="control-label col-md-3" for="firstName">First name</label>                                    <div class="controls col-md-8">                                        <input type="text" id="firstName" name="firstName" class="form-control" value="$!page.profile.firstName" />                                    </div>                                </div>                                <div class="control-group form-group">                                    <label class="control-label col-md-3" for="nickName">Surname</label>                                    <div class="controls col-md-8">                                        <input type="text" id="surName" name="surName" class=" form-control" value="$!page.profile.surName" />                                    </div>                                </div>                                <div class="control-group form-group">                                    <label class="control-label col-md-3" for="nickName">Phone</label>                                    <div class="controls col-md-8">                                        <input type="text" id="phone" name="phone" class=" form-control" value="$!page.profile.phone" />                                    </div>                                </div>                                #set($fields = $page.extraFields)                                #foreach($field in $fields.keySet())                                <div class="control-group form-group">                                    <label class="control-label col-md-3" for="field_${field.name}">$field.text</label>                                    <div class="controls col-md-8">                                        $field.html( $fields[$field] )                                    </div>                                </div>                                                            #end                            </fieldset>                            <div class="control-group form-group">                                <div class="controls col-md-offset-3 col-md-8">                                    <button class="btn btn-success" type="submit">Save</button>                                </div>                            </div>                              </form>                                </div>                    #portlets("profilePrimary")                </div>                <div class="span6 col-md-6 profilePic">                    <div class="well well-avatar">                        <p class="confirm">Your profile photo has been updated</p>                        <div>                            <img src="$page.photoHref" class="avatar" /><h4>Update photo</h4>                            <p>Update your profile image below. This must be less then 10Mb</p>                        </div>                        <button id="btn-change-ava" class="btn btn-success">Change avatar</button>                    </div>                    <div class="well well-password">                        <form action="$request.absolutePath" method="POST" class="form-inline" role="form">                            <h4>Update your password</h4>                            <p class="pageMessage alert alert-warning"></p>                            <div class="row">                                <div class="form-group col-md-4">                                    <label class="sr-only" for="password">Enter a new password</label>                                    <input type="password" name="password" id="password" class="required input-medium form-control" placeholder="New password">                                </div>                                <div class="form-group col-md-4">                                    <label class="sr-only" for="confirmPassword">Confirm your new password</label>                                    <input type="password" name="confirmPassword" id="confirmPassword" class="required input-medium form-control" placeholder="Confirm">                                </div>                                <button type="submit" class="btn btn-primary col-md-3">Change</button>                            </div>                            <div class="clearfix"></div>                        </form>                    </div>                    <div class="well well-memberships">                        <form action="$request.absolutePath" method="POST" class="form-inline memberships">                            <img class='ajax-loader' src='/static/common/loading.gif'/>                            <h4>Memberships</h4>                            <ul class='list-unstyled memberships'>                                #foreach($membership in $page.memberships)                                <li>                                    Member of the <b>$membership.groupEntity.name</b> group in                                     #if( $membership.groupEntity.openGroup )                                    <a href="?changeMemberOrg=${membership.id} .change-org-modal-content" data-toggle="modal" data-target="#myModal">$membership.withinOrg.formattedName</a>                                    #else                                    <b>$membership.withinOrg.formattedName</b>                                    #end                                <acronym title='Remove this membership. If this is your last membership you will lose access to this site'>                                    <a href='$membership.id' class='membership-remove'><i class="glyphicon glyphicon-remove-circle icon-remove-circle"></i><span>Remove</span></a>                                </acronym>                                </li>                                #end                            </ul>                        </form>                    </div>                    <div class="well well-unsubscribe">                        <form action="$request.absolutePath" method="POST" class="form-inline form-unsubscribe">                            <img class='ajax-loader' src='/static/common/loading.gif'/>                            <h4>Unsubscribe</h4>                            <p>Unsubscribe from this site. You will no longer receive any email communications, and you will not be able to login.</p>                            <input type="hidden" name="unsubscribe" value="true"/>                            <button class="btn btn-danger">Unsubscribe - $page.profile.email</button>                        </form>                    </div>                                        #if( $page.optins.size() gt 0 )                    <div class="well">                        <form action="." method="POST" class="form-inline optins">                            <img class='ajax-loader' src='/static/common/loading.gif'/>                            <h4>Optional Mailing Lists</h4>                            <ul class='list memberships'>                                #foreach($optin in $page.optins)                                <li>                                    #set($id = "optins_" + $optin.optinGroup.name)                                    <label for="$id" class="optin">                                        $formatter.checkbox($id, "optins", $user.isInGroup($optin.optinGroup) , $optin.optinGroup.name)                                        $optin.message                                    </label>                                </li>                                #end                            </ul>                        </form>                    </div>                                    #end                    <div class="sideBar">                        #portlets("profileSecondary")                    </div>                </div>                        </div>        </div>        <!-- Appears to be a bug affecting bs3, the shown event doesnt fire if using the 'fade' class -->        <div id="myModal" class="modal profile-change-org" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">            <div class="modal-dialog">                <div class="modal-content">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                        <h4 class="modal-title">Change membership</h4>                    </div>                    <div class="modal-body modal-overflow"  id="changeOrgModalBody">                        <p></p>                    </div>                    <div class="modal-footer">                        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>                        <button class="btn btn-primary btn-save">Save changes</button>                    </div>                </div>            </div>        </div>                        <script type="text/javascript" src="/static/js/jquery.fileupload.js">//</script>        <script type="text/javascript" src="/static/js/jquery.milton-upload.js">//</script>        <script type="text/javascript" src="/theme/apps/user/profile.js">//</script>        <script type="text/javascript">            $(function() {                initProfile();                                $('#btn-change-ava').upcropImage({                    url: window.location.pathname, // this is actually the default value anyway                    onCropComplete: function(resp) {                        flog("onCropComplete:", resp, resp.nextHref);                        $(".profile-photo img, img.avatar").attr("src", resp.nextHref);                        $(".modal").modal("hide");                    }                });                            });        </script>            </body></html>