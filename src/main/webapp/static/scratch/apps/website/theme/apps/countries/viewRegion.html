<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Countries</title>
    </head>
    <body class="manageProjects">
        <h2>Region - $page.name</h2>
        <input type="text" id="query" name="query" value="$!request.params.query"/>
        
        #docs($page.attributes.searchResults.hits)
        
        <table class="table">
        <thead>
            <tr>
                <th>Region</th>
                <th>No. Countries</th>
            </tr>
        </thead>
        <tbody id="countriesBody">
        #foreach($hit in $page.attributes.searchResults.hits.hits )
        <tr>
            <td>
                $hit.fields
            </td>
            <td>$hit.sourceAsString</td>
            <td>$hit.score</td>
        </tr>
        #end
        </tbody>
        </table>

        <script type="text/javascript">
        	$("#query").keyup(function () {
        		typewatch(function () {
        			flog("do search");
        			doSearch();
        		}, 500);
        	});
            function doSearch() {
            	var query = $("#query").val();
            	$.ajax({
            		type: 'GET',
            		url: window.location.pathname + "?query=" + query,
            		success: function (data) {
            			flog("success", data);
            			var $fragment = $(data).find("#countriesBody");
            			$("#countriesBody").replaceWith($fragment);
            		},
            		error: function (resp) {
            			Msg.error("An error occured doing the user search. Please check your internet connection and try again");
            		}
            	});
            }        	
        </script>
    </body>
</html>
            
            
            
            
            
            