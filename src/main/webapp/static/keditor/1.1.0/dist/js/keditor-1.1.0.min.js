!function(n){var t=function(){"undefined"!=typeof console&&n.fn.keditor.debug===!0&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log("[KEditor]",arguments[0]):2==arguments.length?console.log("[KEditor]",arguments[0],arguments[1]):arguments.length>2&&console.log("[KEditor]",arguments[0],arguments[1],arguments[2]):console.log(["KEditor"],arguments))},e=function(n){throw new Error("[KEditor] "+n)};n.fn.draggable||e("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),n.fn.droppable||e("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),n.fn.sortable||e("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor."),n.fn.ckeditor?CKEDITOR.disableAutoInline=!0:e("$.fn.ckeditor does not exist. Please import CKEditor and its jQuery adapter into your document for continue using KEditor."),n.fn.keditor=function(n){if(r[n]&&"init"!==n)return r[n].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof n&&n)throw new Error("[KEditor] Method "+n+" does not exist on jquery.keditor");return r.init.apply(this,arguments)},n.fn.keditor.debug=!0,n.fn.keditor.version="1.0.0";var o=n.fn.keditor.DEFAULTS={ckeditor:{allowedContent:!0,bodyId:"editor",templates_replaceContent:!1,enterMode:"P",forceEnterMode:!0,format_tags:"p;h1;h2;h3;h4;h5;h6",format_p2:{element:"p",attributes:{"class":"lessSpace"}},removePlugins:"magicline",minimumChangeMilliseconds:100},snippetsUrl:"snippets/default/snippets.html",snippetsListId:"keditor-snippets-list",onInitContentArea:function(n){},onContentChanged:function(n){},onInitContainer:function(n){},onBeforeContainerDeleted:function(n,t){},onContainerDeleted:function(n,t){},onContainerChanged:function(n,t){},onContainerDuplicated:function(n,t,e){},onContainerSelected:function(n,t){},onContainerSnippetDropped:function(n,t,e){},onCKEditorReady:function(n,t){},onInitComponent:function(n){},onBeforeComponentDeleted:function(n,t){},onComponentDeleted:function(n,t){},onComponentChanged:function(n,t){},onComponentDuplicated:function(n,t,e){},onComponentSelected:function(n,t){},onComponentSnippetDropped:function(n,t,e){}},i={generateId:function(n){var t=(new Date).getTime();return"keditor-"+n+"-"+t},initSidebar:function(r){t("initSidebar",r);var a=n(document.body);a.addClass("opened-keditor-sidebar"),r.snippetsListId===o.snippetsListId?(t("Render default KEditor snippet container"),a.append('<div id="keditor-sidebar">    <a id="keditor-sidebar-toggler"><i class="fa fa-chevron-right"></i></a>    <div id="keditor-snippets-list"></div>    <div id="keditor-snippets-content" style="display: none"></div></div>'),i.initSidebarToggler()):(t('Render KEditor snippets content after custom snippets list with id="'+r.snippetsListId+'"'),n("#"+r.snippetsListId).after('<div id="keditor-snippets-content" style="display: none"></div>')),"string"==typeof r.snippetsUrl&&r.snippetsUrl.length>0?(t('Getting snippets form "'+r.snippetsUrl+'"...'),n.ajax({type:"get",dataType:"html",url:r.snippetsUrl,success:function(n){t("Success in getting snippets",n),i.renderSnippets(n,r),i.initSnippets(r),i.initSnippetsSwitcher(r)},error:function(n){t("Error when getting snippets",n)}})):e('"snippetsUrl" must be not null!')},initSidebarToggler:function(){t("initSidebarToggler");var e=n(document.body);n("#keditor-sidebar-toggler").on("click",function(t){t.preventDefault();var o=n(this).find("i");e.hasClass("opened-keditor-sidebar")?(e.removeClass("opened-keditor-sidebar"),o.attr("class","fa fa-chevron-left")):(e.addClass("opened-keditor-sidebar"),o.attr("class","fa fa-chevron-right"))})},renderSnippets:function(e,o){t("renderSnippets",e,o);var i="",r="",a="";n("<div />").html(e).find("> div").each(function(e){var o=n(this),s=o.html().trim(),d=o.attr("data-preview"),c=o.attr("data-type"),l="";t("Snippet #"+e+" type="+c,d,s),l+='<section class="keditor-snippet" data-snippet="#keditor-snippet-'+e+'" data-type="'+c+'">',l+='   <img class="keditor-snippet-preview" src="'+d+'" />',l+="</section>","container"===c?i+=l:"component"===c&&(r+=l),a+='<div id="keditor-snippet-'+e+'" style="display: none;">'+s+"</div>"}),n("#"+o.snippetsListId).html('<ul id="keditor-snippets-type-switcher" class="nav nav-tabs nav-justified">    <li class="active"><a href="#keditor-container-snippets">Containers</a></li>    <li><a href="#keditor-component-snippets">Components</a></li></ul><div id="keditor-snippets-container" class="tab-content">   <div class="tab-pane keditor-snippets active" id="keditor-container-snippets">'+i+'</div>   <div class="tab-pane keditor-snippets" id="keditor-component-snippets">'+r+"</div></div>").addClass("loaded-snippets"),n("#keditor-snippets-content").html(a)},initSnippets:function(e){t("initSnippets",e);var o=n("#"+e.snippetsListId);n.fn.niceScroll?(t("Initialize $.fn.niceScroll for snippets list"),o.find(".keditor-snippets").niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:""})):t("$.fn.niceScroll does not exist. Use default sidebar."),t("Initialize $.fn.draggable for container snippets list"),o.find(".keditor-snippet[data-type=container]").draggable({helper:"clone",revert:"invalid",connectToSortable:".keditor-content-area",start:function(){n("[contenteditable]").blur(),n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}}),o.find(".keditor-snippet[data-type=component]").draggable({helper:"clone",revert:"invalid",connectToSortable:".keditor-container-content",start:function(){n("[contenteditable]").blur(),n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n(document.body).addClass("highlighted-container-content")},stop:function(){n(document.body).removeClass("highlighted-container-content")}})},initSnippetsSwitcher:function(e){t("initSnippetsSwitcher",e);var o=n("#keditor-snippets-type-switcher li"),i=n("#keditor-snippets-container .keditor-snippets");o.find("a").on("click",function(t){t.preventDefault();var e=n(this),r=e.parent(),a=e.attr("href");if(!r.hasClass("active")){var s=o.filter(".active"),d=i.filter(".active"),c=n(a);s.removeClass("active"),d.removeClass("active"),r.addClass("active"),c.addClass("active"),n.fn.niceScroll&&(d.getNiceScroll().hide(),c.getNiceScroll().show())}})},initContentArea:function(e,o){if(t("initContentArea",e,o),e.addClass("keditor-content-area"),t("Initialize $.fn.droppable for content area"),e.droppable({accept:".keditor-snippet[data-type=container]",tolerance:"pointer",greedy:!0}),t("Initialize $.fn.sortable for content area"),e.sortable({handle:".btn-container-reposition",items:"> section",connectWith:".keditor-content-area",axis:"y",tolerance:"pointer",sort:function(){n(this).removeClass("ui-state-default")},receive:function(r,a){t("On received snippet",r,a);var s=a.helper,d=a.item;if(d.is(".keditor-snippet")){var c=n(d.attr("data-snippet")).html();t("Snippet content",c);var l=n('<section class="keditor-container">   <section class="keditor-container-inner">'+c+"</section></section>");s.replaceWith(l),l.hasClass("showed-keditor-toolbar")||(n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),l.addClass("showed-keditor-toolbar")),"function"==typeof o.onContainerSnippetDropped&&o.onContainerSnippetDropped.call(e,r,l,a.item),i.initContainer(e,l,o)}"function"==typeof o.onContentChanged&&o.onContentChanged.call(e,r)}}),t("Initialize existing containers in content area"),e.children("section").each(function(){i.convertToContainer(e,n(this),o)}),"function"==typeof o.onInitContentArea){var r=o.onInitContentArea.call(e,e);r&&r.length>0&&n.each(r,function(){i.convertToContainer(e,n(this),o)})}},convertToContainer:function(n,t,e){var o,r=t.is("section");r?(t.addClass("keditor-container"),t.wrapInner('<section class="keditor-container-inner"></section>'),o=t):(t.wrap('<section class="keditor-container"><section class="keditor-container-inner"></section></section>'),o=t.parent().parent()),i.initContainer(n,o,e)},initContainer:function(e,o,r){if(t("initContainer",e,o,r),o.hasClass("keditor-initialized-container")&&o.hasClass("keditor-initializing-container"))t(o.hasClass("keditor-initialized-container")?"Container is already initialized!":"Container is initializing...");else{o.addClass("keditor-initializing-container"),t("Render KEditor toolbar for container",o),o.append('<div class="keditor-toolbar keditor-toolbar-container">   <a href="#" class="btn-container-reposition"><i class="fa fa-sort"></i></a>   <a href="#" class="btn-container-duplicate"><i class="fa fa-files-o"></i></a>   <a href="#" class="btn-container-delete"><i class="fa fa-times"></i></a></div>');var a=i.generateId("container");t("Id for container is: "+a),o.attr("id",a);var s=o.find('[data-type="container-content"]');t("Initialize "+s.length+" container content(s)"),s.each(function(){var t=n(this);i.initContainerContent(e,o,t,r)}),"function"==typeof r.onInitContainer&&r.onInitContainer.call(e,o),o.addClass("keditor-initialized-container"),o.removeClass("keditor-initializing-container")}},initContainerContent:function(e,o,r,a){t("initContainerContent",e,o,r,a);var s=i.generateId("container-content");r.addClass("keditor-container-content"),t("Id for container content id: "+s,r),r.attr("id",s),t("Initialize $.fn.droppable for container content"),r.droppable({accept:".keditor-snippet[data-type=component]",tolerance:"pointer",greedy:!0}),t("Initialize $.fn.sortable for container content"),r.sortable({handle:".btn-component-reposition",items:"> section",connectWith:".keditor-container-content",tolerance:"pointer",sort:function(){n(this).removeClass("ui-state-default")},receive:function(o,r){t("On received snippet",o,r);var s,d=r.helper,c=r.item;if(c.is(".keditor-snippet")){var l=n(c.attr("data-snippet")).html();t("Snippet content",l);var p=n('<section class="keditor-component">   <section class="keditor-component-content">'+l+"</section></section>");d.replaceWith(p),s=p.closest(".keditor-container"),"function"==typeof a.onComponentSnippetDropped&&a.onComponentSnippetDropped.call(e,o,p,r.item),i.initComponent(e,s,p,a)}else s=c.closest(".keditor-container");s.hasClass("showed-keditor-toolbar")||(n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar")),"function"==typeof a.onContainerChanged&&a.onContainerChanged.call(e,o,s),"function"==typeof a.onContentChanged&&a.onContentChanged.call(e,o)}}),t("Initialize existing components inside container content"),r.children().each(function(){var t=n(this);i.convertToComponent(e,o,t,a)})},convertToComponent:function(n,t,e,o){var r,a=e.is("section");a?(e.addClass("keditor-component"),e.wrapInner('<section class="keditor-component-content"></section>'),r=e):(e.wrap('<section class="keditor-component"><section class="keditor-component-content"></section></section>'),r=e.parent().parent()),i.initComponent(n,t,r,o)},initComponent:function(n,e,o,r){if(t("initComponent",n,e,o,r),o.hasClass("keditor-initialized-component")&&o.hasClass("keditor-initializing-component"))t(o.hasClass("keditor-initialized-component")?"Component is already initialized!":"Component is initializing...");else{o.addClass("keditor-initializing-component"),t("Render KEditor toolbar for component",o),o.append('<div class="keditor-toolbar keditor-toolbar-component">   <a href="#" class="btn-component-reposition"><i class="fa fa-arrows"></i></a>   <a href="#" class="btn-component-duplicate"><i class="fa fa-files-o"></i></a>   <a href="#" class="btn-component-delete"><i class="fa fa-times"></i></a></div>'),t("Initialize CKEditor for component",o);var a=o.children(".keditor-component-content");a.prop("contenteditable",!0);var s=i.generateId("component-content");t("Id for component content is: "+s),a.attr("id",s),a.on("input",function(t){"function"==typeof r.onComponentChanged&&r.onComponentChanged.call(n,t,o),"function"==typeof r.onContainerChanged&&r.onContainerChanged.call(n,t,e),"function"==typeof r.onContentChanged&&r.onContentChanged.call(n,t)});var d=a.ckeditor(r.ckeditor).editor;d.on("instanceReady",function(){t("CKEditor is ready",o),"function"==typeof r.onCKEditorReady&&r.onCKEditorReady.call(n,o,d)}),"function"==typeof r.onInitComponent&&r.onInitComponent.call(n,o),o.addClass("keditor-initialized-component"),o.removeClass("keditor-initializing-component")}},getClickedElement:function(t,e){var o=n(t.target),i=o.closest(e);return o.is(e)?o:i.length>0?i:null},initKEditorClicks:function(e){t("initKEditorClicks",e);var o=n(document.body);o.on("click",function(o){var r=i.getClickedElement(o,".keditor-container");if(r){if(t("Click on .keditor-container",r,r.hasClass("showed-keditor-toolbar")),!r.hasClass("showed-keditor-toolbar")){n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),r.addClass("showed-keditor-toolbar");var a=r.parent();"function"==typeof e.onContainerSelected&&e.onContainerSelected.call(a,o,r)}}else n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar");var s=i.getClickedElement(o,".keditor-component");if(s){if(t("Click on .keditor-component",s),!s.hasClass("showed-keditor-toolbar")){n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar");var a=s.parent();"function"==typeof e.onComponentSelected&&e.onComponentSelected.call(a,o,s)}}else n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}),o.on("click",".btn-container-duplicate",function(o){o.preventDefault();var r=n(this);t("Click on .btn-container-duplicate",r);var a=r.closest(".keditor-container"),s=a.parent(),d=n(i.getContainerContent(a));a.after(d),i.convertToContainer(s,d,e),t("Container is duplicated"),"function"==typeof e.onContainerDuplicated&&e.onContainerDuplicated.call(s,a,d),"function"==typeof e.onContentChanged&&e.onContentChanged.call(s,o)}),o.on("click",".btn-container-delete",function(o){o.preventDefault();var r=n(this);if(t("Click on .btn-container-delete",r),confirm("Are you sure that you want to delete this container? This action can not be undo!")){var a=r.closest(".keditor-container"),s=a.find(".keditor-component"),d=a.parent();"function"==typeof e.onBeforeContainerDeleted&&e.onBeforeContainerDeleted.call(d,o,a),s.length>0&&s.each(function(){i.deleteComponent(n(this))}),a.remove(),"function"==typeof e.onContainerDeleted&&e.onContainerDeleted.call(d,o,a),"function"==typeof e.onContentChanged&&e.onContentChanged.call(d,o)}}),o.on("click",".btn-component-duplicate",function(o){o.preventDefault();var r=n(this);t("Click on .btn-component-duplicate",r);var a=r.closest(".keditor-component"),s=a.closest(".keditor-container"),d=s.parent(),c=n(i.getComponentContent(a));a.after(c),i.convertToComponent(d,s,c,e),t("Component is duplicated"),"function"==typeof e.onComponentDuplicated&&e.onComponentDuplicated.call(d,a,c),"function"==typeof e.onContainerChanged&&e.onContainerChanged.call(d,o,s),"function"==typeof e.onContentChanged&&e.onContentChanged.call(d,o)}),o.on("click",".btn-component-delete",function(o){o.preventDefault();var r=n(this);if(t("Click on .btn-component-delete",r),confirm("Are you sure that you want to delete this component? This action can not be undo!")){var a=r.closest(".keditor-component"),s=a.closest(".keditor-content-area");"function"==typeof e.onBeforeComponentDeleted&&e.onBeforeComponentDeleted.call(s,o,a),i.deleteComponent(a),"function"==typeof e.onComponentDeleted&&e.onComponentDeleted.call(s,o,a),"function"==typeof e.onContainerChanged&&e.onContainerChanged.call(s,o,a),"function"==typeof e.onContentChanged&&e.onContentChanged.call(s,o)}})},deleteComponent:function(n){t("deleteComponent",n);var e=n.children(".keditor-component-content"),o=e.attr("id"),i=CKEDITOR.instances[o];i&&i.destroy(),n.remove()},getComponentContent:function(n){var t=n.find(".keditor-component-content").attr("id");return"<section>"+CKEDITOR.instances[t].getData()+"</section>"},getContainerContent:function(t){var e=t.children(".keditor-container-inner").clone();return e.find("[data-type=container-content]").each(function(){var t=n(this);t.removeClass("keditor-container-content ui-droppable ui-sortable").removeAttr("id"),t.children(".keditor-component").each(function(){var t=n(this);t.replaceWith(i.getComponentContent(t))})}),"<section>"+e.html()+"</section>"}},r={init:function(e){var r=n(this);e=n.extend({},o,e),r.each(function(){var e=n(this);if(0===e.attr("id").length){t("Content area does not contain Id. Generating id for content area...");var o=i.generateId("content-area");e.attr("id",o),t('Id for content are is: "'+o+'"')}});var a=n("#"+e.snippetsListId);return a.hasClass("loaded-snippets")?t("Snippets list is already initialized!"):i.initSidebar(e),i.initKEditorClicks(e),r.each(function(){var o=n(this);o.data("keditorOptions")?t("KEditor is already initialized!"):(o.data("keditorOptions",e),i.initContentArea(o,e))}),r},getContent:function(){var t=n(this),e="";return t.children(".keditor-container").each(function(){var t=n(this);e+=i.getContainerContent(t)}),e}}}(jQuery);
//# sourceMappingURL=keditor-1.1.0.min.js.map
