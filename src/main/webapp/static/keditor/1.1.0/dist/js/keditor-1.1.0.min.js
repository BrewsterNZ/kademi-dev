!function(n){var e=function(){"undefined"!=typeof console&&n.fn.keditor.debug===!0&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log("[KEditor]",arguments[0]):2==arguments.length?console.log("[KEditor]",arguments[0],arguments[1]):arguments.length>2&&console.log("[KEditor]",arguments[0],arguments[1],arguments[2]):console.log(["KEditor"],arguments))},t=function(n){throw new Error("[KEditor] "+n)};n.fn.draggable||t("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),n.fn.droppable||t("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),n.fn.sortable||t("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor."),n.fn.ckeditor?CKEDITOR.disableAutoInline=!0:t("$.fn.ckeditor does not exist. Please import CKEditor and its jQuery adapter into your document for continue using KEditor."),n.fn.keditor=function(n){if(r[n]&&"init"!==n)return r[n].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof n&&n)throw new Error("[KEditor] Method "+n+" does not exist on jquery.keditor");return r.init.apply(this,arguments)},n.fn.keditor.debug=!0,n.fn.keditor.version="1.0.0";var o=n.fn.keditor.DEFAULTS={ckeditor:{allowedContent:!0,bodyId:"editor",templates_replaceContent:!1,enterMode:"P",forceEnterMode:!0,format_tags:"p;h1;h2;h3;h4;h5;h6",format_p2:{element:"p",attributes:{"class":"lessSpace"}},removePlugins:"magicline",minimumChangeMilliseconds:100},snippetsUrl:"snippets/default/snippets.html",snippetsListId:"keditor-snippets-list",onSidebarToggled:function(n){},onInitContentArea:function(n){},onContentChanged:function(n){},onInitContainer:function(n){},onBeforeContainerDeleted:function(n,e){},onContainerDeleted:function(n,e){},onContainerChanged:function(n,e){},onContainerDuplicated:function(n,e,t){},onContainerSelected:function(n,e){},onContainerSnippetDropped:function(n,e,t){},onCKEditorReady:function(n,e){},onInitComponent:function(n){},onBeforeComponentDeleted:function(n,e){},onComponentDeleted:function(n,e){},onComponentChanged:function(n,e){},onComponentDuplicated:function(n,e,t){},onComponentSelected:function(n,e){},onComponentSnippetDropped:function(n,e,t){}},i={generateId:function(n){var e=(new Date).getTime();return"keditor-"+n+"-"+e},initSidebar:function(r){e("initSidebar",r);var a=n(document.body);a.addClass("opened-keditor-sidebar"),r.snippetsListId===o.snippetsListId?(e("Render default KEditor snippet container"),a.append('<div id="keditor-sidebar">    <a id="keditor-sidebar-toggler"><i class="fa fa-chevron-right"></i></a>    <div id="keditor-snippets-list"></div>    <div id="keditor-snippets-content" style="display: none"></div></div>'),i.initSidebarToggler(r)):(e('Render KEditor snippets content after custom snippets list with id="'+r.snippetsListId+'"'),n("#"+r.snippetsListId).after('<div id="keditor-snippets-content" style="display: none"></div>')),"string"==typeof r.snippetsUrl&&r.snippetsUrl.length>0?(e('Getting snippets form "'+r.snippetsUrl+'"...'),n.ajax({type:"get",dataType:"html",url:r.snippetsUrl,success:function(n){e("Success in getting snippets",n),i.renderSnippets(n,r),i.initSnippets(r),i.initSnippetsSwitcher(r)},error:function(n){e("Error when getting snippets",n)}})):t('"snippetsUrl" must be not null!')},initSidebarToggler:function(t){e("initSidebarToggler",t);var o=n(document.body);n("#keditor-sidebar-toggler").on("click",function(e){e.preventDefault();var i=n(this).find("i"),r=o.hasClass("opened-keditor-sidebar");r?(o.removeClass("opened-keditor-sidebar"),i.attr("class","fa fa-chevron-left")):(o.addClass("opened-keditor-sidebar"),i.attr("class","fa fa-chevron-right")),"function"==typeof t.onSidebarToggled&&t.onSidebarToggled.call(null,!r)})},renderSnippets:function(t,o){e("renderSnippets",t,o);var i="",r="",a="";n("<div />").html(t).find("> div").each(function(t){var o=n(this),s=o.html().trim(),d=o.attr("data-preview"),c=o.attr("data-type"),l="";e("Snippet #"+t+" type="+c,d,s),l+='<section class="keditor-snippet" data-snippet="#keditor-snippet-'+t+'" data-type="'+c+'">',l+='   <img class="keditor-snippet-preview" src="'+d+'" />',l+="</section>","container"===c?i+=l:"component"===c&&(r+=l),a+='<div id="keditor-snippet-'+t+'" style="display: none;">'+s+"</div>"}),n("#"+o.snippetsListId).html('<ul id="keditor-snippets-type-switcher" class="nav nav-tabs nav-justified">    <li class="active"><a href="#keditor-container-snippets">Containers</a></li>    <li><a href="#keditor-component-snippets">Components</a></li></ul><div id="keditor-snippets-container" class="tab-content">   <div class="tab-pane keditor-snippets active" id="keditor-container-snippets">'+i+'</div>   <div class="tab-pane keditor-snippets" id="keditor-component-snippets">'+r+"</div></div>").addClass("loaded-snippets"),n("#keditor-snippets-content").html(a)},initSnippets:function(t){e("initSnippets",t);var o=n("#"+t.snippetsListId);n.fn.niceScroll?(e("Initialize $.fn.niceScroll for snippets list"),o.find(".keditor-snippets").niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:""})):e("$.fn.niceScroll does not exist. Use default sidebar."),e("Initialize $.fn.draggable for container snippets list"),o.find(".keditor-snippet[data-type=container]").draggable({helper:"clone",revert:"invalid",connectToSortable:".keditor-content-area",start:function(){n("[contenteditable]").blur(),n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}}),o.find(".keditor-snippet[data-type=component]").draggable({helper:"clone",revert:"invalid",connectToSortable:".keditor-container-content",start:function(){n("[contenteditable]").blur(),n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n(document.body).addClass("highlighted-container-content")},stop:function(){n(document.body).removeClass("highlighted-container-content")}})},initSnippetsSwitcher:function(t){e("initSnippetsSwitcher",t);var o=n("#keditor-snippets-type-switcher li"),i=n("#keditor-snippets-container .keditor-snippets");o.find("a").on("click",function(e){e.preventDefault();var t=n(this),r=t.parent(),a=t.attr("href");if(!r.hasClass("active")){var s=o.filter(".active"),d=i.filter(".active"),c=n(a);s.removeClass("active"),d.removeClass("active"),r.addClass("active"),c.addClass("active"),n.fn.niceScroll&&(d.getNiceScroll().hide(),c.getNiceScroll().show())}})},initContentArea:function(t,o){if(e("initContentArea",t,o),t.addClass("keditor-content-area"),e("Initialize $.fn.droppable for content area"),t.droppable({accept:".keditor-snippet[data-type=container]",tolerance:"pointer",greedy:!0}),e("Initialize $.fn.sortable for content area"),t.sortable({handle:".btn-container-reposition",items:"> section",connectWith:".keditor-content-area",axis:"y",tolerance:"pointer",sort:function(){n(this).removeClass("ui-state-default")},receive:function(r,a){e("On received snippet",r,a);var s=a.helper,d=a.item;if(d.is(".keditor-snippet")){var c=n(d.attr("data-snippet")).html();e("Snippet content",c);var l=n('<section class="keditor-container">   <section class="keditor-container-inner">'+c+"</section></section>");s.replaceWith(l),l.hasClass("showed-keditor-toolbar")||(n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),l.addClass("showed-keditor-toolbar")),"function"==typeof o.onContainerSnippetDropped&&o.onContainerSnippetDropped.call(t,r,l,a.item),i.initContainer(t,l,o)}"function"==typeof o.onContentChanged&&o.onContentChanged.call(t,r)}}),e("Initialize existing containers in content area"),t.children("section").each(function(){i.convertToContainer(t,n(this),o)}),"function"==typeof o.onInitContentArea){var r=o.onInitContentArea.call(t,t);r&&r.length>0&&n.each(r,function(){i.convertToContainer(t,n(this),o)})}},convertToContainer:function(n,e,t){var o,r=e.is("section");r?(e.addClass("keditor-container"),e.wrapInner('<section class="keditor-container-inner"></section>'),o=e):(e.wrap('<section class="keditor-container"><section class="keditor-container-inner"></section></section>'),o=e.parent().parent()),i.initContainer(n,o,t)},initContainer:function(t,o,r){if(e("initContainer",t,o,r),o.hasClass("keditor-initialized-container")&&o.hasClass("keditor-initializing-container"))e(o.hasClass("keditor-initialized-container")?"Container is already initialized!":"Container is initializing...");else{o.addClass("keditor-initializing-container"),e("Render KEditor toolbar for container",o),o.append('<div class="keditor-toolbar keditor-toolbar-container">   <a href="#" class="btn-container-reposition"><i class="fa fa-sort"></i></a>   <a href="#" class="btn-container-duplicate"><i class="fa fa-files-o"></i></a>   <a href="#" class="btn-container-delete"><i class="fa fa-times"></i></a></div>');var a=i.generateId("container");e("Id for container is: "+a),o.attr("id",a);var s=o.find('[data-type="container-content"]');e("Initialize "+s.length+" container content(s)"),s.each(function(){var e=n(this);i.initContainerContent(t,o,e,r)}),"function"==typeof r.onInitContainer&&r.onInitContainer.call(t,o),o.addClass("keditor-initialized-container"),o.removeClass("keditor-initializing-container")}},initContainerContent:function(t,o,r,a){e("initContainerContent",t,o,r,a);var s=i.generateId("container-content");r.addClass("keditor-container-content"),e("Id for container content id: "+s,r),r.attr("id",s),e("Initialize $.fn.droppable for container content"),r.droppable({accept:".keditor-snippet[data-type=component]",tolerance:"pointer",greedy:!0}),e("Initialize $.fn.sortable for container content"),r.sortable({handle:".btn-component-reposition",items:"> section",connectWith:".keditor-container-content",tolerance:"pointer",sort:function(){n(this).removeClass("ui-state-default")},receive:function(o,r){e("On received snippet",o,r);var s,d=r.helper,c=r.item;if(c.is(".keditor-snippet")){var l=n(c.attr("data-snippet")).html();e("Snippet content",l);var p=n('<section class="keditor-component">   <section class="keditor-component-content">'+l+"</section></section>");d.replaceWith(p),s=p.closest(".keditor-container"),"function"==typeof a.onComponentSnippetDropped&&a.onComponentSnippetDropped.call(t,o,p,r.item),i.initComponent(t,s,p,a)}else s=c.closest(".keditor-container");s.hasClass("showed-keditor-toolbar")||(n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar")),"function"==typeof a.onContainerChanged&&a.onContainerChanged.call(t,o,s),"function"==typeof a.onContentChanged&&a.onContentChanged.call(t,o)}}),e("Initialize existing components inside container content"),r.children().each(function(){var e=n(this);i.convertToComponent(t,o,e,a)})},convertToComponent:function(n,e,t,o){var r,a=t.is("section");a?(t.addClass("keditor-component"),t.wrapInner('<section class="keditor-component-content"></section>'),r=t):(t.wrap('<section class="keditor-component"><section class="keditor-component-content"></section></section>'),r=t.parent().parent()),i.initComponent(n,e,r,o)},initComponent:function(n,t,o,r){if(e("initComponent",n,t,o,r),o.hasClass("keditor-initialized-component")&&o.hasClass("keditor-initializing-component"))e(o.hasClass("keditor-initialized-component")?"Component is already initialized!":"Component is initializing...");else{o.addClass("keditor-initializing-component"),e("Render KEditor toolbar for component",o),o.append('<div class="keditor-toolbar keditor-toolbar-component">   <a href="#" class="btn-component-reposition"><i class="fa fa-arrows"></i></a>   <a href="#" class="btn-component-duplicate"><i class="fa fa-files-o"></i></a>   <a href="#" class="btn-component-delete"><i class="fa fa-times"></i></a></div>'),e("Initialize CKEditor for component",o);var a=o.children(".keditor-component-content");a.prop("contenteditable",!0);var s=i.generateId("component-content");e("Id for component content is: "+s),a.attr("id",s),a.on("input",function(e){"function"==typeof r.onComponentChanged&&r.onComponentChanged.call(n,e,o),"function"==typeof r.onContainerChanged&&r.onContainerChanged.call(n,e,t),"function"==typeof r.onContentChanged&&r.onContentChanged.call(n,e)});var d=a.ckeditor(r.ckeditor).editor;d.on("instanceReady",function(){e("CKEditor is ready",o),"function"==typeof r.onCKEditorReady&&r.onCKEditorReady.call(n,o,d)}),"function"==typeof r.onInitComponent&&r.onInitComponent.call(n,o),o.addClass("keditor-initialized-component"),o.removeClass("keditor-initializing-component")}},getClickedElement:function(e,t){var o=n(e.target),i=o.closest(t);return o.is(t)?o:i.length>0?i:null},initKEditorClicks:function(t){e("initKEditorClicks",t);var o=n(document.body);o.on("click",function(o){var r=i.getClickedElement(o,".keditor-container");if(r){if(e("Click on .keditor-container",r,r.hasClass("showed-keditor-toolbar")),!r.hasClass("showed-keditor-toolbar")){n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),r.addClass("showed-keditor-toolbar");var a=r.parent();"function"==typeof t.onContainerSelected&&t.onContainerSelected.call(a,o,r)}}else n(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar");var s=i.getClickedElement(o,".keditor-component");if(s){if(e("Click on .keditor-component",s),!s.hasClass("showed-keditor-toolbar")){n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar");var a=s.parent();"function"==typeof t.onComponentSelected&&t.onComponentSelected.call(a,o,s)}}else n(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}),o.on("click",".btn-container-duplicate",function(o){o.preventDefault();var r=n(this);e("Click on .btn-container-duplicate",r);var a=r.closest(".keditor-container"),s=a.parent(),d=n(i.getContainerContent(a));a.after(d),i.convertToContainer(s,d,t),e("Container is duplicated"),"function"==typeof t.onContainerDuplicated&&t.onContainerDuplicated.call(s,a,d),"function"==typeof t.onContentChanged&&t.onContentChanged.call(s,o)}),o.on("click",".btn-container-delete",function(o){o.preventDefault();var r=n(this);if(e("Click on .btn-container-delete",r),confirm("Are you sure that you want to delete this container? This action can not be undo!")){var a=r.closest(".keditor-container"),s=a.find(".keditor-component"),d=a.parent();"function"==typeof t.onBeforeContainerDeleted&&t.onBeforeContainerDeleted.call(d,o,a),s.length>0&&s.each(function(){i.deleteComponent(n(this))}),a.remove(),"function"==typeof t.onContainerDeleted&&t.onContainerDeleted.call(d,o,a),"function"==typeof t.onContentChanged&&t.onContentChanged.call(d,o)}}),o.on("click",".btn-component-duplicate",function(o){o.preventDefault();var r=n(this);e("Click on .btn-component-duplicate",r);var a=r.closest(".keditor-component"),s=a.closest(".keditor-container"),d=s.parent(),c=n(i.getComponentContent(a));a.after(c),i.convertToComponent(d,s,c,t),e("Component is duplicated"),"function"==typeof t.onComponentDuplicated&&t.onComponentDuplicated.call(d,a,c),"function"==typeof t.onContainerChanged&&t.onContainerChanged.call(d,o,s),"function"==typeof t.onContentChanged&&t.onContentChanged.call(d,o)}),o.on("click",".btn-component-delete",function(o){o.preventDefault();var r=n(this);if(e("Click on .btn-component-delete",r),confirm("Are you sure that you want to delete this component? This action can not be undo!")){var a=r.closest(".keditor-component"),s=a.closest(".keditor-content-area");"function"==typeof t.onBeforeComponentDeleted&&t.onBeforeComponentDeleted.call(s,o,a),i.deleteComponent(a),"function"==typeof t.onComponentDeleted&&t.onComponentDeleted.call(s,o,a),"function"==typeof t.onContainerChanged&&t.onContainerChanged.call(s,o,a),"function"==typeof t.onContentChanged&&t.onContentChanged.call(s,o)}})},deleteComponent:function(n){e("deleteComponent",n);var t=n.children(".keditor-component-content"),o=t.attr("id"),i=CKEDITOR.instances[o];i&&i.destroy(),n.remove()},getComponentContent:function(n){var e=n.find(".keditor-component-content").attr("id");return"<section>"+CKEDITOR.instances[e].getData()+"</section>"},getContainerContent:function(e){var t=e.children(".keditor-container-inner").clone();return t.find("[data-type=container-content]").each(function(){var e=n(this);e.removeClass("keditor-container-content ui-droppable ui-sortable").removeAttr("id"),e.children(".keditor-component").each(function(){var e=n(this);e.replaceWith(i.getComponentContent(e))})}),"<section>"+t.html()+"</section>"}},r={init:function(t){var r=n(this);t=n.extend({},o,t),r.each(function(){var t=n(this);if(0===t.attr("id").length){e("Content area does not contain Id. Generating id for content area...");var o=i.generateId("content-area");t.attr("id",o),e('Id for content are is: "'+o+'"')}});var a=n("#"+t.snippetsListId);return a.hasClass("loaded-snippets")?e("Snippets list is already initialized!"):i.initSidebar(t),i.initKEditorClicks(t),r.each(function(){var o=n(this);o.data("keditorOptions")?e("KEditor is already initialized!"):(o.data("keditorOptions",t),i.initContentArea(o,t))}),r},getContent:function(){var e=n(this),t="";return e.children(".keditor-container").each(function(){var e=n(this);t+=i.getContainerContent(e)}),t}}}(jQuery);
//# sourceMappingURL=keditor-1.1.0.min.js.map
