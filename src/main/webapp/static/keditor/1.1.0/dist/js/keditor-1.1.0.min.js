!function(t){var e=function(){"undefined"!=typeof console&&o.debug===!0&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log("[KEditor]",arguments[0]):2==arguments.length?console.log("[KEditor]",arguments[0],arguments[1]):arguments.length>2&&console.log("[KEditor]",arguments[0],arguments[1],arguments[2]):console.log(["KEditor"],arguments))},n=function(t){throw new Error("[KEditor] "+t)};t.fn.draggable||n("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),t.fn.droppable||n("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),t.fn.sortable||n("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor.");var o=t.keditor={debug:!0,version:"1.1.0",log:e,error:n,DEFAULTS:{btnMoveContainerText:'<i class="fa fa-sort"></i>',btnMoveComponentText:'<i class="fa fa-arrows"></i>',btnSettingContainerText:'<i class="fa fa-cog"></i>',btnSettingComponentText:'<i class="fa fa-cog"></i>',btnDuplicateContainerText:'<i class="fa fa-files-o"></i>',btnDuplicateComponentText:'<i class="fa fa-files-o"></i>',btnDeleteContainerText:'<i class="fa fa-times"></i>',btnDeleteComponentText:'<i class="fa fa-times"></i>',defaultComponentType:"text",snippetsUrl:"snippets/default/snippets.html",snippetsListId:"keditor-snippets-list",onInitContentArea:function(t){},onContentChanged:function(t){},onInitContainer:function(t){},onBeforeContainerDeleted:function(t,e){},onContainerDeleted:function(t,e){},onContainerChanged:function(t,e){},onContainerDuplicated:function(t,e,n){},onContainerSelected:function(t,e){},onContainerSnippetDropped:function(t,e,n){},onComponentReady:function(t){},onInitComponent:function(t){},onBeforeComponentDeleted:function(t,e){},onComponentDeleted:function(t,e){},onComponentChanged:function(t,e){},onComponentDuplicated:function(t,e,n){},onComponentSelected:function(t,e){},onComponentSnippetDropped:function(t,e,n){}},components:{},generateId:function(t){var e=(new Date).getTime();return"keditor-"+t+"-"+e},initNiceScroll:function(n){e("initNiceScroll",n),t.fn.niceScroll?(e("Initialize $.fn.niceScroll"),n.niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:""})):e("$.fn.niceScroll does not exist. Use default sidebar.")},initSidebar:function(i){e("initSidebar",i);var a=t(document.body);a.addClass("opened-keditor-sidebar"),i.snippetsListId===o.DEFAULTS.snippetsListId?(e("Render default KEditor snippet container"),a.append('<div id="keditor-sidebar">   <a id="keditor-sidebar-toggler"><i class="fa fa-chevron-right"></i></a>   <div id="keditor-snippets-list"></div>   <div id="keditor-snippets-content" style="display: none"></div>   <div id="keditor-setting-panel">       <div id="keditor-setting-header"><span id="keditor-setting-title"></span><a href="#" id="keditor-setting-closer"><i class="fa fa-arrow-right"></i></a></div>       <div id="keditor-setting-body"><div id="keditor-setting-forms"></div></div>   </div></div>'),o.initSidebarToggler()):(e('Render KEditor snippets content after custom snippets list with id="'+i.snippetsListId+'"'),t("#"+i.snippetsListId).after('<div id="keditor-snippets-content" style="display: none"></div>')),"string"==typeof i.snippetsUrl&&i.snippetsUrl.length>0?(e('Getting snippets form "'+i.snippetsUrl+'"...'),t.ajax({type:"get",dataType:"html",url:i.snippetsUrl,success:function(t){e("Success in getting snippets",t),o.renderSnippets(t,i),o.initSnippets(i),o.initSnippetsSwitcher(i),o.initSettingPanel(i)},error:function(t){e("Error when getting snippets",t)}})):n('"snippetsUrl" must be not null!')},initSidebarToggler:function(){e("initSidebarToggler");var n=t(document.body);t("#keditor-sidebar-toggler").on("click",function(e){e.preventDefault();var o=t(this).find("i");n.hasClass("opened-keditor-sidebar")?(n.removeClass("opened-keditor-sidebar"),o.attr("class","fa fa-chevron-left")):(n.addClass("opened-keditor-sidebar"),o.attr("class","fa fa-chevron-right"))})},renderSnippets:function(n,o){e("renderSnippets",n,o);var i="",a="",r="";t("<div />").html(n).find("> div").each(function(n){var o=t(this),s=o.html().trim(),d=o.attr("data-preview"),c=o.attr("data-type"),l="";e("Snippet #"+n+" type="+c,d,s),l+='<section class="keditor-snippet" data-snippet="#keditor-snippet-'+n+'" data-type="'+c+'">',l+='   <img class="keditor-snippet-preview" src="'+d+'" />',l+="</section>","container"===c?i+=l:-1!==c.indexOf("component")&&(a+=l),r+='<script id="keditor-snippet-'+n+'" type="text/template">'+s+"</script>"}),t("#"+o.snippetsListId).html('<ul id="keditor-snippets-type-switcher" class="nav nav-tabs nav-justified">    <li class="active"><a href="#keditor-container-snippets">Containers</a></li>    <li><a href="#keditor-component-snippets">Components</a></li></ul><div id="keditor-snippets-container" class="tab-content">   <div class="tab-pane keditor-snippets active" id="keditor-container-snippets">'+i+'</div>   <div class="tab-pane keditor-snippets" id="keditor-component-snippets">'+a+"</div></div>").addClass("loaded-snippets"),t("#keditor-snippets-content").html(r)},initSnippets:function(n){e("initSnippets",n);var i=t("#"+n.snippetsListId);o.initNiceScroll(i.find(".keditor-snippets")),e("Initialize $.fn.draggable for container snippets list"),i.find(".keditor-snippet[data-type=container]").draggable({helper:"clone",revert:"invalid",connectToSortable:".keditor-content-area",start:function(){t("[contenteditable]").blur(),t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}}),i.find(".keditor-snippet[data-type^=component]").draggable({helper:"clone",revert:"invalid",connectToSortable:".keditor-container-content",start:function(){t("[contenteditable]").blur(),t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(document.body).addClass("highlighted-container-content")},stop:function(){t(document.body).removeClass("highlighted-container-content")}})},initSnippetsSwitcher:function(n){e("initSnippetsSwitcher",n);var o=t("#keditor-snippets-type-switcher li"),i=t("#keditor-snippets-container .keditor-snippets");o.find("a").on("click",function(e){e.preventDefault();var n=t(this),a=n.parent(),r=n.attr("href");if(!a.hasClass("active")){var s=o.filter(".active"),d=i.filter(".active"),c=t(r);s.removeClass("active"),d.removeClass("active"),a.addClass("active"),c.addClass("active"),t.fn.niceScroll&&(d.getNiceScroll().hide(),c.getNiceScroll().show())}})},initSettingPanel:function(i){e("initSettingPanel",i),t("#keditor-setting-closer").on("click",function(t){t.preventDefault(),o.hideSettingPanel()});var a=t("#keditor-setting-forms");o.initNiceScroll(a),e('Call "initSettingForm" function of all component types if settingEnabled = true');for(var r in o.components){var s=o.components[r],d=s.settingEnabled===!0;if(e("Type: "+r+", settingEnabled: "+d),d)if("function"==typeof s.initSettingForm){var c=t('<div id="keditor-setting-'+r+'" data-type="'+r+'" class="keditor-setting-form clearfix"></div>');a.append(c),e('Initialize setting form for component type "'+r+'"'),s.initSettingForm.call(s,c,i)}else n('"initSettingForm" function of component type "'+r+'" does not exist!')}},showSettingPanel:function(i,a){e("showSettingPanel",i,a);var r=t("#keditor-setting-forms").children(".active");r.removeClass("active");var s=o.getComponentType(i,a),d=o.components[s];t("#keditor-setting-title").html(d.settingTitle);var c=t("#keditor-setting-"+s);"function"==typeof d.showSettingForm?(e('Show setting form of component type "'+s+'"'),d.showSettingForm.call(d,c,i,a),c.addClass("active")):n('"showSettingForm" function of component type "'+s+'" does not exist!'),t(document.body).addClass("opened-keditor-setting")},hideSettingPanel:function(){e("hideSettingPanel"),t(document.body).removeClass("opened-keditor-setting");var n=t("#keditor-setting-forms").children(".active"),i=n.attr("data-type"),a=o.components[i];"function"==typeof a.hideSettingForm&&(e('Hide setting form of component type "'+i+'"'),a.hideSettingForm.call(a,n)),n.removeClass("active"),t(document.body).removeClass("opened-keditor-setting"),o.settingComponent=null},initContentArea:function(n,i){if(e("initContentArea",n,i),n.addClass("keditor-content-area"),e("Initialize $.fn.droppable for content area"),n.droppable({accept:".keditor-snippet[data-type=container]",tolerance:"pointer",greedy:!0}),e("Initialize $.fn.sortable for content area"),n.sortable({handle:".btn-container-reposition",items:"> section",connectWith:".keditor-content-area",axis:"y",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},receive:function(a,r){e("On received snippet",a,r);var s=r.helper,d=r.item;if(d.is(".keditor-snippet")){var c=t(d.attr("data-snippet")).html();e("Snippet content",c);var l=t('<section class="keditor-container">   <section class="keditor-container-inner">'+c+"</section></section>");s.replaceWith(l),l.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),l.addClass("showed-keditor-toolbar")),"function"==typeof i.onContainerSnippetDropped&&i.onContainerSnippetDropped.call(n,a,l,r.item),o.initContainer(n,l,i)}"function"==typeof i.onContentChanged&&i.onContentChanged.call(n,a)}}),e("Initialize existing containers in content area"),n.children("section").each(function(){o.convertToContainer(n,t(this),i)}),"function"==typeof i.onInitContentArea){var a=i.onInitContentArea.call(n,n);a&&a.length>0&&t.each(a,function(){o.convertToContainer(n,t(this),i)})}},convertToContainer:function(t,e,n){var i,a=e.is("section");a?(e.addClass("keditor-container"),e.wrapInner('<section class="keditor-container-inner"></section>'),i=e):(e.wrap('<section class="keditor-container"><section class="keditor-container-inner"></section></section>'),i=e.parent().parent()),o.initContainer(t,i,n)},initContainer:function(n,i,a){if(e("initContainer",n,i,a),i.hasClass("keditor-initialized-container")&&i.hasClass("keditor-initializing-container"))e(i.hasClass("keditor-initialized-container")?"Container is already initialized!":"Container is initializing...");else{i.addClass("keditor-initializing-container"),e("Render KEditor toolbar for container",i),i.append('<div class="keditor-toolbar keditor-toolbar-container">   <a href="#" class="btn-container-reposition">'+a.btnMoveContainerText+'</a>   <a href="#" class="btn-container-duplicate">'+a.btnDuplicateContainerText+'</a>   <a href="#" class="btn-container-delete">'+a.btnDeleteContainerText+"</a></div>");var r=o.generateId("container");e("Id for container is: "+r),i.attr("id",r);var s=i.find('[data-type="container-content"]');e("Initialize "+s.length+" container content(s)"),s.each(function(){var e=t(this);o.initContainerContent(n,i,e,a)}),"function"==typeof a.onInitContainer&&a.onInitContainer.call(n,i),i.addClass("keditor-initialized-container"),i.removeClass("keditor-initializing-container")}},initContainerContent:function(n,i,a,r){e("initContainerContent",n,i,a,r);var s=o.generateId("container-content");a.addClass("keditor-container-content"),e("Id for container content id: "+s,a),a.attr("id",s),e("Initialize $.fn.droppable for container content"),a.droppable({accept:".keditor-snippet[data-type=component]",tolerance:"pointer",greedy:!0}),e("Initialize $.fn.sortable for container content"),a.sortable({handle:".btn-component-reposition",items:"> section",connectWith:".keditor-container-content",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},receive:function(i,a){e("On received snippet",i,a);var s,d=a.helper,c=a.item;if(c.is(".keditor-snippet")){var l=t(c.attr("data-snippet")).html(),p=c.attr("data-type");e("Snippet content",l);var f=t('<section class="keditor-component" data-type="'+p+'">   <section class="keditor-component-content">'+l+"</section></section>");d.replaceWith(f),s=f.closest(".keditor-container"),"function"==typeof r.onComponentSnippetDropped&&r.onComponentSnippetDropped.call(n,i,f,a.item),o.initComponent(n,s,f,r)}else s=c.closest(".keditor-container");s.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar")),"function"==typeof r.onContainerChanged&&r.onContainerChanged.call(n,i,s),"function"==typeof r.onContentChanged&&r.onContentChanged.call(n,i)}}),e("Initialize existing components inside container content"),a.children().each(function(){var e=t(this);o.convertToComponent(n,i,e,r)})},convertToComponent:function(t,e,n,i){var a,r=n.is("section");r?(n.addClass("keditor-component"),n.wrapInner('<section class="keditor-component-content"></section>'),a=n):(n.wrap('<section class="keditor-component"><section class="keditor-component-content"></section></section>'),a=n.parent().parent()),o.initComponent(t,e,a,i)},getComponentType:function(t,i){var a=t.attr("data-type"),r=a?a.replace("component-",""):"";return r&&r in o.components?r:(e(r?'Component type "'+r+'" does not exist':"This component does not contain data-type attribute"),"string"==typeof i.defaultComponentType?r=i.defaultComponentType:"function"==typeof i.defaultComponentType&&(r=i.defaultComponentType.call(t,t)),r||n("Component type is undefined!"),e("Fallback to defaultComponentType: "+r),r)},initComponent:function(i,a,r,s){if(e("initComponent",i,a,r,s),r.hasClass("keditor-initialized-component")&&r.hasClass("keditor-initializing-component"))e(r.hasClass("keditor-initialized-component")?"Component is already initialized!":"Component is initializing...");else{r.addClass("keditor-initializing-component");var d=r.children(".keditor-component-content"),c=o.generateId("component-content");e("Id for component content is: "+c),d.attr("id",c);var l=o.getComponentType(r,s);e("Component type: "+l);var p=o.components[l],f=p.settingEnabled,C="";f&&(C='<a href="#" class="btn-component-setting">'+s.btnSettingComponentText+"</a>"),e("Render KEditor toolbar for component",r),r.append('<div class="keditor-toolbar keditor-toolbar-component">   <a href="#" class="btn-component-reposition">'+s.btnMoveComponentText+"</a>"+C+'   <a href="#" class="btn-component-duplicate">'+s.btnDuplicateComponentText+'</a>   <a href="#" class="btn-component-delete">'+s.btnDeleteComponentText+"</a></div>"),"function"==typeof p.init?p.init.call(p,i,a,r,s):(t(document.body).removeClass("highlighted-container-content"),n('"init" function of component type "'+l+'" does not exist!')),"function"==typeof s.onInitComponent&&s.onInitComponent.call(i,r),r.addClass("keditor-initialized-component"),r.removeClass("keditor-initializing-component")}},getClickedElement:function(e,n){var o=t(e.target),i=o.closest(n);return o.is(n)?o:i.length>0?i:null},initKEditorClicks:function(n){e("initKEditorClicks",n);var i=t(document.body);i.on("click",function(i){var a=o.getClickedElement(i,".keditor-container");if(a){if(e("Click on .keditor-container",a,a.hasClass("showed-keditor-toolbar")),!a.hasClass("showed-keditor-toolbar")){t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),a.addClass("showed-keditor-toolbar");var r=a.parent();"function"==typeof n.onContainerSelected&&n.onContainerSelected.call(r,i,a)}}else t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar");var s=o.getClickedElement(i,".keditor-component");if(s){if(e("Click on .keditor-component",s),!s.hasClass("showed-keditor-toolbar")){t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar");var r=s.parent();"function"==typeof n.onComponentSelected&&n.onComponentSelected.call(r,i,s)}}else t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}),i.on("click",".btn-container-duplicate",function(i){i.preventDefault();var a=t(this);e("Click on .btn-container-duplicate",a);var r=a.closest(".keditor-container"),s=r.parent(),d=t(o.getContainerContent(r));r.after(d),o.convertToContainer(s,d,n),e("Container is duplicated"),"function"==typeof n.onContainerDuplicated&&n.onContainerDuplicated.call(s,r,d),"function"==typeof n.onContentChanged&&n.onContentChanged.call(s,i)}),i.on("click",".btn-container-delete",function(i){i.preventDefault();var a=t(this);if(e("Click on .btn-container-delete",a),confirm("Are you sure that you want to delete this container? This action can not be undo!")){var r=a.closest(".keditor-container"),s=r.find(".keditor-component"),d=r.parent();"function"==typeof n.onBeforeContainerDeleted&&n.onBeforeContainerDeleted.call(d,i,r),s.length>0&&s.each(function(){o.deleteComponent(t(this))}),r.remove(),"function"==typeof n.onContainerDeleted&&n.onContainerDeleted.call(d,i,r),"function"==typeof n.onContentChanged&&n.onContentChanged.call(d,i)}}),i.on("click",".btn-component-setting",function(a){a.preventDefault();var r=t(this);e("Click on .btn-component-setting",r);var s=r.closest(".keditor-component");i.hasClass("opened-keditor-setting")&&s.is(o.settingComponent)?o.hideSettingPanel():(o.showSettingPanel(s,n),o.settingComponent=s)}),i.on("click",".btn-component-duplicate",function(i){i.preventDefault();var a=t(this);e("Click on .btn-component-duplicate",a);var r=a.closest(".keditor-component"),s=r.closest(".keditor-container"),d=s.parent(),c=t(o.getComponentContent(r));r.after(c),o.convertToComponent(d,s,c,n),e("Component is duplicated"),"function"==typeof n.onComponentDuplicated&&n.onComponentDuplicated.call(d,r,c),"function"==typeof n.onContainerChanged&&n.onContainerChanged.call(d,i,s),"function"==typeof n.onContentChanged&&n.onContentChanged.call(d,i)}),i.on("click",".btn-component-delete",function(i){i.preventDefault();var a=t(this);if(e("Click on .btn-component-delete",a),confirm("Are you sure that you want to delete this component? This action can not be undo!")){var r=a.closest(".keditor-component"),s=r.closest(".keditor-content-area");"function"==typeof n.onBeforeComponentDeleted&&n.onBeforeComponentDeleted.call(s,i,r),o.deleteComponent(r),"function"==typeof n.onComponentDeleted&&n.onComponentDeleted.call(s,i,r),"function"==typeof n.onContainerChanged&&n.onContainerChanged.call(s,i,r),"function"==typeof n.onContentChanged&&n.onContentChanged.call(s,i)}})},deleteComponent:function(t,i){e("deleteComponent",t,i);var a=o.getComponentType(t,i);"function"==typeof o.components[a].destroy?o.components[a].destroy(t,i):n('"destroy" function of component type "'+a+'" does not exist!'),t.remove()},getComponentContent:function(t,e){var i,a=t.attr("data-type"),r=o.getComponentType(t,e);return"function"==typeof o.components[r].getContent?i=o.components[r].getContent(t,e):n('"getContent" function of component type "'+r+'" does not exist!'),'<section data-type="'+a+'">'+i+"</section>"},getContainerContent:function(e,n){var i=e.children(".keditor-container-inner").clone();return i.find("[data-type=container-content]").each(function(){var e=t(this);e.removeClass("keditor-container-content ui-droppable ui-sortable").removeAttr("id"),e.children(".keditor-component").each(function(){var e=t(this);e.replaceWith(o.getComponentContent(e,n))})}),"<section>"+i.html()+"</section>"}};t.fn.keditor=function(t){if(i[t]&&"init"!==t)return i[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"!=typeof t&&t)throw new Error("[KEditor] Method "+t+" does not exist on $.fn.keditor");return i.init.apply(this,arguments)};var i={init:function(n){var i=t(this);n=t.extend({},o.DEFAULTS,n),i.each(function(){var n=t(this);if(0===n.attr("id").length){e("Content area does not contain Id. Generating id for content area...");var i=o.generateId("content-area");n.attr("id",i),e('Id for content are is: "'+i+'"')}});var a=t("#"+n.snippetsListId);return a.hasClass("loaded-snippets")?e("Snippets list is already initialized!"):o.initSidebar(n),o.initKEditorClicks(n),i.each(function(){var i=t(this);i.data("keditorOptions")?e("KEditor is already initialized!"):(i.data("keditorOptions",n),o.initContentArea(i,n))}),i},getContent:function(){var e=t(this),n=i.getOptions.call(e),a="";return e.children(".keditor-container").each(function(){var e=t(this);a+=o.getContainerContent(e,n)}),a},getOptions:function(){return t(this).data("keditorOptions")||o.DEFAULTS}}}(jQuery);
//# sourceMappingURL=keditor-1.1.0.min.js.map
