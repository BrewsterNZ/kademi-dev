{"version":3,"sources":["keditor-1.0.0.js"],"names":["$","flog","fn","keditor","debug","navigator","appName","arguments","length","console","log","error","msg","Error","draggable","droppable","sortable","ckeditor","CKEDITOR","disableAutoInline","method","methods","apply","this","Array","prototype","slice","call","init","version","DEFAULTS","allowedContent","bodyId","templates_replaceContent","enterMode","forceEnterMode","format_tags","format_p2","element","attributes","class","removePlugins","minimumChangeMilliseconds","snippetsUrl","snippetsListId","onContentChange","KEditor","initSnippet","contentArea","options","body","document","addClass","append","initSnippetToggler","after","ajax","type","dataType","url","success","resp","renderSnippets","initSnippetsActions","initContentAreaActions","jqXHR","on","e","preventDefault","icon","find","hasClass","removeClass","attr","snippetsHtml","snippetsContentHtml","html","each","i","div","content","trim","previewUrl","snippetsList","niceScroll","cursorcolor","cursorwidth","railpadding","top","right","left","bottom","cursorborder","contentAreaId","helper","revert","connectToSortable","cursorAt","start","blur","accept","tolerance","greedy","handle","items","connectWith","axis","sort","receive","event","ui","item","snippetContent","section","replaceWith","initContentEditable","wrap","keditorSection","parent","getClickElement","btnRemove","confirm","selectedSection","closest","id","instances","destroy","remove","selector","target","is","sectionContent","prop","Date","getTime","data","extend","getContent","getData","jQuery"],"mappings":"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","file":"keditor-1.0.0.min.js","sourcesContent":["/*!\r\n * KEditor - Kademi content editor\r\n * @copyright: Kademi (http://kademi.co)\r\n * @author: Kademi (http://kademi.co)\r\n * @version: 1.0.0\r\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, $.fn.ckeditor\r\n *\r\n * Configuration:\r\n * @option {Object} ckeditor Configuration for CKEditor. See at http://docs.ckeditor.com/#!/api/CKEDITOR.config\r\n * @option {String} snippetsUrl Url to snippets file\r\n * @option {String} [snippetsListId=\"keditor-snippets-list\"] Id of element which contains snippets. As default, value is \"keditor-snippets-list\" and KEditor will render snippets sidebar automatically. If you specific other id, only snippets will rendered and put into your element\r\n * @option {Function} onContentChange Callback will be called when content is changed\r\n */\r\n(function ($) {\r\n    // Log function will print log message when \"$.fn.keditor.debug\" equals \"true\"\r\n    var flog = function () {\r\n        if (typeof (console) !== 'undefined' && $.fn.keditor.debug) {\r\n            if (navigator.appName == 'Microsoft Internet Explorer') {\r\n                // BM: Previous used JSON, but that crashed IE sometimes. So this is pretty crap, but at least safer\r\n                if (arguments.length == 1) {\r\n                    console.log('[KEditor]', arguments[0]);\r\n                } else if (arguments.length == 2) {\r\n                    console.log('[KEditor]', arguments[0], arguments[1]);\r\n                } else if (arguments.length > 2) {\r\n                    console.log('[KEditor]', arguments[0], arguments[1], arguments[2]);\r\n                }\r\n            } else {\r\n                console.log(['KEditor'], arguments);\r\n            }\r\n        }\r\n    };\r\n\r\n    // Throw error message\r\n    var error = function (msg) {\r\n        throw new Error('[KEditor] ' + msg);\r\n    };\r\n\r\n    // Check dependencies\r\n    if (!$.fn.draggable) {\r\n        error('$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor.');\r\n    }\r\n    if (!$.fn.droppable) {\r\n        error('$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor.');\r\n    }\r\n    if (!$.fn.sortable) {\r\n        error('$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor.');\r\n    }\r\n    if (!$.fn.ckeditor) {\r\n        error('$.fn.ckeditor does not exist. Please import CKEditor and its jQuery adapter into your document for continue using KEditor.');\r\n    } else {\r\n        // Disable CKEditor init automatically with element which has \"contenteditable=true\"\r\n        CKEDITOR.disableAutoInline = true;\r\n    }\r\n\r\n    $.fn.keditor = function (method) {\r\n        if (methods[method] && method !== 'init') {\r\n            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));\r\n        } else if (typeof method === 'object' || !method) {\r\n            return methods.init.apply(this, arguments);\r\n        } else {\r\n            throw new Error('[KEditor] Method ' + method + ' does not exist on jquery.keditor');\r\n        }\r\n    };\r\n\r\n    $.fn.keditor.debug = true;\r\n\r\n    $.fn.keditor.version = '1.0.0';\r\n\r\n    var DEFAULTS = $.fn.keditor.DEFAULTS = {\r\n        ckeditor: {\r\n            allowedContent: true, // DISABLES Advanced Content Filter. This is so templates with classes are allowed through\r\n            bodyId: 'editor',\r\n            templates_replaceContent: false,\r\n            enterMode: 'P',\r\n            forceEnterMode: true,\r\n            format_tags: 'p;h1;h2;h3;h4;h5;h6', // removed p2\r\n            format_p2: {\r\n                element: 'p',\r\n                attributes: {\r\n                    'class': 'lessSpace'\r\n                }\r\n            },\r\n            removePlugins: 'magicline',\r\n            minimumChangeMilliseconds: 100\r\n        },\r\n        snippetsUrl: 'snippets.html',\r\n        snippetsListId: 'keditor-snippets-list',\r\n        onContentChange: function () {\r\n        }\r\n    };\r\n\r\n    var KEditor = {\r\n        initSnippet: function (contentArea, options) {\r\n            flog('initSnippetToggler', contentArea, options);\r\n\r\n            var body = $(document.body);\r\n            body.addClass('opened-keditor-snippets');\r\n            contentArea.addClass('keditor-content-area');\r\n\r\n            if (options.snippetsListId === DEFAULTS.snippetsListId) {\r\n                flog('Render default KEditor snippet container');\r\n\r\n                body.append(\r\n                    '<div id=\"keditor-snippets-container\">' +\r\n                    '    <a id=\"keditor-snippets-toggler\"><i class=\"glyphicon glyphicon-chevron-right\"></i></a>' +\r\n                    '    <div id=\"keditor-snippets-list\" class=\"clearfix\"></div>' +\r\n                    '    <div id=\"keditor-snippets-content\" style=\"display: none\"></div>' +\r\n                    '</div>'\r\n                );\r\n                KEditor.initSnippetToggler();\r\n            } else {\r\n                flog('Render KEditor snippets content after custom snippets list with id=\"' + options.snippetsListId + '\"');\r\n                $('#' + options.snippetsListId).after('<div id=\"keditor-snippets-content\" style=\"display: none\"></div>');\r\n            }\r\n\r\n            if (typeof options.snippetsUrl === 'string' && options.snippetsUrl.length > 0) {\r\n                flog('Getting snippets form \"' + options.snippetsUrl + '\"...');\r\n\r\n                $.ajax({\r\n                    type: 'get',\r\n                    dataType: 'html',\r\n                    url: options.snippetsUrl,\r\n                    success: function (resp) {\r\n                        flog('Success in getting snippets', resp);\r\n\r\n                        KEditor.renderSnippets(resp, options);\r\n                        KEditor.initSnippetsActions(contentArea, options);\r\n                        KEditor.initContentAreaActions(contentArea, options);\r\n                    },\r\n                    error: function (jqXHR) {\r\n                        flog('Error when getting snippets', jqXHR);\r\n                    }\r\n                });\r\n            } else {\r\n                error('\"snippetsUrl\" must be not null!');\r\n            }\r\n        },\r\n\r\n        initSnippetToggler: function () {\r\n            flog('initSnippetToggler');\r\n\r\n            var body = $(document.body);\r\n\r\n            $('#keditor-snippets-toggler').on('click', function (e) {\r\n                e.preventDefault();\r\n\r\n                var icon = $(this).find('i');\r\n                if (body.hasClass('opened-keditor-snippets')) {\r\n                    body.removeClass('opened-keditor-snippets');\r\n                    icon.attr('class', 'glyphicon glyphicon-chevron-left')\r\n                } else {\r\n                    body.addClass('opened-keditor-snippets');\r\n                    icon.attr('class', 'glyphicon glyphicon-chevron-right')\r\n                }\r\n            });\r\n        },\r\n\r\n        renderSnippets: function (resp, options) {\r\n            flog('renderSnippets', resp, options);\r\n\r\n            var snippetsHtml = '';\r\n            var snippetsContentHtml = '';\r\n\r\n            $('<div />').html(resp).find('> div').each(function (i) {\r\n                var div = $(this);\r\n                var content = div.html().trim();\r\n                var previewUrl = div.attr('data-preview');\r\n\r\n                flog('Snippet #' + i, previewUrl, content);\r\n\r\n                snippetsHtml += '<section class=\"keditor-snippet\" data-snippet=\"#keditor-snippet-' + i + '\">';\r\n                snippetsHtml += '   <img class=\"keditor-snippet-preview\" src=\"' + previewUrl + '\" />';\r\n                snippetsHtml += '</section>';\r\n\r\n                snippetsContentHtml += '<div id=\"keditor-snippet-' + i + '\" style=\"display: none;\">' + content + '</div>';\r\n            });\r\n\r\n            $('#' + options.snippetsListId).html(snippetsHtml);\r\n            $('#keditor-snippets-content').html(snippetsContentHtml);\r\n        },\r\n\r\n        initSnippetsActions: function (contentArea, options) {\r\n            flog('initSnippetsActions', contentArea, options);\r\n\r\n            var snippetsList = $('#' + options.snippetsListId);\r\n\r\n            if ($.fn.niceScroll) {\r\n                flog('Initialize $.fn.niceScroll for snippets list');\r\n                snippetsList.niceScroll({\r\n                    cursorcolor: '#999',\r\n                    cursorwidth: 6,\r\n                    railpadding: {\r\n                        top: 0,\r\n                        right: 0,\r\n                        left: 0,\r\n                        bottom: 0\r\n                    },\r\n                    cursorborder: ''\r\n                });\r\n            } else {\r\n                flog('$.fn.niceScroll does not exist. Use default sidebar.');\r\n            }\r\n\r\n            var contentAreaId = contentArea.attr('id');\r\n            flog('Initialize $.fn.draggable for snippets list which connect to #' + contentAreaId);\r\n            snippetsList.find('.keditor-snippet').draggable({\r\n                helper: 'clone',\r\n                revert: 'invalid',\r\n                connectToSortable: '#' + contentAreaId,\r\n                cursorAt: {\r\n                    top: 0,\r\n                    left: 0\r\n                },\r\n                start: function () {\r\n                    $('.keditor-section-content').blur();\r\n                }\r\n            });\r\n        },\r\n\r\n        initContentAreaActions: function (contentArea, options) {\r\n            flog('initContentAreaActions', contentArea, options);\r\n\r\n            var body = $(document.body);\r\n            var contentAreaId = contentArea.attr('id');\r\n\r\n            flog('Initialize $.fn.droppable for content area');\r\n            contentArea.droppable({\r\n                accept: '.keditor-snippet',\r\n                tolerance: 'pointer',\r\n                greedy: true\r\n            });\r\n\r\n            flog('Initialize $.fn.sortable for content area');\r\n            contentArea.sortable({\r\n                handle: '.btn-section-reposition',\r\n                items: '> section',\r\n                connectWith: '#' + contentAreaId,\r\n                axis: 'y',\r\n                sort: function () {\r\n                    $(this).removeClass('ui-state-default');\r\n                },\r\n                receive: function (event, ui) {\r\n                    flog('On received snippet', event, ui);\r\n\r\n                    var helper = ui.helper;\r\n                    var item = ui.item;\r\n                    var snippetContent = $(item.attr('data-snippet')).html();\r\n                    flog('Snippet content', snippetContent);\r\n                    var section = $(\r\n                        '<section class=\"keditor-section\">' +\r\n                        '   <section class=\"keditor-section-content\">' + snippetContent + '</section>' +\r\n                        '</section>'\r\n                    );\r\n\r\n                    helper.replaceWith(section);\r\n                    KEditor.initContentEditable(section, options);\r\n\r\n                    if (typeof options.onContentChange === 'function') {\r\n                        options.onContentChange.call(this, event);\r\n                    }\r\n                }\r\n            });\r\n\r\n            flog('Initialize sections in content area');\r\n            contentArea.find('> section').each(function () {\r\n                var section = $(this);\r\n                section.addClass('keditor-section-content');\r\n                section.wrap('<section class=\"keditor-section\"></section>');\r\n\r\n                var keditorSection = section.parent();\r\n                KEditor.initContentEditable(keditorSection, options);\r\n            });\r\n\r\n            body.on('click', function (e) {\r\n                var section = KEditor.getClickElement(e, 'section.keditor-section');\r\n                contentArea.find('.keditor-section.showed-keditor-toolbar').removeClass('showed-keditor-toolbar');\r\n                if (section) {\r\n                    flog('Click on .keditor-section');\r\n                    section.addClass('showed-keditor-toolbar');\r\n                }\r\n\r\n                var btnRemove = KEditor.getClickElement(e, '.btn-section-delete');\r\n                if (btnRemove) {\r\n                    flog('Click on .btn-section-delete', btnRemove);\r\n\r\n                    if (confirm('Are you sure that you want to delete this section? This action can not be undo!')) {\r\n                        var selectedSection = btnRemove.closest('section.keditor-section');\r\n                        var id = selectedSection.find('.keditor-section-content').attr('id');\r\n\r\n                        CKEDITOR.instances[id].destroy();\r\n                        selectedSection.remove();\r\n\r\n                        flog('Section is deleted');\r\n\r\n                        if (typeof options.onContentChange === 'function') {\r\n                            options.onContentChange.call(this, e);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        getClickElement: function (event, selector) {\r\n            var target = $(event.target);\r\n            var closest = target.closest(selector);\r\n\r\n            if (target.is(selector)) {\r\n                return target;\r\n            } else if (closest.length > 0) {\r\n                return closest;\r\n            } else {\r\n                return null;\r\n            }\r\n        },\r\n\r\n        initContentEditable: function (section, options) {\r\n            flog('initContentEditable', section, options);\r\n\r\n            if (!section.hasClass('keditor-editable') || !section.hasClass('keditor-initializing')) {\r\n                section.addClass('keditor-initializing');\r\n\r\n                flog('Render KEditor toolbar for section', section);\r\n                section.append(\r\n                    '<div class=\"keditor-toolbar\">' +\r\n                    '   <div class=\"btn-group-vertical\">' +\r\n                    '       <a href=\"#\" class=\"btn btn-xs btn-info btn-section-reposition\"><i class=\"glyphicon glyphicon-sort\"></i></a>' +\r\n                    '       <a href=\"#\" class=\"btn btn-xs btn-danger btn-section-delete\"><i class=\"glyphicon glyphicon-remove\"></i></a>' +\r\n                    '   </div>' +\r\n                    '</div>'\r\n                );\r\n\r\n                flog('Initialize CKEditor for section', section);\r\n                var sectionContent = section.find('.keditor-section-content');\r\n                sectionContent.prop('contenteditable', true);\r\n\r\n                var id = 'keditor-section-' + (new Date()).getTime();\r\n                flog('Id for section content is: ' + id);\r\n                sectionContent.attr('id', id);\r\n\r\n                sectionContent.ckeditor(options.ckeditor);\r\n                sectionContent.on('input', function (e) {\r\n                    if (typeof options.onContentChange === 'function') {\r\n                        options.onContentChange.call(this, e);\r\n                    }\r\n                });\r\n\r\n                section.addClass('keditor-editable');\r\n                section.removeClass('keditor-initializing');\r\n            } else {\r\n                if (section.hasClass('keditor-editable')) {\r\n                    flog('Section is already initialized!');\r\n                } else {\r\n                    flog('Section is initializing...');\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    var methods = {\r\n        init: function (options) {\r\n            return $(this).each(function () {\r\n                var contentArea = $(this);\r\n                if (contentArea.data('keditorOptions')) {\r\n                    flog('KEditor is already initialized!');\r\n                } else {\r\n                    if (contentArea.attr('id').length === 0) {\r\n                        flog('Content area does not contain Id. Generating id for content area...');\r\n\r\n                        var id = 'keditor-content-area-' + (new Date()).getTime();\r\n                        contentArea.attr('id', id);\r\n                        flog('Id for content are is: \"' + id + '\"');\r\n                    }\r\n\r\n                    options = $.extend({}, DEFAULTS, options);\r\n                    contentArea.data('keditorOptions', options);\r\n                    KEditor.initSnippet(contentArea, options);\r\n                }\r\n\r\n                return contentArea;\r\n            });\r\n        },\r\n        getContent: function () {\r\n            var contentArea = $(this);\r\n            var html = '';\r\n\r\n            contentArea.find('> section').each(function () {\r\n                var section = $(this);\r\n                var id = section.find('.keditor-section-content').attr('id');\r\n\r\n                html += '<section>' + CKEDITOR.instances[id].getData() + '</section>';\r\n            });\r\n\r\n            return html;\r\n        }\r\n    };\r\n\r\n})(jQuery);\r\n"],"sourceRoot":"/source/"}