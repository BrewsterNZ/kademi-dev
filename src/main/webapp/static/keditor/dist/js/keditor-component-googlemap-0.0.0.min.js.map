{"version":3,"sources":["keditor-component-googlemap-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","script","find","length","remove","removeAttr","place","attr","maptype","window","on","trigger","getContent","componentContent","children","html","append","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","apiKey","mapjs","google","maps","places","e","this","checked","value","removeClass","cls","not","val","addClass","comp","getSettingComponent","data","event","self","initAutocomplete","input","i","setInterval","clearInterval","keyCode","iframe","src","alert","btn169","btn43","preventDefault","showSettingForm","ratio169","hasClass","ratio43","prop","firstLoad","siblings","googleMapInitialized","setTimeout","mapdiv","map","Map","zoom","mapTypeId","searchBox","SearchBox","addListener","setBounds","getBounds","markers","getPlaces","forEach","marker","setMap","bounds","LatLngBounds","geometry","console","icon","size","Size","origin","Point","anchor","scaledSize","push","Marker","title","name","position","location","viewport","union","extend","fitBounds","initKeditorMapSetting","jQuery"],"mappings":"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","file":"keditor-component-googlemap-0.0.0.min.js","sourcesContent":["/**\r\n * KEditor Google Map Component\r\n * @copyright: Kademi (http://kademi.co)\r\n * @author: Kademi (http://kademi.co)\r\n * @version: @{version}\r\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\r\n */\r\n(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['googlemap'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            var script = component.find('script');\r\n            if (script.length) {\r\n                script.remove();\r\n            }\r\n            component.removeAttr('data-firstLoad');\r\n            var place = component.attr('data-place');\r\n            var maptype = component.attr('data-maptype');\r\n            if (place && maptype === 'manually') {\r\n                $(window).on('load', function () {\r\n                    component.find('.btn-component-setting').trigger('click');\r\n                });\r\n            }\r\n        },\r\n        getContent: function (component, keditor) {\r\n            flog('getContent \"googlemap\" component', component);\r\n            var componentContent = component.children('.keditor-component-content');\r\n            componentContent.find('.googlemap-cover').remove();\r\n            var place = component.attr('data-place');\r\n            var maptype = component.attr('data-maptype');\r\n            component.find('.kgooglemap').html('');\r\n            var script = '<script>$(function(){if(!$(document.body).hasClass(\"content-editor-page\")){var apiKey=\"AIzaSyBUcuZxwpBXCPztG7ot-rITXJbycPuS7gs\";var s=document.createElement(\"script\");s.type=\"text/javascript\";s.async=true;s.defer=true;s.src=\"https://maps.googleapis.com/maps/api/js?key=\"+apiKey+\"&callback=kgooglemapInit&libraries=places\";$(\"head\").append(s);window.kgooglemapInit=function(){var mapdiv=$(\".kgooglemap\").not(\".hide\");mapdiv.each(function(){var parent=$(this).parents(\"[data-type=component-googlemap]\");if(parent.attr(\"data-maptype\")!==\"manually\")return;var map=new google.maps.Map(this,{zoom:13,mapTypeId:\"roadmap\"});var place=parent.attr(\"data-place\");var input=parent.find(\"input\")[0];input.value=place;var searchBox=new google.maps.places.SearchBox(input);map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);setTimeout(function(){google.maps.event.trigger(input,\"focus\");google.maps.event.trigger(input,\"keydown\",{keyCode:13});},500);map.addListener(\"bounds_changed\",function(){searchBox.setBounds(map.getBounds());});var markers=[];searchBox.addListener(\"places_changed\",function(){var places=searchBox.getPlaces();if(places.length==0){return;}markers.forEach(function(marker){marker.setMap(null);});markers=[];var bounds=new google.maps.LatLngBounds();places.forEach(function(place){if(!place.geometry){console.log(\"Returned place contains no geometry\");return;}var icon={url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};markers.push(new google.maps.Marker({map:map,icon:icon,title:place.name,position:place.geometry.location}));if(place.geometry.viewport){bounds.union(place.geometry.viewport);}else{bounds.extend(place.geometry.location);}});map.fitBounds(bounds);});})}}});</script>';\r\n            component.find('.embed-responsive').append(script);\r\n            return componentContent.html();\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Google Map Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"googlemap\" settings', form);\r\n            \r\n            return $.ajax({\r\n                url: '/static/keditor/componentGoogleMapSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    var apiKey = 'AIzaSyBUcuZxwpBXCPztG7ot-rITXJbycPuS7gs';\r\n                    var mapjs = '<script src=\"https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&callback=initKeditorMapSetting&libraries=places\" async defer></script>';\r\n                    if (window.google && window.google.maps && google.maps.places) {\r\n                        mapjs = '';\r\n                    }\r\n                    \r\n                    form.append(\r\n                        mapjs + resp\r\n                    );\r\n                    \r\n                    form.find('.mapType').on('click', function (e) {\r\n                        if (this.checked) {\r\n                            $('.' + this.value).removeClass('hide');\r\n                            var cls = form.find('.mapType').not(this).val();\r\n                            $('.' + cls).addClass('hide');\r\n                            var comp = keditor.getSettingComponent();\r\n                            comp.attr('data-maptype', this.value);\r\n                            if (this.value === 'manually') {\r\n                                comp.find('iframe').addClass('hide');\r\n                                comp.find('.kgooglemap').removeClass('hide');\r\n                                if (comp.find('.kgooglemap').data('map')) {\r\n                                    google.maps.event.trigger(comp.find('.kgooglemap').data('map'), \"resize\");\r\n                                } else {\r\n                                    self.initAutocomplete(comp, form);\r\n                                    var input = form.find('[name=mapAddress]')[0];\r\n                                    var i = setInterval(function () {\r\n                                        if (comp.find('.kgooglemap').data('map')) {\r\n                                            clearInterval(i);\r\n                                            google.maps.event.trigger(input, 'focus')\r\n                                            google.maps.event.trigger(input, 'keydown', {\r\n                                                keyCode: 13\r\n                                            });\r\n                                        }\r\n                                    }, 100);\r\n                                }\r\n                            } else {\r\n                                comp.find('iframe').removeClass('hide');\r\n                                comp.find('.kgooglemap').addClass('hide');\r\n                            }\r\n                        }\r\n                    });\r\n                    \r\n                    var self = this;\r\n                    form.find('[name=mapEmbedCode]').on('change', function () {\r\n                        var iframe = $(this.value);\r\n                        var src = iframe.attr('src');\r\n                        if (iframe.length > 0 && src && src.length > 0) {\r\n                            keditor.getSettingComponent().find('.embed-responsive-item').attr('src', src);\r\n                        } else {\r\n                            alert('Your Google Map embed code is invalid!');\r\n                        }\r\n                    });\r\n                    \r\n                    var btn169 = form.find('.btn-googlemap-169');\r\n                    var btn43 = form.find('.btn-googlemap-43');\r\n                    \r\n                    btn169.on('click', function (e) {\r\n                        e.preventDefault();\r\n                        $(this).addClass('btn-primary').removeClass('btn-default');\r\n                        btn43.removeClass('btn-primary').addClass('btn-default');\r\n                        keditor.getSettingComponent().find('.embed-responsive').removeClass('embed-responsive-4by3').addClass('embed-responsive-16by9');\r\n                        var comp = keditor.getSettingComponent();\r\n                        if (comp.attr('maptype') === 'manually') {\r\n                            if (comp.find('.kgooglemap').data('map')) {\r\n                                google.maps.event.trigger(comp.find('.kgooglemap').data('map'), \"resize\");\r\n                            }\r\n                        }\r\n                    });\r\n                    \r\n                    btn43.on('click', function (e) {\r\n                        e.preventDefault();\r\n                        $(this).addClass('btn-primary').removeClass('btn-default');\r\n                        btn169.removeClass('btn-primary').addClass('btn-default');\r\n                        keditor.getSettingComponent().find('.embed-responsive').removeClass('embed-responsive-16by9').addClass('embed-responsive-4by3');\r\n                        var comp = keditor.getSettingComponent();\r\n                        if (comp.attr('maptype') === 'manually') {\r\n                            if (comp.find('.kgooglemap').data('map')) {\r\n                                google.maps.event.trigger(comp.find('.kgooglemap').data('map'), \"resize\");\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        showSettingForm: function (form, component, keditor) {\r\n            var self = this;\r\n            var maptype = component.attr('data-maptype');\r\n            var place = component.attr('data-place');\r\n            var ratio169 = component.find('.embed-responsive').hasClass('embed-responsive-16by9');\r\n            var ratio43 = component.find('.embed-responsive').hasClass('embed-responsive-4by3');\r\n            if (ratio43) {\r\n                form.find('.btn-googlemap-43').addClass('btn-primary').removeClass('btn-default');\r\n            }\r\n            if (ratio169) {\r\n                form.find('.btn-googlemap-169').addClass('btn-primary').removeClass('btn-default');\r\n            }\r\n            form.find('.mapType[value=' + maptype + ']').prop('checked', true);\r\n            var src = component.find('iframe').attr('src');\r\n            var iframe = '<iframe class=\"embed-responsive-item\" src=\"' + src + '\"></iframe>';\r\n            if (!place) {\r\n                place = 'Hanoi, Vietnam';\r\n            }\r\n            form.find('[name=mapAddress]').val(place);\r\n            form.find('[name=mapEmbedCode]').val(iframe);\r\n            var firstLoad = component.attr('data-firstLoad');\r\n            if (maptype === 'manually') {\r\n                form.find('.manually').removeClass('hide').siblings('.embed').addClass('hide');\r\n                \r\n                if (!firstLoad && place) {\r\n                    var i = setInterval(function () {\r\n                        if (window.googleMapInitialized) {\r\n                            clearInterval(i);\r\n                            self.initAutocomplete(component, form);\r\n                            setTimeout(function () {\r\n                                var input = form.find('[name=mapAddress]')[0];\r\n                                google.maps.event.trigger(input, 'focus')\r\n                                google.maps.event.trigger(input, 'keydown', {\r\n                                    keyCode: 13\r\n                                });\r\n                                component.attr('data-firstLoad', 'false');\r\n                            }, 1000);\r\n                        }\r\n                    }, 100);\r\n                }\r\n            } else {\r\n                form.find('.manually').addClass('hide').siblings('.embed').removeClass('hide');\r\n            }\r\n        },\r\n        \r\n        initAutocomplete: function (component, form) {\r\n            if (!window.googleMapInitialized) {\r\n                alert('google map is not initialized');\r\n                return;\r\n            }\r\n            var mapdiv = component.find('.kgooglemap')[0];\r\n            var map = new google.maps.Map(mapdiv, {\r\n                zoom: 13,\r\n                mapTypeId: 'roadmap'\r\n            });\r\n            // Create the search box and link it to the UI element.\r\n            var input = form.find('[name=mapAddress]')[0];\r\n            var searchBox = new google.maps.places.SearchBox(input);\r\n            //map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);\r\n            \r\n            // Bias the SearchBox results towards current map's viewport.\r\n            map.addListener('bounds_changed', function () {\r\n                searchBox.setBounds(map.getBounds());\r\n            });\r\n            \r\n            var markers = [];\r\n            // Listen for the event fired when the user selects a prediction and retrieve\r\n            // more details for that place.\r\n            \r\n            searchBox.addListener('places_changed', function () {\r\n                var places = searchBox.getPlaces();\r\n                \r\n                if (places.length == 0) {\r\n                    return;\r\n                }\r\n                \r\n                // Clear out the old markers.\r\n                markers.forEach(function (marker) {\r\n                    marker.setMap(null);\r\n                });\r\n                markers = [];\r\n                // For each place, get the icon, name and location.\r\n                var bounds = new google.maps.LatLngBounds();\r\n                places.forEach(function (place) {\r\n                    if (!place.geometry) {\r\n                        console.log(\"Returned place contains no geometry\");\r\n                        return;\r\n                    }\r\n                    \r\n                    var icon = {\r\n                        url: place.icon,\r\n                        size: new google.maps.Size(71, 71),\r\n                        origin: new google.maps.Point(0, 0),\r\n                        anchor: new google.maps.Point(17, 34),\r\n                        scaledSize: new google.maps.Size(25, 25)\r\n                    };\r\n                    \r\n                    // Create a marker for each place.\r\n                    markers.push(new google.maps.Marker({\r\n                        map: map,\r\n                        icon: icon,\r\n                        title: place.name,\r\n                        position: place.geometry.location\r\n                    }));\r\n                    \r\n                    if (place.geometry.viewport) {\r\n                        // Only geocodes have viewport.\r\n                        bounds.union(place.geometry.viewport);\r\n                    } else {\r\n                        bounds.extend(place.geometry.location);\r\n                    }\r\n                });\r\n                map.fitBounds(bounds);\r\n                component.attr('data-place', input.value);\r\n            });\r\n            \r\n            component.find('.kgooglemap').data('map', map);\r\n        }\r\n    };\r\n    \r\n    window.initKeditorMapSetting = function () {\r\n        window.googleMapInitialized = true;\r\n    }\r\n})(jQuery);\r\n"],"sourceRoot":"/source/"}