!function(t){var n=function(){"undefined"!=typeof console&&o.debug===!0&&("Microsoft Internet Explorer"==navigator.appName?1==arguments.length?console.log("[KEditor]",arguments[0]):2==arguments.length?console.log("[KEditor]",arguments[0],arguments[1]):arguments.length>2&&console.log("[KEditor]",arguments[0],arguments[1],arguments[2]):console.log(["KEditor"],arguments))},e=function(t){throw new Error("[KEditor] "+t)};t.fn.draggable||e("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),t.fn.droppable||e("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),t.fn.sortable||e("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor.");var o=function(n,e){this.options=t.extend({},o.DEFAULTS,e),this.init(n)};o.debug=!0,o.version="0.0.0",o.DEFAULTS={btnMoveContainerText:'<i class="fa fa-sort"></i>',btnMoveComponentText:'<i class="fa fa-arrows"></i>',btnSettingContainerText:'<i class="fa fa-cog"></i>',btnSettingComponentText:'<i class="fa fa-cog"></i>',btnDuplicateContainerText:'<i class="fa fa-files-o"></i>',btnDuplicateComponentText:'<i class="fa fa-files-o"></i>',btnDeleteContainerText:'<i class="fa fa-times"></i>',btnDeleteComponentText:'<i class="fa fa-times"></i>',tabContainersText:"Containers",tabContainersTitle:"Containers",tabComponentsText:"Components",tabComponentsTitle:"Components",tabTooltipEnabled:!0,extraTabs:null,defaultComponentType:"text",snippetsUrl:"snippets/default/snippets.html",snippetsListId:"keditor-snippets-list",snippetsTooltipEnabled:!0,snippetsTooltipPosition:"left",iframeMode:!1,contentAreasSelector:null,contentAreasWrapper:'<div class="keditor-content-areas-wrapper container"></div>',containerSettingEnabled:!1,containerSettingInitFunction:null,containerSettingShowFunction:null,containerSettingHideFunction:null,onReady:function(){},onInitFrame:function(t,n,e){},onSidebarToggled:function(t){},onInitContentArea:function(t){},onContentChanged:function(t){},onInitContainer:function(t){},onBeforeContainerDeleted:function(t,n){},onContainerDeleted:function(t,n){},onContainerChanged:function(t,n){},onContainerDuplicated:function(t,n,e){},onContainerSelected:function(t,n){},onContainerSnippetDropped:function(t,n,e){},onComponentReady:function(t){},onInitComponent:function(t){},onBeforeComponentDeleted:function(t,n){},onComponentDeleted:function(t,n){},onComponentChanged:function(t,n){},onComponentDuplicated:function(t,n,e){},onComponentSelected:function(t,n){},onComponentSnippetDropped:function(t,n,e){},onBeforeDynamicContentLoad:function(t,n){},onDynamicContentLoaded:function(t,n,e,o){},onDynamicContentError:function(t,n,e,o){}},o.components={},o.log=n,o.error=e,o.prototype={init:function(e){var o=this,i=o.options;if(i.iframeMode)e=o.initFrame(e);else if(o.body=t(document.body),e.is("textarea")){n("Target is textarea",e);var a=e.val(),r=t("<div />"),s=o.generateId("wrapper");e.after(r),r.attr({id:s,"class":"keditor-wrapper"}),n('Id for keditor wrapper is: "'+s+'"'),r.html(a),e.css("display","none"),e.attr("data-keditor-wrapper","#"+s),e=r}o.initContentAreas(e);var d,c=o.body;c.hasClass("initialized-snippets-list")?n("Snippets list is already initialized!"):(d=o.initSidebar(),c.addClass("initialized-snippets-list")),c.hasClass("initialized-click-event-handlers")?n("CLick event handlers is already initialized!"):(o.initKEditorClicks(),c.addClass("initialized-click-event-handlers")),d||"function"!=typeof i.onReady||i.onReady.call(o)},generateId:function(t){var n=(new Date).getTime();return"keditor-"+t+"-"+n},initNiceScroll:function(e){n("initNiceScroll",e),t.fn.niceScroll?(n("Initialize $.fn.niceScroll"),e.niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:"",disablemutationobserver:!0})):n("$.fn.niceScroll does not exist. Use default sidebar.")},initFrame:function(e){n("initFrame",e);var i=this,a=i.options,r=e.html(),s=t("<iframe />"),d=i.generateId("frame");e.after(s),s.attr({id:d,"class":"keditor-frame"}),n('Id for keditor frame is: "'+d+'"'),e.css("display","none"),e.attr("data-keditor-frame","#"+d);var c=s.contents(),l=c.find("head"),p=c.find("body");n("Adding styles to iframe...");var f="";t('[data-type="keditor-style"]').each(function(){var n=t(this),e=n.attr("href")||n.attr("data-href")||"";f+=e?'<link rel="stylesheet" type="text/css" href="'+e+'" />\n':'<style type="text/css">'+n.html()+"</style>\n"}),n("Styles: \n"+f),l.append(f),n("All styles are added"),n("Adding original content to iframe...");var g;return a.contentAreasWrapper?(g=t(a.contentAreasWrapper),p.append(g),g.html(r)):p.html(r),a.snippetsListId=o.DEFAULTS.snippetsListId,i.body=p,"function"==typeof a.onInitFrame&&a.onInitFrame.call(s,s,l,p),g||p},initSidebar:function(){n("initSidebar");var i=this,a=i.options,r=i.body;return r.addClass("opened-keditor-sidebar"),a.snippetsListId===o.DEFAULTS.snippetsListId?(n("Render default KEditor snippet container"),r.append('<div id="keditor-sidebar">   <a id="keditor-sidebar-toggler"><i class="fa fa-chevron-right"></i></a>   <div id="keditor-snippets-list"></div>   <div id="keditor-snippets-content" style="display: none"></div>   <div id="keditor-setting-panel">       <div id="keditor-setting-header"><span id="keditor-setting-title"></span><a href="#" id="keditor-setting-closer"><i class="fa fa-arrow-right"></i></a></div>       <div id="keditor-setting-body"><div id="keditor-setting-forms"></div></div>   </div></div>'),i.initSidebarToggler()):(n('Render KEditor snippets content after custom snippets list with id="'+a.snippetsListId+'"'),r.find("#"+a.snippetsListId).after('<div id="keditor-snippets-content" style="display: none"></div>')),"string"==typeof a.snippetsUrl&&a.snippetsUrl.length>0?(n('Getting snippets form "'+a.snippetsUrl+'"...'),t.ajax({type:"get",dataType:"html",url:a.snippetsUrl,success:function(t){n("Success in getting snippets",t),i.renderSnippets(t),i.initSnippets(),i.initTabs(),i.initTabsSwitcher(),i.initSettingPanel(),(a.snippetsTooltipEnabled||a.tabTooltipEnabled)&&(n("Initialize Bootstrap tooltip plugin"),r.find("#"+a.snippetsListId).find('[data-toggle="tooltip"]').tooltip()),"function"==typeof a.onReady&&a.onReady.call(i)},error:function(t){n("Error when getting snippets",t)}})):void e('"snippetsUrl" must be not null!')},toggleSidebar:function(t){n("toggleSidebar",t);var e=this,o=e.options,i=e.body,a=i.find("#keditor-sidebar-toggler i");t?(i.addClass("opened-keditor-sidebar"),a.attr("class","fa fa-chevron-right")):(i.removeClass("opened-keditor-sidebar"),a.attr("class","fa fa-chevron-left")),"function"==typeof o.onSidebarToggled&&o.onSidebarToggled.call(null,t)},initSidebarToggler:function(){n("initSidebarToggler");var t=this,e=t.body;e.find("#keditor-sidebar-toggler").on("click",function(n){n.preventDefault(),t.toggleSidebar(!e.hasClass("opened-keditor-sidebar"))})},renderSnippets:function(e){n("renderSnippets",e);var o=this,i=o.options,a=o.body,r="",s="",d="";t("<div />").html(e).find("> div").each(function(e){var a=t(this),c=a.html().trim(),l=a.attr("data-preview"),p=a.attr("data-type"),f=a.attr("data-title"),g="";n("Snippet #"+e+" type="+p,l,c),g+='<section class="keditor-snippet" data-snippet="#keditor-snippet-'+e+'" data-type="'+p+'" '+(i.snippetsTooltipEnabled?'data-toggle="tooltip" data-placement="'+i.snippetsTooltipPosition+'"':"")+' title="'+f+'">',g+='   <img class="keditor-snippet-preview" src="'+l+'" />',g+="</section>","container"===p?r+=g:p.indexOf("component")!==-1&&(s+=g);var m=o.getDataAttributes(a,["data-preview","data-type","data-title"],!0);d+='<script id="keditor-snippet-'+e+'" type="text/html" '+m.join(" ")+">"+c+"</script>"}),a.find("#"+i.snippetsListId).html('<ul id="keditor-snippets-type-switcher" class="nav nav-tabs nav-justified">    <li class="active"><a href="#keditor-container-snippets"'+(i.tabTooltipEnabled?'data-toggle="tooltip" data-placement="bottom"':"")+' title="'+i.tabContainersTitle+'">'+i.tabContainersText+'</a></li>    <li><a href="#keditor-component-snippets"'+(i.tabTooltipEnabled?'data-toggle="tooltip" data-placement="bottom"':"")+' title="'+i.tabComponentsTitle+'">'+i.tabComponentsText+'</a></li></ul><div id="keditor-snippets-container" class="tab-content">   <div class="tab-pane keditor-snippets active" id="keditor-container-snippets">'+r+'</div>   <div class="tab-pane keditor-snippets" id="keditor-component-snippets">'+s+"</div></div>").addClass("loaded-snippets"),a.find("#keditor-snippets-content").html(d)},initSnippets:function(){n("initSnippets");var e=this,o=e.options,i=e.body,a=i.find("#"+o.snippetsListId);n("Initialize $.fn.draggable for container snippets list"),a.find(".keditor-snippet[data-type=container]").draggable({helper:"clone",revert:"invalid",connectToSortable:i.find(".keditor-content-area"),start:function(){t("[contenteditable]").blur(),t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),t(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")},stop:function(){a.find(".keditor-snippet[data-type^=component]").draggable("option","connectToSortable",i.find(".keditor-container-content"))}}),a.find(".keditor-snippet[data-type^=component]").draggable({helper:"clone",revert:"invalid",connectToSortable:i.find(".keditor-container-content"),start:function(){i.find("[contenteditable]").blur(),i.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.addClass("highlighted-container-content")},stop:function(){i.removeClass("highlighted-container-content")}})},initTabs:function(){n("initTabs");var e=this,o=e.body,i=e.options,a=o.find("#keditor-snippets-type-switcher"),r=o.find("#keditor-snippets-container");if(i.extraTabs&&t.isPlainObject(i.extraTabs)){n("Add extra tabs",i.extraTabs);for(var s in i.extraTabs){var d=i.extraTabs[s];a.append('<li><a href="#keditor-extra-tab-'+s+'"'+(i.tabTooltipEnabled?'data-toggle="tooltip" data-placement="bottom" title="'+d.title+'"':"")+">"+d.text+"</a></li>"),r.append('<div class="tab-pane keditor-snippets" id="keditor-extra-tab-'+s+'">'+d.content+"</div>")}}e.initNiceScroll(r.find(".tab-pane"))},initTabsSwitcher:function(){n("initTabsSwitcher");var e=this,o=e.body,i=o.find("#keditor-snippets-type-switcher li"),a=o.find("#keditor-snippets-container .tab-pane");i.find("a").on("click",function(n){n.preventDefault();var e=t(this),r=e.parent(),s=e.attr("href");if(!r.hasClass("active")){var d=i.filter(".active"),c=a.filter(".active"),l=o.find(s);d.removeClass("active"),c.removeClass("active"),r.addClass("active"),l.addClass("active"),t.fn.niceScroll&&(c.getNiceScroll().hide(),l.getNiceScroll().show())}})},initSettingPanel:function(){n("initSettingPanel");var i=this,a=i.options,r=i.body;r.find("#keditor-setting-closer").on("click",function(t){t.preventDefault(),i.hideSettingPanel()});var s=r.find("#keditor-setting-forms");if(i.initNiceScroll(s),a.containerSettingEnabled===!0)if("function"==typeof a.containerSettingInitFunction){var d=t('<div id="keditor-container-setting" class="keditor-setting-form clearfix"></div>');s.append(d),n("Initialize container setting panel"),a.containerSettingInitFunction.call(i,d,i)}else e('"containerSettingInitFunction" is not function!');n('Call "initSettingForm" function of all component types if settingEnabled = true');for(var c in o.components)if(o.components.hasOwnProperty(c)){var l=o.components[c],p=l.settingEnabled===!0;if(n("Type: "+c+", settingEnabled: "+p),p)if("function"==typeof l.initSettingForm){var d=t('<div id="keditor-setting-'+c+'" data-type="'+c+'" class="keditor-setting-form clearfix"></div>');s.append(d),n('Initialize setting form for component type "'+c+'"'),l.initSettingForm.call(l,d,i)}else n('"initSettingForm" function of component type "'+c+'" does not exist')}},setSettingContainer:function(t){n("setSettingContainer",t);var e=this,o=e.body;if(t){var i=t.attr("id");o.attr("data-setting-container",i)}else o.removeAttr("data-setting-container")},getSettingContainer:function(){n("getSettingContainer");var t=this,e=t.body,o=e.attr("data-setting-container");return e.find("#"+o)},setSettingComponent:function(t){n("setSettingComponent",t);var e=this,o=e.body;if(t){var i=t.attr("id");o.attr("data-setting-component",i)}else o.removeAttr("data-setting-component")},getSettingComponent:function(){n("getSettingComponent");var t=this,e=t.body,o=e.attr("data-setting-component");return e.find("#"+o)},showSettingPanel:function(t){n("showSettingPanel",t);var e=this,i=e.options,a=e.body,r=t.is(".keditor-component"),s=a.find("#keditor-setting-forms").children(".active");if(s.removeClass("active"),r){e.setSettingComponent(t),e.setSettingContainer(null);var d=e.getComponentType(t),c=o.components[d];a.find("#keditor-setting-title").html(c.settingTitle);var l=a.find("#keditor-setting-"+d);"function"==typeof c.showSettingForm?(n('Show setting form of component type "'+d+'"'),c.showSettingForm.call(c,l,t,e)):n('"showSettingForm" function of component type "'+d+'" does not exist'),l.addClass("active")}else{e.setSettingContainer(t),e.setSettingComponent(null),a.find("#keditor-setting-title").html("Container Settings");var l=a.find("#keditor-container-setting");"function"==typeof i.containerSettingShowFunction?(n("Show setting form of container"),i.containerSettingShowFunction.call(e,l,t,e)):n('"containerSettingShowFunction" does not exist'),l.addClass("active")}e.toggleSidebar(!0),a.addClass("opened-keditor-setting")},hideSettingPanel:function(){n("hideSettingPanel");var t=this,e=t.options,i=t.body;i.removeClass("opened-keditor-setting");var a=i.find("#keditor-setting-forms").children(".active");if(a.length>0){if(a.is("#keditor-container-setting"))"function"==typeof e.containerSettingHideFunction?(n("Hide setting form of container"),e.containerSettingHideFunction.call(t,a,t)):n('"containerSettingHideFunction" does not exist');else{var r=a.attr("data-type"),s=o.components[r];"function"==typeof s.hideSettingForm?(n('Hide setting form of component type "'+r+'"'),s.hideSettingForm.call(s,a,t)):n('"hideSettingForm" function of component type "'+r+'" does not exist')}a.removeClass("active")}i.removeClass("opened-keditor-setting"),t.setSettingComponent(null),t.setSettingContainer(null)},getContentAreas:function(e){n("getContentAreas",e);var o,i=this,a=i.options;if(a.contentAreasSelector&&(o=e.find(a.contentAreasSelector)),!o||0===o.length){n("Do not find any content area. Creating default content area..."),o=t("<div />");var r=e.html();o.html(r),e.empty().append(o)}return o},initContentAreas:function(e){n("initContentAreas",e);var o=this,i=o.getContentAreas(e);i.each(function(){var e=t(this),i=e.attr("id")||"";0===i.length&&(n("Content area does not contain Id. Generating id for content area..."),i=o.generateId("content-area"),e.attr("id",i),n('Id for content are is: "'+i+'"')),o.initContentArea(e),e.data("keditor",o)})},initContentArea:function(e){n("initContentArea",e);var o=this,i=o.options,a=o.body;if(e.addClass("keditor-content-area"),n("Initialize $.fn.droppable for content area"),e.droppable({accept:".keditor-snippet[data-type=container]",tolerance:"pointer",greedy:!0}),n("Initialize $.fn.sortable for content area"),e.sortable({handle:".btn-container-reposition",items:"> section",connectWith:".keditor-content-area",axis:"y",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},receive:function(r,s){n("On received snippet",r,s);var d=s.helper,c=s.item;if(c.is(".keditor-snippet")){var l=a.find(c.attr("data-snippet")).html();n("Snippet content",l);var p=t('<section class="keditor-container">   <section class="keditor-container-inner">'+l+"</section></section>");d.replaceWith(p),p.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),p.addClass("showed-keditor-toolbar")),"function"==typeof i.onContainerSnippetDropped&&i.onContainerSnippetDropped.call(e,r,p,s.item),o.initContainer(e,p)}o.hideSettingPanel(),"function"==typeof i.onContentChanged&&i.onContentChanged.call(e,r)}}),n("Initialize existing containers in content area"),e.children("section").each(function(){o.convertToContainer(e,t(this))}),"function"==typeof i.onInitContentArea){var r=i.onInitContentArea.call(e,e);r&&r.length>0&&t.each(r,function(){o.convertToContainer(e,t(this))})}},convertToContainer:function(t,e){n("convertToContainer",t,e);var o,i=this,a=e.is("section");a?(e.addClass("keditor-container"),e.wrapInner('<section class="keditor-container-inner"></section>'),o=e):(e.wrap('<section class="keditor-container"><section class="keditor-container-inner"></section></section>'),o=e.parent().parent()),i.initContainer(t,o)},initContainer:function(e,o){n("initContainer",e,o);var i=this,a=i.options;if(o.hasClass("keditor-initialized-container")&&o.hasClass("keditor-initializing-container"))n(o.hasClass("keditor-initialized-container")?"Container is already initialized!":"Container is initializing...");else{o.addClass("keditor-initializing-container");var r="";a.containerSettingEnabled===!0&&(r='<a href="#" class="btn-container-setting">'+a.btnSettingContainerText+"</a>"),n("Render KEditor toolbar for container",o),o.append('<div class="keditor-toolbar keditor-toolbar-container">   <a href="#" class="btn-container-reposition">'+a.btnMoveContainerText+"</a>"+r+'   <a href="#" class="btn-container-duplicate">'+a.btnDuplicateContainerText+'</a>   <a href="#" class="btn-container-delete">'+a.btnDeleteContainerText+"</a></div>");var s=i.generateId("container");n("Id for container is: "+s),o.attr("id",s);var d=o.find('[data-type="container-content"]');n("Initialize "+d.length+" container content(s)"),d.each(function(){var n=t(this);i.initContainerContent(e,o,n)}),"function"==typeof a.onInitContainer&&a.onInitContainer.call(e,o),o.addClass("keditor-initialized-container"),o.removeClass("keditor-initializing-container")}},initContainerContent:function(e,o,i){n("initContainerContent",e,o,i);var a=this,r=a.options,s=a.body,d=a.generateId("container-content");i.addClass("keditor-container-content"),n("Id for container content id: "+d,i),i.attr("id",d),n("Initialize $.fn.droppable for container content"),i.droppable({accept:".keditor-snippet[data-type=component]",tolerance:"pointer",greedy:!0}),n("Initialize $.fn.sortable for container content"),i.sortable({handle:".btn-component-reposition",items:"> section",connectWith:".keditor-container-content",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},receive:function(o,i){n("On received snippet",o,i);var d,c=i.helper,l=i.item;if(l.is(".keditor-snippet")){var p=s.find(l.attr("data-snippet")),f=p.html(),g=l.attr("data-type");n("Snippet content",f);var m=a.getDataAttributes(p,null,!0),C=t('<section class="keditor-component" data-type="'+g+'" '+m.join(" ")+'>   <section class="keditor-component-content">'+f+"</section></section>");c.replaceWith(C),d=C.closest(".keditor-container"),"function"==typeof r.onComponentSnippetDropped&&r.onComponentSnippetDropped.call(e,o,C,i.item),a.initComponent(e,d,C)}else d=l.closest(".keditor-container");d.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),d.addClass("showed-keditor-toolbar")),"function"==typeof r.onContainerChanged&&r.onContainerChanged.call(e,o,d),"function"==typeof r.onContentChanged&&r.onContentChanged.call(e,o)}}),n("Initialize existing components inside container content"),i.children().each(function(){var n=t(this);a.convertToComponent(e,o,n)})},convertToComponent:function(t,e,o){n("convertToComponent",t,e,o);var i,a=this,r=o.is("section");r?(o.addClass("keditor-component"),o.wrapInner('<section class="keditor-component-content"></section>'),i=o):(o.wrap('<section class="keditor-component"><section class="keditor-component-content"></section></section>'),i=o.parent().parent()),a.initComponent(t,e,i)},getDataAttributes:function(e,o,i){n("getDataAttributes",e,o,i);var a=i?[]:{};return o||(o=[]),t.each(e.get(0).attributes,function(n,e){0===e.name.indexOf("data-")&&t.inArray(e.name,o)===-1&&(i?a.push(e.name+'="'+e.value+'"'):a[e.name]=e.value)}),a},getComponentType:function(t){n("getComponentType",t);var i=this,a=i.options,r=t.attr("data-type"),s=r?r.replace("component-",""):"";return s&&s in o.components?s:(n(s?'Component type "'+s+'" does not exist':"This component does not contain data-type attribute"),"string"==typeof a.defaultComponentType?s=a.defaultComponentType:"function"==typeof a.defaultComponentType&&(s=a.defaultComponentType.call(t,t)),s||e("Component type is undefined!"),n("Fallback to defaultComponentType: "+s),s)},initComponent:function(e,i,a){n("initComponent",e,i,a);var r=this,s=r.options,d=r.body;if(a.hasClass("keditor-initialized-component")&&a.hasClass("keditor-initializing-component"))n(a.hasClass("keditor-initialized-component")?"Component is already initialized!":"Component is initializing...");else{a.addClass("keditor-initializing-component");var c=r.generateId("component");n("Id for component is: "+c),a.attr("id",c);var l=a.children(".keditor-component-content"),p=r.generateId("component-content");n("Id for component content is: "+p),l.attr("id",p);var f=r.getComponentType(a);n("Component type: "+f);var g=o.components[f],m=g.settingEnabled,C="";m&&(C='<a href="#" class="btn-component-setting">'+s.btnSettingComponentText+"</a>"),n("Render KEditor toolbar for component",a),a.append('<div class="keditor-toolbar keditor-toolbar-component">   <a href="#" class="btn-component-reposition">'+s.btnMoveComponentText+"</a>"+C+'   <a href="#" class="btn-component-duplicate">'+s.btnDuplicateComponentText+'</a>   <a href="#" class="btn-component-delete">'+s.btnDeleteComponentText+"</a></div>");var h=[];a.find("[data-dynamic-href]").each(function(){var n=t(this);h.push(r.initDynamicContent(n))}),t.when.apply(null,h).then(function(){"function"==typeof g.init?g.init.call(g,e,i,a,r):(d.removeClass("highlighted-container-content"),n('"init" function of component type "'+f+'" does not exist')),"function"==typeof s.onInitComponent&&s.onInitComponent.call(e,a),a.addClass("keditor-initialized-component"),a.removeClass("keditor-initializing-component")})}},getClickedElement:function(n,e){var o=t(n.target),i=o.closest(e);return o.is(e)?o:i.length>0?i:null},initKEditorClicks:function(){n("initKEditorClicks");var e=this,o=e.options,i=e.body;i.on("click",function(t){var a=e.getClickedElement(t,"#keditor-sidebar"),r=e.getClickedElement(t,".keditor-container");if(r){if(n("Click on .keditor-container",r,r.hasClass("showed-keditor-toolbar")),!r.hasClass("showed-keditor-toolbar")){i.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),r.addClass("showed-keditor-toolbar");var s=r.parent();"function"==typeof o.onContainerSelected&&o.onContainerSelected.call(s,t,r)}}else a||(i.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"));var d=e.getClickedElement(t,".keditor-component");if(d){if(n("Click on .keditor-component",d),!d.hasClass("showed-keditor-toolbar")){i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),d.addClass("showed-keditor-toolbar");var s=d.parent();"function"==typeof o.onComponentSelected&&o.onComponentSelected.call(s,t,d)}}else a||i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}),i.on("click",".btn-container-setting",function(o){o.preventDefault();var a=t(this);n("Click on .btn-container-setting",a);var r=a.closest(".keditor-container");i.hasClass("opened-keditor-setting")&&i.hasClass("opened-keditor-sidebar")&&r.is(e.getSettingContainer())?e.hideSettingPanel():e.showSettingPanel(r)}),i.on("click",".btn-container-duplicate",function(a){a.preventDefault();var r=t(this);n("Click on .btn-container-duplicate",r);var s=r.closest(".keditor-container"),d=s.parent(),c=t(e.getContainerContent(s));s.after(c),e.convertToContainer(d,c);var l=i.find("#"+o.snippetsListId),p=l.find(".keditor-snippet[data-type^=component]"),f=p.draggable("option","connectToSortable");p.draggable("option","connectToSortable",f.add(c.find(".keditor-container-content"))),n("Container is duplicated"),"function"==typeof o.onContainerDuplicated&&o.onContainerDuplicated.call(d,s,c),"function"==typeof o.onContentChanged&&o.onContentChanged.call(d,a)}),i.on("click",".btn-container-delete",function(i){i.preventDefault();var a=t(this);if(n("Click on .btn-container-delete",a),confirm("Are you sure that you want to delete this container? This action can not be undo!")){var r=a.closest(".keditor-container"),s=r.find(".keditor-component"),d=r.parent();"function"==typeof o.onBeforeContainerDeleted&&o.onBeforeContainerDeleted.call(d,i,r);var c=e.getSettingComponent();if(c){var l=c.closest(".keditor-container");l.is(r)&&(n("Deleting container is container of setting container. Close setting panel for this setting component",c),e.hideSettingPanel())}else e.getSettingContainer().is(r)&&(n("Deleting container is setting container. Close setting panel for this container",r),e.hideSettingPanel());s.length>0&&s.each(function(){e.deleteComponent(t(this))}),r.remove(),"function"==typeof o.onContainerDeleted&&o.onContainerDeleted.call(d,i,r),"function"==typeof o.onContentChanged&&o.onContentChanged.call(d,i)}}),i.on("click",".btn-component-setting",function(o){o.preventDefault();var a=t(this);n("Click on .btn-component-setting",a);var r=a.closest(".keditor-component");i.hasClass("opened-keditor-setting")&&i.hasClass("opened-keditor-sidebar")&&r.is(e.getSettingComponent())?e.hideSettingPanel():e.showSettingPanel(r)}),i.on("click",".btn-component-duplicate",function(i){i.preventDefault();var a=t(this);n("Click on .btn-component-duplicate",a);var r=a.closest(".keditor-component"),s=r.closest(".keditor-container"),d=s.parent(),c=t(e.getComponentContent(r));r.after(c),e.convertToComponent(d,s,c),n("Component is duplicated"),"function"==typeof o.onComponentDuplicated&&o.onComponentDuplicated.call(d,r,c),"function"==typeof o.onContainerChanged&&o.onContainerChanged.call(d,i,s),"function"==typeof o.onContentChanged&&o.onContentChanged.call(d,i)}),i.on("click",".btn-component-delete",function(i){i.preventDefault();var a=t(this);if(n("Click on .btn-component-delete",a),confirm("Are you sure that you want to delete this component? This action can not be undo!")){var r=a.closest(".keditor-component"),s=r.closest(".keditor-content-area");"function"==typeof o.onBeforeComponentDeleted&&o.onBeforeComponentDeleted.call(s,i,r),e.getSettingComponent().is(r)&&e.hideSettingPanel(),e.deleteComponent(r),"function"==typeof o.onComponentDeleted&&o.onComponentDeleted.call(s,i,r),"function"==typeof o.onContainerChanged&&o.onContainerChanged.call(s,i,r),"function"==typeof o.onContentChanged&&o.onContentChanged.call(s,i)}})},deleteComponent:function(t){n("deleteComponent",t);var e=this,i=e.getComponentType(t),a=o.components[i];"function"==typeof a.destroy?a.destroy.call(a,t,e):n('"destroy" function of component type "'+i+'" does not exist'),t.remove()},initDynamicContent:function(e){n("initDynamicContent",e);var o=this,i=o.options,a=e.closest(".keditor-component"),r=e.closest(".keditor-content-area");"function"==typeof i.onBeforeDynamicContentLoad&&i.onBeforeDynamicContentLoad.call(r,e,a);var s=e.attr("data-dynamic-href"),d=o.getDataAttributes(a,["data-type","data-dynamic-href"],!1);return d=t.param(d),n("Dynamic href: "+s,"Data: "+d),t.ajax({url:s,data:d,type:"GET",dataType:"HTML",success:function(t,o,a){n("Dynamic content is loaded",e,t,o,a),e.html(t),"function"==typeof i.onDynamicContentLoaded&&i.onDynamicContentLoaded.call(r,e,t,o,a)},error:function(t,o,a){n("Error when loading dynamic content",e,t,o,a),"function"==typeof i.onDynamicContentError&&i.onDynamicContentError.call(r,e,t,o,a)}})},getComponentContent:function(e){n("getComponentContent",e);var i,a=this,r=a.getComponentType(e),s=o.components[r],d=a.getDataAttributes(e,null,!0);if("function"==typeof s.getContent)i=s.getContent.call(s,e,a);else{n('"getContent" function of component type "'+r+'" does not exist. Using default getContent method');var c=e.children(".keditor-component-content");i=c.html()}var l=t("<div />").html(i);return l.find("[data-dynamic-href]").each(function(){t(this).html("")}),i=l.html(),"<section "+d.join(" ")+">"+i+"</section>"},getContainerContent:function(e){n("getContainerContent",e);var o=this,i=(o.options,e.children(".keditor-container-inner").clone());return i.find("[data-type=container-content]").each(function(){var n=t(this);n.removeClass("keditor-container-content ui-droppable ui-sortable").removeAttr("id"),n.children(".keditor-component").each(function(){var n=t(this);n.replaceWith(o.getComponentContent(n))})}),"<section>"+i.html()+"</section>"}};var i={__init:function(e){return t(this).each(function(){var i=t(this);if(i.data("keditor"))n("KEditor is already initialized!");else{n("Initialze KEditor",i,e);var a=new o(i,e);i.data("keditor",a)}})},getContent:function(n){var e=t(this),o=e.data("keditor"),i=o.options,a=[];return e=i.iframeMode?o.body:e,e.find(".keditor-content-area").each(function(){var n="";t(this).children(".keditor-container").each(function(){var e=t(this);n+=o.getContainerContent(e,i)}),a.push(n)}),n?a:a.join("\n")},getOptions:function(){var n=t(this).data("keditor");return n.options}};t.keditor=o,t.fn.keditor=function(t){return i[t]&&"init"!==t?i[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e("Method "+t+" does not exist on $.fn.keditor"):i.__init.apply(this,arguments)}}(jQuery);
//# sourceMappingURL=keditor-0.0.0.min.js.map
