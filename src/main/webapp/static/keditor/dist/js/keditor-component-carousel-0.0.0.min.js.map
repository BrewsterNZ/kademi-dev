{"version":3,"sources":["keditor-component-carousel-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","componentContent","children","carousel","find","length","self","this","images","addClass","each","item","push","src","attr","hash","css","html","i","image","addImageToCarousel","id","generateId","getContent","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","basePath","window","location","pathname","substr","lastIndexOf","carouselAddImage","carouselImageWrap","mselect","contentTypes","bs3Modal","pagePath","onSelectFile","relUrl","addImageToList","getSettingComponent","sortable","handle","items","axis","tolerance","sort","removeClass","update","rearrangeItems","document","body","on","e","preventDefault","confirm","btn","closest","siblings","refreshCarousel","remove","value","isNaN","comp","checked","showSettingForm","index","replace","isWrap","pause","interval","height","val","prop","cls","backgroundUrl","append","carouselImageItem","img","jQuery"],"mappings":"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","file":"keditor-component-carousel-0.0.0.min.js","sourcesContent":["/**\n * Created by Anh on 7/27/2016.\n */\n/**\n * KEditor Carousel Component\n * @copyright: Kademi (http://kademi.co)\n * @author: Kademi (http://kademi.co)\n * @version: @{version}\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\n */\n(function ($) {\n    var KEditor = $.keditor;\n    var flog = KEditor.log;\n    \n    KEditor.components['carousel'] = {\n        init: function (contentArea, container, component, keditor) {\n            flog('init \"carousel\" component', component);\n            var componentContent = component.children('.keditor-component-content');\n            var carousel = componentContent.find('.carousel');\n            \n            if (carousel.find('.carousel-img').length === 0) {\n                var self = this;\n                var images = [];\n    \n                carousel.addClass('carousel-fixed-height');\n                carousel.find('.carousel-inner .item').each(function () {\n                    var item = $(this);\n    \n                    images.push({\n                        src: item.find('img').attr('src'),\n                        hash: item.attr('data-hash')\n                    });\n                });\n    \n                carousel.attr('data-height', 200).css('height', 200);\n                carousel.find('.carousel-inner').html('');\n                carousel.find('.carousel-indicators').html('');\n                \n                $.each(images, function (i, image) {\n                    self.addImageToCarousel(component, image.src, image.hash);\n                });\n            }\n            \n            var id = keditor.generateId('component-carousel');\n            carousel.attr('id', id);\n            carousel.find('.carousel-indicators li').attr('data-target', id);\n            carousel.find('.carousel-control').attr('href', '#' + id);\n        },\n        getContent: function (component, keditor) {\n            var componentContent = component.children('.keditor-component-content');\n            return componentContent.html();\n        },\n        settingEnabled: true,\n        \n        settingTitle: 'Carousel settings',\n        \n        initSettingForm: function (form, keditor) {\n            flog('init \"carousel\" settings', form);\n            \n            return $.ajax({\n                url: '/static/keditor/componentCarouselSettings.html',\n                type: 'get',\n                dataType: 'HTML',\n                success: function (resp) {\n                    form.html(resp);\n                    \n                    var basePath = window.location.pathname.substr(0, window.location.pathname.lastIndexOf('/') + 1);\n                    var carouselAddImage = form.find('.carouselAddImage');\n                    var carouselImageWrap = form.find('.carouselImageWrap');\n                    var self = this;\n                    \n                    carouselAddImage.mselect({\n                        contentTypes: ['image'],\n                        bs3Modal: true,\n                        pagePath: basePath,\n                        basePath: basePath,\n                        onSelectFile: function (url, relUrl, type, hash) {\n                            flog('keditor carousel selected a file', url, hash);\n                            self.addImageToList(form, url, hash);\n                            self.addImageToCarousel(keditor.getSettingComponent(), url, hash);\n                        }\n                    });\n                    \n                    carouselImageWrap.sortable({\n                        handle: '.btn-sort-image',\n                        items: '> .carouselImageItem',\n                        axis: 'y',\n                        tolerance: 'pointer',\n                        sort: function () {\n                            $(this).removeClass('ui-state-default');\n                        },\n                        update: function () {\n                            self.rearrangeItems(keditor.getSettingComponent(), form);\n                        }\n                    });\n                    \n                    $(document.body).on('click', '.carouselImageItem a.btn-remove-image', function (e) {\n                        e.preventDefault();\n                        \n                        if (confirm('Are you sure that you want to delete this image?')) {\n                            var btn = $(this);\n                            var hash = btn.closest('.btn-group').siblings('[data-hash]').attr('data-hash');\n                            \n                            self.refreshCarousel(keditor.getSettingComponent(), hash);\n                            btn.closest('.carouselImageItem').remove();\n                        }\n                    });\n                    \n                    form.find('.carouselHeight').on('change', function (e) {\n                        var value = this.value;\n                        \n                        if (isNaN(value) || +value < 200) {\n                            value = 200;\n                            this.value = 200;\n                        }\n    \n                        var carousel = keditor.getSettingComponent().find('.carousel');\n                        carousel.attr('data-height', value);\n                        carousel.css('height', value);\n                    });\n                    \n                    form.find('.carouselPause').on('change', function (e) {\n                        e.preventDefault();\n                        var comp = keditor.getSettingComponent().find('.carousel');\n                        comp.attr('data-pause', this.value);\n                    });\n                    \n                    form.find('.carouselInterval').on('change', function (e) {\n                        e.preventDefault();\n                        var comp = keditor.getSettingComponent().find('.carousel');\n                        comp.attr('data-interval', this.value);\n                    });\n                    \n                    form.find('.carouselWrap').on('click', function (e) {\n                        var comp = keditor.getSettingComponent().find('.carousel');\n                        if (this.checked) {\n                            comp.attr('data-wrap', 'true');\n                        } else {\n                            comp.attr('data-wrap', 'false');\n                        }\n                    });\n                }\n            });\n        },\n        \n        showSettingForm: function (form, component, keditor) {\n            var self = this;\n            form.find('.carouselImageWrap').html('');\n            component.find('.carousel-inner > .item').each(function (index, item) {\n                var url = $(item).find('.carousel-img').css('background-image');\n                url = url.replace(/^url\\('*(.+)'*\\)$/, '$1');\n                var hash = $(item).attr('data-hash');\n                self.addImageToList(form, url, hash);\n            });\n            \n            var isWrap = component.find('.carousel').attr('data-wrap');\n            var pause = component.find('.carousel').attr('data-pause');\n            var interval = component.find('.carousel').attr('data-interval');\n            var height = component.find('.carousel').attr('data-height');\n            \n            form.find('.carouselPause').val(pause);\n            form.find('.carouselInterval').val(interval);\n            form.find('.carouselWrap').prop('checked', isWrap === 'true');\n            form.find('.carouselHeight').val(height);\n        },\n        \n        addImageToCarousel: function (component, url, hash) {\n            var carousel = component.find('.carousel');\n            var index = carousel.find('.carousel-indicators').children().length;\n            var cls = index === 0 ? 'active' : '';\n            var backgroundUrl = \"background-image: url('\" + url + \"')\";\n            carousel.find('.carousel-indicators').append('<li data-target=\"#' + carousel.attr('id') + '\" data-slide-to=\"' + index + '\" class=\"' + cls + '\"></li>');\n            \n            carousel.find('.carousel-inner').append(\n                '<div data-hash=\"' + hash + '\" class=\"item ' + cls + '\">' +\n                '   <div class=\"carousel-img\" style=\"' + backgroundUrl + '\"></div>' +\n                '   <div class=\"carousel-caption\"></div>' +\n                '</div>'\n            );\n        },\n        \n        addImageToList: function (form, src, hash) {\n            form.find('.carouselImageWrap').append(\n                '<div class=\"carouselImageItem\">' +\n                '   <img class=\"img-responsive\" src=\"' + src + '\" data-hash=\"' + hash + '\" />' +\n                '   <div class=\"btn-group btn-group-sm\">' +\n                '       <a class=\"btn btn-info btn-sort-image\" href=\"#\"><i class=\"fa fa-sort\"></i></a>' +\n                '       <a title=\"Delete this image\" class=\"btn btn-danger btn-remove-image\" href=\"#\"><i class=\"fa fa-trash\"></i></a>' +\n                '   </div>' +\n                '</div>'\n            );\n        },\n        \n        refreshCarousel: function (component, hash) {\n            component.find('[data-hash=' + hash + ']').remove();\n            if (!component.find('.carousel-inner .item.active').length) {\n                component.find('.carousel-inner .item:first-child').addClass('active');\n            }\n            component.find('.carousel-indicators li:last-child').remove();\n        },\n        \n        rearrangeItems: function (component, form) {\n            var self = this;\n            var carousel = component.find('.carousel');\n            carousel.find('.carousel-inner').html('');\n            carousel.find('.carousel-indicators').html('');\n            \n            form.find('.carouselImageWrap').find('.carouselImageItem').each(function () {\n                var carouselImageItem = $(this);\n                var img = carouselImageItem.find('img');\n                \n                self.addImageToCarousel(component, img.attr('src'), img.attr('data-hash'));\n            });\n        }\n    }\n    \n})(jQuery);"],"sourceRoot":"/source/"}