{"version":3,"sources":["keditor-component-carousel-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","componentContent","children","carousel","find","length","self","this","images","addClass","each","item","push","src","attr","hash","css","html","i","image","addItemToCarousel","id","generateId","getContent","removeClass","eq","settingEnabled","settingTitle","editingItemId","initSettingForm","form","ajax","url","type","dataType","success","resp","getStyleOnce","getScriptOnce","iconpicker","iconset","cols","rows","placement","on","e","getSettingComponent","icon","carouselAddImage","carouselItemsWrap","mselect","contentTypes","bs3Modal","pagePath","options","basePath","onSelectFile","relUrl","addItemToList","caption","refreshCarousel","sortable","handle","items","axis","tolerance","sort","update","editorContent","initModalContent","modalContent","editorCaption","initModalCaption","modalCaption","preventDefault","modal","confirm","btn","closest","siblings","remove","carouselItem","txtCarouselContent","setData","val","trigger","txtCarouselCaption","value","isNaN","comp","checked","appendTo","document","body","contentOptions","extend","ckeditorOptions","removePlugins","replace","extraPlugins","ckeditor","editor","carouselContent","getData","content","captionOptions","toolbarGroups","toolbarSets","carouselCaption","showSettingForm","carouselImg","slice","isWrap","pause","interval","height","prop","iconPrev","trim","end","iconNext","data","carouselInner","index","cls","backgroundUrl","backgroundSize","append","itemStr","editCaption","Date","getTime","txtContent","txtCaption","img","jQuery"],"mappings":"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","file":"keditor-component-carousel-0.0.0.min.js","sourcesContent":["/**\n * KEditor Carousel Component\n * @copyright: Kademi (http://kademi.co)\n * @author: Kademi (http://kademi.co)\n * @version: @{version}\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\n */\n(function ($) {\n    var KEditor = $.keditor;\n    var flog = KEditor.log;\n    \n    KEditor.components['carousel'] = {\n        init: function (contentArea, container, component, keditor) {\n            flog('init \"carousel\" component', component);\n            var componentContent = component.children('.keditor-component-content');\n            var carousel = componentContent.find('.carousel');\n            \n            if (carousel.find('.carousel-img').length === 0 && carousel.find('.carousel-content').length === 0) {\n                var self = this;\n                var images = [];\n                \n                carousel.addClass('carousel-fixed-height');\n                carousel.find('.carousel-inner .item').each(function () {\n                    var item = $(this);\n                    \n                    images.push({\n                        src: item.find('img').attr('src'),\n                        hash: item.attr('data-hash')\n                    });\n                });\n                \n                carousel.attr('data-height', 300).css('height', 300);\n                carousel.find('.carousel-inner').html('');\n                carousel.find('.carousel-indicators').html('');\n                \n                $.each(images, function (i, image) {\n                    self.addItemToCarousel(component, {\n                        src: image.src,\n                        hash: image.hash\n                    });\n                });\n            }\n            \n            var id = keditor.generateId('component-carousel');\n            carousel.attr('id', id);\n            carousel.find('.carousel-indicators li').attr('data-target', '#' + id);\n            carousel.find('.carousel-control').attr('href', '#' + id);\n        },\n        getContent: function (component, keditor) {\n            var componentContent = component.children('.keditor-component-content');\n            componentContent.find('.carousel-inner').children().removeClass('active').eq(0).addClass('active');\n            \n            return componentContent.html();\n        },\n        settingEnabled: true,\n        \n        settingTitle: 'Carousel settings',\n        \n        editingItemId: '',\n        \n        initSettingForm: function (form, keditor) {\n            flog('init \"carousel\" settings', form);\n            \n            var self = this;\n            return $.ajax({\n                url: '/static/keditor/componentCarouselSettings.html',\n                type: 'get',\n                dataType: 'HTML',\n                success: function (resp) {\n                    form.html(resp);\n                    \n                    $.getStyleOnce('/static/bootstrap-iconpicker/1.7.0/css/bootstrap-iconpicker.min.css');\n                    $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/iconset/iconset-fontawesome-4.2.0.min.js', function () {\n                        $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/bootstrap-iconpicker.min.js', function () {\n                            form.find('.btn-prev-icon, .btn-next-icon').iconpicker({\n                                iconset: 'fontawesome',\n                                cols: 10,\n                                rows: 4,\n                                placement: 'left'\n                            });\n                            \n                            form.find('.btn-prev-icon').on('change', function (e) {\n                                var carousel = keditor.getSettingComponent().find('.carousel');\n                                carousel.find('.glyphicon-chevron-left').attr('class', 'fa glyphicon-chevron-left ' + e.icon);\n                            });\n                            \n                            form.find('.btn-next-icon').on('change', function (e) {\n                                var carousel = keditor.getSettingComponent().find('.carousel');\n                                carousel.find('.glyphicon-chevron-right').attr('class', 'fa glyphicon-chevron-right ' + e.icon);\n                            });\n                        });\n                    });\n                    \n                    var carouselAddImage = form.find('.carouselAddImage');\n                    var carouselItemsWrap = form.find('.carouselItemsWrap');\n                    \n                    carouselAddImage.mselect({\n                        contentTypes: ['image'],\n                        bs3Modal: true,\n                        pagePath: keditor.options.pagePath,\n                        basePath: keditor.options.basePath,\n                        onSelectFile: function (url, relUrl, type, hash) {\n                            flog('Keditor carousel selected a file', url, hash);\n                            self.addItemToList(form, {\n                                src: url,\n                                hash: hash,\n                                caption: ''\n                            });\n                            \n                            self.refreshCarousel(keditor.getSettingComponent(), form);\n                            self.editingItemId = '';\n                        }\n                    });\n                    \n                    carouselItemsWrap.sortable({\n                        handle: '.btn-sort-item',\n                        items: '> .carouselItem',\n                        axis: 'y',\n                        tolerance: 'pointer',\n                        sort: function () {\n                            $(this).removeClass('ui-state-default');\n                        },\n                        update: function () {\n                            self.refreshCarousel(keditor.getSettingComponent(), form);\n                        }\n                    });\n                    \n                    // Content modal\n                    var editorContent = self.initModalContent(form, keditor)\n                    var modalContent = $('#modal-carousel-content');\n                    \n                    // Caption modal\n                    var editorCaption = self.initModalCaption(form, keditor)\n                    var modalCaption = $('#modal-carousel-caption');\n                    \n                    form.find('.carouselAddImage').on('click', function (e) {\n                        e.preventDefault();\n                    });\n                    \n                    form.find('.carouselAddContent').on('click', function (e) {\n                        e.preventDefault();\n                        modalContent.modal('show');\n                    });\n                    \n                    form.on('click', '.carouselItem a.btn-remove-item', function (e) {\n                        e.preventDefault();\n                        \n                        if (confirm('Are you sure that you want to delete this image?')) {\n                            var btn = $(this);\n                            var hash = btn.closest('.btn-group').siblings('[data-hash]').attr('data-hash');\n                            \n                            var carousel = keditor.getSettingComponent().find('.carousel');\n                            carousel.find('[data-hash=' + hash + ']').remove();\n                            btn.closest('.carouselItem').remove();\n                            \n                            self.refreshCarousel(keditor.getSettingComponent(), form);\n                        }\n                    });\n                    \n                    form.on('click', '.carouselItem a.btn-edit-item', function (e) {\n                        e.preventDefault();\n                        \n                        var carouselItem = $(this).closest('.carouselItem');\n                        self.editingItemId = carouselItem.attr('id');\n                        var txtCarouselContent = carouselItem.find('.txt-carousel-content');\n                        \n                        if (txtCarouselContent.length > 0) {\n                            editorContent.setData(txtCarouselContent.val() || '');\n                            form.find('.carouselAddContent').trigger('click');\n                        } else {\n                            form.find('.carouselAddImage').trigger('click');\n                        }\n                    });\n                    \n                    \n                    form.on('click', '.carouselItem a.btn-edit-caption-item', function (e) {\n                        e.preventDefault();\n                        \n                        var carouselItem = $(this).closest('.carouselItem');\n                        self.editingItemId = carouselItem.attr('id');\n                        var txtCarouselCaption = carouselItem.find('.txt-carousel-caption');\n                        \n                        editorCaption.setData(txtCarouselCaption.val() || '');\n                        modalCaption.modal('show');\n                    });\n                    \n                    form.find('.carouselHeight').on('change', function (e) {\n                        var value = this.value;\n                        \n                        if (isNaN(value) || +value < 200) {\n                            value = 200;\n                            this.value = 200;\n                        }\n                        \n                        var carousel = keditor.getSettingComponent().find('.carousel');\n                        carousel.attr('data-height', value);\n                        carousel.css('height', value);\n                    });\n                    \n                    form.find('.carouselPause').on('change', function (e) {\n                        e.preventDefault();\n                        var comp = keditor.getSettingComponent().find('.carousel');\n                        comp.attr('data-pause', this.value);\n                    });\n                    \n                    form.find('.carouselInterval').on('change', function (e) {\n                        e.preventDefault();\n                        var comp = keditor.getSettingComponent().find('.carousel');\n                        comp.attr('data-interval', this.value);\n                    });\n                    \n                    form.find('.carouselWrap').on('click', function (e) {\n                        var comp = keditor.getSettingComponent().find('.carousel');\n                        if (this.checked) {\n                            comp.attr('data-wrap', 'true');\n                        } else {\n                            comp.attr('data-wrap', 'false');\n                        }\n                    });\n                    \n                    form.find('.select-image-size').on('change', function () {\n                        var carousel = keditor.getSettingComponent().find('.carousel');\n                        \n                        carousel.attr('data-image-size', this.value);\n                        \n                        carousel.find('.carousel-img').css('background-size', this.value === 'centered' ? 'unset' : '');\n                    });\n                }\n            });\n        },\n        \n        initModalContent: function (form, keditor) {\n            var self = this;\n            \n            var modalContent = $(\n                '<div class=\"modal fade\" tabindex=\"-1\" id=\"modal-carousel-content\">' +\n                '    <div class=\"modal-dialog modal-lg\">' +\n                '        <div class=\"modal-content\">' +\n                '            <div class=\"modal-header\">' +\n                '                <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>' +\n                '                <h4 class=\"modal-title\">Edit content</h4>' +\n                '            </div>' +\n                '            <div class=\"modal-body\">' +\n                '                <textarea id=\"modal-carousel-content-body\" class=\"form-control\" rows=\"12\"></textarea>' +\n                '            </div>' +\n                '            <div class=\"modal-footer\">' +\n                '                <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>' +\n                '                <button type=\"button\" class=\"btn btn-primary btn-carousel-save-content\">Save</button>' +\n                '            </div>' +\n                '        </div>' +\n                '    </div>' +\n                '</div>'\n            ).appendTo(document.body);\n            \n            var contentOptions = $.extend({}, keditor.options.ckeditorOptions);\n            contentOptions.removePlugins = contentOptions.removePlugins.replace(',autogrow', '') + ',sourcedialog';\n            contentOptions.extraPlugins = contentOptions.extraPlugins + ',autogrow';\n            var editorContent = $('#modal-carousel-content-body').ckeditor(contentOptions).editor;\n            \n            modalContent.on('hidden.bs.modal', function () {\n                editorContent.setData('');\n                self.editingItemId = '';\n            });\n            \n            modalContent.find('.btn-carousel-save-content').on('click', function (e) {\n                e.preventDefault();\n                \n                flog('Keditor carousel add content');\n                \n                var carouselContent = editorContent.getData() || '';\n                self.addItemToList(form, {\n                    content: carouselContent\n                });\n                \n                self.refreshCarousel(keditor.getSettingComponent(), form);\n                modalContent.modal('hide');\n            });\n            \n            return editorContent;\n        },\n        \n        initModalCaption: function (form, keditor) {\n            var self = this;\n            \n            var modalCaption = $(\n                '<div class=\"modal fade\" tabindex=\"-1\" id=\"modal-carousel-caption\">' +\n                '    <div class=\"modal-dialog modal-lg\">' +\n                '        <div class=\"modal-content\">' +\n                '            <div class=\"modal-header\">' +\n                '                <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>' +\n                '                <h4 class=\"modal-title\">Edit caption</h4>' +\n                '            </div>' +\n                '            <div class=\"modal-body\">' +\n                '                <textarea id=\"modal-carousel-caption-body\" class=\"form-control\" rows=\"12\"></textarea>' +\n                '            </div>' +\n                '            <div class=\"modal-footer\">' +\n                '                <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>' +\n                '                <button type=\"button\" class=\"btn btn-primary btn-carousel-save-caption\">Save</button>' +\n                '            </div>' +\n                '        </div>' +\n                '    </div>' +\n                '</div>'\n            ).appendTo(document.body);\n            \n            var captionOptions = $.extend({}, keditor.options.ckeditorOptions);\n            captionOptions.removePlugins = captionOptions.removePlugins.replace(',autogrow', '') + ',sourcedialog';\n            captionOptions.extraPlugins = captionOptions.extraPlugins + ',autogrow';\n            captionOptions.toolbarGroups = toolbarSets['Lite'];\n            var editorCaption = $('#modal-carousel-caption-body').ckeditor(captionOptions).editor;\n            \n            modalCaption.on('hidden.bs.modal', function () {\n                editorCaption.setData('');\n                self.editingItemId = '';\n            });\n            \n            modalCaption.find('.btn-carousel-save-caption').on('click', function (e) {\n                e.preventDefault();\n                \n                flog('Keditor carousel add content');\n                \n                var carouselCaption = editorCaption.getData() || '';\n                var item = form.find('#' + self.editingItemId).find('.img-responsive');\n                self.addItemToList(form, {\n                    src: item.attr('src'),\n                    hash: item.attr('data-hash'),\n                    caption: carouselCaption\n                });\n                \n                self.refreshCarousel(keditor.getSettingComponent(), form);\n                modalCaption.modal('hide');\n            });\n            \n            return editorCaption;\n        },\n        \n        showSettingForm: function (form, component, keditor) {\n            var self = this;\n            self.editingItemId = '';\n            form.find('.carouselItemsWrap').html('');\n            component.find('.carousel-inner > .item').each(function () {\n                var item = $(this);\n                var carouselImg = item.find('.carousel-img');\n                var carouselContent = item.find('.carousel-content');\n                \n                if (carouselContent.length > 0) {\n                    self.addItemToList(form, {\n                        content: carouselContent.html()\n                    });\n                } else {\n                    var url = carouselImg.css('background-image');\n                    url = url.slice(4, -1).replace(/['\"]/g, '');\n                    var hash = $(item).attr('data-hash');\n                    var caption = item.find('.carousel-caption');\n                    \n                    self.addItemToList(form, {\n                        src: url,\n                        hash: hash,\n                        caption: caption.html() || ''\n                    });\n                }\n            });\n            \n            var carousel = component.find('.carousel');\n            var isWrap = carousel.attr('data-wrap');\n            var pause = carousel.attr('data-pause');\n            var interval = carousel.attr('data-interval');\n            var height = carousel.attr('data-height');\n            \n            form.find('.carouselPause').val(pause);\n            form.find('.carouselInterval').val(interval);\n            form.find('.carouselWrap').prop('checked', isWrap === 'true');\n            form.find('.carouselHeight').val(height);\n            form.find('.select-image-size').val(carousel.attr('data-image-size') || 'stretched');\n            \n            $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/iconset/iconset-fontawesome-4.2.0.min.js', function () {\n                $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/bootstrap-iconpicker.min.js', function () {\n                    var iconPrev = carousel.find('.glyphicon-chevron-left').attr('class') || '';\n                    iconPrev = iconPrev.replace('glyphicon-chevron-left', '').replace('fa', '').trim();\n                    form.find('.btn-prev-icon').find('i').attr('class', 'fa ' + iconPrev).end().find('input').val(iconPrev);\n                    \n                    var iconNext = carousel.find('.glyphicon-chevron-right').attr('class') || '';\n                    iconNext = iconNext.replace('glyphicon-chevron-right', '').replace('fa', '').trim();\n                    form.find('.btn-next-icon').find('i').attr('class', 'fa ' + iconNext).end().find('input').val(iconNext);\n                });\n            });\n        },\n        \n        addItemToCarousel: function (component, data) {\n            flog('addItemToCarousel', component, data);\n            \n            var carousel = component.find('.carousel');\n            var carouselInner = carousel.find('.carousel-inner');\n            var id = carousel.attr('id');\n            var index = carouselInner.children().length;\n            var cls = index === 0 ? 'active' : '';\n            var backgroundUrl = \"background-image: url('\" + data.src + \"')\";\n            var backgroundSize = carousel.attr('data-image-size') === 'centered' ? ';background-size: unset' : '';\n            \n            carousel.find('.carousel-indicators').append(\n                '<li data-target=\"#' + id + '\" data-slide-to=\"' + index + '\" class=\"' + cls + '\"></li>'\n            );\n            \n            var itemStr = '';\n            if (data.content) {\n                itemStr += '<div class=\"item ' + cls + '\">';\n                itemStr += '   <div class=\"carousel-content clearfix\">' + data.content + '</div>';\n                itemStr += '   <div class=\"carousel-caption\"></div>';\n                itemStr += '</div>';\n            } else {\n                itemStr += '<div data-hash=\"' + data.hash + '\" class=\"item ' + cls + '\">';\n                itemStr += '   <div class=\"carousel-img\" style=\"' + backgroundUrl + backgroundSize + '\"></div>';\n                itemStr += '   <div class=\"carousel-caption\">' + data.caption + '</div>';\n                itemStr += '</div>';\n            }\n            \n            carouselInner.append(itemStr);\n        },\n        \n        addItemToList: function (form, data) {\n            flog('addItemToList', form, data);\n            \n            var editCaption = '';\n            \n            var itemStr = '';\n            if (data.content) {\n                itemStr += '<img class=\"img-responsive\" src=\"/static/keditor/componentCarouselContent.png\" />';\n                itemStr += '<textarea style=\"display: none\" class=\"txt-carousel-content\">' + data.content + '</textarea>';\n            } else {\n                itemStr += '<img class=\"img-responsive\" src=\"' + data.src + '\" data-hash=\"' + data.hash + '\" />';\n                itemStr += '<textarea style=\"display: none\" class=\"txt-carousel-caption\">' + data.caption + '</textarea>';\n                editCaption = '<a title=\"Edit caption\" class=\"btn btn-success btn-edit-caption-item\" href=\"#\"><i class=\"fa fa-file\"></i></a>';\n            }\n            \n            itemStr += '   <div class=\"btn-group btn-group-xs\">';\n            itemStr += '       <a title=\"Reorder item\" class=\"btn btn-info btn-sort-item\" href=\"#\"><i class=\"fa fa-sort\"></i></a>';\n            itemStr += '       <a title=\"Edit item\" class=\"btn btn-primary btn-edit-item\" href=\"#\"><i class=\"fa fa-edit\"></i></a>' + editCaption;\n            itemStr += '       <a title=\"Delete item\" class=\"btn btn-danger btn-remove-item\" href=\"#\"><i class=\"fa fa-trash\"></i></a>';\n            itemStr += '   </div>';\n            \n            if (this.editingItemId) {\n                form.find('#' + this.editingItemId).html(itemStr);\n                this.editingItemId = '';\n            } else {\n                form.find('.carouselItemsWrap').append(\n                    '<div class=\"carouselItem\" id=\"carouselItem-' + (new Date()).getTime() + '\">' + itemStr + '</div>'\n                );\n            }\n        },\n        \n        refreshCarousel: function (component, form) {\n            var self = this;\n            var carousel = component.find('.carousel');\n            carousel.find('.carousel-inner').html('');\n            carousel.find('.carousel-indicators').html('');\n            \n            form.find('.carouselItemsWrap').find('.carouselItem').each(function () {\n                var carouselItem = $(this);\n                var txtContent = carouselItem.find('.txt-carousel-content');\n                var txtCaption = carouselItem.find('.txt-carousel-caption');\n                var img = carouselItem.find('img');\n                \n                if (txtContent.length === 0) {\n                    self.addItemToCarousel(component, {\n                        src: img.attr('src'),\n                        hash: img.attr('data-hash'),\n                        caption: txtCaption.val()\n                    });\n                } else {\n                    self.addItemToCarousel(component, {\n                        content: txtContent.val()\n                    });\n                }\n            });\n        }\n    }\n    \n})(jQuery);"]}