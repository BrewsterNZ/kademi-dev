{"version":3,"sources":["keditor-component-photo-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","componentContent","children","img","find","css","options","onComponentReady","call","settingEnabled","settingTitle","initSettingForm","form","self","this","append","txtLink","on","link","value","trim","pattern","RegExp","span","next","formGroup","closest","test","getSettingComponent","attr","hide","removeClass","show","addClass","cbbTarget","chkLinkable","is","prop","wrap","unwrap","photoEdit","mselect","contentTypes","bs3Modal","pagePath","basePath","onSelectFile","url","relativeUrl","fileType","hash","showSettingForm","inputAlign","panel","inputVAlign","inputResponsive","checked","cbbStyle","val","inputWidth","inputHeight","newWidth","newHeight","Math","round","ratio","width","height","a","parent","length","algin","valign","hasClass","load","jQuery"],"mappings":"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","file":"keditor-component-photo-0.0.0.min.js","sourcesContent":["/**\r\n * KEditor Photo Component\r\n * @copyright: Kademi (http://kademi.co)\r\n * @author: Kademi (http://kademi.co)\r\n * @version: @{version}\r\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\r\n */\r\n(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n\r\n    KEditor.components['photo'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"photo\" component', component);\r\n\r\n            var componentContent = component.children('.keditor-component-content');\r\n            var img = componentContent.find('img');\r\n\r\n            img.css('display', 'inline-block');\r\n            img.css('vertical-align', 'middle');\r\n\r\n            var options = keditor.options;\r\n            if (typeof options.onComponentReady === 'function') {\r\n                options.onComponentReady.call(contentArea, component);\r\n            }\r\n        },\r\n\r\n        settingEnabled: true,\r\n\r\n        settingTitle: 'Photo Settings',\r\n\r\n        initSettingForm: function (form, keditor) {\r\n            flog('initSettingForm \"photo\" component');\r\n            \r\n            var self = this;\r\n            var options = keditor.options;\r\n\r\n            form.append(\r\n                '<form class=\"form-horizontal\">' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <button type=\"button\" class=\"btn btn-block btn-primary\" id=\"photo-edit\">Change Photo</button>' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-align\" class=\"col-sm-12\">Align</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <select id=\"photo-align\" class=\"form-control\">' +\r\n                '               <option value=\"left\">Left</option>' +\r\n                '               <option value=\"center\">Center</option>' +\r\n                '               <option value=\"right\">Right</option>' +\r\n                '           </select>' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"vertical-alignment\" class=\"col-sm-12\">V Align</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <select class=\"form-control\" id=\"v-align\">' +\r\n                '               <option value=\"top\">Top</option>' +\r\n                '               <option value=\"middle\">Middle</option>' +\r\n                '               <option value=\"bottom\">Bottom</option>' +\r\n                '           </select>' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-style\" class=\"col-sm-12\">Style</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <select id=\"photo-style\" class=\"form-control\">' +\r\n                '               <option value=\"\">None</option>' +\r\n                '               <option value=\"img-rounded\">Rounded</option>' +\r\n                '               <option value=\"img-circle\">Circle</option>' +\r\n                '               <option value=\"img-thumbnail\">Thumbnail</option>' +\r\n                '           </select>' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-responsive\" class=\"col-sm-12\">Responsive</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <input type=\"checkbox\" id=\"photo-responsive\" />' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-width\" class=\"col-sm-12\">Width</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <input type=\"number\" id=\"photo-width\" class=\"form-control\" />' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-height\" class=\"col-sm-12\">Height</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <input type=\"number\" id=\"photo-height\" class=\"form-control\" />' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-width\" class=\"col-sm-12\">Linkable</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <input type=\"checkbox\" id=\"photo-linkable\" />' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-height\" class=\"col-sm-12\">Link</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <input type=\"text\" id=\"photo-link\" class=\"form-control\" disabled=\"disabled\" />' +\r\n                '           <span class=\"help-block\" style=\"display: none;\">Link is invalid</span>' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-height\" class=\"col-sm-12\">Open link in</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <select class=\"form-control\" id=\"photo-target\" disabled=\"disabled\">' +\r\n                '               <option value=\"\" selected=\"selected\">Current tab/window</option>' +\r\n                '               <option value=\"_blank\">New tab/window</option>' +\r\n                '           </select>' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '</form>'\r\n            );\r\n\r\n            var txtLink = form.find('#photo-link');\r\n            txtLink.on('change', function () {\r\n                var link = this.value.trim();\r\n                var pattern = new RegExp('^[a-zA-Z0-9_/%:/./-]+$');\r\n                var span = txtLink.next();\r\n                var formGroup = txtLink.closest('.form-group');\r\n\r\n                if (pattern.test(link)) {\r\n                    keditor.getSettingComponent().find('a').attr('href', link);\r\n                    span.hide();\r\n                    formGroup.removeClass('has-error');\r\n                } else {\r\n                    span.show();\r\n                    formGroup.addClass('has-error');\r\n                }\r\n            });\r\n\r\n            var cbbTarget = form.find('#photo-target');\r\n            cbbTarget.on('change', function () {\r\n                keditor.getSettingComponent().find('a').attr('target', this.value);\r\n            });\r\n\r\n            var chkLinkable = form.find('#photo-linkable');\r\n            chkLinkable.on('click', function () {\r\n                var img = keditor.getSettingComponent().find('img');\r\n\r\n                if (chkLinkable.is(':checked')) {\r\n                    txtLink.prop('disabled', false);\r\n                    cbbTarget.prop('disabled', false);\r\n                    img.wrap('<a href=\"\"></a>');\r\n                } else {\r\n                    txtLink.prop('disabled', true);\r\n                    cbbTarget.prop('disabled', true);\r\n                    img.unwrap('a');\r\n                }\r\n            });\r\n            \r\n            var photoEdit = form.find('#photo-edit');\r\n            photoEdit.mselect({\r\n                contentTypes: ['image'],\r\n                bs3Modal: true,\r\n                pagePath: options.pagePath,\r\n                basePath: options.basePath,\r\n                onSelectFile: function (url, relativeUrl, fileType, hash) {\r\n                    var img = keditor.getSettingComponent().find('img');\r\n                    img.attr('src', \"/_hashes/files/\" + hash);\r\n                    self.showSettingForm(form, keditor.getSettingComponent(), options);\r\n                }\r\n            });\r\n\r\n            var inputAlign = form.find('#photo-align');\r\n            inputAlign.on('change', function () {\r\n                var panel = keditor.getSettingComponent().find('.photo-panel');\r\n                panel.css('text-align', this.value);\r\n            });\r\n\r\n            var inputVAlign = form.find('#v-align');\r\n            inputVAlign.on('change', function () {\r\n                var panel = keditor.getSettingComponent().find('.photo-panel').find('img');\r\n                panel.css('vertical-align', this.value);\r\n            });\r\n\r\n            var inputResponsive = form.find('#photo-responsive');\r\n            inputResponsive.on('click', function () {\r\n                keditor.getSettingComponent().find('img')[this.checked ? 'addClass' : 'removeClass']('img-responsive');\r\n            });\r\n\r\n            var cbbStyle = form.find('#photo-style');\r\n            cbbStyle.on('change', function () {\r\n                var img = keditor.getSettingComponent().find('img');\r\n                var val = this.value;\r\n\r\n                img.removeClass('img-rounded img-circle img-thumbnail');\r\n                if (val) {\r\n                    img.addClass(val);\r\n                }\r\n            });\r\n\r\n            var inputWidth = form.find('#photo-width');\r\n            var inputHeight = form.find('#photo-height');\r\n            inputWidth.on('change', function () {\r\n                var img = keditor.getSettingComponent().find('img');\r\n                var newWidth = +this.value;\r\n                var newHeight = Math.round(newWidth / self.ratio);\r\n\r\n                if (newWidth <= 0) {\r\n                    newWidth = self.width;\r\n                    newHeight = self.height;\r\n                    this.value = newWidth;\r\n                }\r\n\r\n                img.css({\r\n                    'width': newWidth,\r\n                    'height': newHeight\r\n                });\r\n                inputHeight.val(newHeight);\r\n            });\r\n            inputHeight.on('change', function () {\r\n                var img = keditor.getSettingComponent().find('img');\r\n                var newHeight = +this.value;\r\n                var newWidth = Math.round(newHeight * self.ratio);\r\n\r\n                if (newHeight <= 0) {\r\n                    newWidth = self.width;\r\n                    newHeight = self.height;\r\n                    this.value = newHeight;\r\n                }\r\n\r\n                img.css({\r\n                    'height': newHeight,\r\n                    'width': newWidth\r\n                });\r\n                inputWidth.val(newWidth);\r\n            });\r\n        },\r\n\r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"photo\" component', component);\r\n\r\n            var self = this;\r\n            var inputAlign = form.find('#photo-align');\r\n            var inputVAlign = form.find('#v-align');\r\n            var inputResponsive = form.find('#photo-responsive');\r\n            var inputWidth = form.find('#photo-width');\r\n            var inputHeight = form.find('#photo-height');\r\n            var cbbStyle = form.find('#photo-style');\r\n            var txtLink = form.find('#photo-link');\r\n            var cbbTarget = form.find('#photo-target');\r\n            var chkLinkable = form.find('#photo-linkable');\r\n\r\n            txtLink.next().hide();\r\n            txtLink.closest('.form-group').removeClass('has-error');\r\n\r\n            var panel = component.find('.photo-panel');\r\n            var img = panel.find('img');\r\n\r\n            var a = img.parent('a');\r\n            if (a.length > 0) {\r\n                chkLinkable.prop('checked', true);\r\n                txtLink.prop('disabled', false).val(a.attr('href'));\r\n                cbbTarget.prop('disabled', false).val(a.attr('target'));\r\n            } else {\r\n                chkLinkable.prop('checked', false);\r\n                txtLink.prop('disabled', true).val('');\r\n                cbbTarget.prop('disabled', true).val('');\r\n            }\r\n\r\n            var algin = panel.css('text-align');\r\n            if (algin !== 'right' || algin !== 'center') {\r\n                algin = 'left';\r\n            }\r\n\r\n            var valign = img.css('vertical-align');\r\n\r\n            if (img.hasClass('img-rounded')) {\r\n                cbbStyle.val('img-rounded');\r\n            } else if (img.hasClass('img-circle')) {\r\n                cbbStyle.val('img-circle');\r\n            } else if (img.hasClass('img-thumbnail')) {\r\n                cbbStyle.val('img-thumbnail');\r\n            } else {\r\n                cbbStyle.val('');\r\n            }\r\n            debugger;\r\n            inputAlign.val(algin);\r\n            inputVAlign.val(valign);\r\n            inputResponsive.prop('checked', img.hasClass('img-responsive'));\r\n            inputWidth.val(img.width());\r\n            inputHeight.val(img.height());\r\n\r\n            $('<img />').attr('src', img.attr('src')).load(function () {\r\n                self.ratio = this.width / this.height;\r\n                self.width = this.width;\r\n                self.height = this.height;\r\n            });\r\n        }\r\n    };\r\n\r\n})(jQuery);\r\n"]}