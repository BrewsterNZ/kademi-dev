{"version":3,"sources":["keditor-component-photo-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","componentContent","children","img","find","css","options","onComponentReady","call","settingEnabled","settingTitle","initSettingForm","form","self","this","ajax","url","type","dataType","success","resp","html","txtLink","on","link","value","trim","pattern","RegExp","span","next","formGroup","closest","test","getSettingComponent","attr","hide","removeClass","show","addClass","cbbTarget","chkLinkable","is","prop","wrap","unwrap","photoEdit","mselect","contentTypes","bs3Modal","pagePath","basePath","onSelectFile","relativeUrl","fileType","hash","showSettingForm","inputAlign","panel","inputVAlign","inputResponsive","checked","cbbStyle","val","inputWidth","inputHeight","newWidth","newHeight","Math","round","ratio","width","height","a","parent","length","algin","valign","hasClass","load","jQuery"],"mappings":"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","file":"keditor-component-photo-0.0.0.min.js","sourcesContent":["/**\n * KEditor Photo Component\n * @copyright: Kademi (http://kademi.co)\n * @author: Kademi (http://kademi.co)\n * @version: @{version}\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\n */\n(function ($) {\n    var KEditor = $.keditor;\n    var flog = KEditor.log;\n    \n    KEditor.components['photo'] = {\n        init: function (contentArea, container, component, keditor) {\n            flog('init \"photo\" component', component);\n            \n            var componentContent = component.children('.keditor-component-content');\n            var img = componentContent.find('img');\n            \n            img.css('display', 'inline-block');\n            if (!img.css('vertical-align')) {\n                img.css('vertical-align', 'middle');\n            }\n            \n            var options = keditor.options;\n            if (typeof options.onComponentReady === 'function') {\n                options.onComponentReady.call(contentArea, component);\n            }\n        },\n        \n        settingEnabled: true,\n        \n        settingTitle: 'Photo Settings',\n        \n        initSettingForm: function (form, keditor) {\n            flog('init \"photo\" settings', form, keditor);\n            \n            var self = this;\n            var options = keditor.options;\n            \n            return $.ajax({\n                url: '/static/keditor/componentPhotoSettings.html',\n                type: 'get',\n                dataType: 'HTML',\n                success: function (resp) {\n                    form.html(resp);\n                    \n                    var txtLink = form.find('#photo-link');\n                    txtLink.on('change', function () {\n                        var link = this.value.trim();\n                        var pattern = new RegExp('^[a-zA-Z0-9_/%:/./-]+$');\n                        var span = txtLink.next();\n                        var formGroup = txtLink.closest('.form-group');\n                        \n                        if (pattern.test(link)) {\n                            keditor.getSettingComponent().find('a').attr('href', link);\n                            span.hide();\n                            formGroup.removeClass('has-error');\n                        } else {\n                            span.show();\n                            formGroup.addClass('has-error');\n                        }\n                    });\n                    \n                    var cbbTarget = form.find('#photo-target');\n                    cbbTarget.on('change', function () {\n                        keditor.getSettingComponent().find('a').attr('target', this.value);\n                    });\n                    \n                    var chkLinkable = form.find('#photo-linkable');\n                    chkLinkable.on('click', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        \n                        if (chkLinkable.is(':checked')) {\n                            txtLink.prop('disabled', false);\n                            cbbTarget.prop('disabled', false);\n                            img.wrap('<a href=\"\"></a>');\n                        } else {\n                            txtLink.prop('disabled', true);\n                            cbbTarget.prop('disabled', true);\n                            img.unwrap('a');\n                        }\n                    });\n                    \n                    var photoEdit = form.find('#photo-edit');\n                    photoEdit.mselect({\n                        contentTypes: ['image'],\n                        bs3Modal: true,\n                        pagePath: options.pagePath,\n                        basePath: options.basePath,\n                        onSelectFile: function (url, relativeUrl, fileType, hash) {\n                            var img = keditor.getSettingComponent().find('img');\n                            img.attr('src', \"/_hashes/files/\" + hash);\n                            self.showSettingForm(form, keditor.getSettingComponent(), options);\n                        }\n                    });\n                    \n                    var inputAlign = form.find('#photo-align');\n                    inputAlign.on('change', function () {\n                        var panel = keditor.getSettingComponent().find('.photo-panel');\n                        panel.css('text-align', this.value);\n                    });\n                    \n                    var inputVAlign = form.find('#v-align');\n                    inputVAlign.on('change', function () {\n                        var panel = keditor.getSettingComponent().find('.photo-panel').find('img');\n                        panel.css('vertical-align', this.value);\n                    });\n                    \n                    var inputResponsive = form.find('#photo-responsive');\n                    inputResponsive.on('click', function () {\n                        keditor.getSettingComponent().find('img')[this.checked ? 'addClass' : 'removeClass']('img-responsive');\n                    });\n                    \n                    var cbbStyle = form.find('#photo-style');\n                    cbbStyle.on('change', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        var val = this.value;\n                        \n                        img.removeClass('img-rounded img-circle img-thumbnail');\n                        if (val) {\n                            img.addClass(val);\n                        }\n                    });\n                    \n                    var inputWidth = form.find('#photo-width');\n                    var inputHeight = form.find('#photo-height');\n                    inputWidth.on('change', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        var newWidth = +this.value;\n                        var newHeight = Math.round(newWidth / self.ratio);\n                        \n                        if (newWidth <= 0) {\n                            newWidth = self.width;\n                            newHeight = self.height;\n                            this.value = newWidth;\n                        }\n                        \n                        img.css({\n                            'width': newWidth,\n                            'height': newHeight\n                        });\n                        inputHeight.val(newHeight);\n                    });\n                    inputHeight.on('change', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        var newHeight = +this.value;\n                        var newWidth = Math.round(newHeight * self.ratio);\n                        \n                        if (newHeight <= 0) {\n                            newWidth = self.width;\n                            newHeight = self.height;\n                            this.value = newHeight;\n                        }\n                        \n                        img.css({\n                            'height': newHeight,\n                            'width': newWidth\n                        });\n                        inputWidth.val(newWidth);\n                    });\n                }\n            });\n        },\n        \n        showSettingForm: function (form, component, keditor) {\n            flog('showSettingForm \"photo\" component', component);\n            \n            var self = this;\n            var inputAlign = form.find('#photo-align');\n            var inputVAlign = form.find('#v-align');\n            var inputResponsive = form.find('#photo-responsive');\n            var inputWidth = form.find('#photo-width');\n            var inputHeight = form.find('#photo-height');\n            var cbbStyle = form.find('#photo-style');\n            var txtLink = form.find('#photo-link');\n            var cbbTarget = form.find('#photo-target');\n            var chkLinkable = form.find('#photo-linkable');\n            \n            txtLink.next().hide();\n            txtLink.closest('.form-group').removeClass('has-error');\n            \n            var panel = component.find('.photo-panel');\n            var img = panel.find('img');\n            \n            var a = img.parent('a');\n            if (a.length > 0) {\n                chkLinkable.prop('checked', true);\n                txtLink.prop('disabled', false).val(a.attr('href'));\n                cbbTarget.prop('disabled', false).val(a.attr('target'));\n            } else {\n                chkLinkable.prop('checked', false);\n                txtLink.prop('disabled', true).val('');\n                cbbTarget.prop('disabled', true).val('');\n            }\n            \n            var algin = panel.css('text-align');\n            if (algin !== 'right' || algin !== 'center') {\n                algin = 'left';\n            }\n            \n            var valign = img.css('vertical-align');\n            \n            if (img.hasClass('img-rounded')) {\n                cbbStyle.val('img-rounded');\n            } else if (img.hasClass('img-circle')) {\n                cbbStyle.val('img-circle');\n            } else if (img.hasClass('img-thumbnail')) {\n                cbbStyle.val('img-thumbnail');\n            } else {\n                cbbStyle.val('');\n            }\n            inputAlign.val(algin);\n            inputVAlign.val(valign);\n            inputResponsive.prop('checked', img.hasClass('img-responsive'));\n            inputWidth.val(img.width());\n            inputHeight.val(img.height());\n            \n            $('<img />').attr('src', img.attr('src')).load(function () {\n                self.ratio = this.width / this.height;\n                self.width = this.width;\n                self.height = this.height;\n            });\n        }\n    };\n    \n})(jQuery);\n"],"sourceRoot":"/source/"}