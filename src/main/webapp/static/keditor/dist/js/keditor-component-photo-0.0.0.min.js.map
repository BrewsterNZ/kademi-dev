{"version":3,"sources":["keditor-component-photo-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","componentContent","children","img","find","css","options","onComponentReady","call","settingEnabled","settingTitle","initSettingForm","form","self","this","ajax","url","type","dataType","success","resp","html","txtLink","on","link","value","trim","pattern","span","next","formGroup","closest","test","getSettingComponent","attr","hide","removeClass","show","addClass","cbbTarget","chkLinkable","is","prop","wrap","unwrap","inputAlign","panel","inputVAlign","inputResponsive","checked","cbbStyle","val","inputWidth","inputHeight","newWidth","newHeight","Math","round","ratio","width","height","photoEdit","mselect","contentTypes","bs3Modal","pagePath","basePath","onSelectFile","relativeUrl","fileType","hash","src","load","showSettingForm","a","parent","length","algin","valign","hasClass","jQuery"],"mappings":"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","file":"keditor-component-photo-0.0.0.min.js","sourcesContent":["/**\r\n * KEditor Photo Component\r\n * @copyright: Kademi (http://kademi.co)\r\n * @author: Kademi (http://kademi.co)\r\n * @version: @{version}\r\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\r\n */\r\n(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['photo'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"photo\" component', component);\r\n            \r\n            var componentContent = component.children('.keditor-component-content');\r\n            var img = componentContent.find('img');\r\n            \r\n            img.css('display', 'inline-block');\r\n            if (!img.css('vertical-align')) {\r\n                img.css('vertical-align', 'middle');\r\n            }\r\n            \r\n            var options = keditor.options;\r\n            if (typeof options.onComponentReady === 'function') {\r\n                options.onComponentReady.call(contentArea, component);\r\n            }\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Photo Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"photo\" settings', form, keditor);\r\n            \r\n            var self = this;\r\n            var options = keditor.options;\r\n            \r\n            return $.ajax({\r\n                url: '/static/keditor/componentPhotoSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                    \r\n                    var txtLink = form.find('#photo-link');\r\n                    txtLink.on('change', function () {\r\n                        var link = this.value.trim();\r\n                        var pattern =  /(https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]\\.[^\\s]{2,})/;\r\n                        var span = txtLink.next();\r\n                        var formGroup = txtLink.closest('.form-group');\r\n                        \r\n                        if (pattern.test(link)) {\r\n                            keditor.getSettingComponent().find('a').attr('href', link);\r\n                            span.hide();\r\n                            formGroup.removeClass('has-error');\r\n                        } else {\r\n                            span.show();\r\n                            formGroup.addClass('has-error');\r\n                        }\r\n                    });\r\n                    \r\n                    var cbbTarget = form.find('#photo-target');\r\n                    cbbTarget.on('change', function () {\r\n                        keditor.getSettingComponent().find('a').attr('target', this.value);\r\n                    });\r\n                    \r\n                    var chkLinkable = form.find('#photo-linkable');\r\n                    chkLinkable.on('click', function () {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        \r\n                        if (chkLinkable.is(':checked')) {\r\n                            txtLink.prop('disabled', false);\r\n                            cbbTarget.prop('disabled', false);\r\n                            img.wrap('<a href=\"\"></a>');\r\n                        } else {\r\n                            txtLink.prop('disabled', true);\r\n                            cbbTarget.prop('disabled', true);\r\n                            img.unwrap('a');\r\n                        }\r\n                    });\r\n                    \r\n                    var inputAlign = form.find('#photo-align');\r\n                    inputAlign.on('change', function () {\r\n                        var panel = keditor.getSettingComponent().find('.photo-panel');\r\n                        panel.css('text-align', this.value);\r\n                    });\r\n                    \r\n                    var inputVAlign = form.find('#v-align');\r\n                    inputVAlign.on('change', function () {\r\n                        var panel = keditor.getSettingComponent().find('.photo-panel').find('img');\r\n                        panel.css('vertical-align', this.value);\r\n                    });\r\n                    \r\n                    var inputResponsive = form.find('#photo-responsive');\r\n                    inputResponsive.on('click', function () {\r\n                        keditor.getSettingComponent().find('img')[this.checked ? 'addClass' : 'removeClass']('img-responsive');\r\n                    });\r\n                    \r\n                    var cbbStyle = form.find('#photo-style');\r\n                    cbbStyle.on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        var val = this.value;\r\n                        \r\n                        img.removeClass('img-rounded img-circle img-thumbnail');\r\n                        if (val) {\r\n                            img.addClass(val);\r\n                        }\r\n                    });\r\n                    \r\n                    var inputWidth = form.find('#photo-width');\r\n                    var inputHeight = form.find('#photo-height');\r\n                    inputWidth.on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        var newWidth = +this.value;\r\n                        var newHeight = Math.round(newWidth / self.ratio);\r\n                        \r\n                        if (newWidth <= 0) {\r\n                            newWidth = self.width;\r\n                            newHeight = self.height;\r\n                            this.value = newWidth;\r\n                        }\r\n                        \r\n                        img.css({\r\n                            'width': newWidth,\r\n                            'height': newHeight\r\n                        });\r\n                        inputHeight.val(newHeight);\r\n                    });\r\n                    inputHeight.on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        var newHeight = +this.value;\r\n                        var newWidth = Math.round(newHeight * self.ratio);\r\n                        \r\n                        if (newHeight <= 0) {\r\n                            newWidth = self.width;\r\n                            newHeight = self.height;\r\n                            this.value = newHeight;\r\n                        }\r\n                        \r\n                        img.css({\r\n                            'height': newHeight,\r\n                            'width': newWidth\r\n                        });\r\n                        inputWidth.val(newWidth);\r\n                    });\r\n                    \r\n                    var photoEdit = form.find('#photo-edit');\r\n                    photoEdit.mselect({\r\n                        contentTypes: ['image'],\r\n                        bs3Modal: true,\r\n                        pagePath: keditor.options.pagePath,\r\n                        basePath: keditor.options.basePath,\r\n                        onSelectFile: function (url, relativeUrl, fileType, hash) {\r\n                            var img = keditor.getSettingComponent().find('img');\r\n                            var src = '/_hashes/files/' + hash;\r\n                            \r\n                            $('<img />').attr('src', src).load(function () {\r\n                                img.attr('src', src).css({\r\n                                    width: this.width,\r\n                                    height: this.height\r\n                                })\r\n                                self.ratio = this.width / this.height;\r\n                                self.width = this.width;\r\n                                self.height = this.height;\r\n                                inputWidth.val(this.width);\r\n                                inputHeight.val(this.height);\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"photo\" component', component);\r\n            \r\n            var self = this;\r\n            var inputAlign = form.find('#photo-align');\r\n            var inputVAlign = form.find('#v-align');\r\n            var inputResponsive = form.find('#photo-responsive');\r\n            var inputWidth = form.find('#photo-width');\r\n            var inputHeight = form.find('#photo-height');\r\n            var cbbStyle = form.find('#photo-style');\r\n            var txtLink = form.find('#photo-link');\r\n            var cbbTarget = form.find('#photo-target');\r\n            var chkLinkable = form.find('#photo-linkable');\r\n            \r\n            txtLink.next().hide();\r\n            txtLink.closest('.form-group').removeClass('has-error');\r\n            \r\n            var panel = component.find('.photo-panel');\r\n            var img = panel.find('img');\r\n            \r\n            var a = img.parent('a');\r\n            if (a.length > 0) {\r\n                chkLinkable.prop('checked', true);\r\n                txtLink.prop('disabled', false).val(a.attr('href'));\r\n                cbbTarget.prop('disabled', false).val(a.attr('target'));\r\n            } else {\r\n                chkLinkable.prop('checked', false);\r\n                txtLink.prop('disabled', true).val('');\r\n                cbbTarget.prop('disabled', true).val('');\r\n            }\r\n            \r\n            var algin = panel.css('text-align');\r\n            if (algin !== 'right' || algin !== 'center') {\r\n                algin = 'left';\r\n            }\r\n            \r\n            var valign = img.css('vertical-align');\r\n            \r\n            if (img.hasClass('img-rounded')) {\r\n                cbbStyle.val('img-rounded');\r\n            } else if (img.hasClass('img-circle')) {\r\n                cbbStyle.val('img-circle');\r\n            } else if (img.hasClass('img-thumbnail')) {\r\n                cbbStyle.val('img-thumbnail');\r\n            } else {\r\n                cbbStyle.val('');\r\n            }\r\n            inputAlign.val(algin);\r\n            inputVAlign.val(valign);\r\n            inputResponsive.prop('checked', img.hasClass('img-responsive'));\r\n            inputWidth.val(img.width());\r\n            inputHeight.val(img.height());\r\n            \r\n            $('<img />').attr('src', img.attr('src')).load(function () {\r\n                self.ratio = this.width / this.height;\r\n                self.width = this.width;\r\n                self.height = this.height;\r\n            });\r\n        }\r\n    };\r\n    \r\n})(jQuery);\r\n"]}