/**!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 0.0.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap (optional), FontAwesome (optional)
 */
!function(e){var a=e.keditor,o=a.log;a.components.googlemap={init:function(a,o,t,n){var i=t.find("script");i.length&&i.remove(),t.removeAttr("data-firstLoad");var s=t.attr("data-place"),l=t.attr("data-maptype");s&&"manually"===l&&e(window).on("load",function(){t.find(".btn-component-setting").trigger("click")})},getContent:function(e,a){o('getContent "googlemap" component',e);var t=e.children(".keditor-component-content");t.find(".googlemap-cover").remove();e.attr("data-place"),e.attr("data-maptype");e.find(".kgooglemap").html("");var n='<script>$(function(){if(!$(document.body).hasClass("content-editor-page")){var apiKey="AIzaSyBUcuZxwpBXCPztG7ot-rITXJbycPuS7gs";var s=document.createElement("script");s.type="text/javascript";s.async=true;s.defer=true;s.src="https://maps.googleapis.com/maps/api/js?key="+apiKey+"&callback=kgooglemapInit&libraries=places";$("head").append(s);window.kgooglemapInit=function(){var mapdiv=$(".kgooglemap").not(".hide");mapdiv.each(function(){var parent=$(this).parents("[data-type=component-googlemap]");if(parent.attr("data-maptype")!=="manually")return;var map=new google.maps.Map(this,{zoom:13,mapTypeId:"roadmap"});var place=parent.attr("data-place");var input=parent.find("input")[0];input.value=place;var searchBox=new google.maps.places.SearchBox(input);map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);setTimeout(function(){google.maps.event.trigger(input,"focus");google.maps.event.trigger(input,"keydown",{keyCode:13});},500);map.addListener("bounds_changed",function(){searchBox.setBounds(map.getBounds());});var markers=[];searchBox.addListener("places_changed",function(){var places=searchBox.getPlaces();if(places.length==0){return;}markers.forEach(function(marker){marker.setMap(null);});markers=[];var bounds=new google.maps.LatLngBounds();places.forEach(function(place){if(!place.geometry){console.log("Returned place contains no geometry");return;}var icon={url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};markers.push(new google.maps.Marker({map:map,icon:icon,title:place.name,position:place.geometry.location}));if(place.geometry.viewport){bounds.union(place.geometry.viewport);}else{bounds.extend(place.geometry.location);}});map.fitBounds(bounds);});})}}});</script>';return e.find(".embed-responsive").append(n),t.html()},settingEnabled:!0,settingTitle:"Google Map Settings",initSettingForm:function(a,t){o('initSettingForm "googlemap" component');var n="AIzaSyBUcuZxwpBXCPztG7ot-rITXJbycPuS7gs",i='<script src="https://maps.googleapis.com/maps/api/js?key='+n+'&callback=initKeditorMapSetting&libraries=places" async defer></script>';window.google&&window.google.maps&&google.maps.places&&(i=""),a.append(i+'<form class="form-horizontal" onsubmit="return false;">   <div class="form-group">       <label class="col-sm-12">Map type</label>       <div class="radio-inline">           <label class="radio-inline"><input checked type="radio" name="mapType" class="mapType" value="embed"> Embed</label>           <label class="radio-inline"><input type="radio" name="mapType" class="mapType" value="manually"> Manually</label>       </div>   </div>   <div class="form-group embed">       <div class="col-sm-12">           <textarea class="form-control" name="mapEmbedCode" placeholder="Embed code"></textarea>       </div>   </div>   <div class="form-group manually hide">       <div class="col-sm-12">           <input class="form-control" name="mapAddress" placeholder="Enter address" />       </div>   </div>   <div class="form-group">       <label class="col-sm-12">Aspect Ratio</label>       <div class="col-sm-12">           <button type="button" class="btn btn-sm btn-default btn-googlemap-169">16:9</button>           <button type="button" class="btn btn-sm btn-default btn-googlemap-43">4:3</button>       </div>   </div></form>'),a.find(".mapType").on("click",function(o){if(this.checked){e("."+this.value).removeClass("hide");var n=a.find(".mapType").not(this).val();e("."+n).addClass("hide");var i=t.getSettingComponent();if(i.attr("data-maptype",this.value),"manually"===this.value)if(i.find("iframe").addClass("hide"),i.find(".kgooglemap").removeClass("hide"),i.find(".kgooglemap").data("map"))google.maps.event.trigger(i.find(".kgooglemap").data("map"),"resize");else{s.initAutocomplete(i,a);var l=a.find("[name=mapAddress]")[0],r=setInterval(function(){i.find(".kgooglemap").data("map")&&(clearInterval(r),google.maps.event.trigger(l,"focus"),google.maps.event.trigger(l,"keydown",{keyCode:13}))},100)}else i.find("iframe").removeClass("hide"),i.find(".kgooglemap").addClass("hide")}});var s=this;a.find("[name=mapEmbedCode]").on("change",function(){var a=e(this.value),o=a.attr("src");a.length>0&&o&&o.length>0?t.getSettingComponent().find(".embed-responsive-item").attr("src",o):alert("Your Google Map embed code is invalid!")});var l=a.find(".btn-googlemap-169"),r=a.find(".btn-googlemap-43");l.on("click",function(a){a.preventDefault(),e(this).addClass("btn-primary").removeClass("btn-default"),r.removeClass("btn-primary").addClass("btn-default"),t.getSettingComponent().find(".embed-responsive").removeClass("embed-responsive-4by3").addClass("embed-responsive-16by9");var o=t.getSettingComponent();"manually"===o.attr("maptype")&&o.find(".kgooglemap").data("map")&&google.maps.event.trigger(o.find(".kgooglemap").data("map"),"resize")}),r.on("click",function(a){a.preventDefault(),e(this).addClass("btn-primary").removeClass("btn-default"),l.removeClass("btn-primary").addClass("btn-default"),t.getSettingComponent().find(".embed-responsive").removeClass("embed-responsive-16by9").addClass("embed-responsive-4by3");var o=t.getSettingComponent();"manually"===o.attr("maptype")&&o.find(".kgooglemap").data("map")&&google.maps.event.trigger(o.find(".kgooglemap").data("map"),"resize")})},showSettingForm:function(e,a,o){var t=this,n=a.attr("data-maptype"),i=a.attr("data-place"),s=a.find(".embed-responsive").hasClass("embed-responsive-16by9"),l=a.find(".embed-responsive").hasClass("embed-responsive-4by3");l&&e.find(".btn-googlemap-43").addClass("btn-primary").removeClass("btn-default"),s&&e.find(".btn-googlemap-169").addClass("btn-primary").removeClass("btn-default"),e.find(".mapType[value="+n+"]").prop("checked",!0);var r=a.find("iframe").attr("src"),p='<iframe class="embed-responsive-item" src="'+r+'"></iframe>';i||(i="Hanoi, Vietnam"),e.find("[name=mapAddress]").val(i),e.find("[name=mapEmbedCode]").val(p);var d=a.attr("data-firstLoad");if("manually"===n){if(e.find(".manually").removeClass("hide").siblings(".embed").addClass("hide"),!d&&i)var m=setInterval(function(){window.googleMapInitialized&&(clearInterval(m),t.initAutocomplete(a,e),setTimeout(function(){var o=e.find("[name=mapAddress]")[0];google.maps.event.trigger(o,"focus"),google.maps.event.trigger(o,"keydown",{keyCode:13}),a.attr("data-firstLoad","false")},1e3))},100)}else e.find(".manually").addClass("hide").siblings(".embed").removeClass("hide")},initAutocomplete:function(e,a){if(!window.googleMapInitialized)return void alert("google map is not initialized");var o=e.find(".kgooglemap")[0],t=new google.maps.Map(o,{zoom:13,mapTypeId:"roadmap"}),n=a.find("[name=mapAddress]")[0],i=new google.maps.places.SearchBox(n);t.addListener("bounds_changed",function(){i.setBounds(t.getBounds())});var s=[];i.addListener("places_changed",function(){var a=i.getPlaces();if(0!=a.length){s.forEach(function(e){e.setMap(null)}),s=[];var o=new google.maps.LatLngBounds;a.forEach(function(e){if(!e.geometry)return void console.log("Returned place contains no geometry");var a={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};s.push(new google.maps.Marker({map:t,icon:a,title:e.name,position:e.geometry.location})),e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location)}),t.fitBounds(o),e.attr("data-place",n.value)}}),e.find(".kgooglemap").data("map",t)}},window.initKeditorMapSetting=function(){window.googleMapInitialized=!0}}(jQuery);
//# sourceMappingURL=keditor-component-googlemap-0.0.0.min.js.map
