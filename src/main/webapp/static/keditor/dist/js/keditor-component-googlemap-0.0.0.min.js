/**!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 0.0.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap (optional), FontAwesome (optional)
 */
!function(e){var t=e.keditor,a=t.log;t.components.googlemap={init:function(t,a,o,n){var i=o.find("script");i.length&&i.remove(),o.removeAttr("data-firstLoad");var r=o.attr("data-place"),s=o.attr("data-maptype");r&&"manually"===s&&e(window).on("load",function(){o.find(".btn-component-setting").trigger("click")})},getContent:function(e,t){a('getContent "googlemap" component',e);var o=e.children(".keditor-component-content");return o.find(".googlemap-cover").remove(),e.find(".kgooglemap").html(""),o.html()},settingEnabled:!0,settingTitle:"Google Map Settings",initSettingForm:function(t,o){a('init "googlemap" settings',t);var n=this;return e.ajax({url:"/static/keditor/componentGoogleMapSettings.html",type:"get",dataType:"HTML",success:function(a){var i="AIzaSyBUcuZxwpBXCPztG7ot-rITXJbycPuS7gs",r='<script src="https://maps.googleapis.com/maps/api/js?key='+i+'&callback=initKeditorMapSetting&libraries=places" async defer></script>';window.google&&window.google.maps&&google.maps.places&&(r=""),t.append(r+a);var s=t.find(".map-type");t.find(".mapType").on("click",function(){s.hide().filter("."+this.value).show();var e=o.getSettingComponent(),a=e.find("iframe"),i=e.find(".kgooglemap");if(e.attr("data-maptype",this.value),a["manually"===this.value?"hide":"show"](),i["manually"===this.value?"show":"hide"](),"manually"===this.value){var r=i.data("map");if(r)google.maps.event.trigger(r,"resize");else{n.initAutocomplete(e,t);var l=t.find("[name=mapAddress]")[0],g=setInterval(function(){r&&(clearInterval(g),google.maps.event.trigger(l,"focus"),google.maps.event.trigger(l,"keydown",{keyCode:13}))},100)}}}),t.find("[name=mapEmbedCode]").on("change",function(){var t=e(this.value),a=t.attr("src");t.length>0&&a&&a.length>0?o.getSettingComponent().find(".embed-responsive-item").attr("src",a):alert("Your Google Map embed code is invalid!")}),t.find("[name=mapRatio]").on("click",function(){var e=o.getSettingComponent();if(e.find(".embed-responsive").removeClass("embed-responsive-4by3 embed-responsive-16by9").addClass("embed-responsive-"+this.value),"manually"===e.attr("data-maptype")){var t=e.find(".kgooglemap").data("map");t&&google.maps.event.trigger(t,"resize")}})}})},showSettingForm:function(e,t,a){var o=this,n=t.attr("data-maptype")||"embed",i=t.attr("data-place"),r=t.find(".embed-responsive").hasClass("embed-responsive-16by9")?"16by9":"4by3";e.find(".mapRatio[value="+r+"]").prop("checked",!0),e.find(".mapType[value="+n+"]").prop("checked",!0);var s=t.find("iframe").attr("src"),l='<iframe class="embed-responsive-item" src="'+s+'"></iframe>';i||(i="Hanoi, Vietnam"),e.find("[name=mapAddress]").val(i),e.find("[name=mapEmbedCode]").val(l),e.find(".map-type").hide().filter("."+n).show();var g=t.attr("data-firstLoad");if("manually"===n&&!g&&i)var d=setInterval(function(){window.googleMapInitialized&&(clearInterval(d),o.initAutocomplete(t,e),setTimeout(function(){var a=e.find("[name=mapAddress]")[0];google.maps.event.trigger(a,"focus"),google.maps.event.trigger(a,"keydown",{keyCode:13}),t.attr("data-firstLoad","false")},1e3))},100)},initAutocomplete:function(e,t){if(!window.googleMapInitialized)return void alert("google map is not initialized");var a=e.find(".kgooglemap")[0],o=new google.maps.Map(a,{zoom:13,mapTypeId:"roadmap"}),n=t.find("[name=mapAddress]")[0],i=new google.maps.places.SearchBox(n);o.addListener("bounds_changed",function(){i.setBounds(o.getBounds())});var r=[];i.addListener("places_changed",function(){var t=i.getPlaces();if(0!=t.length){r.forEach(function(e){e.setMap(null)}),r=[];var a=new google.maps.LatLngBounds;t.forEach(function(e){if(!e.geometry)return void console.log("Returned place contains no geometry");var t={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};r.push(new google.maps.Marker({map:o,icon:t,title:e.name,position:e.geometry.location})),e.geometry.viewport?a.union(e.geometry.viewport):a.extend(e.geometry.location)}),o.fitBounds(a),e.attr("data-place",n.value)}}),e.find(".kgooglemap").data("map",o)}},window.initKeditorMapSetting=function(){window.googleMapInitialized=!0}}(jQuery);
//# sourceMappingURL=keditor-component-googlemap-0.0.0.min.js.map
