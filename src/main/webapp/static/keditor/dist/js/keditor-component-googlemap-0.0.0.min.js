/**!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 0.0.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap (optional), FontAwesome (optional)
 */
!function(e){var a=e.keditor,t=a.log;a.components.googlemap={init:function(a,t,o,n){var i=o.find("script");i.length&&i.remove(),o.removeAttr("data-firstLoad");var s=o.attr("data-place"),r=o.attr("data-maptype");s&&"manually"===r&&e(window).on("load",function(){o.find(".btn-component-setting").trigger("click")})},getContent:function(e,a){t('getContent "googlemap" component',e);var o=e.children(".keditor-component-content");o.find(".googlemap-cover").remove();e.attr("data-place"),e.attr("data-maptype");e.find(".kgooglemap").html("");var n='<script>$(function(){if(!$(document.body).hasClass("content-editor-page")){var apiKey="AIzaSyBUcuZxwpBXCPztG7ot-rITXJbycPuS7gs";var s=document.createElement("script");s.type="text/javascript";s.async=true;s.defer=true;s.src="https://maps.googleapis.com/maps/api/js?key="+apiKey+"&callback=kgooglemapInit&libraries=places";$("head").append(s);window.kgooglemapInit=function(){var mapdiv=$(".kgooglemap").not(".hide");mapdiv.each(function(){var parent=$(this).parents("[data-type=component-googlemap]");if(parent.attr("data-maptype")!=="manually")return;var map=new google.maps.Map(this,{zoom:13,mapTypeId:"roadmap"});var place=parent.attr("data-place");var input=parent.find("input")[0];input.value=place;var searchBox=new google.maps.places.SearchBox(input);map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);setTimeout(function(){google.maps.event.trigger(input,"focus");google.maps.event.trigger(input,"keydown",{keyCode:13});},500);map.addListener("bounds_changed",function(){searchBox.setBounds(map.getBounds());});var markers=[];searchBox.addListener("places_changed",function(){var places=searchBox.getPlaces();if(places.length==0){return;}markers.forEach(function(marker){marker.setMap(null);});markers=[];var bounds=new google.maps.LatLngBounds();places.forEach(function(place){if(!place.geometry){console.log("Returned place contains no geometry");return;}var icon={url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};markers.push(new google.maps.Marker({map:map,icon:icon,title:place.name,position:place.geometry.location}));if(place.geometry.viewport){bounds.union(place.geometry.viewport);}else{bounds.extend(place.geometry.location);}});map.fitBounds(bounds);});})}}});</script>';return e.find(".embed-responsive").append(n),o.html()},settingEnabled:!0,settingTitle:"Google Map Settings",initSettingForm:function(a,o){t('init "googlemap" settings',a);var n=this;return e.ajax({url:"/static/keditor/componentGoogleMapSettings.html",type:"get",dataType:"HTML",success:function(t){var i="AIzaSyBUcuZxwpBXCPztG7ot-rITXJbycPuS7gs",s='<script src="https://maps.googleapis.com/maps/api/js?key='+i+'&callback=initKeditorMapSetting&libraries=places" async defer></script>';window.google&&window.google.maps&&google.maps.places&&(s=""),a.append(s+t),a.find(".mapType").on("click",function(t){if(this.checked){e("."+this.value).removeClass("hide");var i=a.find(".mapType").not(this).val();e("."+i).addClass("hide");var s=o.getSettingComponent();if(s.attr("data-maptype",this.value),"manually"===this.value)if(s.find("iframe").addClass("hide"),s.find(".kgooglemap").removeClass("hide"),s.find(".kgooglemap").data("map"))google.maps.event.trigger(s.find(".kgooglemap").data("map"),"resize");else{n.initAutocomplete(s,a);var r=a.find("[name=mapAddress]")[0],p=setInterval(function(){s.find(".kgooglemap").data("map")&&(clearInterval(p),google.maps.event.trigger(r,"focus"),google.maps.event.trigger(r,"keydown",{keyCode:13}))},100)}else s.find("iframe").removeClass("hide"),s.find(".kgooglemap").addClass("hide")}}),a.find("[name=mapEmbedCode]").on("change",function(){var a=e(this.value),t=a.attr("src");a.length>0&&t&&t.length>0?o.getSettingComponent().find(".embed-responsive-item").attr("src",t):alert("Your Google Map embed code is invalid!")});var r=a.find(".btn-googlemap-169"),p=a.find(".btn-googlemap-43");r.on("click",function(a){a.preventDefault(),e(this).addClass("btn-primary").removeClass("btn-default"),p.removeClass("btn-primary").addClass("btn-default"),o.getSettingComponent().find(".embed-responsive").removeClass("embed-responsive-4by3").addClass("embed-responsive-16by9");var t=o.getSettingComponent();"manually"===t.attr("maptype")&&t.find(".kgooglemap").data("map")&&google.maps.event.trigger(t.find(".kgooglemap").data("map"),"resize")}),p.on("click",function(a){a.preventDefault(),e(this).addClass("btn-primary").removeClass("btn-default"),r.removeClass("btn-primary").addClass("btn-default"),o.getSettingComponent().find(".embed-responsive").removeClass("embed-responsive-16by9").addClass("embed-responsive-4by3");var t=o.getSettingComponent();"manually"===t.attr("maptype")&&t.find(".kgooglemap").data("map")&&google.maps.event.trigger(t.find(".kgooglemap").data("map"),"resize")})}})},showSettingForm:function(e,a,t){var o=this,n=a.attr("data-maptype"),i=a.attr("data-place"),s=a.find(".embed-responsive").hasClass("embed-responsive-16by9"),r=a.find(".embed-responsive").hasClass("embed-responsive-4by3");r&&e.find(".btn-googlemap-43").addClass("btn-primary").removeClass("btn-default"),s&&e.find(".btn-googlemap-169").addClass("btn-primary").removeClass("btn-default"),e.find(".mapType[value="+n+"]").prop("checked",!0);var p=a.find("iframe").attr("src"),l='<iframe class="embed-responsive-item" src="'+p+'"></iframe>';i||(i="Hanoi, Vietnam"),e.find("[name=mapAddress]").val(i),e.find("[name=mapEmbedCode]").val(l);var d=a.attr("data-firstLoad");if("manually"===n){if(e.find(".manually").removeClass("hide").siblings(".embed").addClass("hide"),!d&&i)var m=setInterval(function(){window.googleMapInitialized&&(clearInterval(m),o.initAutocomplete(a,e),setTimeout(function(){var t=e.find("[name=mapAddress]")[0];google.maps.event.trigger(t,"focus"),google.maps.event.trigger(t,"keydown",{keyCode:13}),a.attr("data-firstLoad","false")},1e3))},100)}else e.find(".manually").addClass("hide").siblings(".embed").removeClass("hide")},initAutocomplete:function(e,a){if(!window.googleMapInitialized)return void alert("google map is not initialized");var t=e.find(".kgooglemap")[0],o=new google.maps.Map(t,{zoom:13,mapTypeId:"roadmap"}),n=a.find("[name=mapAddress]")[0],i=new google.maps.places.SearchBox(n);o.addListener("bounds_changed",function(){i.setBounds(o.getBounds())});var s=[];i.addListener("places_changed",function(){var a=i.getPlaces();if(0!=a.length){s.forEach(function(e){e.setMap(null)}),s=[];var t=new google.maps.LatLngBounds;a.forEach(function(e){if(!e.geometry)return void console.log("Returned place contains no geometry");var a={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};s.push(new google.maps.Marker({map:o,icon:a,title:e.name,position:e.geometry.location})),e.geometry.viewport?t.union(e.geometry.viewport):t.extend(e.geometry.location)}),o.fitBounds(t),e.attr("data-place",n.value)}}),e.find(".kgooglemap").data("map",o)}},window.initKeditorMapSetting=function(){window.googleMapInitialized=!0}}(jQuery);
//# sourceMappingURL=keditor-component-googlemap-0.0.0.min.js.map
