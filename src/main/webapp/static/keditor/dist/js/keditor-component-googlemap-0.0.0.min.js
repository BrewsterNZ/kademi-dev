/**!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 0.0.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap (optional), FontAwesome (optional)
 */
!function(e,o){var a=e.keditor,n=a.log;a.components.googlemap={init:function(e,o,a,t){n('init "googlemap" component',a),this.callWhenGoogleMapReady(function(){initKGoogleMap(a)})},getContent:function(e,o){n('getContent "googlemap" component',e);var a=e.children(".keditor-component-content");return a.find(".googlemap-cover").remove(),e.find(".kgooglemap").html(""),a.html()},settingEnabled:!0,settingTitle:"Google Map Settings",initSettingForm:function(o,a){n('init "googlemap" settings',o);var t=this;return e.ajax({url:"/static/keditor/componentGoogleMapSettings.html",type:"get",dataType:"HTML",success:function(n){o.html(n),t.callWhenGoogleMapReady(function(){var e=a.getSettingComponent();t.initAutocomplete(e,o)});var i=o.find(".map-type");o.find(".mapType").on("click",function(){i.hide().filter("."+this.value).show();var e=a.getSettingComponent(),n=e.find("iframe"),l=e.find(".kgooglemap");e.attr("data-maptype",this.value),n["manually"===this.value?"hide":"show"](),l["manually"===this.value?"show":"hide"](),"manually"===this.value&&t.makeGoogleMapFresh(o,e)}),o.find("[name=mapEmbedCode]").on("change",function(){var o=e(this.value),n=o.attr("src");o.length>0&&n&&n.length>0?a.getSettingComponent().find(".embed-responsive-item").attr("src",n):alert("Your Google Map embed code is invalid!")}),o.find("[name=mapRatio]").on("click",function(){var e=a.getSettingComponent();e.find(".embed-responsive").removeClass("embed-responsive-4by3 embed-responsive-16by9").addClass("embed-responsive-"+this.value)})}})},callWhenGoogleMapReady:function(a){var n=this,t="AIzaSyBUcuZxwpBXCPztG7ot-rITXJbycPuS7gs",i="https://maps.googleapis.com/maps/api/js?key="+t+"&libraries=places";o.google&&o.google.maps&&google.maps.places?a.call(n):e.getScriptOnce(i,function(){a.call(n)})},makeGoogleMapFresh:function(e,o){var a=e.find("[name=mapAddress]")[0];setTimeout(function(){google.maps.event.trigger(a,"focus"),google.maps.event.trigger(a,"keydown",{keyCode:13})},1e3);var n=o.find(".kgooglemap").data("map");setTimeout(function(){google.maps.event.trigger(n,"resize")},100)},showSettingForm:function(e,o,a){var n=this;n.callWhenGoogleMapReady(function(){var a=o.attr("data-maptype")||"embed",t=o.attr("data-place"),i=o.find(".embed-responsive").hasClass("embed-responsive-16by9")?"16by9":"4by3";e.find(".mapRatio[value="+i+"]").prop("checked",!0),e.find(".mapType[value="+a+"]").prop("checked",!0);var l=o.find("iframe").attr("src"),s='<iframe class="embed-responsive-item" src="'+l+'"></iframe>';t||(t="Hanoi, Vietnam"),e.find("[name=mapAddress]").val(t),e.find("[name=mapEmbedCode]").val(s),e.find(".map-type").hide().filter("."+a).show(),o.find(".kgooglemap").data("map")?"manually"===a&&n.makeGoogleMapFresh(e,o):(n.initAutocomplete(o,e),"manually"===a&&n.makeGoogleMapFresh(e,o))})},initAutocomplete:function(e,o){if(e.find(".kgooglemap").data("map"))this.makeGoogleMapFresh(o,e);else{var a=e.find(".kgooglemap")[0],n=new google.maps.Map(a,{zoom:13,mapTypeId:"roadmap"}),t=o.find("[name=mapAddress]")[0],i=new google.maps.places.SearchBox(t);n.addListener("bounds_changed",function(){i.setBounds(n.getBounds())});var l=[];i.addListener("places_changed",function(){var o=i.getPlaces();if(0!=o.length){l.forEach(function(e){e.setMap(null)}),l=[];var a=new google.maps.LatLngBounds;o.forEach(function(e){if(!e.geometry)return void console.log("Returned place contains no geometry");var o={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};l.push(new google.maps.Marker({map:n,icon:o,title:e.name,position:e.geometry.location})),e.geometry.viewport?a.union(e.geometry.viewport):a.extend(e.geometry.location)}),n.fitBounds(a),e.attr("data-place",t.value)}}),e.find(".kgooglemap").data("map",n)}}}}(jQuery,window);
//# sourceMappingURL=keditor-component-googlemap-0.0.0.min.js.map
