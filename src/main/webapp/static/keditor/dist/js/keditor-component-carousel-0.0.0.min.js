/**!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 0.0.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap (optional), FontAwesome (optional)
 */
!function(t){var e=t.keditor,a=e.log;e.components.carousel={init:function(e,n,o,i){a('init "carousel" component',o);var s=o.children(".keditor-component-content"),r=s.find(".carousel");if(0===r.find(".carousel-img").length&&0===r.find(".carousel-content").length){var d=this,c=[];r.addClass("carousel-fixed-height"),r.find(".carousel-inner .item").each(function(){var e=t(this);c.push({src:e.find("img").attr("src"),hash:e.attr("data-hash")})}),r.attr("data-height",300).css("height",300),r.find(".carousel-inner").html(""),r.find(".carousel-indicators").html(""),t.each(c,function(t,e){d.addItemToCarousel(o,{src:e.src,hash:e.hash})})}var l=i.generateId("component-carousel");r.attr("id",l),r.find(".carousel-indicators li").attr("data-target","#"+l),r.find(".carousel-control").attr("href","#"+l)},getContent:function(t,e){var a=t.children(".keditor-component-content");return a.find(".carousel-inner").children().removeClass("active").eq(0).addClass("active"),a.html()},settingEnabled:!0,settingTitle:"Carousel settings",editingItemId:"",initSettingForm:function(e,n){a('init "carousel" settings',e);var o=this;return t.ajax({url:"/static/keditor/componentCarouselSettings.html",type:"get",dataType:"HTML",success:function(i){e.html(i);var s=e.find(".carouselAddImage"),r=e.find(".carouselItemsWrap");s.mselect({contentTypes:["image"],bs3Modal:!0,pagePath:n.options.pagePath,basePath:n.options.basePath,onSelectFile:function(t,i,s,r){a("Keditor carousel selected a file",t,r),o.addItemToList(e,{src:t,hash:r,caption:""}),o.refreshCarousel(n.getSettingComponent(),e),o.editingItemId=""}}),r.sortable({handle:".btn-sort-item",items:"> .carouselItem",axis:"y",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},update:function(){o.refreshCarousel(n.getSettingComponent(),e)}});var d=o.initModalContent(e,n),c=t("#modal-carousel-content"),l=o.initModalCaption(e,n),u=t("#modal-carousel-caption");e.find(".carouselAddImage").on("click",function(t){t.preventDefault()}),e.find(".carouselAddContent").on("click",function(t){t.preventDefault(),c.modal("show")}),t(document.body).on("click",".carouselItem a.btn-remove-item",function(a){if(a.preventDefault(),confirm("Are you sure that you want to delete this image?")){var i=t(this),s=i.closest(".btn-group").siblings("[data-hash]").attr("data-hash"),r=n.getSettingComponent().find(".carousel");r.find("[data-hash="+s+"]").remove(),i.closest(".carouselItem").remove(),o.refreshCarousel(n.getSettingComponent(),e)}}),t(document.body).on("click",".carouselItem a.btn-edit-item",function(a){a.preventDefault();var n=t(this).closest(".carouselItem");o.editingItemId=n.attr("id");var i=n.find(".txt-carousel-content");i.length>0?(d.setData(i.val()||""),e.find(".carouselAddContent").trigger("click")):e.find(".carouselAddImage").trigger("click")}),t(document.body).on("click",".carouselItem a.btn-edit-caption-item",function(e){e.preventDefault();var a=t(this).closest(".carouselItem");o.editingItemId=a.attr("id");var n=a.find(".txt-carousel-caption");l.setData(n.val()||""),u.modal("show")}),e.find(".carouselHeight").on("change",function(t){var e=this.value;(isNaN(e)||200>+e)&&(e=200,this.value=200);var a=n.getSettingComponent().find(".carousel");a.attr("data-height",e),a.css("height",e)}),e.find(".carouselPause").on("change",function(t){t.preventDefault();var e=n.getSettingComponent().find(".carousel");e.attr("data-pause",this.value)}),e.find(".carouselInterval").on("change",function(t){t.preventDefault();var e=n.getSettingComponent().find(".carousel");e.attr("data-interval",this.value)}),e.find(".carouselWrap").on("click",function(t){var e=n.getSettingComponent().find(".carousel");this.checked?e.attr("data-wrap","true"):e.attr("data-wrap","false")})}})},initModalContent:function(e,n){var o=this,i=t('<div class="modal fade" tabindex="-1" id="modal-carousel-content">    <div class="modal-dialog modal-lg">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h4 class="modal-title">Edit content</h4>            </div>            <div class="modal-body">                <textarea id="modal-carousel-content-body" class="form-control" rows="12"></textarea>            </div>            <div class="modal-footer">                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>                <button type="button" class="btn btn-primary btn-carousel-save-content">Save</button>            </div>        </div>    </div></div>').appendTo(document.body),s=t.extend({},n.options.ckeditorOptions);s.removePlugins=s.removePlugins.replace(",autogrow","")+",sourcedialog",s.extraPlugins=s.extraPlugins+",autogrow";var r=t("#modal-carousel-content-body").ckeditor(s).editor;return i.on("hidden.bs.modal",function(){r.setData(""),o.editingItemId=""}),i.find(".btn-carousel-save-content").on("click",function(t){t.preventDefault(),a("Keditor carousel add content");var s=r.getData()||"";o.addItemToList(e,{content:s}),o.refreshCarousel(n.getSettingComponent(),e),i.modal("hide")}),r},initModalCaption:function(e,n){var o=this,i=t('<div class="modal fade" tabindex="-1" id="modal-carousel-caption">    <div class="modal-dialog modal-lg">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h4 class="modal-title">Edit caption</h4>            </div>            <div class="modal-body">                <textarea id="modal-carousel-caption-body" class="form-control" rows="12"></textarea>            </div>            <div class="modal-footer">                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>                <button type="button" class="btn btn-primary btn-carousel-save-caption">Save</button>            </div>        </div>    </div></div>').appendTo(document.body),s=t.extend({},n.options.ckeditorOptions);s.removePlugins=s.removePlugins.replace(",autogrow","")+",sourcedialog",s.extraPlugins=s.extraPlugins+",autogrow",s.toolbarGroups=toolbarSets.Lite;var r=t("#modal-carousel-caption-body").ckeditor(s).editor;return i.on("hidden.bs.modal",function(){r.setData(""),o.editingItemId=""}),i.find(".btn-carousel-save-caption").on("click",function(t){t.preventDefault(),a("Keditor carousel add content");var s=r.getData()||"",d=e.find("#"+o.editingItemId).find(".img-responsive");o.addItemToList(e,{src:d.attr("src"),hash:d.attr("data-hash"),caption:s}),o.refreshCarousel(n.getSettingComponent(),e),i.modal("hide")}),r},showSettingForm:function(e,a,n){var o=this;o.editingItemId="",e.find(".carouselItemsWrap").html(""),a.find(".carousel-inner > .item").each(function(){var a=t(this),n=a.find(".carousel-img"),i=a.find(".carousel-content");if(i.length>0)o.addItemToList(e,{content:i.html()});else{var s=n.css("background-image");s=s.slice(4,-1).replace(/['"]/g,"");var r=t(a).attr("data-hash"),d=a.find(".carousel-caption");o.addItemToList(e,{src:s,hash:r,caption:d.html()||""})}});var i=a.find(".carousel").attr("data-wrap"),s=a.find(".carousel").attr("data-pause"),r=a.find(".carousel").attr("data-interval"),d=a.find(".carousel").attr("data-height");e.find(".carouselPause").val(s),e.find(".carouselInterval").val(r),e.find(".carouselWrap").prop("checked","true"===i),e.find(".carouselHeight").val(d)},addItemToCarousel:function(t,e){a("addItemToCarousel",t,e);var n=t.find(".carousel"),o=n.find(".carousel-inner"),i=n.attr("id"),s=o.children().length,r=0===s?"active":"",d="background-image: url('"+e.src+"')";n.find(".carousel-indicators").append('<li data-target="#'+i+'" data-slide-to="'+s+'" class="'+r+'"></li>');var c="";e.content?(c+='<div class="item '+r+'">',c+='   <div class="carousel-content clearfix">'+e.content+"</div>",c+='   <div class="carousel-caption"></div>',c+="</div>"):(c+='<div data-hash="'+e.hash+'" class="item '+r+'">',c+='   <div class="carousel-img" style="'+d+'"></div>',c+='   <div class="carousel-caption">'+e.caption+"</div>",c+="</div>"),o.append(c)},addItemToList:function(t,e){a("addItemToList",t,e);var n="",o="";e.content?(o+='<img class="img-responsive" src="/static/keditor/componentCarouselContent.png" />',o+='<textarea style="display: none" class="txt-carousel-content">'+e.content+"</textarea>"):(o+='<img class="img-responsive" src="'+e.src+'" data-hash="'+e.hash+'" />',o+='<textarea style="display: none" class="txt-carousel-caption">'+e.caption+"</textarea>",n='<a title="Edit caption" class="btn btn-success btn-edit-caption-item" href="#"><i class="fa fa-file"></i></a>'),o+='   <div class="btn-group btn-group-xs">',o+='       <a title="Reorder item" class="btn btn-info btn-sort-item" href="#"><i class="fa fa-sort"></i></a>',o+='       <a title="Edit item" class="btn btn-primary btn-edit-item" href="#"><i class="fa fa-edit"></i></a>'+n,o+='       <a title="Delete item" class="btn btn-danger btn-remove-item" href="#"><i class="fa fa-trash"></i></a>',o+="   </div>",this.editingItemId?(t.find("#"+this.editingItemId).html(o),this.editingItemId=""):t.find(".carouselItemsWrap").append('<div class="carouselItem" id="carouselItem-'+(new Date).getTime()+'">'+o+"</div>")},refreshCarousel:function(e,a){var n=this,o=e.find(".carousel");o.find(".carousel-inner").html(""),o.find(".carousel-indicators").html(""),a.find(".carouselItemsWrap").find(".carouselItem").each(function(){var a=t(this),o=a.find(".txt-carousel-content"),i=a.find(".txt-carousel-caption"),s=a.find("img");0===o.length?n.addItemToCarousel(e,{src:s.attr("src"),hash:s.attr("data-hash"),caption:i.val()}):n.addItemToCarousel(e,{content:o.val()})})}}}(jQuery);
//# sourceMappingURL=keditor-component-carousel-0.0.0.min.js.map
