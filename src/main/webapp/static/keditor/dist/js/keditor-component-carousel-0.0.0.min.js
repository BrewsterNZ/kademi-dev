/**!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 0.0.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap (optional), FontAwesome (optional)
 */
!function(a){var e=a.keditor,t=e.log;e.components.carousel={init:function(e,n,i,r){t('init "carousel" component',i);var s=i.children(".keditor-component-content"),o=s.find(".carousel");if(0===o.find(".carousel-img").length){var c=this,l=[];o.addClass("carousel-fixed-height"),o.find(".carousel-inner .item").each(function(){var e=a(this);l.push({src:e.find("img").attr("src"),hash:e.attr("data-hash")})}),o.attr("data-height",200).css("height",200),o.find(".carousel-inner").html(""),o.find(".carousel-indicators").html(""),a.each(l,function(a,e){c.addImageToCarousel(i,e.src,e.hash)})}var d=r.generateId("component-carousel");o.attr("id",d),o.find(".carousel-indicators li").attr("data-target",d),o.find(".carousel-control").attr("href","#"+d)},getContent:function(a,e){var t=a.children(".keditor-component-content");return t.html()},settingEnabled:!0,settingTitle:"Carousel settings",initSettingForm:function(e,n){return t('init "carousel" settings',e),a.ajax({url:"/static/keditor/componentCarouselSettings.html",type:"get",dataType:"HTML",success:function(i){e.html(i);var r=window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/")+1),s=e.find(".carouselAddImage"),o=e.find(".carouselImageWrap"),c=this;s.mselect({contentTypes:["image"],bs3Modal:!0,pagePath:r,basePath:r,onSelectFile:function(a,i,r,s){t("keditor carousel selected a file",a,s),c.addImageToList(e,a,s),c.addImageToCarousel(n.getSettingComponent(),a,s)}}),o.sortable({handle:".btn-sort-image",items:"> .carouselImageItem",axis:"y",tolerance:"pointer",sort:function(){a(this).removeClass("ui-state-default")},update:function(){c.rearrangeItems(n.getSettingComponent(),e)}}),a(document.body).on("click",".carouselImageItem a.btn-remove-image",function(e){if(e.preventDefault(),confirm("Are you sure that you want to delete this image?")){var t=a(this),i=t.closest(".btn-group").siblings("[data-hash]").attr("data-hash");c.refreshCarousel(n.getSettingComponent(),i),t.closest(".carouselImageItem").remove()}}),e.find(".carouselHeight").on("change",function(a){var e=this.value;(isNaN(e)||200>+e)&&(e=200,this.value=200);var t=n.getSettingComponent().find(".carousel");t.attr("data-height",e),t.css("height",e)}),e.find(".carouselPause").on("change",function(a){a.preventDefault();var e=n.getSettingComponent().find(".carousel");e.attr("data-pause",this.value)}),e.find(".carouselInterval").on("change",function(a){a.preventDefault();var e=n.getSettingComponent().find(".carousel");e.attr("data-interval",this.value)}),e.find(".carouselWrap").on("click",function(a){var e=n.getSettingComponent().find(".carousel");this.checked?e.attr("data-wrap","true"):e.attr("data-wrap","false")})}})},showSettingForm:function(e,t,n){var i=this;e.find(".carouselImageWrap").html(""),t.find(".carousel-inner > .item").each(function(t,n){var r=a(n).find(".carousel-img").css("background-image");r=r.replace(/^url\('*(.+)'*\)$/,"$1");var s=a(n).attr("data-hash");i.addImageToList(e,r,s)});var r=t.find(".carousel").attr("data-wrap"),s=t.find(".carousel").attr("data-pause"),o=t.find(".carousel").attr("data-interval"),c=t.find(".carousel").attr("data-height");e.find(".carouselPause").val(s),e.find(".carouselInterval").val(o),e.find(".carouselWrap").prop("checked","true"===r),e.find(".carouselHeight").val(c)},addImageToCarousel:function(a,e,t){var n=a.find(".carousel"),i=n.find(".carousel-indicators").children().length,r=0===i?"active":"",s="background-image: url('"+e+"')";n.find(".carousel-indicators").append('<li data-target="#'+n.attr("id")+'" data-slide-to="'+i+'" class="'+r+'"></li>'),n.find(".carousel-inner").append('<div data-hash="'+t+'" class="item '+r+'">   <div class="carousel-img" style="'+s+'"></div>   <div class="carousel-caption"></div></div>')},addImageToList:function(a,e,t){a.find(".carouselImageWrap").append('<div class="carouselImageItem">   <img class="img-responsive" src="'+e+'" data-hash="'+t+'" />   <div class="btn-group btn-group-sm">       <a class="btn btn-info btn-sort-image" href="#"><i class="fa fa-sort"></i></a>       <a title="Delete this image" class="btn btn-danger btn-remove-image" href="#"><i class="fa fa-trash"></i></a>   </div></div>')},refreshCarousel:function(a,e){a.find("[data-hash="+e+"]").remove(),a.find(".carousel-inner .item.active").length||a.find(".carousel-inner .item:first-child").addClass("active"),a.find(".carousel-indicators li:last-child").remove()},rearrangeItems:function(e,t){var n=this,i=e.find(".carousel");i.find(".carousel-inner").html(""),i.find(".carousel-indicators").html(""),t.find(".carouselImageWrap").find(".carouselImageItem").each(function(){var t=a(this),i=t.find("img");n.addImageToCarousel(e,i.attr("src"),i.attr("data-hash"))})}}}(jQuery);
//# sourceMappingURL=keditor-component-carousel-0.0.0.min.js.map
