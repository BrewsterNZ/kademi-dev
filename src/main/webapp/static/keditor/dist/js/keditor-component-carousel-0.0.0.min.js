/**!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 0.0.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap (optional), FontAwesome (optional)
 */
!function(t){var e=t.keditor,a=e.log;e.components.carousel={init:function(e,n,i,o){a('init "carousel" component',i);var s=i.children(".keditor-component-content"),c=s.find(".carousel");if(0===c.find(".carousel-img").length&&0===c.find(".carousel-content").length){var r=this,d=[];c.addClass("carousel-fixed-height"),c.find(".carousel-inner .item").each(function(){var e=t(this);d.push({src:e.find("img").attr("src"),hash:e.attr("data-hash")})}),c.attr("data-height",300).css("height",300),c.find(".carousel-inner").html(""),c.find(".carousel-indicators").html(""),t.each(d,function(t,e){r.addItemToCarousel(i,{src:e.src,hash:e.hash})})}var l=o.generateId("component-carousel");c.attr("id",l),c.find(".carousel-indicators li").attr("data-target","#"+l),c.find(".carousel-control").attr("href","#"+l)},getContent:function(t,e){var a=t.children(".keditor-component-content");return a.find(".carousel-inner").children().removeClass("active").eq(0).addClass("active"),a.html()},settingEnabled:!0,settingTitle:"Carousel settings",editingItemId:"",initSettingForm:function(e,n){a('init "carousel" settings',e);var i=this;return t.ajax({url:"/static/keditor/componentCarouselSettings.html",type:"get",dataType:"HTML",success:function(o){e.html(o),t.getStyleOnce("/static/bootstrap-iconpicker/1.7.0/css/bootstrap-iconpicker.min.css"),t.getScriptOnce("/static/bootstrap-iconpicker/1.7.0/js/iconset/iconset-fontawesome-4.2.0.min.js",function(){t.getScriptOnce("/static/bootstrap-iconpicker/1.7.0/js/bootstrap-iconpicker.min.js",function(){e.find(".btn-prev-icon, .btn-next-icon").iconpicker({iconset:"fontawesome",cols:10,rows:4,placement:"left"}),e.find(".btn-prev-icon").on("change",function(t){var e=n.getSettingComponent().find(".carousel");e.find(".glyphicon-chevron-left").attr("class","fa glyphicon-chevron-left "+t.icon)}),e.find(".btn-next-icon").on("change",function(t){var e=n.getSettingComponent().find(".carousel");e.find(".glyphicon-chevron-right").attr("class","fa glyphicon-chevron-right "+t.icon)})})});var s=e.find(".carouselAddImage"),c=e.find(".carouselItemsWrap");s.mselect({contentTypes:["image"],bs3Modal:!0,pagePath:n.options.pagePath,basePath:n.options.basePath,onSelectFile:function(t,o,s,c){a("Keditor carousel selected a file",t,c),i.addItemToList(e,{src:t,hash:c,caption:""}),i.refreshCarousel(n.getSettingComponent(),e),i.editingItemId=""}}),c.sortable({handle:".btn-sort-item",items:"> .carouselItem",axis:"y",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},update:function(){i.refreshCarousel(n.getSettingComponent(),e)}});var r=i.initModalContent(e,n),d=t("#modal-carousel-content"),l=i.initModalCaption(e,n),u=t("#modal-carousel-caption");e.find(".carouselAddImage").on("click",function(t){t.preventDefault()}),e.find(".carouselAddContent").on("click",function(t){t.preventDefault(),d.modal("show")}),t(document.body).on("click",".carouselItem a.btn-remove-item",function(a){if(a.preventDefault(),confirm("Are you sure that you want to delete this image?")){var o=t(this),s=o.closest(".btn-group").siblings("[data-hash]").attr("data-hash"),c=n.getSettingComponent().find(".carousel");c.find("[data-hash="+s+"]").remove(),o.closest(".carouselItem").remove(),i.refreshCarousel(n.getSettingComponent(),e)}}),t(document.body).on("click",".carouselItem a.btn-edit-item",function(a){a.preventDefault();var n=t(this).closest(".carouselItem");i.editingItemId=n.attr("id");var o=n.find(".txt-carousel-content");o.length>0?(r.setData(o.val()||""),e.find(".carouselAddContent").trigger("click")):e.find(".carouselAddImage").trigger("click")}),t(document.body).on("click",".carouselItem a.btn-edit-caption-item",function(e){e.preventDefault();var a=t(this).closest(".carouselItem");i.editingItemId=a.attr("id");var n=a.find(".txt-carousel-caption");l.setData(n.val()||""),u.modal("show")}),e.find(".carouselHeight").on("change",function(t){var e=this.value;(isNaN(e)||200>+e)&&(e=200,this.value=200);var a=n.getSettingComponent().find(".carousel");a.attr("data-height",e),a.css("height",e)}),e.find(".carouselPause").on("change",function(t){t.preventDefault();var e=n.getSettingComponent().find(".carousel");e.attr("data-pause",this.value)}),e.find(".carouselInterval").on("change",function(t){t.preventDefault();var e=n.getSettingComponent().find(".carousel");e.attr("data-interval",this.value)}),e.find(".carouselWrap").on("click",function(t){var e=n.getSettingComponent().find(".carousel");this.checked?e.attr("data-wrap","true"):e.attr("data-wrap","false")}),e.find(".select-image-size").on("change",function(){var t=n.getSettingComponent().find(".carousel");t.attr("data-image-size",this.value),t.find(".carousel-img").css("background-size","centered"===this.value?"unset":"")})}})},initModalContent:function(e,n){var i=this,o=t('<div class="modal fade" tabindex="-1" id="modal-carousel-content">    <div class="modal-dialog modal-lg">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h4 class="modal-title">Edit content</h4>            </div>            <div class="modal-body">                <textarea id="modal-carousel-content-body" class="form-control" rows="12"></textarea>            </div>            <div class="modal-footer">                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>                <button type="button" class="btn btn-primary btn-carousel-save-content">Save</button>            </div>        </div>    </div></div>').appendTo(document.body),s=t.extend({},n.options.ckeditorOptions);s.removePlugins=s.removePlugins.replace(",autogrow","")+",sourcedialog",s.extraPlugins=s.extraPlugins+",autogrow";var c=t("#modal-carousel-content-body").ckeditor(s).editor;return o.on("hidden.bs.modal",function(){c.setData(""),i.editingItemId=""}),o.find(".btn-carousel-save-content").on("click",function(t){t.preventDefault(),a("Keditor carousel add content");var s=c.getData()||"";i.addItemToList(e,{content:s}),i.refreshCarousel(n.getSettingComponent(),e),o.modal("hide")}),c},initModalCaption:function(e,n){var i=this,o=t('<div class="modal fade" tabindex="-1" id="modal-carousel-caption">    <div class="modal-dialog modal-lg">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h4 class="modal-title">Edit caption</h4>            </div>            <div class="modal-body">                <textarea id="modal-carousel-caption-body" class="form-control" rows="12"></textarea>            </div>            <div class="modal-footer">                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>                <button type="button" class="btn btn-primary btn-carousel-save-caption">Save</button>            </div>        </div>    </div></div>').appendTo(document.body),s=t.extend({},n.options.ckeditorOptions);s.removePlugins=s.removePlugins.replace(",autogrow","")+",sourcedialog",s.extraPlugins=s.extraPlugins+",autogrow",s.toolbarGroups=toolbarSets.Lite;var c=t("#modal-carousel-caption-body").ckeditor(s).editor;return o.on("hidden.bs.modal",function(){c.setData(""),i.editingItemId=""}),o.find(".btn-carousel-save-caption").on("click",function(t){t.preventDefault(),a("Keditor carousel add content");var s=c.getData()||"",r=e.find("#"+i.editingItemId).find(".img-responsive");i.addItemToList(e,{src:r.attr("src"),hash:r.attr("data-hash"),caption:s}),i.refreshCarousel(n.getSettingComponent(),e),o.modal("hide")}),c},showSettingForm:function(e,a,n){var i=this;i.editingItemId="",e.find(".carouselItemsWrap").html(""),a.find(".carousel-inner > .item").each(function(){var a=t(this),n=a.find(".carousel-img"),o=a.find(".carousel-content");if(o.length>0)i.addItemToList(e,{content:o.html()});else{var s=n.css("background-image");s=s.slice(4,-1).replace(/['"]/g,"");var c=t(a).attr("data-hash"),r=a.find(".carousel-caption");i.addItemToList(e,{src:s,hash:c,caption:r.html()||""})}});var o=a.find(".carousel"),s=o.attr("data-wrap"),c=o.attr("data-pause"),r=o.attr("data-interval"),d=o.attr("data-height");e.find(".carouselPause").val(c),e.find(".carouselInterval").val(r),e.find(".carouselWrap").prop("checked","true"===s),e.find(".carouselHeight").val(d),e.find(".select-image-size").val(o.attr("data-image-size")||"stretched"),t.getScriptOnce("/static/bootstrap-iconpicker/1.7.0/js/iconset/iconset-fontawesome-4.2.0.min.js",function(){t.getScriptOnce("/static/bootstrap-iconpicker/1.7.0/js/bootstrap-iconpicker.min.js",function(){var t=o.find(".glyphicon-chevron-left").attr("class")||"";t=t.replace("glyphicon-chevron-left","").replace("fa","").trim(),e.find(".btn-prev-icon").find("i").attr("class","fa "+t).end().find("input").val(t);var a=o.find(".glyphicon-chevron-right").attr("class")||"";a=a.replace("glyphicon-chevron-right","").replace("fa","").trim(),e.find(".btn-next-icon").find("i").attr("class","fa "+a).end().find("input").val(a)})})},addItemToCarousel:function(t,e){a("addItemToCarousel",t,e);var n=t.find(".carousel"),i=n.find(".carousel-inner"),o=n.attr("id"),s=i.children().length,c=0===s?"active":"",r="background-image: url('"+e.src+"')",d="centered"===n.attr("data-image-size")?";background-size: unset":"";n.find(".carousel-indicators").append('<li data-target="#'+o+'" data-slide-to="'+s+'" class="'+c+'"></li>');var l="";e.content?(l+='<div class="item '+c+'">',l+='   <div class="carousel-content clearfix">'+e.content+"</div>",l+='   <div class="carousel-caption"></div>',l+="</div>"):(l+='<div data-hash="'+e.hash+'" class="item '+c+'">',l+='   <div class="carousel-img" style="'+r+d+'"></div>',l+='   <div class="carousel-caption">'+e.caption+"</div>",l+="</div>"),i.append(l)},addItemToList:function(t,e){a("addItemToList",t,e);var n="",i="";e.content?(i+='<img class="img-responsive" src="/static/keditor/componentCarouselContent.png" />',i+='<textarea style="display: none" class="txt-carousel-content">'+e.content+"</textarea>"):(i+='<img class="img-responsive" src="'+e.src+'" data-hash="'+e.hash+'" />',i+='<textarea style="display: none" class="txt-carousel-caption">'+e.caption+"</textarea>",n='<a title="Edit caption" class="btn btn-success btn-edit-caption-item" href="#"><i class="fa fa-file"></i></a>'),i+='   <div class="btn-group btn-group-xs">',i+='       <a title="Reorder item" class="btn btn-info btn-sort-item" href="#"><i class="fa fa-sort"></i></a>',i+='       <a title="Edit item" class="btn btn-primary btn-edit-item" href="#"><i class="fa fa-edit"></i></a>'+n,i+='       <a title="Delete item" class="btn btn-danger btn-remove-item" href="#"><i class="fa fa-trash"></i></a>',i+="   </div>",this.editingItemId?(t.find("#"+this.editingItemId).html(i),this.editingItemId=""):t.find(".carouselItemsWrap").append('<div class="carouselItem" id="carouselItem-'+(new Date).getTime()+'">'+i+"</div>")},refreshCarousel:function(e,a){var n=this,i=e.find(".carousel");i.find(".carousel-inner").html(""),i.find(".carousel-indicators").html(""),a.find(".carouselItemsWrap").find(".carouselItem").each(function(){var a=t(this),i=a.find(".txt-carousel-content"),o=a.find(".txt-carousel-caption"),s=a.find("img");0===i.length?n.addItemToCarousel(e,{src:s.attr("src"),hash:s.attr("data-hash"),caption:o.val()}):n.addItemToCarousel(e,{content:i.val()})})}}}(jQuery);
//# sourceMappingURL=keditor-component-carousel-0.0.0.min.js.map
