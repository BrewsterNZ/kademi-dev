/**!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 0.0.0
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap (optional), FontAwesome (optional)
 */
!function(t){var e=t.keditor,a=e.log;e.components.carousel={init:function(e,n,i,o){a('init "carousel" component',i);var s=i.children(".keditor-component-content"),r=s.find(".carousel");if(0===r.find(".carousel-img").length&&0===r.find(".carousel-content").length){var d=this,c=[];r.addClass("carousel-fixed-height"),r.find(".carousel-inner .item").each(function(){var e=t(this);c.push({src:e.find("img").attr("src"),hash:e.attr("data-hash")})}),r.attr("data-height",200).css("height",200),r.find(".carousel-inner").html(""),r.find(".carousel-indicators").html(""),t.each(c,function(t,e){d.addItemToCarousel(i,e.src,e.hash)})}var l=o.generateId("component-carousel");r.attr("id",l),r.find(".carousel-indicators li").attr("data-target","#"+l),r.find(".carousel-control").attr("href","#"+l)},getContent:function(t,e){var a=t.children(".keditor-component-content");return a.html()},settingEnabled:!0,settingTitle:"Carousel settings",editingItemId:"",initSettingForm:function(e,n){a('init "carousel" settings',e);var i=this;return t.ajax({url:"/static/keditor/componentCarouselSettings.html",type:"get",dataType:"HTML",success:function(o){e.html(o);var s=window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/")+1),r=e.find(".carouselAddImage"),d=e.find(".carouselItemsWrap");r.mselect({contentTypes:["image"],bs3Modal:!0,pagePath:s,basePath:s,onSelectFile:function(t,o,s,r){a("Keditor carousel selected a file",t,r),i.addItemToList(e,{src:t,hash:r}),i.refreshCarousel(n.getSettingComponent(),e),i.editingItemId=""}}),d.sortable({handle:".btn-sort-item",items:"> .carouselItem",axis:"y",tolerance:"pointer",sort:function(){t(this).removeClass("ui-state-default")},update:function(){i.refreshCarousel(n.getSettingComponent(),e)}});var c=t('<div class="modal fade" tabindex="-1" id="modal-carousel-content">    <div class="modal-dialog modal-lg">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal">&times;</button>                <h4 class="modal-title">Edit your content</h4>            </div>            <div class="modal-body">                <textarea id="modal-carousel-content-body" class="form-control" rows="12"></textarea>            </div>            <div class="modal-footer">                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>                <button type="button" class="btn btn-primary btn-carousel-save-content">Save</button>            </div>        </div>    </div></div>').appendTo(document.body),l=n.options.ckeditorOptions;l.removePlugins=l.removePlugins.replace(",autogrow",""),l.extraPlugins=l.extraPlugins+",autogrow";var u=t("#modal-carousel-content-body").ckeditor(l).editor;e.find(".carouselAddImage").on("click",function(t){t.preventDefault()}),e.find(".carouselAddContent").on("click",function(t){t.preventDefault(),c.modal("show")}),c.on("hidden.bs.modal",function(){u.setData(""),i.editingItemId=""}),c.find(".btn-carousel-save-content").on("click",function(t){t.preventDefault(),a("Keditor carousel add content");var o=u.getData()||"";i.addItemToList(e,{content:o}),i.refreshCarousel(n.getSettingComponent(),e),c.modal("hide")}),t(document.body).on("click",".carouselItem a.btn-remove-item",function(e){if(e.preventDefault(),confirm("Are you sure that you want to delete this image?")){var a=t(this),o=a.closest(".btn-group").siblings("[data-hash]").attr("data-hash");i.refreshCarousel(n.getSettingComponent(),o),a.closest(".carouselItem").remove()}}),t(document.body).on("click",".carouselItem a.btn-edit-item",function(a){a.preventDefault();var n=t(this).closest(".carouselItem");i.editingItemId=n.attr("id"),n.find("textarea").length>0?(u.setData(n.find("textarea").val()||""),e.find(".carouselAddContent").trigger("click")):e.find(".carouselAddImage").trigger("click")}),e.find(".carouselHeight").on("change",function(t){var e=this.value;(isNaN(e)||200>+e)&&(e=200,this.value=200);var a=n.getSettingComponent().find(".carousel");a.attr("data-height",e),a.css("height",e)}),e.find(".carouselPause").on("change",function(t){t.preventDefault();var e=n.getSettingComponent().find(".carousel");e.attr("data-pause",this.value)}),e.find(".carouselInterval").on("change",function(t){t.preventDefault();var e=n.getSettingComponent().find(".carousel");e.attr("data-interval",this.value)}),e.find(".carouselWrap").on("click",function(t){var e=n.getSettingComponent().find(".carousel");this.checked?e.attr("data-wrap","true"):e.attr("data-wrap","false")})}})},showSettingForm:function(e,a,n){var i=this;i.editingItemId="",e.find(".carouselItemsWrap").html(""),a.find(".carousel-inner > .item").each(function(){var a=t(this),n=a.find(".carousel-img"),o=a.find(".carousel-content");if(o.length>0)i.addItemToList(e,{content:o.html()});else{var s=n.css("background-image");s=s.slice(4,-1).replace(/['"]/g,"");var r=t(a).attr("data-hash");i.addItemToList(e,{src:s,hash:r})}});var o=a.find(".carousel").attr("data-wrap"),s=a.find(".carousel").attr("data-pause"),r=a.find(".carousel").attr("data-interval"),d=a.find(".carousel").attr("data-height");e.find(".carouselPause").val(s),e.find(".carouselInterval").val(r),e.find(".carouselWrap").prop("checked","true"===o),e.find(".carouselHeight").val(d)},addItemToCarousel:function(t,e){a("addItemToCarousel",t,e);var n=t.find(".carousel"),i=n.attr("id"),o=n.find(".carousel-indicators").children().length,s=0===o?"active":"",r="background-image: url('"+e.src+"')";n.find(".carousel-indicators").append('<li data-target="#'+i+'" data-slide-to="'+o+'" class="'+s+'"></li>');var d="";e.content?(d+='<div class="item '+s+'">',d+='   <div class="carousel-content clearfix">'+e.content+"</div>",d+='   <div class="carousel-caption"></div>',d+="</div>"):(d+='<div data-hash="'+e.hash+'" class="item '+s+'">',d+='   <div class="carousel-img" style="'+r+'"></div>',d+='   <div class="carousel-caption"></div>',d+="</div>"),n.find(".carousel-inner").append(d)},addItemToList:function(t,e){a("addItemToList",t,e);var n="";e.content?(n+='<img class="img-responsive" src="/static/keditor/componentCarouselContent.png" />',n+='<textarea style="display: none">'+e.content+"</textarea>"):n='<img class="img-responsive" src="'+e.src+'" data-hash="'+e.hash+'" />',n+='   <div class="btn-group btn-group-sm">',n+='       <a class="btn btn-info btn-sort-item" href="#"><i class="fa fa-sort"></i></a>',n+='       <a class="btn btn-success btn-edit-item" href="#"><i class="fa fa-edit"></i></a>',n+='       <a title="Delete this image" class="btn btn-danger btn-remove-item" href="#"><i class="fa fa-trash"></i></a>',n+="   </div>",this.editingItemId?(t.find("#"+this.editingItemId).html(n),this.editingItemId=""):t.find(".carouselItemsWrap").append('<div class="carouselItem" id="carouselItem-'+(new Date).getTime()+'">'+n+"</div>")},refreshCarousel:function(e,a){var n=this,i=e.find(".carousel");i.find(".carousel-inner").html(""),i.find(".carousel-indicators").html(""),a.find(".carouselItemsWrap").find(".carouselItem").each(function(){var a=t(this),i=a.find("textarea"),o=a.find("img");0===i.length?n.addItemToCarousel(e,{src:o.attr("src"),hash:o.attr("data-hash")}):n.addItemToCarousel(e,{content:i.val()})})}}}(jQuery);
//# sourceMappingURL=keditor-component-carousel-0.0.0.min.js.map
