{"version":3,"sources":["keditor-component-video-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","self","this","img","find","attr","generateId","wrapper","parent","hasClass","wrap","getScriptOnce","jwplayer","key","buildJWVideoPlayerPreview","getContent","html","componentId","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","selectPicker","selectpicker","on","borderStyle","value","getSettingComponent","css","txtBorderWidth","width","isNaN","borderWidth","colorPicker","input","previewer","colorpicker","format","align","colorSelectors","transparent","e","colorHex","color","toHex","val","trim","length","borderColor","prop","checked","btnVideoFileInput","mselect","contentTypes","bs3Modal","pagePath","window","location","pathname","replace","onSelectFile","refreshVideoPlayerPreview","autoplayToggle","loopToggle","ratio","showcontrolsToggle","showSettingForm","isBorderEnabled","chkBorder","filter","jquery","src","autostart","repeat","aspectratio","controls","playerInstance","posterHref","setup","flashplayer","html5player","androidhls","playlist","image","sources","file","primary","onReady","load","play","jQuery"],"mappings":"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","file":"keditor-component-video-0.0.0.min.js","sourcesContent":["/**\r\n * KEditor Video Component\r\n * @copyright: Kademi (http://kademi.co)\r\n * @author: Kademi (http://kademi.co)\r\n * @version: @{version}\r\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\r\n */\r\n(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['video'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"video\" component', component);\r\n            \r\n            var self = this;\r\n            \r\n            var img = component.find('img[data-video-src]');\r\n            img.attr('id', keditor.generateId('component-video'));\r\n            \r\n            var wrapper = img.parent();\r\n            if (!wrapper.hasClass('video-wrapper')) {\r\n                img.wrap('<div class=\"video-wrapper\"></div>');\r\n                wrapper = img.parent();\r\n            }\r\n            \r\n            wrapper.attr('data-id', img.attr('id'));\r\n            wrapper.attr('data-autostart', img.attr('data-autostart'));\r\n            wrapper.attr('data-aspectratio', img.attr('data-aspectratio'));\r\n            wrapper.attr('data-video-src', img.attr('data-video-src'));\r\n            wrapper.attr('data-repeat', img.attr('data-repeat'));\r\n            wrapper.attr('data-controls', img.attr('data-controls'));\r\n            \r\n            $.getScriptOnce('/static/jwplayer/6.10/jwplayer.js', function () {\r\n                jwplayer.key = 'cXefLoB9RQlBo/XvVncatU90OaeJMXMOY/lamKrzOi0=';\r\n                self.buildJWVideoPlayerPreview(component);\r\n            });\r\n        },\r\n        \r\n        getContent: function (component) {\r\n            flog('getContent \"video\" component, component');\r\n            \r\n            var wrapper = component.find('.video-wrapper');\r\n            var html = '<img class=\"video-jw\" ';\r\n            html += '       id=\"' + this.componentId + '\" ';\r\n            html += '       src=\"' + wrapper.attr('data-video-src') + '/alt-640-360.png\" ';\r\n            html += '       data-autostart=\"' + wrapper.attr('data-autostart') + '\" ';\r\n            html += '       data-aspectratio=\"' + wrapper.attr('data-aspectratio') + '\" ';\r\n            html += '       data-video-src=\"' + wrapper.attr('data-video-src') + '\" ';\r\n            html += '       data-repeat=\"' + wrapper.attr('data-repeat') + '\" ';\r\n            html += '       data-controls=\"' + wrapper.attr('data-controls') + '\" />';\r\n            wrapper.html(html);\r\n            \r\n            return component.find('.keditor-component-content').html();\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Video Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"video\" settings', form);\r\n            var self = this;\r\n            \r\n            return $.ajax({\r\n                url: '/static/keditor/componentVideoSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                    \r\n                    var selectPicker = form.find('.select-border-style');\r\n                    selectPicker.selectpicker().on('changed.bs.select', function () {\r\n                        self.borderStyle = this.value;\r\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-style', this.value);\r\n                    });\r\n                    \r\n                    var txtBorderWidth = form.find('.border-width');\r\n                    txtBorderWidth.on('change', function () {\r\n                        var width = this.value;\r\n                        if (isNaN(width) || width < 0) {\r\n                            width = 1;\r\n                            this.value = width;\r\n                        }\r\n                        \r\n                        self.borderWidth = width;\r\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-width', width);\r\n                    });\r\n                    \r\n                    var colorPicker = form.find('.color-picker');\r\n                    var input = colorPicker.find('input');\r\n                    var previewer = colorPicker.find('.input-group-addon i');\r\n                    colorPicker.colorpicker({\r\n                        format: 'hex',\r\n                        container: colorPicker.parent(),\r\n                        component: '.input-group-addon',\r\n                        align: 'left',\r\n                        colorSelectors: {\r\n                            'transparent': 'transparent'\r\n                        }\r\n                    }).on('changeColor.colorpicker', function (e) {\r\n                        var colorHex = e.color.toHex();\r\n                        \r\n                        if (!input.val() || input.val().trim().length === 0) {\r\n                            colorHex = '';\r\n                            previewer.css('background-color', '');\r\n                        }\r\n                        \r\n                        self.borderColor = colorHex;\r\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-color', colorHex);\r\n                    });\r\n                    \r\n                    form.find('.chk-border').on('click', function () {\r\n                        selectPicker.prop('disabled', !this.checked).selectpicker('refresh');\r\n                        txtBorderWidth.prop('disabled', !this.checked);\r\n                        colorPicker.colorpicker(this.checked ? 'enable' : 'disable');\r\n                        \r\n                        if (!this.checked) {\r\n                            keditor.getSettingComponent().find('.video-wrapper').css('border', '');\r\n                            selectPicker.selectpicker('val', '');\r\n                            txtBorderWidth.val('');\r\n                            colorPicker.colorpicker('setValue', 'transparent');\r\n                        }\r\n                    });\r\n                    \r\n                    var btnVideoFileInput = form.find('.btn-videoFileInput');\r\n                    btnVideoFileInput.mselect({\r\n                        contentTypes: ['video'],\r\n                        bs3Modal: true,\r\n                        pagePath: window.location.pathname.replace('contenteditor', ''),\r\n                        onSelectFile: function (url) {\r\n                            keditor.getSettingComponent().find('.video-wrapper').attr('data-video-src', url);\r\n                            self.refreshVideoPlayerPreview(keditor);\r\n                        }\r\n                    });\r\n                    \r\n                    var autoplayToggle = form.find('#video-autoplay');\r\n                    autoplayToggle.on('click', function () {\r\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-autostart', this.checked);\r\n                        self.buildJWVideoPlayerPreview(keditor);\r\n                    });\r\n                    \r\n                    var loopToggle = form.find('#video-loop');\r\n                    loopToggle.on('click', function () {\r\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-repeat', this.checked);\r\n                        self.buildJWVideoPlayerPreview(keditor);\r\n                    });\r\n                    \r\n                    var ratio = form.find('.video-ratio');\r\n                    ratio.on('click', function (e) {\r\n                        if (this.checked) {\r\n                            keditor.getSettingComponent().find('.video-wrapper').attr('data-aspectratio', this.value);\r\n                            self.buildJWVideoPlayerPreview(keditor);\r\n                        }\r\n                    });\r\n                    \r\n                    var showcontrolsToggle = form.find('#video-showcontrols');\r\n                    showcontrolsToggle.on('click', function (e) {\r\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-controls', this.checked);\r\n                        self.buildJWVideoPlayerPreview(keditor);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"video\" component', form, component);\r\n            \r\n            var wrapper = component.find('.video-wrapper');\r\n            var borderWidth = wrapper.css('border-width') || '';\r\n            var isBorderEnabled = borderWidth !== '0px';\r\n            \r\n            var chkBorder = form.find('.chk-border');\r\n            var txtBorderWidth = form.find('.border-width');\r\n            var colorPicker = form.find('.color-picker');\r\n            var selectPicker = form.find('.select-border-style');\r\n            \r\n            chkBorder.prop('checked', isBorderEnabled);\r\n            selectPicker.prop('disabled', !isBorderEnabled).selectpicker('refresh').selectpicker('val', wrapper.css('border-style'));\r\n            txtBorderWidth.prop('disabled', !isBorderEnabled).val(isBorderEnabled ? borderWidth.replace('px', '') : '');\r\n            colorPicker.colorpicker(isBorderEnabled ? 'enable' : 'disable').colorpicker('setValue', isBorderEnabled ? wrapper.css('border-color') : '');\r\n            \r\n            form.find('#video-autoplay').prop('checked', wrapper.attr('data-autostart') === 'true');\r\n            form.find('#video-loop').prop('checked', wrapper.attr('data-repeat') === 'true');\r\n            form.find('.video-ratio').filter('[value=\"' + wrapper.attr('data-aspectratio') + '\"]').prop('checked', true);\r\n            form.find('#video-showcontrols').prop('checked', wrapper.attr('data-controls') === 'true');\r\n        },\r\n        \r\n        buildJWVideoPlayerPreview: function (component) {\r\n            if (!component.jquery) {\r\n                component = component.getSettingComponent();\r\n            }\r\n            var wrapper = component.find('.video-wrapper');\r\n            var src = wrapper.attr('data-video-src');\r\n            var autostart = wrapper.attr('data-autostart');\r\n            var repeat = wrapper.attr('data-repeat');\r\n            var aspectratio = wrapper.attr('data-aspectratio');\r\n            var controls = wrapper.attr('data-controls');\r\n            var playerInstance = jwplayer(wrapper.attr('data-id'));\r\n            var posterHref = src + '/alt-640-360.png';\r\n            \r\n            flog(\"buildJWPlayer\", src, \"aspectratio=\", aspectratio);\r\n            playerInstance.setup({\r\n                autostart: autostart,\r\n                repeat: repeat,\r\n                controls: controls,\r\n                aspectratio: aspectratio,\r\n                flashplayer: \"/static/jwplayer/6.10/jwplayer.flash.swf\",\r\n                html5player: \"/static/jwplayer/6.10/jwplayer.html5.js\",\r\n                width: \"100%\",\r\n                androidhls: true, //enable hls on android 4.1+\r\n                playlist: [{\r\n                    image: posterHref,\r\n                    sources: [{\r\n                        file: src\r\n                    }\r\n                        , {\r\n                            file: src + \"/../alt-640-360.webm\"\r\n                        }, {\r\n                            file: src + \"/../alt-640-360.m4v\"\r\n                        }]\r\n                }]\r\n                , primary: \"flash\"\r\n            });\r\n            \r\n            playerInstance.onReady(function () {\r\n                flog('jwplayer preview init done');\r\n            });\r\n        },\r\n        \r\n        refreshVideoPlayerPreview: function (keditor) {\r\n            var wrapper = keditor.getSettingComponent().find('.video-wrapper');\r\n            var playerInstance = jwplayer(wrapper.attr('data-id'));\r\n            var src = wrapper.attr('data-video-src');\r\n            \r\n            playerInstance.load([{\r\n                file: src\r\n            }]);\r\n            playerInstance.play();\r\n        }\r\n    };\r\n})(jQuery);\r\n"]}