{"version":3,"sources":["keditor-component-video-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","self","this","img","find","attr","generateId","wrapper","parent","hasClass","wrap","getScriptOnce","jwplayer","key","buildJWVideoPlayerPreview","getContent","html","componentId","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","selectPicker","on","borderStyle","value","getSettingComponent","css","txtBorderWidth","width","isNaN","borderWidth","colorPicker","input","previewer","colorpicker","format","align","colorSelectors","transparent","e","colorHex","color","toHex","val","trim","length","borderColor","prop","checked","selectpicker","btnVideoFileInput","mselect","contentTypes","bs3Modal","pagePath","options","basePath","onSelectFile","refreshVideoPlayerPreview","autoplayToggle","loopToggle","ratio","showcontrolsToggle","showSettingForm","isBorderEnabled","chkBorder","replace","filter","jquery","src","autostart","repeat","aspectratio","controls","playerInstance","posterHref","setup","flashplayer","html5player","androidhls","playlist","image","sources","file","primary","onReady","load","play","jQuery"],"mappings":"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","file":"keditor-component-video-0.0.0.min.js","sourcesContent":["/**\r\n * KEditor Video Component\r\n * @copyright: Kademi (http://kademi.co)\r\n * @author: Kademi (http://kademi.co)\r\n * @version: @{version}\r\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\r\n */\r\n(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['video'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"video\" component', component);\r\n            \r\n            var self = this;\r\n            \r\n            var img = component.find('img[data-video-src]');\r\n            img.attr('id', keditor.generateId('component-video'));\r\n            \r\n            var wrapper = img.parent();\r\n            if (!wrapper.hasClass('video-wrapper')) {\r\n                img.wrap('<div class=\"video-wrapper\"></div>');\r\n                wrapper = img.parent();\r\n            }\r\n            \r\n            wrapper.attr('data-id', img.attr('id'));\r\n            wrapper.attr('data-autostart', img.attr('data-autostart'));\r\n            wrapper.attr('data-aspectratio', img.attr('data-aspectratio'));\r\n            wrapper.attr('data-video-src', img.attr('data-video-src'));\r\n            wrapper.attr('data-repeat', img.attr('data-repeat'));\r\n            wrapper.attr('data-controls', img.attr('data-controls'));\r\n            \r\n            $.getScriptOnce('/static/jwplayer/6.10/jwplayer.js', function () {\r\n                jwplayer.key = 'cXefLoB9RQlBo/XvVncatU90OaeJMXMOY/lamKrzOi0=';\r\n                self.buildJWVideoPlayerPreview(component);\r\n            });\r\n        },\r\n        \r\n        getContent: function (component) {\r\n            flog('getContent \"video\" component, component');\r\n            \r\n            var wrapper = component.find('.video-wrapper');\r\n            var html = '<img class=\"video-jw\" ';\r\n            html += '       id=\"' + this.componentId + '\" ';\r\n            html += '       src=\"' + wrapper.attr('data-video-src') + '/alt-640-360.png\" ';\r\n            html += '       data-autostart=\"' + wrapper.attr('data-autostart') + '\" ';\r\n            html += '       data-aspectratio=\"' + wrapper.attr('data-aspectratio') + '\" ';\r\n            html += '       data-video-src=\"' + wrapper.attr('data-video-src') + '\" ';\r\n            html += '       data-repeat=\"' + wrapper.attr('data-repeat') + '\" ';\r\n            html += '       data-controls=\"' + wrapper.attr('data-controls') + '\" />';\r\n            wrapper.html(html);\r\n            \r\n            return component.find('.keditor-component-content').html();\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Video Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"video\" settings', form);\r\n            var self = this;\r\n            \r\n            return $.ajax({\r\n                url: '/static/keditor/componentVideoSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                    \r\n                    var selectPicker = form.find('.select-border-style');\r\n                    selectPicker.on('change', function () {\r\n                        self.borderStyle = this.value;\r\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-style', this.value);\r\n                    });\r\n                    \r\n                    var txtBorderWidth = form.find('.border-width');\r\n                    txtBorderWidth.on('change', function () {\r\n                        var width = this.value;\r\n                        if (isNaN(width) || width < 0) {\r\n                            width = 1;\r\n                            this.value = width;\r\n                        }\r\n                        \r\n                        self.borderWidth = width;\r\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-width', width);\r\n                    });\r\n                    \r\n                    var colorPicker = form.find('.color-picker');\r\n                    var input = colorPicker.find('input');\r\n                    var previewer = colorPicker.find('.input-group-addon i');\r\n                    colorPicker.colorpicker({\r\n                        format: 'hex',\r\n                        container: colorPicker.parent(),\r\n                        component: '.input-group-addon',\r\n                        align: 'left',\r\n                        colorSelectors: {\r\n                            'transparent': 'transparent'\r\n                        }\r\n                    }).on('changeColor.colorpicker', function (e) {\r\n                        var colorHex = e.color.toHex();\r\n                        \r\n                        if (!input.val() || input.val().trim().length === 0) {\r\n                            colorHex = '';\r\n                            previewer.css('background-color', '');\r\n                        }\r\n                        \r\n                        self.borderColor = colorHex;\r\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-color', colorHex);\r\n                    });\r\n                    \r\n                    form.find('.chk-border').on('click', function () {\r\n                        selectPicker.prop('disabled', !this.checked).selectpicker('refresh');\r\n                        txtBorderWidth.prop('disabled', !this.checked);\r\n                        colorPicker.colorpicker(this.checked ? 'enable' : 'disable');\r\n                        \r\n                        if (!this.checked) {\r\n                            keditor.getSettingComponent().find('.video-wrapper').css('border', '');\r\n                            selectPicker.selectpicker('val', '');\r\n                            txtBorderWidth.val('');\r\n                            colorPicker.colorpicker('setValue', 'transparent');\r\n                        }\r\n                    });\r\n                    \r\n                    var btnVideoFileInput = form.find('.btn-videoFileInput');\r\n                    btnVideoFileInput.mselect({\r\n                        contentTypes: ['video'],\r\n                        bs3Modal: true,\r\n                        pagePath: keditor.options.pagePath,\r\n                        basePath: keditor.options.basePath,\r\n                        onSelectFile: function (url) {\r\n                            keditor.getSettingComponent().find('.video-wrapper').attr('data-video-src', url);\r\n                            self.refreshVideoPlayerPreview(keditor);\r\n                        }\r\n                    });\r\n                    \r\n                    var autoplayToggle = form.find('#video-autoplay');\r\n                    autoplayToggle.on('click', function () {\r\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-autostart', this.checked);\r\n                        self.buildJWVideoPlayerPreview(keditor);\r\n                    });\r\n                    \r\n                    var loopToggle = form.find('#video-loop');\r\n                    loopToggle.on('click', function () {\r\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-repeat', this.checked);\r\n                        self.buildJWVideoPlayerPreview(keditor);\r\n                    });\r\n                    \r\n                    var ratio = form.find('.video-ratio');\r\n                    ratio.on('click', function (e) {\r\n                        if (this.checked) {\r\n                            keditor.getSettingComponent().find('.video-wrapper').attr('data-aspectratio', this.value);\r\n                            self.buildJWVideoPlayerPreview(keditor);\r\n                        }\r\n                    });\r\n                    \r\n                    var showcontrolsToggle = form.find('#video-showcontrols');\r\n                    showcontrolsToggle.on('click', function (e) {\r\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-controls', this.checked);\r\n                        self.buildJWVideoPlayerPreview(keditor);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"video\" component', form, component);\r\n            \r\n            var wrapper = component.find('.video-wrapper');\r\n            var borderWidth = wrapper.css('border-width') || '';\r\n            var isBorderEnabled = borderWidth !== '0px';\r\n            \r\n            var chkBorder = form.find('.chk-border');\r\n            var txtBorderWidth = form.find('.border-width');\r\n            var colorPicker = form.find('.color-picker');\r\n            var selectPicker = form.find('.select-border-style');\r\n            \r\n            chkBorder.prop('checked', isBorderEnabled);\r\n            selectPicker.prop('disabled', !isBorderEnabled).selectpicker('refresh').selectpicker('val', wrapper.css('border-style'));\r\n            txtBorderWidth.prop('disabled', !isBorderEnabled).val(isBorderEnabled ? borderWidth.replace('px', '') : '');\r\n            colorPicker.colorpicker(isBorderEnabled ? 'enable' : 'disable').colorpicker('setValue', isBorderEnabled ? wrapper.css('border-color') : '');\r\n            \r\n            form.find('#video-autoplay').prop('checked', wrapper.attr('data-autostart') === 'true');\r\n            form.find('#video-loop').prop('checked', wrapper.attr('data-repeat') === 'true');\r\n            form.find('.video-ratio').filter('[value=\"' + wrapper.attr('data-aspectratio') + '\"]').prop('checked', true);\r\n            form.find('#video-showcontrols').prop('checked', wrapper.attr('data-controls') === 'true');\r\n        },\r\n        \r\n        buildJWVideoPlayerPreview: function (component) {\r\n            if (!component.jquery) {\r\n                component = component.getSettingComponent();\r\n            }\r\n            var wrapper = component.find('.video-wrapper');\r\n            var src = wrapper.attr('data-video-src');\r\n            var autostart = wrapper.attr('data-autostart');\r\n            var repeat = wrapper.attr('data-repeat');\r\n            var aspectratio = wrapper.attr('data-aspectratio');\r\n            var controls = wrapper.attr('data-controls');\r\n            var playerInstance = jwplayer(wrapper.attr('data-id'));\r\n            var posterHref = src + '/alt-640-360.png';\r\n            \r\n            flog(\"buildJWPlayer\", src, \"aspectratio=\", aspectratio);\r\n            playerInstance.setup({\r\n                autostart: autostart,\r\n                repeat: repeat,\r\n                controls: controls,\r\n                aspectratio: aspectratio,\r\n                flashplayer: \"/static/jwplayer/6.10/jwplayer.flash.swf\",\r\n                html5player: \"/static/jwplayer/6.10/jwplayer.html5.js\",\r\n                width: \"100%\",\r\n                androidhls: true, //enable hls on android 4.1+\r\n                playlist: [{\r\n                    image: posterHref,\r\n                    sources: [{\r\n                        file: src\r\n                    }\r\n                        , {\r\n                            file: src + \"/../alt-640-360.webm\"\r\n                        }, {\r\n                            file: src + \"/../alt-640-360.m4v\"\r\n                        }]\r\n                }]\r\n                , primary: \"flash\"\r\n            });\r\n            \r\n            playerInstance.onReady(function () {\r\n                flog('jwplayer preview init done');\r\n            });\r\n        },\r\n        \r\n        refreshVideoPlayerPreview: function (keditor) {\r\n            var wrapper = keditor.getSettingComponent().find('.video-wrapper');\r\n            var playerInstance = jwplayer(wrapper.attr('data-id'));\r\n            var src = wrapper.attr('data-video-src');\r\n            \r\n            playerInstance.load([{\r\n                file: src\r\n            }]);\r\n            playerInstance.play();\r\n        }\r\n    };\r\n})(jQuery);\r\n"]}