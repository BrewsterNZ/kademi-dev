{"version":3,"sources":["keditor-component-video-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","self","this","img","find","attr","generateId","wrapper","parent","hasClass","wrap","getScriptOnce","jwplayer","key","buildJWVideoPlayerPreview","getContent","html","componentId","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","selectPicker","selectpicker","on","borderStyle","value","getSettingComponent","css","txtBorderWidth","width","isNaN","borderWidth","colorPicker","input","previewer","colorpicker","format","align","colorSelectors","transparent","e","colorHex","color","toHex","val","trim","length","borderColor","prop","checked","btnVideoFileInput","mselect","contentTypes","bs3Modal","pagePath","window","location","pathname","replace","onSelectFile","refreshVideoPlayerPreview","autoplayToggle","loopToggle","ratio","showcontrolsToggle","showSettingForm","isBorderEnabled","chkBorder","filter","jquery","src","autostart","repeat","aspectratio","controls","playerInstance","posterHref","setup","flashplayer","html5player","androidhls","playlist","image","sources","file","primary","onReady","load","play","jQuery"],"mappings":"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","file":"keditor-component-video-0.0.0.min.js","sourcesContent":["/**\n * KEditor Video Component\n * @copyright: Kademi (http://kademi.co)\n * @author: Kademi (http://kademi.co)\n * @version: @{version}\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\n */\n(function ($) {\n    var KEditor = $.keditor;\n    var flog = KEditor.log;\n    \n    KEditor.components['video'] = {\n        init: function (contentArea, container, component, keditor) {\n            flog('init \"video\" component', component);\n            \n            var self = this;\n            \n            var img = component.find('img[data-video-src]');\n            img.attr('id', keditor.generateId('component-video'));\n            \n            var wrapper = img.parent();\n            if (!wrapper.hasClass('video-wrapper')) {\n                img.wrap('<div class=\"video-wrapper\"></div>');\n                wrapper = img.parent();\n            }\n            \n            wrapper.attr('data-id', img.attr('id'));\n            wrapper.attr('data-autostart', img.attr('data-autostart'));\n            wrapper.attr('data-aspectratio', img.attr('data-aspectratio'));\n            wrapper.attr('data-video-src', img.attr('data-video-src'));\n            wrapper.attr('data-repeat', img.attr('data-repeat'));\n            wrapper.attr('data-controls', img.attr('data-controls'));\n            \n            $.getScriptOnce('/static/jwplayer/6.10/jwplayer.js', function () {\n                jwplayer.key = 'cXefLoB9RQlBo/XvVncatU90OaeJMXMOY/lamKrzOi0=';\n                self.buildJWVideoPlayerPreview(component);\n            });\n        },\n        \n        getContent: function (component) {\n            flog('getContent \"video\" component, component');\n            \n            var wrapper = component.find('.video-wrapper');\n            var html = '<img class=\"video-jw\" ';\n            html += '       id=\"' + this.componentId + '\" ';\n            html += '       src=\"' + wrapper.attr('data-video-src') + '/alt-640-360.png\" ';\n            html += '       data-autostart=\"' + wrapper.attr('data-autostart') + '\" ';\n            html += '       data-aspectratio=\"' + wrapper.attr('data-aspectratio') + '\" ';\n            html += '       data-video-src=\"' + wrapper.attr('data-video-src') + '\" ';\n            html += '       data-repeat=\"' + wrapper.attr('data-repeat') + '\" ';\n            html += '       data-controls=\"' + wrapper.attr('data-controls') + '\" />';\n            wrapper.html(html);\n            \n            return component.find('.keditor-component-content').html();\n        },\n        \n        settingEnabled: true,\n        \n        settingTitle: 'Video Settings',\n        \n        initSettingForm: function (form, keditor) {\n            flog('init \"video\" settings', form);\n            var self = this;\n            \n            return $.ajax({\n                url: '/static/keditor/componentVideoSettings.html',\n                type: 'get',\n                dataType: 'HTML',\n                success: function (resp) {\n                    form.html(resp);\n                    \n                    var selectPicker = form.find('.select-border-style');\n                    selectPicker.selectpicker().on('changed.bs.select', function () {\n                        self.borderStyle = this.value;\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-style', this.value);\n                    });\n                    \n                    var txtBorderWidth = form.find('.border-width');\n                    txtBorderWidth.on('change', function () {\n                        var width = this.value;\n                        if (isNaN(width) || width < 0) {\n                            width = 1;\n                            this.value = width;\n                        }\n                        \n                        self.borderWidth = width;\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-width', width);\n                    });\n                    \n                    var colorPicker = form.find('.color-picker');\n                    var input = colorPicker.find('input');\n                    var previewer = colorPicker.find('.input-group-addon i');\n                    colorPicker.colorpicker({\n                        format: 'hex',\n                        container: colorPicker.parent(),\n                        component: '.input-group-addon',\n                        align: 'left',\n                        colorSelectors: {\n                            'transparent': 'transparent'\n                        }\n                    }).on('changeColor.colorpicker', function (e) {\n                        var colorHex = e.color.toHex();\n                        \n                        if (!input.val() || input.val().trim().length === 0) {\n                            colorHex = '';\n                            previewer.css('background-color', '');\n                        }\n                        \n                        self.borderColor = colorHex;\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-color', colorHex);\n                    });\n                    \n                    form.find('.chk-border').on('click', function () {\n                        selectPicker.prop('disabled', !this.checked).selectpicker('refresh');\n                        txtBorderWidth.prop('disabled', !this.checked);\n                        colorPicker.colorpicker(this.checked ? 'enable' : 'disable');\n                        \n                        if (!this.checked) {\n                            keditor.getSettingComponent().find('.video-wrapper').css('border', '');\n                            selectPicker.selectpicker('val', '');\n                            txtBorderWidth.val('');\n                            colorPicker.colorpicker('setValue', 'transparent');\n                        }\n                    });\n                    \n                    var btnVideoFileInput = form.find('.btn-videoFileInput');\n                    btnVideoFileInput.mselect({\n                        contentTypes: ['video'],\n                        bs3Modal: true,\n                        pagePath: window.location.pathname.replace('contenteditor', ''),\n                        onSelectFile: function (url) {\n                            keditor.getSettingComponent().find('.video-wrapper').attr('data-video-src', url);\n                            self.refreshVideoPlayerPreview(keditor);\n                        }\n                    });\n                    \n                    var autoplayToggle = form.find('#video-autoplay');\n                    autoplayToggle.on('click', function () {\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-autostart', this.checked);\n                        self.buildJWVideoPlayerPreview(keditor);\n                    });\n                    \n                    var loopToggle = form.find('#video-loop');\n                    loopToggle.on('click', function () {\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-repeat', this.checked);\n                        self.buildJWVideoPlayerPreview(keditor);\n                    });\n                    \n                    var ratio = form.find('.video-ratio');\n                    ratio.on('click', function (e) {\n                        if (this.checked) {\n                            keditor.getSettingComponent().find('.video-wrapper').attr('data-aspectratio', this.value);\n                            self.buildJWVideoPlayerPreview(keditor);\n                        }\n                    });\n                    \n                    var showcontrolsToggle = form.find('#video-showcontrols');\n                    showcontrolsToggle.on('click', function (e) {\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-controls', this.checked);\n                        self.buildJWVideoPlayerPreview(keditor);\n                    });\n                }\n            });\n        },\n        \n        showSettingForm: function (form, component, keditor) {\n            flog('showSettingForm \"video\" component', form, component);\n            \n            var wrapper = component.find('.video-wrapper');\n            var borderWidth = wrapper.css('border-width') || '';\n            var isBorderEnabled = borderWidth !== '0px';\n            \n            var chkBorder = form.find('.chk-border');\n            var txtBorderWidth = form.find('.border-width');\n            var colorPicker = form.find('.color-picker');\n            var selectPicker = form.find('.select-border-style');\n            \n            chkBorder.prop('checked', isBorderEnabled);\n            selectPicker.prop('disabled', !isBorderEnabled).selectpicker('refresh').selectpicker('val', wrapper.css('border-style'));\n            txtBorderWidth.prop('disabled', !isBorderEnabled).val(isBorderEnabled ? borderWidth.replace('px', '') : '');\n            colorPicker.colorpicker(isBorderEnabled ? 'enable' : 'disable').colorpicker('setValue', isBorderEnabled ? wrapper.css('border-color') : '');\n            \n            form.find('#video-autoplay').prop('checked', wrapper.attr('data-autostart') === 'true');\n            form.find('#video-loop').prop('checked', wrapper.attr('data-repeat') === 'true');\n            form.find('.video-ratio').filter('[value=\"' + wrapper.attr('data-aspectratio') + '\"]').prop('checked', true);\n            form.find('#video-showcontrols').prop('checked', wrapper.attr('data-controls') === 'true');\n        },\n        \n        buildJWVideoPlayerPreview: function (component) {\n            if (!component.jquery) {\n                component = component.getSettingComponent();\n            }\n            var wrapper = component.find('.video-wrapper');\n            var src = wrapper.attr('data-video-src');\n            var autostart = wrapper.attr('data-autostart');\n            var repeat = wrapper.attr('data-repeat');\n            var aspectratio = wrapper.attr('data-aspectratio');\n            var controls = wrapper.attr('data-controls');\n            var playerInstance = jwplayer(wrapper.attr('data-id'));\n            var posterHref = src + '/alt-640-360.png';\n            \n            flog(\"buildJWPlayer\", src, \"aspectratio=\", aspectratio);\n            playerInstance.setup({\n                autostart: autostart,\n                repeat: repeat,\n                controls: controls,\n                aspectratio: aspectratio,\n                flashplayer: \"/static/jwplayer/6.10/jwplayer.flash.swf\",\n                html5player: \"/static/jwplayer/6.10/jwplayer.html5.js\",\n                width: \"100%\",\n                androidhls: true, //enable hls on android 4.1+\n                playlist: [{\n                    image: posterHref,\n                    sources: [{\n                        file: src\n                    }\n                        , {\n                            file: src + \"/../alt-640-360.webm\"\n                        }, {\n                            file: src + \"/../alt-640-360.m4v\"\n                        }]\n                }]\n                , primary: \"flash\"\n            });\n            \n            playerInstance.onReady(function () {\n                flog('jwplayer preview init done');\n            });\n        },\n        \n        refreshVideoPlayerPreview: function (keditor) {\n            var wrapper = keditor.getSettingComponent().find('.video-wrapper');\n            var playerInstance = jwplayer(wrapper.attr('data-id'));\n            var src = wrapper.attr('data-video-src');\n            \n            playerInstance.load([{\n                file: src\n            }]);\n            playerInstance.play();\n        }\n    };\n})(jQuery);\n"],"sourceRoot":"/source/"}