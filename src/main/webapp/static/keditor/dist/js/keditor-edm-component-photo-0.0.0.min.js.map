{"version":3,"sources":["keditor-edm-component-photo-0.0.0.js"],"names":["$","KEditor","keditor","edmEditor","flog","log","components","init","contentArea","container","component","self","this","img","find","adjustWidthForImg","hasClass","options","onComponentReady","call","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","html","initDefaultComponentControls","onPaddingChanged","dataCss","value","getSettingComponent","txtLink","on","link","trim","pattern","RegExp","span","next","formGroup","closest","test","attr","hide","removeClass","show","addClass","cbbTarget","chkLinkable","is","prop","wrap","css","unwrap","photoEdit","mselect","contentTypes","bs3Modal","pagePath","basePath","onSelectFile","relativeUrl","fileType","hash","window","location","host","inputAlt","chkFullWidth","checked","cbbAlign","setStyles","showSettingForm","showDefaultComponentControls","val","a","parent","length","isFullWidth","load","realWidth","width","realHeight","height","ratio","wrapper","wrapperWidth","onWithChanged","jQuery"],"mappings":"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","file":"keditor-edm-component-photo-0.0.0.min.js","sourcesContent":["/**\n * KEditor Photo Component\n * @copyright: Kademi (http://kademi.co)\n * @author: Kademi (http://kademi.co)\n * @version: @{version}\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\n */\n(function ($) {\n    var KEditor = $.keditor;\n    var edmEditor = $.edmEditor;\n    var flog = KEditor.log;\n    \n    KEditor.components['photo'] = {\n        init: function (contentArea, container, component, keditor) {\n            flog('init \"photo\" component', component);\n            \n            var self = this;\n            var img = component.find('img');\n            self.adjustWidthForImg(img, img.hasClass('full-width'));\n            \n            var options = keditor.options;\n            if (typeof options.onComponentReady === 'function') {\n                options.onComponentReady.call(contentArea, component);\n            }\n        },\n        \n        settingEnabled: true,\n        \n        settingTitle: 'Photo Settings',\n        \n        initSettingForm: function (form, keditor) {\n            flog('init \"photo\" settings', form);\n            \n            var self = this;\n            return $.ajax({\n                url: '/static/keditor/edmComponentPhotoSettings.html',\n                type: 'get',\n                dataType: 'HTML',\n                success: function (resp) {\n                    form.html(resp);\n                    \n                    form = form.find('.form-horizontal');\n                    edmEditor.initDefaultComponentControls(form, keditor, {\n                        onPaddingChanged: function (dataCss, value) {\n                            if (dataCss === 'padding-left' || dataCss === 'padding-right') {\n                                var img = keditor.getSettingComponent().find('img');\n                                self.adjustWidthForImg(img, img.hasClass('full-width'));\n                            }\n                        }\n                    });\n                    \n                    var txtLink = form.find('#photo-link');\n                    txtLink.on('change', function () {\n                        var link = this.value.trim();\n                        var pattern = new RegExp('^[a-zA-Z0-9_/%:/./-]+$');\n                        var span = txtLink.next();\n                        var formGroup = txtLink.closest('.form-group');\n                        \n                        if (pattern.test(link)) {\n                            keditor.getSettingComponent().find('a').attr('href', link);\n                            span.hide();\n                            formGroup.removeClass('has-error');\n                        } else {\n                            span.show();\n                            formGroup.addClass('has-error');\n                        }\n                    });\n                    \n                    var cbbTarget = form.find('#photo-target');\n                    cbbTarget.on('change', function () {\n                        keditor.getSettingComponent().find('a').attr('target', this.value);\n                    });\n                    \n                    var chkLinkable = form.find('#photo-linkable');\n                    chkLinkable.on('click', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        \n                        if (chkLinkable.is(':checked')) {\n                            txtLink.prop('disabled', false);\n                            cbbTarget.prop('disabled', false);\n                            img.wrap('<a href=\"\" style=\"text-decoration: none;\"></a>');\n                            img.css('border', '0');\n                        } else {\n                            txtLink.prop('disabled', true);\n                            cbbTarget.prop('disabled', true);\n                            img.unwrap('a');\n                        }\n                    });\n                    \n                    var photoEdit = form.find('#photo-edit');\n                    photoEdit.mselect({\n                        contentTypes: ['image'],\n                        bs3Modal: true,\n                        pagePath: keditor.options.pagePath,\n                        basePath: keditor.options.basePath,\n                        onSelectFile: function (url, relativeUrl, fileType, hash) {\n                            var img = keditor.getSettingComponent().find('img');\n                            img.attr('src', \"http://\" + window.location.host + \"/_hashes/files/\" + hash);\n                            self.adjustWidthForImg(img, true);\n                        }\n                    });\n                    \n                    var inputAlt = form.find('#photo-alt');\n                    inputAlt.on('change', function () {\n                        keditor.getSettingComponent().find('img').attr('alt', this.value);\n                    });\n                    \n                    var chkFullWidth = form.find('#photo-fullwidth');\n                    chkFullWidth.on('click', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        img[this.checked ? 'addClass' : 'removeClass']('full-width');\n                        self.adjustWidthForImg(img, this.checked);\n                    });\n                    \n                    var cbbAlign = form.find('#photo-align');\n                    cbbAlign.on('change', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        img.attr('align', this.value);\n                        edmEditor.setStyles('margin-left', this.value === 'center' ? 'auto' : '', img);\n                        edmEditor.setStyles('margin-right', this.value === 'center' ? 'auto' : '', img);\n                    });\n                }\n            });\n        },\n        \n        showSettingForm: function (form, component, keditor) {\n            flog('showSettingForm \"photo\" component', component);\n            \n            edmEditor.showDefaultComponentControls(form, component, keditor);\n            \n            var img = component.find('img');\n            \n            var inputAlt = form.find('#photo-alt');\n            inputAlt.val(img.attr('alt') || '');\n            \n            var chkFullWidth = form.find('#photo-fullwidth');\n            chkFullWidth.prop('checked', img.hasClass('full-width'));\n            \n            var txtLink = form.find('#photo-link');\n            var cbbTarget = form.find('#photo-target');\n            var chkLinkable = form.find('#photo-linkable');\n            var cbbAlign = form.find('#photo-align');\n            \n            cbbAlign.val(img.attr('align') || 'left');\n            txtLink.next().hide();\n            txtLink.closest('.form-group').removeClass('has-error');\n            \n            var a = img.parent('a');\n            if (a.length > 0) {\n                chkLinkable.prop('checked', true);\n                txtLink.prop('disabled', false).val(a.attr('href'));\n                cbbTarget.prop('disabled', false).val(a.attr('target'));\n            } else {\n                chkLinkable.prop('checked', false);\n                txtLink.prop('disabled', true).val('');\n                cbbTarget.prop('disabled', true).val('');\n            }\n        },\n        \n        adjustWidthForImg: function (img, isFullWidth) {\n            flog('adjustWidthForImg', img, isFullWidth);\n            \n            img.css('display', 'none');\n            \n            $('<img />').attr('src', img.attr('src')).load(function () {\n                var realWidth = this.width;\n                var realHeight = this.height;\n                var ratio = realWidth / realHeight;\n                var wrapper = img.parent();\n                if (wrapper.is('a')) {\n                    wrapper = wrapper.parent();\n                }\n                var wrapperWidth = wrapper.width();\n                img.attr({\n                    width: isFullWidth ? wrapperWidth : realWidth,\n                    height: isFullWidth ? wrapperWidth / ratio : realHeight\n                });\n                img.css('display', 'block');\n            });\n        },\n        \n        onWithChanged: function (component, width, keditor) {\n            var self = this;\n            \n            var img = component.find('img');\n            self.adjustWidthForImg(img, img.hasClass('full-width'));\n        }\n    };\n    \n})(jQuery);\n"],"sourceRoot":"/source/"}