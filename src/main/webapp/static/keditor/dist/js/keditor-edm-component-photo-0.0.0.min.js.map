{"version":3,"sources":["keditor-edm-component-photo-0.0.0.js"],"names":["$","KEditor","keditor","edmEditor","flog","log","components","init","contentArea","container","component","self","this","img","find","adjustWidthForImg","hasClass","options","onComponentReady","call","settingEnabled","settingTitle","initSettingForm","form","append","txtLink","on","link","value","trim","pattern","RegExp","span","next","formGroup","closest","test","getSettingComponent","attr","hide","removeClass","show","addClass","cbbTarget","chkLinkable","is","prop","wrap","css","unwrap","photoEdit","mselect","contentTypes","bs3Modal","pagePath","basePath","onSelectFile","url","relativeUrl","fileType","hash","window","location","host","inputAlt","chkFullWidth","checked","initDefaultComponentControls","onPaddingChanged","dataCss","showSettingForm","showDefaultComponentControls","val","a","parent","length","isFullWidth","load","realWidth","width","realHeight","height","ratio","wrapper","wrapperWidth","onWithChanged","jQuery"],"mappings":"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","file":"keditor-edm-component-photo-0.0.0.min.js","sourcesContent":["/**\r\n * KEditor Photo Component\r\n * @copyright: Kademi (http://kademi.co)\r\n * @author: Kademi (http://kademi.co)\r\n * @version: @{version}\r\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\r\n */\r\n(function ($) {\r\n    var KEditor = $.keditor;\r\n    var edmEditor = $.edmEditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['photo'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"photo\" component', component);\r\n            \r\n            var self = this;\r\n            var img = component.find('img');\r\n            self.adjustWidthForImg(img, img.hasClass('full-width'));\r\n            \r\n            var options = keditor.options;\r\n            if (typeof options.onComponentReady === 'function') {\r\n                options.onComponentReady.call(contentArea, component);\r\n            }\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Photo Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('initSettingForm \"photo\" component');\r\n            \r\n            var self = this;\r\n            \r\n            form.append(\r\n                '<form class=\"form-horizontal\">' +\r\n                '   <div class=\"form-group photo-edit-wrapper\">' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <button type=\"button\" class=\"btn btn-block btn-primary\" id=\"photo-edit\">Change Photo</button>' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group photo-alt-wrapper\">' +\r\n                '       <label for=\"photo-alt\" class=\"col-sm-12\">Alt text</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <input type=\"text\" id=\"photo-alt\" class=\"form-control\" />' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-fullwidth\" class=\"col-sm-12\">Full width</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <input type=\"checkbox\" id=\"photo-fullwidth\" />' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-width\" class=\"col-sm-12\">Linkable</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <input type=\"checkbox\" id=\"photo-linkable\" />' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-height\" class=\"col-sm-12\">Link</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <input type=\"text\" id=\"photo-link\" class=\"form-control\" disabled=\"disabled\" />' +\r\n                '           <span class=\"help-block\" style=\"display: none;\">Link is invalid</span>' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '   <div class=\"form-group\">' +\r\n                '       <label for=\"photo-height\" class=\"col-sm-12\">Open link in</label>' +\r\n                '       <div class=\"col-sm-12\">' +\r\n                '           <select class=\"form-control\" id=\"photo-target\" disabled=\"disabled\">' +\r\n                '               <option value=\"\" selected=\"selected\">Current tab/window</option>' +\r\n                '               <option value=\"_blank\">New tab/window</option>' +\r\n                '           </select>' +\r\n                '       </div>' +\r\n                '   </div>' +\r\n                '</form>'\r\n            );\r\n            \r\n            var txtLink = form.find('#photo-link');\r\n            txtLink.on('change', function () {\r\n                var link = this.value.trim();\r\n                var pattern = new RegExp('^[a-zA-Z0-9_/%:/./-]+$');\r\n                var span = txtLink.next();\r\n                var formGroup = txtLink.closest('.form-group');\r\n                \r\n                if (pattern.test(link)) {\r\n                    keditor.getSettingComponent().find('a').attr('href', link);\r\n                    span.hide();\r\n                    formGroup.removeClass('has-error');\r\n                } else {\r\n                    span.show();\r\n                    formGroup.addClass('has-error');\r\n                }\r\n            });\r\n            \r\n            var cbbTarget = form.find('#photo-target');\r\n            cbbTarget.on('change', function () {\r\n                keditor.getSettingComponent().find('a').attr('target', this.value);\r\n            });\r\n            \r\n            var chkLinkable = form.find('#photo-linkable');\r\n            chkLinkable.on('click', function () {\r\n                var img = keditor.getSettingComponent().find('img');\r\n                \r\n                if (chkLinkable.is(':checked')) {\r\n                    txtLink.prop('disabled', false);\r\n                    cbbTarget.prop('disabled', false);\r\n                    img.wrap('<a href=\"\" style=\"text-decoration: none;\"></a>');\r\n                    img.css('border', '0');\r\n                } else {\r\n                    txtLink.prop('disabled', true);\r\n                    cbbTarget.prop('disabled', true);\r\n                    img.unwrap('a');\r\n                }\r\n            });\r\n            \r\n            var photoEdit = form.find('#photo-edit');\r\n            photoEdit.mselect({\r\n                contentTypes: ['image'],\r\n                bs3Modal: true,\r\n                pagePath: keditor.options.pagePath,\r\n                basePath: keditor.options.basePath,\r\n                onSelectFile: function (url, relativeUrl, fileType, hash) {\r\n                    var img = keditor.getSettingComponent().find('img');\r\n                    img.attr('src', \"http://\" + window.location.host + \"/_hashes/files/\" + hash);\r\n                    self.adjustWidthForImg(img, true);\r\n                }\r\n            });\r\n            \r\n            var inputAlt = form.find('#photo-alt');\r\n            inputAlt.on('change', function () {\r\n                keditor.getSettingComponent().find('img').attr('alt', this.value);\r\n            });\r\n            \r\n            var chkFullWidth = form.find('#photo-fullwidth');\r\n            chkFullWidth.on('click', function () {\r\n                var img = keditor.getSettingComponent().find('img');\r\n                img[this.checked ? 'addClass' : 'removeClass']('full-width');\r\n                self.adjustWidthForImg(img, this.checked);\r\n            });\r\n            \r\n            form = form.find('form');\r\n            edmEditor.initDefaultComponentControls(form, keditor, {\r\n                onPaddingChanged: function (dataCss, value) {\r\n                    if (dataCss === 'padding-left' || dataCss === 'padding-right') {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        self.adjustWidthForImg(img, img.hasClass('full-width'));\r\n                    }\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"photo\" component', component);\r\n            \r\n            edmEditor.showDefaultComponentControls(form, component, keditor);\r\n            \r\n            var img = component.find('img');\r\n            \r\n            var inputAlt = form.find('#photo-alt');\r\n            inputAlt.val(img.attr('alt') || '');\r\n            \r\n            var chkFullWidth = form.find('#photo-fullwidth');\r\n            chkFullWidth.prop('checked', img.hasClass('full-width'));\r\n            \r\n            var txtLink = form.find('#photo-link');\r\n            var cbbTarget = form.find('#photo-target');\r\n            var chkLinkable = form.find('#photo-linkable');\r\n            \r\n            txtLink.next().hide();\r\n            txtLink.closest('.form-group').removeClass('has-error');\r\n            \r\n            var a = img.parent('a');\r\n            if (a.length > 0) {\r\n                chkLinkable.prop('checked', true);\r\n                txtLink.prop('disabled', false).val(a.attr('href'));\r\n                cbbTarget.prop('disabled', false).val(a.attr('target'));\r\n            } else {\r\n                chkLinkable.prop('checked', false);\r\n                txtLink.prop('disabled', true).val('');\r\n                cbbTarget.prop('disabled', true).val('');\r\n            }\r\n        },\r\n        \r\n        adjustWidthForImg: function (img, isFullWidth) {\r\n            flog('adjustWidthForImg', img, isFullWidth);\r\n    \r\n            img.css('display', 'none');\r\n            \r\n            $('<img />').attr('src', img.attr('src')).load(function () {\r\n                var realWidth = this.width;\r\n                var realHeight = this.height;\r\n                var ratio = realWidth / realHeight;\r\n                var wrapper = img.parent();\r\n                if (wrapper.is('a')) {\r\n                    wrapper = wrapper.parent();\r\n                }\r\n                var wrapperWidth = wrapper.width();\r\n                img.attr({\r\n                    width: isFullWidth ? wrapperWidth : realWidth,\r\n                    height: isFullWidth ? wrapperWidth / ratio : realHeight\r\n                });\r\n                img.css('display', 'block');\r\n            });\r\n        },\r\n        \r\n        onWithChanged: function (component, width, keditor) {\r\n            var self = this;\r\n            \r\n            var img = component.find('img');\r\n            self.adjustWidthForImg(img, img.hasClass('full-width'));\r\n        }\r\n    };\r\n    \r\n})(jQuery);\r\n"]}