{"version":3,"sources":["keditor-edm-component-photo-0.0.0.js"],"names":["$","KEditor","keditor","edmEditor","flog","log","components","init","contentArea","container","component","self","this","img","find","adjustWidthForImg","hasClass","options","onComponentReady","call","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","html","initDefaultComponentControls","onPaddingChanged","dataCss","value","getSettingComponent","txtLink","on","link","trim","pattern","RegExp","span","next","formGroup","closest","test","attr","hide","removeClass","show","addClass","cbbTarget","chkLinkable","is","prop","wrap","css","unwrap","photoEdit","mselect","contentTypes","bs3Modal","pagePath","basePath","onSelectFile","relativeUrl","fileType","hash","window","location","host","inputAlt","chkFullWidth","checked","showSettingForm","showDefaultComponentControls","val","a","parent","length","isFullWidth","load","realWidth","width","realHeight","height","ratio","wrapper","wrapperWidth","onWithChanged","jQuery"],"mappings":"CAOA,SAAWA,GACP,GAAIC,GAAUD,EAAEE,QACZC,EAAYH,EAAEG,UACdC,EAAOH,EAAQI,GAEnBJ,GAAQK,WAAkB,OACtBC,KAAM,SAAUC,EAAaC,EAAWC,EAAWR,GAC/CE,EAAK,yBAA0BM,EAE/B,IAAIC,GAAOC,KACPC,EAAMH,EAAUI,KAAK,MACzBH,GAAKI,kBAAkBF,EAAKA,EAAIG,SAAS,cAEzC,IAAIC,GAAUf,EAAQe,OACkB,mBAA7BA,GAAQC,kBACfD,EAAQC,iBAAiBC,KAAKX,EAAaE,IAInDU,gBAAgB,EAEhBC,aAAc,iBAEdC,gBAAiB,SAAUC,EAAMrB,GAC7BE,EAAK,wBAAyBmB,EAE9B,IAAIZ,GAAOC,IACX,OAAOZ,GAAEwB,MACLC,IAAK,iDACLC,KAAM,MACNC,SAAU,OACVC,QAAS,SAAUC,GACfN,EAAKO,KAAKD,GAEVN,EAAOA,EAAKT,KAAK,oBACjBX,EAAU4B,6BAA6BR,EAAMrB,GACzC8B,iBAAkB,SAAUC,EAASC,GACjC,GAAgB,iBAAZD,GAA0C,kBAAZA,EAA6B,CAC3D,GAAIpB,GAAMX,EAAQiC,sBAAsBrB,KAAK,MAC7CH,GAAKI,kBAAkBF,EAAKA,EAAIG,SAAS,kBAKrD,IAAIoB,GAAUb,EAAKT,KAAK,cACxBsB,GAAQC,GAAG,SAAU,WACjB,GAAIC,GAAO1B,KAAKsB,MAAMK,OAClBC,EAAU,GAAIC,QAAO,0BACrBC,EAAON,EAAQO,OACfC,EAAYR,EAAQS,QAAQ,cAE5BL,GAAQM,KAAKR,IACbpC,EAAQiC,sBAAsBrB,KAAK,KAAKiC,KAAK,OAAQT,GACrDI,EAAKM,OACLJ,EAAUK,YAAY,eAEtBP,EAAKQ,OACLN,EAAUO,SAAS,eAI3B,IAAIC,GAAY7B,EAAKT,KAAK,gBAC1BsC,GAAUf,GAAG,SAAU,WACnBnC,EAAQiC,sBAAsBrB,KAAK,KAAKiC,KAAK,SAAUnC,KAAKsB,QAGhE,IAAImB,GAAc9B,EAAKT,KAAK,kBAC5BuC,GAAYhB,GAAG,QAAS,WACpB,GAAIxB,GAAMX,EAAQiC,sBAAsBrB,KAAK,MAEzCuC,GAAYC,GAAG,aACflB,EAAQmB,KAAK,YAAY,GACzBH,EAAUG,KAAK,YAAY,GAC3B1C,EAAI2C,KAAK,kDACT3C,EAAI4C,IAAI,SAAU,OAElBrB,EAAQmB,KAAK,YAAY,GACzBH,EAAUG,KAAK,YAAY,GAC3B1C,EAAI6C,OAAO,OAInB,IAAIC,GAAYpC,EAAKT,KAAK,cAC1B6C,GAAUC,SACNC,cAAe,SACfC,UAAU,EACVC,SAAU7D,EAAQe,QAAQ8C,SAC1BC,SAAU9D,EAAQe,QAAQ+C,SAC1BC,aAAc,SAAUxC,EAAKyC,EAAaC,EAAUC,GAChD,GAAIvD,GAAMX,EAAQiC,sBAAsBrB,KAAK,MAC7CD,GAAIkC,KAAK,MAAO,UAAYsB,OAAOC,SAASC,KAAO,kBAAoBH,GACvEzD,EAAKI,kBAAkBF,GAAK,KAIpC,IAAI2D,GAAWjD,EAAKT,KAAK,aACzB0D,GAASnC,GAAG,SAAU,WAClBnC,EAAQiC,sBAAsBrB,KAAK,OAAOiC,KAAK,MAAOnC,KAAKsB,QAG/D,IAAIuC,GAAelD,EAAKT,KAAK,mBAC7B2D,GAAapC,GAAG,QAAS,WACrB,GAAIxB,GAAMX,EAAQiC,sBAAsBrB,KAAK,MAC7CD,GAAID,KAAK8D,QAAU,WAAa,eAAe,cAC/C/D,EAAKI,kBAAkBF,EAAKD,KAAK8D,eAMjDC,gBAAiB,SAAUpD,EAAMb,EAAWR,GACxCE,EAAK,oCAAqCM,GAE1CP,EAAUyE,6BAA6BrD,EAAMb,EAAWR,EAExD,IAAIW,GAAMH,EAAUI,KAAK,OAErB0D,EAAWjD,EAAKT,KAAK,aACzB0D,GAASK,IAAIhE,EAAIkC,KAAK,QAAU,GAEhC,IAAI0B,GAAelD,EAAKT,KAAK,mBAC7B2D,GAAalB,KAAK,UAAW1C,EAAIG,SAAS,cAE1C,IAAIoB,GAAUb,EAAKT,KAAK,eACpBsC,EAAY7B,EAAKT,KAAK,iBACtBuC,EAAc9B,EAAKT,KAAK,kBAE5BsB,GAAQO,OAAOK,OACfZ,EAAQS,QAAQ,eAAeI,YAAY,YAE3C,IAAI6B,GAAIjE,EAAIkE,OAAO,IACfD,GAAEE,OAAS,GACX3B,EAAYE,KAAK,WAAW,GAC5BnB,EAAQmB,KAAK,YAAY,GAAOsB,IAAIC,EAAE/B,KAAK,SAC3CK,EAAUG,KAAK,YAAY,GAAOsB,IAAIC,EAAE/B,KAAK,aAE7CM,EAAYE,KAAK,WAAW,GAC5BnB,EAAQmB,KAAK,YAAY,GAAMsB,IAAI,IACnCzB,EAAUG,KAAK,YAAY,GAAMsB,IAAI,MAI7C9D,kBAAmB,SAAUF,EAAKoE,GAC9B7E,EAAK,oBAAqBS,EAAKoE,GAE/BpE,EAAI4C,IAAI,UAAW,QAEnBzD,EAAE,WAAW+C,KAAK,MAAOlC,EAAIkC,KAAK,QAAQmC,KAAK,WAC3C,GAAIC,GAAYvE,KAAKwE,MACjBC,EAAazE,KAAK0E,OAClBC,EAAQJ,EAAYE,EACpBG,EAAU3E,EAAIkE,QACdS,GAAQlC,GAAG,OACXkC,EAAUA,EAAQT,SAEtB,IAAIU,GAAeD,EAAQJ,OAC3BvE,GAAIkC,MACAqC,MAAOH,EAAcQ,EAAeN,EACpCG,OAAQL,EAAcQ,EAAeF,EAAQF,IAEjDxE,EAAI4C,IAAI,UAAW,YAI3BiC,cAAe,SAAUhF,EAAW0E,EAAOlF,GACvC,GAAIS,GAAOC,KAEPC,EAAMH,EAAUI,KAAK,MACzBH,GAAKI,kBAAkBF,EAAKA,EAAIG,SAAS,kBAIlD2E","file":"keditor-edm-component-photo-0.0.0.min.js","sourcesContent":["/**\r\n * KEditor Photo Component\r\n * @copyright: Kademi (http://kademi.co)\r\n * @author: Kademi (http://kademi.co)\r\n * @version: @{version}\r\n * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap, FontAwesome (optional)\r\n */\r\n(function ($) {\r\n    var KEditor = $.keditor;\r\n    var edmEditor = $.edmEditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['photo'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"photo\" component', component);\r\n            \r\n            var self = this;\r\n            var img = component.find('img');\r\n            self.adjustWidthForImg(img, img.hasClass('full-width'));\r\n            \r\n            var options = keditor.options;\r\n            if (typeof options.onComponentReady === 'function') {\r\n                options.onComponentReady.call(contentArea, component);\r\n            }\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Photo Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"photo\" settings', form);\r\n            \r\n            var self = this;\r\n            return $.ajax({\r\n                url: '/static/keditor/edmComponentPhotoSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                    \r\n                    form = form.find('.form-horizontal');\r\n                    edmEditor.initDefaultComponentControls(form, keditor, {\r\n                        onPaddingChanged: function (dataCss, value) {\r\n                            if (dataCss === 'padding-left' || dataCss === 'padding-right') {\r\n                                var img = keditor.getSettingComponent().find('img');\r\n                                self.adjustWidthForImg(img, img.hasClass('full-width'));\r\n                            }\r\n                        }\r\n                    });\r\n                    \r\n                    var txtLink = form.find('#photo-link');\r\n                    txtLink.on('change', function () {\r\n                        var link = this.value.trim();\r\n                        var pattern = new RegExp('^[a-zA-Z0-9_/%:/./-]+$');\r\n                        var span = txtLink.next();\r\n                        var formGroup = txtLink.closest('.form-group');\r\n                        \r\n                        if (pattern.test(link)) {\r\n                            keditor.getSettingComponent().find('a').attr('href', link);\r\n                            span.hide();\r\n                            formGroup.removeClass('has-error');\r\n                        } else {\r\n                            span.show();\r\n                            formGroup.addClass('has-error');\r\n                        }\r\n                    });\r\n                    \r\n                    var cbbTarget = form.find('#photo-target');\r\n                    cbbTarget.on('change', function () {\r\n                        keditor.getSettingComponent().find('a').attr('target', this.value);\r\n                    });\r\n                    \r\n                    var chkLinkable = form.find('#photo-linkable');\r\n                    chkLinkable.on('click', function () {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        \r\n                        if (chkLinkable.is(':checked')) {\r\n                            txtLink.prop('disabled', false);\r\n                            cbbTarget.prop('disabled', false);\r\n                            img.wrap('<a href=\"\" style=\"text-decoration: none;\"></a>');\r\n                            img.css('border', '0');\r\n                        } else {\r\n                            txtLink.prop('disabled', true);\r\n                            cbbTarget.prop('disabled', true);\r\n                            img.unwrap('a');\r\n                        }\r\n                    });\r\n                    \r\n                    var photoEdit = form.find('#photo-edit');\r\n                    photoEdit.mselect({\r\n                        contentTypes: ['image'],\r\n                        bs3Modal: true,\r\n                        pagePath: keditor.options.pagePath,\r\n                        basePath: keditor.options.basePath,\r\n                        onSelectFile: function (url, relativeUrl, fileType, hash) {\r\n                            var img = keditor.getSettingComponent().find('img');\r\n                            img.attr('src', \"http://\" + window.location.host + \"/_hashes/files/\" + hash);\r\n                            self.adjustWidthForImg(img, true);\r\n                        }\r\n                    });\r\n                    \r\n                    var inputAlt = form.find('#photo-alt');\r\n                    inputAlt.on('change', function () {\r\n                        keditor.getSettingComponent().find('img').attr('alt', this.value);\r\n                    });\r\n                    \r\n                    var chkFullWidth = form.find('#photo-fullwidth');\r\n                    chkFullWidth.on('click', function () {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        img[this.checked ? 'addClass' : 'removeClass']('full-width');\r\n                        self.adjustWidthForImg(img, this.checked);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"photo\" component', component);\r\n            \r\n            edmEditor.showDefaultComponentControls(form, component, keditor);\r\n            \r\n            var img = component.find('img');\r\n            \r\n            var inputAlt = form.find('#photo-alt');\r\n            inputAlt.val(img.attr('alt') || '');\r\n            \r\n            var chkFullWidth = form.find('#photo-fullwidth');\r\n            chkFullWidth.prop('checked', img.hasClass('full-width'));\r\n            \r\n            var txtLink = form.find('#photo-link');\r\n            var cbbTarget = form.find('#photo-target');\r\n            var chkLinkable = form.find('#photo-linkable');\r\n            \r\n            txtLink.next().hide();\r\n            txtLink.closest('.form-group').removeClass('has-error');\r\n            \r\n            var a = img.parent('a');\r\n            if (a.length > 0) {\r\n                chkLinkable.prop('checked', true);\r\n                txtLink.prop('disabled', false).val(a.attr('href'));\r\n                cbbTarget.prop('disabled', false).val(a.attr('target'));\r\n            } else {\r\n                chkLinkable.prop('checked', false);\r\n                txtLink.prop('disabled', true).val('');\r\n                cbbTarget.prop('disabled', true).val('');\r\n            }\r\n        },\r\n        \r\n        adjustWidthForImg: function (img, isFullWidth) {\r\n            flog('adjustWidthForImg', img, isFullWidth);\r\n            \r\n            img.css('display', 'none');\r\n            \r\n            $('<img />').attr('src', img.attr('src')).load(function () {\r\n                var realWidth = this.width;\r\n                var realHeight = this.height;\r\n                var ratio = realWidth / realHeight;\r\n                var wrapper = img.parent();\r\n                if (wrapper.is('a')) {\r\n                    wrapper = wrapper.parent();\r\n                }\r\n                var wrapperWidth = wrapper.width();\r\n                img.attr({\r\n                    width: isFullWidth ? wrapperWidth : realWidth,\r\n                    height: isFullWidth ? wrapperWidth / ratio : realHeight\r\n                });\r\n                img.css('display', 'block');\r\n            });\r\n        },\r\n        \r\n        onWithChanged: function (component, width, keditor) {\r\n            var self = this;\r\n            \r\n            var img = component.find('img');\r\n            self.adjustWidthForImg(img, img.hasClass('full-width'));\r\n        }\r\n    };\r\n    \r\n})(jQuery);\r\n"],"sourceRoot":"/source/"}