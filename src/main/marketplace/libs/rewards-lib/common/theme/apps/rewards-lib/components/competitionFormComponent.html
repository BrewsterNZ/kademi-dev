#set ($promotionPage = $page)
#if ($promotion && $promotion != "")
    #set ( $promotionPage = $rootFolder.find("/rewards").child("$promotion") )
    #set ( $promotionPage = $page.find("/rewards").child("$promotion") )
#end

#if (!$photosPerRow)
     #set ($photosPerRow = 3)
#end
#set ($photosPerRow = $formatter.toInteger( $photosPerRow ))

#set ($photoClass = "col-sm-4")
#if ($photosPerRow == 1)
    #set ($photoClass = "col-sm-12")
#elseif ($photosPerRow == 2)
    #set ($photoClass = "col-sm-6")
#elseif ($photosPerRow == 3)
    #set ($photoClass = "col-sm-4")
#elseif ($photosPerRow == 4)
    #set ($photoClass = "col-sm-3")
#end

#set ($uploadPath = $promotionPage.href + "uploads")

<div class="panel panel-default">
    <div class="panel-body competitionFormWrap">
        <div class="competitionForm">
            <div style="display: none" class="thankyou bg-success text-center">
                <h1><i class="fa fa-thumbs-o-up fa-3x"></i></h1>
                <h1>Good Work!</h1>
                <p>Your submission has been received.</p>
                #if( !$promotionPage.onePerRecipient )
                    <button class="go-again btn btn-lg btn-primary">Submit another</button>
                #end
            </div>
            #if( !$promotionPage.onePerRecipient || $promotionPage.entriesForUser.size() == 0 )
                <form class="entryForm" method="POST" action="$promotionPage.href">
                    <input type="hidden" name="entry" value="true" />
                    <div class="alert alert-danger pageMessage"></div>
                    
                    #if( $user )
                        <p class="lead">Submit as $user.formattedName</p>
                    #else
                        #if ($showFirstName == "true")
                        <div class="form-group">
                            <label class="control-label" for="firstName">First name</label>
                            <input type="text" name="firstName" id="firstName" class="required form-control" placeholder="Enter your first name" value="$!user.firstName" />
                        </div>
                        #end
                        #if ($showSurName == "true")
                        <div class="form-group">
                            <label class="control-label" for="surName">Surname</label>
                            <input type="text" name="surName" id="surName" class="form-control" placeholder="Enter your surname" value="$!user.surName" />
                        </div>
                        #end
                        #if ($showEmail == "true")
                        <div class="form-group">
                            <label class="control-label" for="email">Email</label>
                            <input type="text" name="email" id="email" class="required form-control" placeholder="Enter your email address" value="$!user.email" />
                        </div>
                        #end
                        #if ($showPhone == "true")
                        <div class="form-group">
                            <label class="control-label" for="phone">Phone</label>
                            <input type="text" name="phone" id="phone" class="form-control" placeholder="Enter your best contact number" value="$!user.phone" />
                        </div>
                        #end
                        
                        #if( $contactPage.hasOptins() )
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="checkbox">
                                        #foreach($optin in $contactPage.optins)
                                            <label class="col-sm-9" for="optins_${optin.optinGroup.name}">
                                                <input type="checkbox" name="optins" value="$optin.optinGroup.name" id="optins_${optin.optinGroup.name}" />
                                                $optin.message
                                            </label>
                                        #end
                                    </div>
                                </div>
                            </div>
                        #end
                        
                        #if( $contactPage.captchaApp )
                            <div class="form-group">
                                <div class="col-sm-9">
                                    #portlets("captcha")
                                </div>
                            </div>
                        #end
                    #end
                    
                    #if( $promotionPage.selectOrg )
                        <div class="form-group">
                            <label class="control-label" for="phone">Your Organisation</label>
                            <input type="text" name="relatedOrgTitle" class="relatedOrgTitlePromo form-control required" placeholder="Enter your organisation" value="" />
                            <input type="hidden" name="relatedOrg" />
                        </div>
                    #end
                    
                    #if( $promotionPage.selectProduct )
                        <div class="form-group">
                            <label class="control-label" for="phone">Product</label>
                            <input type="text" name="relatedProductSkuTitle" class="relatedProductSkuTitlePromo form-control required reset-on-resubmit" placeholder="Enter the product code" value="" />
                            <input type="hidden" class="reset-on-resubmit" name="relatedProductSku">
                        </div>
                    #end
                    
                    #if($promotionPage.userUploadEnabled )
                        <div class="entryFormItem uploadItem">
                            <h3>Photo Gallery</h3>
                            <div class="promotion-photos">
                                <div class="row">
                                    #if ($showUserPhoto != "false")
                                        #set ($userPhoto = "/static/images/photo_holder_squared.png")
                                        #if( $promotionPage.userAttachmentHash )
                                            #set ($userPhoto = "${uploadPath}/$promotionPage.userAttachmentHash/alt-640-640.png")
                                        #end
                                        <div class="$photoClass promotion-photo promotion-photo-user">
                                            <div class="viewUploaded promotion-photo-inner #if( !$promotionPage.userAttachmentHash ) noImage #end" style="background-image: url('$userPhoto')"></div>
                                            
                                            <div id="myPromotionUpload" data-url="${uploadPath}/"></div>
                                            <input type="hidden" class="reset-on-resubmit" name="userAttachmentHash" value="$!page.userAttachmentHash" />
                                        </div>
                                    #end
                                    #foreach($entry in $promotionPage.child("uploads").children)
                                        <div class="$photoClass promotion-photo"><a href="${uploadPath}/$entry.name/alt-600-400.png" class=" promotion-photo-inner" style="background-image: url('${uploadPath}/$entry.name/alt-150-150.png')"></a></div>
                                    #end
                                </div>
                            </div>
                        </div>
                    #end
                    
                    #if($promotionPage.quizEnabled )
                        <div class="entryFormItem quizItem viewQuiz" style='display: none'>$!page.quizHtml</div>
                    #end
                    
                    #if( $promotionPage.isEnterable() )
                        #if( $promotionPage.hasTerms )
                            <div class="form-group">
                                <label for="terms">
                                    <input id="terms" name="terms" required="true" class="required" type="checkbox" />
                                    Please check this box to confirm you have read our terms and conditions*
                                    <a href="terms" target="_blank"> Click here to view full terms and conditions. </a>
                                </label>
                            </div>
                        #end
                        <div class="text-right">
                            <button class="enter btn btn-primary" type="submit"><i class="fa fa-check"></i> Submit your
                                entry
                            </button>
                        </div>
                    #else
                        <i>Not enterable</i>
                    #end
                </form>
            #else
                <div class="entered">
                    <p class="lead">Thank you for entering!</p>
                    #if($promotionPage.userUploadEnabled )
                        <div class="entryFormItem uploadItem readOnly">
                            <h3>Photo Gallery</h3>
                            <ul class="photos clearfix">
                                <li class="first">
                                    <div class="viewUploaded">
                                        #if( $promotionPage.userAttachmentHash )
                                            <img src="uploads/$promotionPage.userAttachmentHash/alt-150-150.png" />
                                        #end
                                    </div>
                                    <strong>My photo</strong>
                                </li>
                                #foreach($entry in $promotionPage.child("uploads").children)
                                    <li>
                                        #if( $entry.rewardEntry.awardedTo != $user.thisUser )
                                            <a href="uploads/$entry.name/alt-600-400.png"><img src="uploads/$entry.name/alt-150-150.png" /></a>
                                        #end
                                    </li>
                                #end
                            </ul>
                        </div>
                    #end
                </div>
            #end
        </div>
    </div>
</div>