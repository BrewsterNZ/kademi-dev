<form id="cart-items" action="$page.href" method="post">
    <div id="itemsTable" class="panel panel-default">
        <div class="panel-heading">
            <div class="panel-title">
                <small>Order Summary</small>
            </div>
        </div>
        <div class="items-list">

            <div class="promo-codes-container form-group">
                <div class="input-group">
                    <input type="text" class="promo-codes form-control" name="promoCodes" value="$formatter.toCsv($applications.shoppingCart.userPromoCodes)" placeholder="Enter promotion codes" />
                    <span class="input-group-btn">
                        <button class="apply-promo-codes btn btn-success">Apply</button>
                    </span>
                </div>
            </div>

            #set($totalCost = 0)
            #set( $items = $formatter.sortByProperty( $page.shoppingCartItemBeans, "href" ) )
            
            #foreach($item in $items )
                <div class="row item-row">
                    <div class="col-sm-3 item-photo">
                        #set ($photo = "/theme/apps/ecommerce/img/no_photo.png")
                        #if( $item.itemPage.productImageHref )
                            #set ($photo = $item.itemPage.productImageHref)
                        #end
                        <div style="background-image: url($photo)"></div>
                    </div>
                    <div class="col-sm-3 item-title center-content">
                        <div>
                            $item.title
                            #foreach( $opt in $item.itemPage.optionTitles( $item.selectedParameterOptions ).entrySet() )
                                <br />
                                <small class="text-muted">
                                    $opt.key: $opt.value
                                </small>
                            #end
                        </div>
                    </div>
                    <div class="col-sm-3 item-quantity center-content">
                        #if( $item.itemPage )
                        <div class="input-group input-group-sm">
                        <span class="input-group-btn">
                            <button class="btn btn-default btn-decrease-quantity" type="button">-</button>
                        </span>
                        <input type="text" value="$item.quantity" name="quantity.${foreach.count}" class="form-control txt-quantity text-center" />
                        <span class="input-group-btn">
                            <button class="btn btn-default btn-increase-quantity" type="button">+</button>
                        </span>
                        </div>
                        #end
                        <input type="hidden" class="itemHref" name="item.${foreach.count}" value="$formatter.htmlAttEncode($item.href)" />
                    </div>
                    <div class="col-sm-2 item-price center-content">
                        <div>
                        <span class="lead">
                            #set ($subTotal = 0)
                            #set ($subTotal = $item.totalAmount)
                            $formatter.formatCurrency($subTotal) Pts
                        </span>
                        </div>
                    </div>
                    <div class="col-sm-1 item-action text-right center-content">
                        <div>
                            #if( $item.itemPage )
                            <a href="#" class="btn-remove-item"><i class="fa fa-times-circle fa-2x"></i></a>
                            #end
                        </div>
                    </div>
                </div>
                
                #set($totalCost = $totalCost + $subTotal)
            
                #if( $item.discountAmount )
                <div class="row item-row">
                    <div class="col-sm-3 item-photo">
                    </div>
                    <div class="col-sm-3 item-title center-content">
                        <div>
                            $item.discountReason
                        </div>
                    </div>
                    <div class="col-sm-3 item-quantity center-content">
                    </div>
                    <div class="col-sm-2 item-price center-content">
                        <div>
                        <span class="lead">
                            #set ($subTotal = 0)
                            #set ($subTotal = $item.discountAmount)
                            #set($totalCost = $totalCost + $subTotal)
                            $formatter.formatCurrency($subTotal) Pts
                        </span>
                        </div>
                    </div>
                    <div class="col-sm-1 item-action text-right center-content">
                    </div>
                </div>                                    
                #end
                
                
            #end
        </div>
        <div class="panel-footer cart-total">
            <div class="row">
                <div class="col-sm-6 col-sm-offset-6">
                    <span><strong>Total</strong></span>
                    <strong class="pull-right">$formatter.formatCurrency($totalCost) Pts</strong>
                </div>
            </div>
        </div>
    </div>
</form>