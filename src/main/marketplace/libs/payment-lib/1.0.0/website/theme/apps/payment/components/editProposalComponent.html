<div class="panel panel-default">
    <div class="panel-heading">
        <div class="panel-title">
            #if( $page.newProposal )
                Create new proposal
            #else
                <div class="dropdown proposal-status pull-right">
                    <button class="btn btn-success dropdown-toggle" type="button" data-toggle="dropdown">
                        Status
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a href="#CREATED">Created</a></li>
                        <li><a href="#ACCEPTED">Accepted</a></li>
                    </ul>
                </div>
                Edit proposal
            #end
        </div>
    </div>
    <div class="panel-body">
        <form method="post" action="$page.href" class="form-horizontal proposal-details-form">
            #if( $request.params.leadId )
                <input type="hidden" name="leadId" value="$request.params.leadId" />
            #end

            <div class="form-group">
                <label class="control-label col-sm-3">Customer</label>
                <div class="col-sm-5">
                    <input type="text" class="form-control proposal-customer" name="customer" value="$!page.customer.id" data-text="$!page.customer.formattedName" />
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-5 col-sm-offset-3">
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </div>
        </form>
    </div>
</div>

#if( !$page.newProposal )
<div class="panel panel-default">
    <div class="panel-heading">
        <div class="panel-title">
            <a class="btn btn-info btn-add-quote pull-right" href="#addQuoteModal" data-toggle="modal">Add a new quote</a>
            Quotes
        </div>
    </div>
    <div class="panel-body">
        <table id="quotesTable" class="table table-hover table-striped table-condensed">
            <thead>
                <tr>
                    <th></th>
                    <th>Status</th>
                    <th>Number</th>
                    <th>Title</th>
                    <th>Vendor</th>
                    <th>Customer</th>
                    <th>Sub Total</th>
                    <th>Tax</th>
                    <th>Total</th>
                    <th>Issue Date</th>
                    <th>Expire Date</th>
                    <th>Options</th>
                </tr>
            </thead>

            <tbody id="quoteTableBody">
                #foreach($v in $page.proposal.quotes)
                    <tr>
                        <td style="text-align: center;"><input name="quote-for-proposal" value="$v.name" type="checkbox" /></td>
                        <td title="$v.quoteState" class="text-center lead">
                            #if($v.quoteState == "New")
                                <i class="fa fa-pencil-square-o text-muted"></i>
                            #elseif($v.quoteState == "Accepted")
                                <i class="fa fa-check-circle text-success"></i>
                            #elseif($v.quoteState == "Invoiced")
                                <i class="fa fa-check-circle text-success"></i>
                            #else
                                <i class="fa fa-exclamation-circle text-danger"></i>
                            #end
                        </td>
                        <td><a href="#">$v.number</a></td>
                        <td>$v.title</td>
                        <td>$formatter.ifNull($v.vendor.formattedName, '-')</td>
                        <td>$formatter.ifNull($v.customer.formattedName, '-')</td>
                        <td>$v.subTotal</td>
                        <td>$v.tax</td>
                        <td>$v.total</td>
                        <td><abbr title="$formatter.formatDateISO8601($v.issuedDate)" class="timeago">$v.issuedDate</abbr></td>
                        #if ($v.expiryDate)
                            <td><abbr title="$formatter.formatDateISO8601($v.expiryDate)" class="timeago">$v.expiryDate</abbr></td>
                        #else
                            <td>-</td>
                        #end
                        <td class="action">
                            <div class="btn-group btn-group-sm">
                                <a href="$v.href" class="btn btn-sm btn-info" title="Edit page"><i class="fa fa-edit"></i> Edit</a>
                            </div>
                        </td>
                    </tr>
                #end
            </tbody>
        </table>
    </div>
</div>
#end

<div class="modal fade" id="addQuoteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Add new Quote</h4>
            </div>
            <div class="modal-body">
                <form id="add-quote-form" class="form-horizontal" method="POST" action="/quotes/">
                    <input type="hidden" name="proposalId" value="$page.proposal.id" />
                    <div class="form-group">
                        <label for="quoteNumber" class="col-sm-3 control-label">Quote Number</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control required" required="true" id="quoteNumber" name="number" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="quoteTitle" class="col-sm-3 control-label">Quote Title</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control required" required="true" id="quoteTitle" name="title" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="description" class="col-sm-3 control-label">Description</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" required="true" id="description" name="description" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="quoteExpiryDate" class="col-sm-3 control-label">Expiry Date</label>
                        <div class="col-sm-8">
                            <input type='text' class="form-control date required" id="quoteExpiryDate" name="expiryDate" style="cursor:pointer;" />
                        </div>
                    </div>
                    <input type="hidden" name="createQuoteFolder" value="true" />
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Close</button>
                <button id="add-quote-button" type="button" class="btn btn-sm btn-primary" data-type="form-submit">Create Quote</button>
            </div>
        </div>
    </div>
</div>


