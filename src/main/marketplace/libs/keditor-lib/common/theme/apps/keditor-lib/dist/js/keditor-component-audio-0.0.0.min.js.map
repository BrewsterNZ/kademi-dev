{"version":3,"sources":["keditor-component-audio-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","this","img","find","componentId","attr","generateId","parent","hasClass","wrap","src","width","autostart","buildJWAudioPlayerPreview","getContent","html","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","showSettingForm","instance","btnAudioFileInput","mselect","contentType","bs3Modal","pagePath","options","basePath","onSelectFile","getSettingComponent","refreshAudioPlayerPreview","autoplayToggle","prop","on","e","checked","audioWidth","val","value","resizeAudioPlayerPreview","playerInstance","jwplayer","setup","file","height","flashplayer","window","JWPLAYER_LIB_PATH_FLASH","html5player","JWPLAYER_LIB_PATH_HTML5","primary","onReady","load","play","resize","jQuery"],"mappings":"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","file":"keditor-component-audio-0.0.0.min.js","sourcesContent":["(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['audio'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"audio\" component', component);\r\n            \r\n            this.component = component;\r\n            var img = component.find('img[data-src]');\r\n            var componentId = '';\r\n            if (!img.attr('id')) {\r\n                componentId = keditor.generateId('component-audio');\r\n                img.attr('id', componentId);\r\n            } else {\r\n                componentId = img.attr('id');\r\n            }\r\n            if (!img.parent().hasClass('audio-wrapper')) {\r\n                img.wrap('<div class=\"audio-wrapper\"></div>');\r\n            }\r\n            this.src = img.attr('data-src');\r\n            this.width = img.attr('data-width');\r\n            this.autostart = img.attr('data-autostart') === 'true';\r\n            this.buildJWAudioPlayerPreview(componentId);\r\n        },\r\n        \r\n        getContent: function (component, keditor) {\r\n            flog('getContent \"audio\" component', component);\r\n            \r\n            var img = component.find('img[data-src]');\r\n            var componentId = img.attr('id');\r\n            \r\n            var html = '<img data-componentId=\"' + componentId + '\" src=\"/theme/apps/content/preview/audio.png\" data-autostart=\"' + this.autostart + '\" data-width=\"' + this.width + '\" data-src=\"' + this.src + '\" data-kaudio=\"' + this.src + '\" />';\r\n            return html;\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Audio settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"audio\" settings', form);\r\n            \r\n            return $.ajax({\r\n                url: '/theme/apps/keditor-lib/componentAudioSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"audio\" component', form, component);\r\n            \r\n            var instance = this;\r\n            var btnAudioFileInput = form.find('.btn-audioFileInput');\r\n            btnAudioFileInput.mselect({\r\n                contentType: 'audio',\r\n                bs3Modal: true,\r\n                pagePath: keditor.options.pagePath,\r\n                basePath: keditor.options.basePath,\r\n                onSelectFile: function (url) {\r\n                    instance.src = url;\r\n                    var component = keditor.getSettingComponent();\r\n                    var img = component.find('object');\r\n                    var componentId = img.attr('id');\r\n                    instance.componentId = componentId;\r\n                    instance.refreshAudioPlayerPreview();\r\n                }\r\n            });\r\n            \r\n\r\n            var autoplayToggle = form.find('#audio-autoplay');\r\n            if (this.autostart) {\r\n                autoplayToggle.prop('checked', true);\r\n            }\r\n            autoplayToggle.on('click', function (e) {\r\n                var component = keditor.getSettingComponent();\r\n                var img = component.find('object');\r\n                var componentId = img.attr('id');\r\n                instance.autostart = this.checked;\r\n                instance.buildJWAudioPlayerPreview(componentId);\r\n            });\r\n            \r\n            var audioWidth = form.find('#audio-width');\r\n            audioWidth.val(this.width);\r\n            audioWidth.on('change', function () {\r\n                var component = keditor.getSettingComponent();\r\n                var img = component.find('object');\r\n                var componentId = img.attr('id');\r\n                instance.componentId = componentId;\r\n                instance.width = this.value;\r\n                instance.resizeAudioPlayerPreview();\r\n            });\r\n        },\r\n        \r\n        buildJWAudioPlayerPreview: function (componentId) {\r\n            var width = this.width;\r\n            var src = this.src;\r\n            var autostart = this.autostart;\r\n            var playerInstance = jwplayer(componentId);\r\n            playerInstance.setup({\r\n                file: src,\r\n                width: width,\r\n                height: 30,\r\n                autostart: autostart,\r\n                flashplayer: window.JWPLAYER_LIB_PATH_FLASH,\r\n                html5player: window.JWPLAYER_LIB_PATH_HTML5,\r\n                primary: \"flash\"\r\n            });\r\n            playerInstance.onReady(function () {\r\n                log('jwplayer preview init done');\r\n            });\r\n        },\r\n        \r\n        refreshAudioPlayerPreview: function () {\r\n            var instance = this;\r\n            var playerInstance = jwplayer(instance.componentId);\r\n            var src = instance.src;\r\n            playerInstance.load([{\r\n                file: src\r\n            }]);\r\n            playerInstance.play();\r\n        },\r\n        \r\n        resizeAudioPlayerPreview: function () {\r\n            var instance = this;\r\n            var playerInstance = jwplayer(instance.componentId);\r\n            var width = instance.width;\r\n            \r\n            playerInstance.resize(width, 30);\r\n        }\r\n    };\r\n    \r\n})(jQuery);\r\n"]}