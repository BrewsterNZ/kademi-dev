{"version":3,"sources":["keditor-component-video-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","self","this","img","find","attr","generateId","wrapper","parent","hasClass","wrap","getScriptOnce","jwplayer","key","buildJWVideoPlayerPreview","getContent","html","componentId","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","selectPicker","on","borderStyle","value","getSettingComponent","css","txtBorderWidth","width","isNaN","borderWidth","colorPicker","contentEditor","initColorPicker","color","borderColor","prop","checked","val","btnVideoFileInput","mselect","contentTypes","bs3Modal","pagePath","options","basePath","onSelectFile","refreshVideoPlayerPreview","autoplayToggle","loopToggle","ratio","e","showcontrolsToggle","showSettingForm","isBorderEnabled","chkBorder","replace","colorpicker","filter","jquery","src","autostart","repeat","aspectratio","controls","playerInstance","posterHref","setup","flashplayer","html5player","androidhls","playlist","image","sources","file","primary","onReady","load","play","jQuery"],"mappings":"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","file":"keditor-component-video-0.0.0.min.js","sourcesContent":["(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['video'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"video\" component', component);\r\n            \r\n            var self = this;\r\n            \r\n            var img = component.find('img[data-video-src]');\r\n            img.attr('id', keditor.generateId('component-video'));\r\n            \r\n            var wrapper = img.parent();\r\n            if (!wrapper.hasClass('video-wrapper')) {\r\n                img.wrap('<div class=\"video-wrapper\"></div>');\r\n                wrapper = img.parent();\r\n            }\r\n            \r\n            wrapper.attr('data-id', img.attr('id'));\r\n            wrapper.attr('data-autostart', img.attr('data-autostart'));\r\n            wrapper.attr('data-aspectratio', img.attr('data-aspectratio'));\r\n            wrapper.attr('data-video-src', img.attr('data-video-src'));\r\n            wrapper.attr('data-repeat', img.attr('data-repeat'));\r\n            wrapper.attr('data-controls', img.attr('data-controls'));\r\n            \r\n            $.getScriptOnce('/static/jwplayer/6.10/jwplayer.js', function () {\r\n                jwplayer.key = 'cXefLoB9RQlBo/XvVncatU90OaeJMXMOY/lamKrzOi0=';\r\n                self.buildJWVideoPlayerPreview(component);\r\n            });\r\n        },\r\n        \r\n        getContent: function (component) {\r\n            flog('getContent \"video\" component, component');\r\n            \r\n            var wrapper = component.find('.video-wrapper');\r\n            var html = '<img class=\"video-jw\" ';\r\n            html += '       id=\"' + this.componentId + '\" ';\r\n            html += '       src=\"' + wrapper.attr('data-video-src') + '/alt-640-360.png\" ';\r\n            html += '       data-autostart=\"' + wrapper.attr('data-autostart') + '\" ';\r\n            html += '       data-aspectratio=\"' + wrapper.attr('data-aspectratio') + '\" ';\r\n            html += '       data-video-src=\"' + wrapper.attr('data-video-src') + '\" ';\r\n            html += '       data-repeat=\"' + wrapper.attr('data-repeat') + '\" ';\r\n            html += '       data-controls=\"' + wrapper.attr('data-controls') + '\" />';\r\n            wrapper.html(html);\r\n            \r\n            return component.find('.keditor-component-content').html();\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Video Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"video\" settings', form);\r\n            var self = this;\r\n            \r\n            return $.ajax({\r\n                url: '/theme/apps/keditor-lib/componentVideoSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                    \r\n                    var selectPicker = form.find('.select-border-style');\r\n                    selectPicker.on('change', function () {\r\n                        self.borderStyle = this.value;\r\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-style', this.value);\r\n                    });\r\n                    \r\n                    var txtBorderWidth = form.find('.border-width');\r\n                    txtBorderWidth.on('change', function () {\r\n                        var width = this.value;\r\n                        if (isNaN(width) || width < 0) {\r\n                            width = 1;\r\n                            this.value = width;\r\n                        }\r\n                        \r\n                        self.borderWidth = width;\r\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-width', width);\r\n                    });\r\n                    \r\n                    var colorPicker = form.find('.borderColor');\r\n                    $.contentEditor.initColorPicker(colorPicker, function (color) {\r\n                        self.borderColor = color;\r\n                        keditor.getSettingComponent().find('.video-wrapper').css('border-color', color);\r\n                    });\r\n                    \r\n                    form.find('.chk-border').on('click', function () {\r\n                        selectPicker.prop('disabled', !this.checked);\r\n                        txtBorderWidth.prop('disabled', !this.checked);\r\n                        colorPicker.prop('disabled', !this.checked);\r\n                        \r\n                        if (!this.checked) {\r\n                            keditor.getSettingComponent().find('.video-wrapper').css('border', '');\r\n                            selectPicker.val('');\r\n                            txtBorderWidth.val('');\r\n                            colorPicker.val('');\r\n                        }\r\n                    });\r\n                    \r\n                    var btnVideoFileInput = form.find('.btn-videoFileInput');\r\n                    btnVideoFileInput.mselect({\r\n                        contentTypes: ['video'],\r\n                        bs3Modal: true,\r\n                        pagePath: keditor.options.pagePath,\r\n                        basePath: keditor.options.basePath,\r\n                        onSelectFile: function (url) {\r\n                            keditor.getSettingComponent().find('.video-wrapper').attr('data-video-src', url);\r\n                            self.refreshVideoPlayerPreview(keditor);\r\n                        }\r\n                    });\r\n                    \r\n                    var autoplayToggle = form.find('#video-autoplay');\r\n                    autoplayToggle.on('click', function () {\r\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-autostart', this.checked);\r\n                        self.buildJWVideoPlayerPreview(keditor);\r\n                    });\r\n                    \r\n                    var loopToggle = form.find('#video-loop');\r\n                    loopToggle.on('click', function () {\r\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-repeat', this.checked);\r\n                        self.buildJWVideoPlayerPreview(keditor);\r\n                    });\r\n                    \r\n                    var ratio = form.find('.video-ratio');\r\n                    ratio.on('click', function (e) {\r\n                        if (this.checked) {\r\n                            keditor.getSettingComponent().find('.video-wrapper').attr('data-aspectratio', this.value);\r\n                            self.buildJWVideoPlayerPreview(keditor);\r\n                        }\r\n                    });\r\n                    \r\n                    var showcontrolsToggle = form.find('#video-showcontrols');\r\n                    showcontrolsToggle.on('click', function (e) {\r\n                        keditor.getSettingComponent().find('.video-wrapper').attr('data-controls', this.checked);\r\n                        self.buildJWVideoPlayerPreview(keditor);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"video\" component', form, component);\r\n            \r\n            var wrapper = component.find('.video-wrapper');\r\n            var borderWidth = wrapper.css('border-width') || '';\r\n            var isBorderEnabled = borderWidth !== '0px';\r\n            \r\n            var chkBorder = form.find('.chk-border');\r\n            var txtBorderWidth = form.find('.border-width');\r\n            var colorPicker = form.find('.color-picker');\r\n            var selectPicker = form.find('.select-border-style');\r\n            \r\n            chkBorder.prop('checked', isBorderEnabled);\r\n            selectPicker.prop('disabled', !isBorderEnabled).val(wrapper.css('border-style'));\r\n            txtBorderWidth.prop('disabled', !isBorderEnabled).val(isBorderEnabled ? borderWidth.replace('px', '') : '');\r\n            colorPicker.colorpicker(isBorderEnabled ? 'enable' : 'disable').colorpicker('setValue', isBorderEnabled ? wrapper.css('border-color') : '');\r\n            \r\n            form.find('#video-autoplay').prop('checked', wrapper.attr('data-autostart') === 'true');\r\n            form.find('#video-loop').prop('checked', wrapper.attr('data-repeat') === 'true');\r\n            form.find('.video-ratio').filter('[value=\"' + wrapper.attr('data-aspectratio') + '\"]').prop('checked', true);\r\n            form.find('#video-showcontrols').prop('checked', wrapper.attr('data-controls') === 'true');\r\n        },\r\n        \r\n        buildJWVideoPlayerPreview: function (component) {\r\n            if (!component.jquery) {\r\n                component = component.getSettingComponent();\r\n            }\r\n            var wrapper = component.find('.video-wrapper');\r\n            var src = wrapper.attr('data-video-src');\r\n            var autostart = wrapper.attr('data-autostart');\r\n            var repeat = wrapper.attr('data-repeat');\r\n            var aspectratio = wrapper.attr('data-aspectratio');\r\n            var controls = wrapper.attr('data-controls');\r\n            var playerInstance = jwplayer(wrapper.attr('data-id'));\r\n            var posterHref = src + '/alt-640-360.png';\r\n            \r\n            flog(\"buildJWPlayer\", src, \"aspectratio=\", aspectratio);\r\n            playerInstance.setup({\r\n                autostart: autostart,\r\n                repeat: repeat,\r\n                controls: controls,\r\n                aspectratio: aspectratio,\r\n                flashplayer: \"/static/jwplayer/6.10/jwplayer.flash.swf\",\r\n                html5player: \"/static/jwplayer/6.10/jwplayer.html5.js\",\r\n                width: \"100%\",\r\n                androidhls: true, //enable hls on android 4.1+\r\n                playlist: [{\r\n                    image: posterHref,\r\n                    sources: [{\r\n                        file: src\r\n                    }\r\n                        , {\r\n                            file: src + \"/../alt-640-360.webm\"\r\n                        }, {\r\n                            file: src + \"/../alt-640-360.m4v\"\r\n                        }]\r\n                }]\r\n                , primary: \"flash\"\r\n            });\r\n            \r\n            playerInstance.onReady(function () {\r\n                flog('jwplayer preview init done');\r\n            });\r\n        },\r\n        \r\n        refreshVideoPlayerPreview: function (keditor) {\r\n            var wrapper = keditor.getSettingComponent().find('.video-wrapper');\r\n            var playerInstance = jwplayer(wrapper.attr('data-id'));\r\n            var src = wrapper.attr('data-video-src');\r\n            \r\n            playerInstance.load([{\r\n                file: src\r\n            }]);\r\n            playerInstance.play();\r\n        }\r\n    };\r\n})(jQuery);\r\n"]}