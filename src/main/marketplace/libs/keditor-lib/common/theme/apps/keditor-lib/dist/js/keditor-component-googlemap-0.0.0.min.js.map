{"version":3,"sources":["keditor-component-googlemap-0.0.0.js"],"names":["$","window","KEditor","keditor","flog","log","components","init","contentArea","container","component","this","callWhenGoogleMapReady","initKGoogleMap","getContent","componentContent","children","find","remove","html","settingEnabled","settingTitle","initSettingForm","form","self","ajax","url","type","dataType","success","resp","getSettingComponent","initAutocomplete","mapTypes","on","hide","filter","value","show","iframe","kgooglemap","attr","makeGoogleMapFresh","src","length","alert","removeClass","addClass","callback","apiKey","google","maps","places","call","getScriptOnce","input","setTimeout","trigger","event","keyCode","e","map","data","showSettingForm","maptype","place","ratio","hasClass","prop","val","mapDiv","Map","zoom","mapTypeId","searchBox","SearchBox","addListener","setBounds","getBounds","markers","getPlaces","forEach","marker","setMap","bounds","LatLngBounds","geometry","console","icon","size","Size","origin","Point","anchor","scaledSize","push","Marker","title","name","position","location","viewport","union","extend","fitBounds","jQuery"],"mappings":"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","file":"keditor-component-googlemap-0.0.0.min.js","sourcesContent":["(function ($, window) {\n    var KEditor = $.keditor;\n    var flog = KEditor.log;\n    \n    KEditor.components['googlemap'] = {\n        init: function (contentArea, container, component, keditor) {\n            flog('init \"googlemap\" component', component);\n            \n            this.callWhenGoogleMapReady(function () {\n                initKGoogleMap(component);\n            });\n        },\n        \n        getContent: function (component, keditor) {\n            flog('getContent \"googlemap\" component', component);\n            \n            var componentContent = component.children('.keditor-component-content');\n            componentContent.find('.googlemap-cover').remove();\n            component.find('.kgooglemap').html('');\n            \n            return componentContent.html();\n        },\n        \n        settingEnabled: true,\n        \n        settingTitle: 'Google Map Settings',\n        \n        initSettingForm: function (form, keditor) {\n            flog('init \"googlemap\" settings', form);\n            var self = this;\n            \n            return $.ajax({\n                url: '/theme/apps/keditor-lib/componentGoogleMapSettings.html',\n                type: 'get',\n                dataType: 'HTML',\n                success: function (resp) {\n                    form.html(resp);\n                    \n                    self.callWhenGoogleMapReady(function () {\n                        var component = keditor.getSettingComponent();\n                        self.initAutocomplete(component, form);\n                    });\n                    \n                    var mapTypes = form.find('.map-type');\n                    form.find('.mapType').on('click', function () {\n                        mapTypes.hide().filter('.' + this.value).show();\n                        \n                        var component = keditor.getSettingComponent();\n                        var iframe = component.find('iframe');\n                        var kgooglemap = component.find('.kgooglemap');\n                        component.attr('data-maptype', this.value);\n                        \n                        iframe[this.value === 'manually' ? 'hide' : 'show']();\n                        kgooglemap[this.value === 'manually' ? 'show' : 'hide']();\n                        \n                        if (this.value === 'manually') {\n                            self.makeGoogleMapFresh(form, component);\n                        }\n                    });\n                    \n                    form.find('[name=mapEmbedCode]').on('change', function () {\n                        var iframe = $(this.value);\n                        var src = iframe.attr('src');\n                        if (iframe.length > 0 && src && src.length > 0) {\n                            keditor.getSettingComponent().find('.embed-responsive-item').attr('src', src);\n                        } else {\n                            alert('Your Google Map embed code is invalid!');\n                        }\n                    });\n                    \n                    form.find('[name=mapRatio]').on('click', function () {\n                        var component = keditor.getSettingComponent();\n                        \n                        component.find('.embed-responsive').removeClass('embed-responsive-4by3 embed-responsive-16by9').addClass('embed-responsive-' + this.value);\n                    });\n                }\n            });\n        },\n        \n        callWhenGoogleMapReady: function (callback) {\n            var self = this;\n            var apiKey = 'AIzaSyBUcuZxwpBXCPztG7ot-rITXJbycPuS7gs';\n            var url = 'https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&libraries=places';\n            \n            if (window.google && window.google.maps && google.maps.places) {\n                callback.call(self);\n            } else {\n                $.getScriptOnce(url, function () {\n                    callback.call(self);\n                });\n            }\n        },\n        \n        makeGoogleMapFresh: function (form, component) {\n            var input = form.find('[name=mapAddress]')[0];\n            \n            setTimeout(function () {\n                try {\n                    $(input).trigger('focus');\n                    // google.maps.event.trigger(input, 'focus');\n                    google.maps.event.trigger(input, 'keydown', {\n                        keyCode: 13\n                    });\n                } catch (e) {\n                    flog('===================', e);\n                }\n            }, 1000);\n            \n            var map = component.find('.kgooglemap').data('map');\n            setTimeout(function () {\n                google.maps.event.trigger(map, \"resize\");\n            }, 100);\n        },\n        \n        showSettingForm: function (form, component, keditor) {\n            var self = this;\n            \n            self.callWhenGoogleMapReady(function () {\n                var maptype = component.attr('data-maptype') || 'embed';\n                var place = component.attr('data-place');\n                \n                var ratio = component.find('.embed-responsive').hasClass('embed-responsive-16by9') ? '16by9' : '4by3';\n                form.find('.mapRatio[value=' + ratio + ']').prop('checked', true);\n                form.find('.mapType[value=' + maptype + ']').prop('checked', true);\n                \n                var src = component.find('iframe').attr('src');\n                var iframe = '<iframe class=\"embed-responsive-item\" src=\"' + src + '\"></iframe>';\n                if (!place) {\n                    place = 'Hanoi, Vietnam';\n                }\n                form.find('[name=mapAddress]').val(place);\n                form.find('[name=mapEmbedCode]').val(iframe);\n                \n                form.find('.map-type').hide().filter('.' + maptype).show();\n                \n                if (!component.find('.kgooglemap').data('map')) {\n                    self.initAutocomplete(component, form);\n                    \n                    if (maptype === 'manually') {\n                        self.makeGoogleMapFresh(form, component);\n                    }\n                } else {\n                    if (maptype === 'manually') {\n                        self.makeGoogleMapFresh(form, component);\n                    }\n                }\n            });\n        },\n        \n        initAutocomplete: function (component, form) {\n            if (component.find('.kgooglemap').data('map')) {\n                this.makeGoogleMapFresh(form, component);\n            } else {\n                var mapDiv = component.find('.kgooglemap')[0];\n                var map = new google.maps.Map(mapDiv, {\n                    zoom: 13,\n                    mapTypeId: 'roadmap'\n                });\n                \n                // Create the search box and link it to the UI element.\n                var input = form.find('[name=mapAddress]')[0];\n                var searchBox = new google.maps.places.SearchBox(input);\n                \n                // Bias the SearchBox results towards current map's viewport.\n                map.addListener('bounds_changed', function () {\n                    searchBox.setBounds(map.getBounds());\n                });\n                \n                var markers = [];\n                searchBox.addListener('places_changed', function () {\n                    var places = searchBox.getPlaces();\n                    \n                    if (places.length == 0) {\n                        return;\n                    }\n                    \n                    // Clear out the old markers.\n                    markers.forEach(function (marker) {\n                        marker.setMap(null);\n                    });\n                    markers = [];\n                    \n                    // For each place, get the icon, name and location.\n                    var bounds = new google.maps.LatLngBounds();\n                    places.forEach(function (place) {\n                        if (!place.geometry) {\n                            console.log(\"Returned place contains no geometry\");\n                            return;\n                        }\n                        \n                        var icon = {\n                            url: place.icon,\n                            size: new google.maps.Size(71, 71),\n                            origin: new google.maps.Point(0, 0),\n                            anchor: new google.maps.Point(17, 34),\n                            scaledSize: new google.maps.Size(25, 25)\n                        };\n                        \n                        // Create a marker for each place.\n                        markers.push(new google.maps.Marker({\n                            map: map,\n                            icon: icon,\n                            title: place.name,\n                            position: place.geometry.location\n                        }));\n                        \n                        if (place.geometry.viewport) {\n                            // Only geocodes have viewport.\n                            bounds.union(place.geometry.viewport);\n                        } else {\n                            bounds.extend(place.geometry.location);\n                        }\n                    });\n                    map.fitBounds(bounds);\n                    component.attr('data-place', input.value);\n                });\n                \n                component.find('.kgooglemap').data('map', map);\n            }\n        }\n    };\n    \n})(jQuery, window);\n"]}