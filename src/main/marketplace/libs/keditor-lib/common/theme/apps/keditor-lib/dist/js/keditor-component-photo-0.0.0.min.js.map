{"version":3,"sources":["keditor-component-photo-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","componentContent","children","img","find","css","attr","width","height","options","onComponentReady","call","settingEnabled","settingTitle","initSettingForm","form","self","this","ajax","url","type","dataType","success","resp","html","txtLink","on","link","value","trim","getSettingComponent","cbbTarget","chkLinkable","is","prop","wrap","unwrap","inputAlign","panel","inputVAlign","inputResponsive","checked","cbbStyle","val","removeClass","addClass","inputWidth","inputHeight","newWidth","newHeight","Math","round","ratio","initMSelectImage","relUrl","hash","src","load","showSettingForm","a","parent","length","align","valign","hasClass","jQuery"],"mappings":"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","file":"keditor-component-photo-0.0.0.min.js","sourcesContent":["(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['photo'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"photo\" component', component);\r\n            \r\n            var componentContent = component.children('.keditor-component-content');\r\n            var img = componentContent.find('img');\r\n            \r\n            img.css('display', 'inline-block');\r\n            if (!img.css('vertical-align')) {\r\n                img.css('vertical-align', 'middle');\r\n            }\r\n            \r\n            img.attr({\r\n                width: img.width(),\r\n                height: img.height()\r\n            }).css({\r\n                width: '',\r\n                height: ''\r\n            });\r\n            \r\n            var options = keditor.options;\r\n            if (typeof options.onComponentReady === 'function') {\r\n                options.onComponentReady.call(contentArea, component);\r\n            }\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Photo Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"photo\" settings', form, keditor);\r\n            \r\n            var self = this;\r\n            \r\n            return $.ajax({\r\n                url: '/theme/apps/keditor-lib/componentPhotoSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                    \r\n                    var txtLink = form.find('#photo-link');\r\n                    txtLink.on('change', function () {\r\n                        var link = this.value.trim();\r\n                        keditor.getSettingComponent().find('a').attr('href', link);\r\n                    });\r\n                    \r\n                    var cbbTarget = form.find('#photo-target');\r\n                    cbbTarget.on('change', function () {\r\n                        keditor.getSettingComponent().find('a').attr('target', this.value);\r\n                    });\r\n                    \r\n                    var chkLinkable = form.find('#photo-linkable');\r\n                    chkLinkable.on('click', function () {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        \r\n                        if (chkLinkable.is(':checked')) {\r\n                            txtLink.prop('disabled', false);\r\n                            cbbTarget.prop('disabled', false);\r\n                            img.wrap('<a href=\"\"></a>');\r\n                        } else {\r\n                            txtLink.prop('disabled', true);\r\n                            cbbTarget.prop('disabled', true);\r\n                            img.unwrap('a');\r\n                        }\r\n                    });\r\n                    \r\n                    var inputAlign = form.find('#photo-align');\r\n                    inputAlign.on('change', function () {\r\n                        var panel = keditor.getSettingComponent().find('.photo-panel');\r\n                        panel.css('text-align', this.value);\r\n                    });\r\n                    \r\n                    var inputVAlign = form.find('#v-align');\r\n                    inputVAlign.on('change', function () {\r\n                        var panel = keditor.getSettingComponent().find('.photo-panel').find('img');\r\n                        panel.css('vertical-align', this.value);\r\n                    });\r\n                    \r\n                    var inputResponsive = form.find('#photo-responsive');\r\n                    inputResponsive.on('click', function () {\r\n                        keditor.getSettingComponent().find('img')[this.checked ? 'addClass' : 'removeClass']('img-responsive');\r\n                    });\r\n                    \r\n                    var cbbStyle = form.find('#photo-style');\r\n                    cbbStyle.on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        var val = this.value;\r\n                        \r\n                        img.removeClass('img-rounded img-circle img-thumbnail');\r\n                        if (val) {\r\n                            img.addClass(val);\r\n                        }\r\n                    });\r\n                    \r\n                    var inputWidth = form.find('#photo-width');\r\n                    var inputHeight = form.find('#photo-height');\r\n                    inputWidth.on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        var newWidth = +this.value;\r\n                        var newHeight = Math.round(newWidth / self.ratio);\r\n                        \r\n                        if (newWidth <= 0) {\r\n                            newWidth = self.width;\r\n                            newHeight = self.height;\r\n                            this.value = newWidth;\r\n                        }\r\n                        \r\n                        img.attr({\r\n                            'width': newWidth,\r\n                            'height': newHeight\r\n                        });\r\n                        inputHeight.val(newHeight);\r\n                    });\r\n                    inputHeight.on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        var newHeight = +this.value;\r\n                        var newWidth = Math.round(newHeight * self.ratio);\r\n                        \r\n                        if (newHeight <= 0) {\r\n                            newWidth = self.width;\r\n                            newHeight = self.height;\r\n                            this.value = newHeight;\r\n                        }\r\n                        \r\n                        img.attr({\r\n                            'height': newHeight,\r\n                            'width': newWidth\r\n                        });\r\n                        inputWidth.val(newWidth);\r\n                    });\r\n                    \r\n                    initMSelectImage(form.find('#photo-edit'), keditor, function (url, relUrl, type, hash) {\r\n                        var img = keditor.getSettingComponent().find('img');\r\n                        var src = '/_hashes/files/' + hash;\r\n                        \r\n                        $('<img />').attr('src', src).load(function () {\r\n                            img.attr({\r\n                                width: this.width,\r\n                                height: this.height,\r\n                                src: src\r\n                            });\r\n                            self.ratio = this.width / this.height;\r\n                            self.width = this.width;\r\n                            self.height = this.height;\r\n                            inputWidth.val(this.width);\r\n                            inputHeight.val(this.height);\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"photo\" component', component);\r\n            \r\n            var self = this;\r\n            var inputAlign = form.find('#photo-align');\r\n            var inputVAlign = form.find('#v-align');\r\n            var inputResponsive = form.find('#photo-responsive');\r\n            var inputWidth = form.find('#photo-width');\r\n            var inputHeight = form.find('#photo-height');\r\n            var cbbStyle = form.find('#photo-style');\r\n            var txtLink = form.find('#photo-link');\r\n            var cbbTarget = form.find('#photo-target');\r\n            var chkLinkable = form.find('#photo-linkable');\r\n            \r\n            var panel = component.find('.photo-panel');\r\n            var img = panel.find('img');\r\n            \r\n            var a = img.parent('a');\r\n            if (a.length > 0) {\r\n                chkLinkable.prop('checked', true);\r\n                txtLink.prop('disabled', false).val(a.attr('href'));\r\n                cbbTarget.prop('disabled', false).val(a.attr('target'));\r\n            } else {\r\n                chkLinkable.prop('checked', false);\r\n                txtLink.prop('disabled', true).val('');\r\n                cbbTarget.prop('disabled', true).val('');\r\n            }\r\n            \r\n            var align = panel.css('text-align');\r\n            if (align !== 'right' || align !== 'center') {\r\n                align = 'left';\r\n            }\r\n            \r\n            var valign = img.css('vertical-align');\r\n            \r\n            if (img.hasClass('img-rounded')) {\r\n                cbbStyle.val('img-rounded');\r\n            } else if (img.hasClass('img-circle')) {\r\n                cbbStyle.val('img-circle');\r\n            } else if (img.hasClass('img-thumbnail')) {\r\n                cbbStyle.val('img-thumbnail');\r\n            } else {\r\n                cbbStyle.val('');\r\n            }\r\n            inputAlign.val(align);\r\n            inputVAlign.val(valign);\r\n            inputResponsive.prop('checked', img.hasClass('img-responsive'));\r\n            inputWidth.val(img.width());\r\n            inputHeight.val(img.height());\r\n            \r\n            $('<img />').attr('src', img.attr('src')).load(function () {\r\n                self.ratio = this.width / this.height;\r\n                self.width = this.width;\r\n                self.height = this.height;\r\n            });\r\n        }\r\n    };\r\n    \r\n})(jQuery);\r\n"]}