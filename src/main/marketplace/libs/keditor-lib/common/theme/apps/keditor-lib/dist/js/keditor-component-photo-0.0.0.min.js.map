{"version":3,"sources":["keditor-component-photo-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","componentContent","children","img","find","css","on","imgWidth","get","style","width","imgHeight","height","attr","options","onComponentReady","call","settingEnabled","settingTitle","initSettingForm","form","self","this","ajax","url","type","dataType","success","resp","html","txtLink","link","value","trim","getSettingComponent","cbbTarget","chkLinkable","is","prop","wrap","unwrap","inputAlign","panel","inputVAlign","inputResponsive","checked","cbbStyle","val","removeClass","addClass","inputWidth","inputHeight","newWidth","newHeight","Math","round","ratio","initMSelectImage","relUrl","hash","src","load","showSettingForm","a","parent","length","align","valign","hasClass","jQuery"],"mappings":"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","file":"keditor-component-photo-0.0.0.min.js","sourcesContent":["(function ($) {\n    var KEditor = $.keditor;\n    var flog = KEditor.log;\n    \n    KEditor.components['photo'] = {\n        init: function (contentArea, container, component, keditor) {\n            flog('init \"photo\" component', component);\n            \n            var componentContent = component.children('.keditor-component-content');\n            var img = componentContent.find('img');\n            \n            img.css('display', 'inline-block');\n            if (!img.css('vertical-align')) {\n                img.css('vertical-align', 'middle');\n            }\n            \n            img.on('load', function () {\n                var imgWidth = img.get(0).style.width;\n                var imgHeight = img.get(0).style.height;\n                \n                if (imgWidth && imgHeight) {\n                    img.attr({\n                        width: imgWidth,\n                        height: imgHeight\n                    }).css({\n                        width: '',\n                        height: ''\n                    });\n                }\n            });\n            \n            var options = keditor.options;\n            if (typeof options.onComponentReady === 'function') {\n                options.onComponentReady.call(contentArea, component);\n            }\n        },\n        \n        settingEnabled: true,\n        \n        settingTitle: 'Photo Settings',\n        \n        initSettingForm: function (form, keditor) {\n            flog('init \"photo\" settings', form, keditor);\n            \n            var self = this;\n            \n            return $.ajax({\n                url: '/theme/apps/keditor-lib/componentPhotoSettings.html',\n                type: 'get',\n                dataType: 'HTML',\n                success: function (resp) {\n                    form.html(resp);\n                    \n                    var txtLink = form.find('#photo-link');\n                    txtLink.on('change', function () {\n                        var link = this.value.trim();\n                        keditor.getSettingComponent().find('a').attr('href', link);\n                    });\n                    \n                    var cbbTarget = form.find('#photo-target');\n                    cbbTarget.on('change', function () {\n                        keditor.getSettingComponent().find('a').attr('target', this.value);\n                    });\n                    \n                    var chkLinkable = form.find('#photo-linkable');\n                    chkLinkable.on('click', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        \n                        if (chkLinkable.is(':checked')) {\n                            txtLink.prop('disabled', false);\n                            cbbTarget.prop('disabled', false);\n                            img.wrap('<a href=\"\"></a>');\n                        } else {\n                            txtLink.prop('disabled', true);\n                            cbbTarget.prop('disabled', true);\n                            img.unwrap('a');\n                        }\n                    });\n                    \n                    var inputAlign = form.find('#photo-align');\n                    inputAlign.on('change', function () {\n                        var panel = keditor.getSettingComponent().find('.photo-panel');\n                        panel.css('text-align', this.value);\n                    });\n                    \n                    var inputVAlign = form.find('#v-align');\n                    inputVAlign.on('change', function () {\n                        var panel = keditor.getSettingComponent().find('.photo-panel').find('img');\n                        panel.css('vertical-align', this.value);\n                    });\n                    \n                    var inputResponsive = form.find('#photo-responsive');\n                    inputResponsive.on('click', function () {\n                        keditor.getSettingComponent().find('img')[this.checked ? 'addClass' : 'removeClass']('img-responsive');\n                    });\n                    \n                    var cbbStyle = form.find('#photo-style');\n                    cbbStyle.on('change', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        var val = this.value;\n                        \n                        img.removeClass('img-rounded img-circle img-thumbnail');\n                        if (val) {\n                            img.addClass(val);\n                        }\n                    });\n                    \n                    var inputWidth = form.find('#photo-width');\n                    var inputHeight = form.find('#photo-height');\n                    inputWidth.on('change', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        var newWidth = +this.value;\n                        var newHeight = Math.round(newWidth / self.ratio);\n                        \n                        if (newWidth <= 0) {\n                            newWidth = self.width;\n                            newHeight = self.height;\n                            this.value = newWidth;\n                        }\n                        \n                        img.attr({\n                            'width': newWidth,\n                            'height': newHeight\n                        });\n                        inputHeight.val(newHeight);\n                    });\n                    inputHeight.on('change', function () {\n                        var img = keditor.getSettingComponent().find('img');\n                        var newHeight = +this.value;\n                        var newWidth = Math.round(newHeight * self.ratio);\n                        \n                        if (newHeight <= 0) {\n                            newWidth = self.width;\n                            newHeight = self.height;\n                            this.value = newHeight;\n                        }\n                        \n                        img.attr({\n                            'height': newHeight,\n                            'width': newWidth\n                        });\n                        inputWidth.val(newWidth);\n                    });\n                    \n                    initMSelectImage(form.find('#photo-edit'), keditor, function (url, relUrl, type, hash) {\n                        var img = keditor.getSettingComponent().find('img');\n                        var src = '/_hashes/files/' + hash;\n                        \n                        $('<img />').attr('src', src).load(function () {\n                            img.attr({\n                                width: this.width,\n                                height: this.height,\n                                src: src\n                            });\n                            self.ratio = this.width / this.height;\n                            self.width = this.width;\n                            self.height = this.height;\n                            inputWidth.val(this.width);\n                            inputHeight.val(this.height);\n                        });\n                    });\n                }\n            });\n        },\n        \n        showSettingForm: function (form, component, keditor) {\n            flog('showSettingForm \"photo\" component', component);\n            \n            var self = this;\n            var inputAlign = form.find('#photo-align');\n            var inputVAlign = form.find('#v-align');\n            var inputResponsive = form.find('#photo-responsive');\n            var inputWidth = form.find('#photo-width');\n            var inputHeight = form.find('#photo-height');\n            var cbbStyle = form.find('#photo-style');\n            var txtLink = form.find('#photo-link');\n            var cbbTarget = form.find('#photo-target');\n            var chkLinkable = form.find('#photo-linkable');\n            \n            var panel = component.find('.photo-panel');\n            var img = panel.find('img');\n            \n            var a = img.parent('a');\n            if (a.length > 0) {\n                chkLinkable.prop('checked', true);\n                txtLink.prop('disabled', false).val(a.attr('href'));\n                cbbTarget.prop('disabled', false).val(a.attr('target'));\n            } else {\n                chkLinkable.prop('checked', false);\n                txtLink.prop('disabled', true).val('');\n                cbbTarget.prop('disabled', true).val('');\n            }\n            \n            var align = panel.css('text-align');\n            if (align !== 'right' || align !== 'center') {\n                align = 'left';\n            }\n            \n            var valign = img.css('vertical-align');\n            \n            if (img.hasClass('img-rounded')) {\n                cbbStyle.val('img-rounded');\n            } else if (img.hasClass('img-circle')) {\n                cbbStyle.val('img-circle');\n            } else if (img.hasClass('img-thumbnail')) {\n                cbbStyle.val('img-thumbnail');\n            } else {\n                cbbStyle.val('');\n            }\n            inputAlign.val(align);\n            inputVAlign.val(valign);\n            inputResponsive.prop('checked', img.hasClass('img-responsive'));\n            inputWidth.val(img.width());\n            inputHeight.val(img.height());\n            \n            $('<img />').attr('src', img.attr('src')).load(function () {\n                self.ratio = this.width / this.height;\n                self.width = this.width;\n                self.height = this.height;\n            });\n        }\n    };\n    \n})(jQuery);\n"]}