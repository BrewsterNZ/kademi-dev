{"version":3,"sources":["keditor-component-media-0.0.0.js"],"names":["$","KEditor","keditor","contentEditor","flog","log","components","init","contentArea","container","component","options","componentContent","children","mediaBody","find","addClass","mediaLeft","mediaLeftInner","length","html","attr","generateId","prop","on","e","onComponentChanged","call","onContainerChanged","onContentChanged","editor","ckeditor","ckeditorOptions","onComponentReady","getContent","id","CKEDITOR","instances","replaceWith","getData","destroy","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","txtLink","link","this","value","trim","getSettingComponent","cbbTarget","chkLinkable","img","is","wrap","unwrap","css","checked","val","removeClass","initMselectImage","relativeUrl","fileType","hash","showSettingForm","inputVAlign","inputResponsive","inputWidth","cbbStyle","get","style","width","replace","a","parent","valign","hasClass","jQuery"],"mappings":"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","file":"keditor-component-media-0.0.0.min.js","sourcesContent":["(function ($) {\r\n    var KEditor = $.keditor;\r\n    var contentEditor = $.contentEditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['media'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"media\" component', component);\r\n            \r\n            var options = keditor.options;\r\n            var componentContent = component.children('.keditor-component-content');\r\n            \r\n            var mediaBody = componentContent.find('.media-body');\r\n            mediaBody.addClass('clearfix');\r\n            \r\n            var mediaLeft = componentContent.find('.media-left');\r\n            var mediaLeftInner = componentContent.find('.media-left-inner');\r\n            if (mediaLeftInner.length === 0) {\r\n                mediaLeft.html('<div class=\"media-left-inner\">' + mediaLeft.html() + '</div>');\r\n            }\r\n            \r\n            if (!mediaBody.attr('id')) {\r\n                mediaBody.attr('id', keditor.generateId('component-text-content-inner'));\r\n            }\r\n            \r\n            mediaBody.prop('contenteditable', true);\r\n            mediaBody.on('input', function (e) {\r\n                if (typeof options.onComponentChanged === 'function') {\r\n                    options.onComponentChanged.call(contentArea, e, component);\r\n                }\r\n                \r\n                if (typeof options.onContainerChanged === 'function') {\r\n                    options.onContainerChanged.call(contentArea, e, container);\r\n                }\r\n                \r\n                if (typeof options.onContentChanged === 'function') {\r\n                    options.onContentChanged.call(contentArea, e);\r\n                }\r\n            });\r\n            \r\n            var editor = mediaBody.ckeditor(options.ckeditorOptions).editor;\r\n            editor.on('instanceReady', function () {\r\n                flog('CKEditor is ready', component);\r\n                \r\n                if (typeof options.onComponentReady === 'function') {\r\n                    options.onComponentReady.call(contentArea, component, editor);\r\n                }\r\n            });\r\n        },\r\n        \r\n        getContent: function (component, keditor) {\r\n            flog('getContent \"media\" component', component);\r\n            \r\n            var componentContent = component.find('.keditor-component-content');\r\n            var mediaBody = componentContent.find('.media-body');\r\n            \r\n            var id = mediaBody.attr('id');\r\n            var editor = CKEDITOR.instances[id];\r\n            if (editor) {\r\n                mediaBody.replaceWith('<div class=\"media-body clearfix\">' + editor.getData() + '</div>');\r\n            }\r\n            \r\n            return componentContent.html();\r\n        },\r\n        \r\n        destroy: function (component, keditor) {\r\n            flog('destroy \"text\" component', component);\r\n            \r\n            var id = component.find('.media-body').attr('id');\r\n            var editor = CKEDITOR.instances[id];\r\n            if (editor) {\r\n                editor.destroy();\r\n            }\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Media Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('initSettingForm \"media\" component');\r\n            \r\n            return $.ajax({\r\n                url: '/theme/apps/keditor-lib/componentMediaSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                    var txtLink = form.find('.photo-link');\r\n                    txtLink.on('change', function () {\r\n                        var link = this.value.trim();\r\n                        keditor.getSettingComponent().find('a').attr('href', link);\r\n                    });\r\n                    \r\n                    var cbbTarget = form.find('.photo-target');\r\n                    cbbTarget.on('change', function () {\r\n                        keditor.getSettingComponent().find('a').attr('target', this.value);\r\n                    });\r\n                    \r\n                    var chkLinkable = form.find('.photo-linkable');\r\n                    chkLinkable.on('click', function () {\r\n                        var img = keditor.getSettingComponent().find('img.media-object');\r\n                        \r\n                        if (chkLinkable.is(':checked')) {\r\n                            txtLink.prop('disabled', false);\r\n                            cbbTarget.prop('disabled', false);\r\n                            img.wrap('<a href=\"\"></a>');\r\n                        } else {\r\n                            txtLink.prop('disabled', true);\r\n                            cbbTarget.prop('disabled', true);\r\n                            img.unwrap('a');\r\n                        }\r\n                    });\r\n                    \r\n                    form.find('.photo-v-align').on('change', function () {\r\n                        var mediaLeft = keditor.getSettingComponent().find('.media-left');\r\n                        mediaLeft.css('vertical-align', this.value);\r\n                    });\r\n                    \r\n                    form.find('.photo-responsive').on('click', function () {\r\n                        keditor.getSettingComponent().find('img')[this.checked ? 'addClass' : 'removeClass']('img-responsive');\r\n                    });\r\n                    \r\n                    form.find('.photo-style').on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img.media-object');\r\n                        var val = this.value;\r\n                        \r\n                        img.removeClass('img-rounded img-circle img-thumbnail');\r\n                        if (val) {\r\n                            img.addClass(val);\r\n                        }\r\n                    });\r\n                    \r\n                    form.find('.photo-width').on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img.media-object');\r\n                        img.attr('width', this.value);\r\n                    });\r\n                    \r\n                    contentEditor.initMselectImage(form.find('.photo-edit'), keditor, function (url, relativeUrl, fileType, hash) {\r\n                        var img = keditor.getSettingComponent().find('img.media-object');\r\n                        \r\n                        img.attr('src', '/_hashes/files/' + hash);\r\n                    });\r\n                    \r\n                    form.find('.left-width').on('change', function () {\r\n                        var mediaLeftInner = keditor.getSettingComponent().find('.media-left-inner');\r\n                        mediaLeftInner.css('width', this.value);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"media\" component', component);\r\n            \r\n            var inputVAlign = form.find('.photo-v-align');\r\n            var inputResponsive = form.find('.photo-responsive');\r\n            var inputWidth = form.find('.photo-width');\r\n            var cbbStyle = form.find('.photo-style');\r\n            var txtLink = form.find('.photo-link');\r\n            var cbbTarget = form.find('.photo-target');\r\n            var chkLinkable = form.find('.photo-linkable');\r\n            \r\n            var img = component.find('img.media-object');\r\n            var mediaLeft = component.find('.media-left');\r\n            var mediaLeftInner = component.find('.media-left-inner');\r\n            \r\n            form.find('.left-width').val((mediaLeftInner.get(0).style.width || '').replace('px', ''));\r\n            \r\n            var a = img.parent('a');\r\n            if (a.length > 0) {\r\n                chkLinkable.prop('checked', true);\r\n                txtLink.prop('disabled', false).val(a.attr('href'));\r\n                cbbTarget.prop('disabled', false).val(a.attr('target'));\r\n            } else {\r\n                chkLinkable.prop('checked', false);\r\n                txtLink.prop('disabled', true).val('');\r\n                cbbTarget.prop('disabled', true).val('');\r\n            }\r\n            \r\n            var valign = mediaLeft.css('vertical-align') || 'top';\r\n            \r\n            if (img.hasClass('img-rounded')) {\r\n                cbbStyle.val('img-rounded');\r\n            } else if (img.hasClass('img-circle')) {\r\n                cbbStyle.val('img-circle');\r\n            } else if (img.hasClass('img-thumbnail')) {\r\n                cbbStyle.val('img-thumbnail');\r\n            } else {\r\n                cbbStyle.val('');\r\n            }\r\n            \r\n            inputVAlign.val(valign);\r\n            inputResponsive.prop('checked', img.hasClass('img-responsive'));\r\n            inputWidth.val(img.attr('width'));\r\n        }\r\n    };\r\n    \r\n})(jQuery);\r\n"]}