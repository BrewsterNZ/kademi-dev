{"version":3,"sources":["keditor-component-media-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","options","componentContent","children","img","find","css","mediaBody","addClass","mediaLeft","mediaLeftInner","length","html","attr","generateId","prop","on","e","onComponentChanged","call","onContainerChanged","onContentChanged","editor","ckeditor","ckeditorOptions","onComponentReady","getContent","id","CKEDITOR","instances","replaceWith","getData","destroy","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","txtLink","link","this","value","trim","getSettingComponent","cbbTarget","chkLinkable","is","wrap","unwrap","checked","val","removeClass","photoEdit","mselect","contentTypes","bs3Modal","pagePath","basePath","onSelectFile","relativeUrl","fileType","hash","showSettingForm","inputVAlign","inputResponsive","inputWidth","inputHeight","cbbStyle","get","style","width","a","parent","valign","hasClass","height","jQuery"],"mappings":"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","file":"keditor-component-media-0.0.0.min.js","sourcesContent":["(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['media'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"media\" component', component);\r\n            \r\n            var options = keditor.options;\r\n            var componentContent = component.children('.keditor-component-content');\r\n            var img = componentContent.find('img.media-object');\r\n            \r\n            img.css('display', 'inline-block');\r\n            \r\n            var mediaBody = componentContent.find('.media-body');\r\n            mediaBody.addClass('clearfix');\r\n            \r\n            var mediaLeft = componentContent.find('.media-left');\r\n            var mediaLeftInner = componentContent.find('.media-left-inner');\r\n            if (mediaLeftInner.length === 0) {\r\n                mediaLeft.html('<div class=\"media-left-inner\">' + mediaLeft.html() + '</div>');\r\n            }\r\n            \r\n            if (!mediaBody.attr('id')) {\r\n                mediaBody.attr('id', keditor.generateId('component-text-content-inner'));\r\n            }\r\n            \r\n            mediaBody.prop('contenteditable', true);\r\n            mediaBody.on('input', function (e) {\r\n                if (typeof options.onComponentChanged === 'function') {\r\n                    options.onComponentChanged.call(contentArea, e, component);\r\n                }\r\n                \r\n                if (typeof options.onContainerChanged === 'function') {\r\n                    options.onContainerChanged.call(contentArea, e, container);\r\n                }\r\n                \r\n                if (typeof options.onContentChanged === 'function') {\r\n                    options.onContentChanged.call(contentArea, e);\r\n                }\r\n            });\r\n            \r\n            var editor = mediaBody.ckeditor(options.ckeditorOptions).editor;\r\n            editor.on('instanceReady', function () {\r\n                flog('CKEditor is ready', component);\r\n                \r\n                if (typeof options.onComponentReady === 'function') {\r\n                    options.onComponentReady.call(contentArea, component, editor);\r\n                }\r\n            });\r\n        },\r\n        \r\n        getContent: function (component, keditor) {\r\n            flog('getContent \"media\" component', component);\r\n            \r\n            var componentContent = component.find('.keditor-component-content');\r\n            var mediaBody = componentContent.find('.media-body');\r\n            \r\n            var id = mediaBody.attr('id');\r\n            var editor = CKEDITOR.instances[id];\r\n            if (editor) {\r\n                mediaBody.replaceWith('<div class=\"media-body clearfix\">' + editor.getData() + '</div>');\r\n            }\r\n            \r\n            return componentContent.html();\r\n        },\r\n        \r\n        destroy: function (component, keditor) {\r\n            flog('destroy \"text\" component', component);\r\n            \r\n            var id = component.find('.media-body').attr('id');\r\n            var editor = CKEDITOR.instances[id];\r\n            if (editor) {\r\n                editor.destroy();\r\n            }\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Media Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('initSettingForm \"media\" component');\r\n            \r\n            return $.ajax({\r\n                url: '/theme/apps/keditor-lib/componentMediaSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                    var txtLink = form.find('.photo-link');\r\n                    txtLink.on('change', function () {\r\n                        var link = this.value.trim();\r\n                        keditor.getSettingComponent().find('a').attr('href', link);\r\n                    });\r\n                    \r\n                    var cbbTarget = form.find('.photo-target');\r\n                    cbbTarget.on('change', function () {\r\n                        keditor.getSettingComponent().find('a').attr('target', this.value);\r\n                    });\r\n                    \r\n                    var chkLinkable = form.find('.photo-linkable');\r\n                    chkLinkable.on('click', function () {\r\n                        var img = keditor.getSettingComponent().find('img.media-object');\r\n                        \r\n                        if (chkLinkable.is(':checked')) {\r\n                            txtLink.prop('disabled', false);\r\n                            cbbTarget.prop('disabled', false);\r\n                            img.wrap('<a href=\"\"></a>');\r\n                        } else {\r\n                            txtLink.prop('disabled', true);\r\n                            cbbTarget.prop('disabled', true);\r\n                            img.unwrap('a');\r\n                        }\r\n                    });\r\n                    \r\n                    form.find('.photo-v-align').on('change', function () {\r\n                        var mediaLeft = keditor.getSettingComponent().find('.media-left');\r\n                        mediaLeft.css('vertical-align', this.value);\r\n                    });\r\n                    \r\n                    form.find('.photo-responsive').on('click', function () {\r\n                        keditor.getSettingComponent().find('img')[this.checked ? 'addClass' : 'removeClass']('img-responsive');\r\n                    });\r\n                    \r\n                    form.find('.photo-style').on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img.media-object');\r\n                        var val = this.value;\r\n                        \r\n                        img.removeClass('img-rounded img-circle img-thumbnail');\r\n                        if (val) {\r\n                            img.addClass(val);\r\n                        }\r\n                    });\r\n                    \r\n                    form.find('.photo-width').on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img.media-object');\r\n                        img.attr('width', this.value);\r\n                    });\r\n                    \r\n                    form.find('.photo-height').on('change', function () {\r\n                        var img = keditor.getSettingComponent().find('img.media-object');\r\n                        img.attr('height', this.value);\r\n                    });\r\n                    \r\n                    var photoEdit = form.find('.photo-edit');\r\n                    photoEdit.mselect({\r\n                        contentTypes: ['image'],\r\n                        bs3Modal: true,\r\n                        pagePath: keditor.options.pagePath,\r\n                        basePath: keditor.options.basePath,\r\n                        onSelectFile: function (url, relativeUrl, fileType, hash) {\r\n                            var img = keditor.getSettingComponent().find('img.media-object');\r\n                            \r\n                            img.attr('src', '/_hashes/files/' + hash);\r\n                        }\r\n                    });\r\n                    \r\n                    form.find('.left-width').on('change', function () {\r\n                        var mediaLeftInner = keditor.getSettingComponent().find('.media-left-inner');\r\n                        mediaLeftInner.css('width', this.value);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"media\" component', component);\r\n            \r\n            var inputVAlign = form.find('.photo-v-align');\r\n            var inputResponsive = form.find('.photo-responsive');\r\n            var inputWidth = form.find('.photo-width');\r\n            var inputHeight = form.find('.photo-height');\r\n            var cbbStyle = form.find('.photo-style');\r\n            var txtLink = form.find('.photo-link');\r\n            var cbbTarget = form.find('.photo-target');\r\n            var chkLinkable = form.find('.photo-linkable');\r\n            \r\n            var img = component.find('img.media-object');\r\n            var mediaLeft = component.find('.media-left');\r\n            var mediaLeftInner = component.find('.media-left-inner');\r\n            \r\n            form.find('.left-width').val(mediaLeftInner.get(0).style.width || '');\r\n            \r\n            var a = img.parent('a');\r\n            if (a.length > 0) {\r\n                chkLinkable.prop('checked', true);\r\n                txtLink.prop('disabled', false).val(a.attr('href'));\r\n                cbbTarget.prop('disabled', false).val(a.attr('target'));\r\n            } else {\r\n                chkLinkable.prop('checked', false);\r\n                txtLink.prop('disabled', true).val('');\r\n                cbbTarget.prop('disabled', true).val('');\r\n            }\r\n            \r\n            var valign = mediaLeft.css('vertical-align') || 'top';\r\n            \r\n            if (img.hasClass('img-rounded')) {\r\n                cbbStyle.val('img-rounded');\r\n            } else if (img.hasClass('img-circle')) {\r\n                cbbStyle.val('img-circle');\r\n            } else if (img.hasClass('img-thumbnail')) {\r\n                cbbStyle.val('img-thumbnail');\r\n            } else {\r\n                cbbStyle.val('');\r\n            }\r\n            \r\n            inputVAlign.val(valign);\r\n            inputResponsive.prop('checked', img.hasClass('img-responsive'));\r\n            inputWidth.val(img.width());\r\n            inputHeight.val(img.height());\r\n        }\r\n    };\r\n    \r\n})(jQuery);\r\n"]}