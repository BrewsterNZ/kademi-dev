{"version":3,"sources":["keditor-component-accordion-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","settingEnabled","settingTitle","init","contentArea","container","component","options","doc","iframeMode","iframeDoc","document","id","generateId","componentContent","children","find","attr","panels","each","index","item","p","itemId","panelCollapseId","length","headingText","headingIcon","text","trim","html","append","collapse","removeClass","prop","on","e","onComponentChanged","call","onContainerChanged","onContentChanged","editor","ckeditor","ckeditorOptions","onComponentReady","off","preventDefault","confirm","panelsCount","this","parents","remove","Msg","error","clone","first","getContent","h","replaceWith","panelTitle","panelCollapse","addClass","removeAttr","css","destroy","CKEDITOR","instances","initSettingForm","form","ajax","url","type","dataType","success","resp","comp","getSettingComponent","checked","old","value","getStyleOnce","getScriptOnce","iconpicker","iconset","cols","rows","placement","icon","className","showSettingForm","dataAttributes","getDataAttributes","val","iconCollapsed","end","iconExpanded","jQuery"],"mappings":"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","file":"keditor-component-accordion-0.0.0.min.js","sourcesContent":["(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n\r\n    KEditor.components['accordion'] = {\r\n        settingEnabled: true,\r\n        settingTitle: 'Accordion Settings',\r\n\r\n        init: function (contentArea, container, component, keditor) {\r\n            var options = keditor.options;\r\n            var doc = options.iframeMode ? keditor.iframeDoc : $(document);\r\n            var id = keditor.generateId('accordion');\r\n            var componentContent = component.children('.keditor-component-content');\r\n            componentContent.find('.accordionWrap .panel-group').attr('id', id);\r\n            componentContent.find('.accordionWrap a[data-toggle]').attr('data-parent', '#' + id);\r\n\r\n\r\n            var panels = componentContent.find('.panel');\r\n            panels.each(function (index, item) {\r\n                var p = $(item);\r\n                var itemId = keditor.generateId('heading' + index);\r\n                var panelCollapseId = keditor.generateId('collapse' + index);\r\n                p.find('.panel-heading').attr('id', itemId);\r\n                p.find('.panel-collapse').attr('aria-labelledby', itemId).attr('id', panelCollapseId);\r\n                p.find('a[data-toggle]').attr('href', '#' + panelCollapseId).attr('aria-controls', '#' + panelCollapseId);\r\n\r\n                // backward compatibility\r\n                if (!p.find('a[data-toggle]').find('.accHeadingText').length){\r\n                    var headingText = $('<div class=\"accHeadingText\" style=\"display: inline-block; width: 90%\"></div>');\r\n                    var headingIcon = $('<div style=\"display: inline-block; width: 5%; float: right; text-align: right\"><i class=\"fa fa-angle-double-down panelIconCollapsed\"></i><i class=\"fa panelIconExpanded fa-angle-double-up\"></i></div>')\r\n                    var text = p.find('a[data-toggle]').text().trim();\r\n                    headingText.text(text);\r\n                    p.find('a[data-toggle]').html('').append(headingText).append(headingIcon);\r\n                }\r\n            });\r\n\r\n            componentContent.find('.accordionWrap .panel-collapse').collapse('show');\r\n            componentContent.find('.panel-footer, .btnAddAccordionItem').removeClass('hide');\r\n            componentContent.find('.panel-title a .accHeadingText').prop('contenteditable', true);\r\n            componentContent.find('.panel-collapse .panel-body').prop('contenteditable', true);\r\n\r\n            componentContent.find('.panel-title a .accHeadingText, .panel-collapse .panel-body').on('input', function (e) {\r\n                if (typeof options.onComponentChanged === 'function') {\r\n                    options.onComponentChanged.call(keditor, e, component, contentArea);\r\n                }\r\n                \r\n                if (typeof options.onContainerChanged === 'function') {\r\n                    options.onContainerChanged.call(keditor, e, container, contentArea);\r\n                }\r\n                \r\n                if (typeof options.onContentChanged === 'function') {\r\n                    options.onContentChanged.call(keditor, e, contentArea);\r\n                }\r\n            });\r\n\r\n            var editor = componentContent.find('.panel-title a .accHeadingText, .panel-collapse .panel-body').ckeditor(options.ckeditorOptions).editor;\r\n            editor.on('instanceReady', function () {\r\n                flog('CKEditor is ready', component);\r\n\r\n                if (typeof options.onComponentReady === 'function') {\r\n                    options.onComponentReady.call(contentArea, component, editor);\r\n                }\r\n            });\r\n\r\n\r\n            doc.off('click', '.btnDeleteAccordionItem').on('click', '.btnDeleteAccordionItem', function (e) {\r\n                e.preventDefault();\r\n\r\n                if (confirm('Are you sure you want to delete this item?')) {\r\n                    var panelsCount = componentContent.find('.panel').length;\r\n                    if (panelsCount > 1) {\r\n                        $(this).parents('.panel').remove();\r\n                    } else {\r\n                        Msg.error('You cant delete the last item');\r\n                    }\r\n                }\r\n            });\r\n\r\n            doc.off('click', '.btnAddAccordionItem').on('click', '.btnAddAccordionItem', function (e) {\r\n                e.preventDefault();\r\n                debugger;\r\n                var clone = componentContent.find('.panel').first().clone();\r\n                var itemId = keditor.generateId('heading');\r\n                var panelCollapseId = keditor.generateId('collapse');\r\n                clone.find('.panel-heading').attr('id', itemId);\r\n                clone.find('.panel-collapse').attr('aria-labelledby', itemId).attr('id', panelCollapseId);\r\n                clone.find('a[data-toggle]').attr('href', '#' + panelCollapseId);\r\n                componentContent.find('.accordionWrap .panel-group').append(clone);\r\n                var editor = clone.find('.panel-title a .accHeadingText, .panel-collapse .panel-body').ckeditor(options.ckeditorOptions).editor;\r\n                editor.on('instanceReady', function () {\r\n                    flog('CKEditor is ready', component);\r\n\r\n                    if (typeof options.onComponentReady === 'function') {\r\n                        options.onComponentReady.call(contentArea, component, editor);\r\n                    }\r\n                });\r\n            });\r\n        },\r\n\r\n        getContent: function (component, keditor) {\r\n            var componentContent = component.children('.keditor-component-content');\r\n            componentContent.find('.panel-collapse .panel-body').each(function () {\r\n                var h = $(this).html();\r\n                $(this).replaceWith('<div class=\"panel-body\">' + h + '</div>');\r\n            });\r\n            if (component.attr('data-initial-collapsed') == 'true'){\r\n                componentContent.find('.panel').each(function () {\r\n                    var panelTitle = $(this).find('.panel-heading a');\r\n                    var panelCollapse = $(this).find('.panel-collapse');\r\n                    panelCollapse.addClass('collapse').attr('aria-expanded', 'false').removeClass('in');\r\n                    panelTitle.addClass('collapsed').attr('aria-expanded', 'false');\r\n                });\r\n            }\r\n            componentContent.find('.panel-footer, .btnAddAccordionItem').addClass('hide');\r\n            componentContent.find('[contenteditable]').removeAttr('contenteditable');\r\n            componentContent.find('.accHeadingText').each(function () {\r\n               $(this).css('outline', 'none').text($(this).text());\r\n            });\r\n            return componentContent.html();\r\n        },\r\n\r\n        destroy: function (component, keditor) {\r\n            flog('destroy \"text\" component', component);\r\n\r\n            var id = component.find('.keditor-component-content').attr('id');\r\n            var editor = CKEDITOR.instances[id];\r\n            if (editor) {\r\n                editor.destroy();\r\n            }\r\n        },\r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"accordion\" settings', form);\r\n\r\n            return $.ajax({\r\n                url: '/theme/apps/keditor-lib/componentAccordionSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n\r\n                    form.find('.collapsedAll').on('click', function () {\r\n                        var comp = keditor.getSettingComponent();\r\n                        comp.attr('data-initial-collapsed', this.checked);\r\n                    });\r\n\r\n                    form.find('.panelStyle').on('change', function (e) {\r\n                        var comp = keditor.getSettingComponent();\r\n                        var old = comp.attr('data-panel-style') || 'panel-default';\r\n                        comp.attr('data-panel-style', this.value);\r\n                        comp.find('.panel').removeClass(old).addClass(this.value);\r\n                    });\r\n                    \r\n                    $.getStyleOnce('/static/bootstrap-iconpicker/1.7.0/css/bootstrap-iconpicker.min.css');\r\n                    $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/iconset/iconset-fontawesome-4.2.0.min.js', function () {\r\n                        $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/bootstrap-iconpicker.min.js', function () {\r\n                            form.find('.btn-collapsed-icon, .btn-expanded-icon').iconpicker({\r\n                                iconset: 'fontawesome',\r\n                                cols: 10,\r\n                                rows: 4,\r\n                                placement: 'left'\r\n                            });\r\n                            \r\n                            form.find('.btn-collapsed-icon').on('change', function (e) {\r\n                                var component = keditor.getSettingComponent();\r\n                                component.attr('data-collapsed-icon', e.icon);\r\n                                component.find('.panelIconCollapsed').each(function () {\r\n                                    this.className = \"panelIconCollapsed fa \"+ e.icon;\r\n                                })\r\n                            });\r\n                            \r\n                            form.find('.btn-expanded-icon').on('change', function (e) {\r\n                                var component = keditor.getSettingComponent();\r\n                                component.attr('data-expanded-icon', e.icon);\r\n                                component.find('.panelIconExpanded').each(function () {\r\n                                    this.className = \"panelIconExpanded fa \"+ e.icon;\r\n                                })\r\n                            });\r\n                        });\r\n                    });\r\n                            \r\n                }\r\n            });\r\n        },\r\n\r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"Accordion\" component');\r\n            var dataAttributes = keditor.getDataAttributes(component, ['data-type'], false);\r\n            \r\n            form.find('.collapsedAll').prop('checked', component.attr('data-initial-collapsed') == 'true');\r\n            form.find('.panelStyle').val(component.attr('data-panel-style'));\r\n            \r\n            $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/iconset/iconset-fontawesome-4.2.0.min.js', function () {\r\n                $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/bootstrap-iconpicker.min.js', function () {\r\n                    var iconCollapsed = dataAttributes['data-collapsed-icon'] || 'fa-caret-up';\r\n                    form.find('.btn-collapsed-icon').find('i').attr('class', 'fa ' + iconCollapsed).end().find('input').val(iconCollapsed);\r\n                    var iconExpanded = dataAttributes['data-expanded-icon'] || 'fa-caret-down';\r\n                    form.find('.btn-expanded-icon').find('i').attr('class', 'fa ' + iconExpanded).end().find('input').val(iconExpanded);\r\n                });\r\n            });\r\n        }\r\n    };\r\n})(jQuery);\r\n\r\n"]}