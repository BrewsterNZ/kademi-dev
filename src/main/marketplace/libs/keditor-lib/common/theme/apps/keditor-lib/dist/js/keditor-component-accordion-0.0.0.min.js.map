{"version":3,"sources":["keditor-component-accordion-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","settingEnabled","settingTitle","init","contentArea","container","component","options","doc","iframeMode","iframeDoc","document","id","generateId","componentContent","children","find","attr","panels","each","index","item","p","itemId","panelCollapseId","on","e","preventDefault","length","headingText","headingIcon","text","trim","html","append","collapse","removeClass","prop","onComponentChanged","call","onContainerChanged","onContentChanged","editor","this","ckeditor","ckeditorOptions","onComponentReady","setTimeout","parents","css","off","componentContentNow","closest","confirm","panelsCount","remove","Msg","error","clone","first","getContent","h","replaceWith","panelTitle","panelCollapse","addClass","removeAttr","destroy","CKEDITOR","instances","initSettingForm","form","ajax","url","type","dataType","success","resp","comp","getSettingComponent","checked","old","value","getStyleOnce","getScriptOnce","iconpicker","iconset","cols","rows","placement","icon","className","showSettingForm","dataAttributes","getDataAttributes","val","iconCollapsed","end","iconExpanded","jQuery"],"mappings":"CAAA,SAAWA,GACP,GAAIC,GAAUD,EAAEE,QACZC,EAAOF,EAAQG,GAEnBH,GAAQI,WAAsB,WAC1BC,gBAAgB,EAChBC,aAAc,qBAEdC,KAAM,SAAUC,EAAaC,EAAWC,EAAWT,GAC/C,GAAIU,GAAUV,EAAQU,QAClBC,EAAMD,EAAQE,WAAaZ,EAAQa,UAAYf,EAAEgB,UACjDC,EAAKf,EAAQgB,WAAW,aACxBC,EAAmBR,EAAUS,SAAS,6BAC1CD,GAAiBE,KAAK,+BAA+BC,KAAK,KAAML,GAChEE,EAAiBE,KAAK,iCAAiCC,KAAK,cAAe,IAAML,EAGjF,IAAIM,GAASJ,EAAiBE,KAAK,SACnCE,GAAOC,KAAK,SAAUC,EAAOC,GACzB,GAAIC,GAAI3B,EAAE0B,GACNE,EAAS1B,EAAQgB,WAAW,UAAYO,GACxCI,EAAkB3B,EAAQgB,WAAW,WAAaO,EAQtD,IAPAE,EAAEN,KAAK,kBAAkBC,KAAK,KAAMM,GACpCD,EAAEN,KAAK,mBAAmBC,KAAK,kBAAmBM,GAAQN,KAAK,KAAMO,GACrEF,EAAEN,KAAK,kBAAkBC,KAAK,OAAQ,IAAMO,GAAiBP,KAAK,gBAAiB,IAAMO,GAAiBC,GAAG,QAAS,SAAUC,GAC5HA,EAAEC,oBAIDL,EAAEN,KAAK,kBAAkBA,KAAK,mBAAmBY,OAAO,CACzD,GAAIC,GAAclC,EAAE,gFAChBmC,EAAcnC,EAAE,0MAChBoC,EAAOT,EAAEN,KAAK,kBAAkBe,OAAOC,MAC3CH,GAAYE,KAAKA,GACjBT,EAAEN,KAAK,kBAAkBiB,KAAK,IAAIC,OAAOL,GAAaK,OAAOJ,MAIrEhB,EAAiBE,KAAK,kCAAkCmB,SAAS,QACjErB,EAAiBE,KAAK,uCAAuCoB,YAAY,QACzEtB,EAAiBE,KAAK,kCAAkCqB,KAAK,mBAAmB,GAChFvB,EAAiBE,KAAK,+BAA+BqB,KAAK,mBAAmB,GAE7EvB,EAAiBE,KAAK,+DAA+DS,GAAG,QAAS,SAAUC,GAC7D,kBAA/BnB,GAAQ+B,oBACf/B,EAAQ+B,mBAAmBC,KAAK1C,EAAS6B,EAAGpB,EAAWF,GAGjB,kBAA/BG,GAAQiC,oBACfjC,EAAQiC,mBAAmBD,KAAK1C,EAAS6B,EAAGrB,EAAWD,GAGnB,kBAA7BG,GAAQkC,kBACflC,EAAQkC,iBAAiBF,KAAK1C,EAAS6B,EAAGtB,KAGlDU,EAAiBE,KAAK,+DAA+DG,KAAK,WACtF,GAAIuB,GAAS/C,EAAEgD,MAAMC,SAASrC,EAAQsC,iBAAiBH,MACvDA,GAAOjB,GAAG,gBAAiB,SAAUC,GACjC5B,EAAK,oBAAqBQ,GAEc,kBAA7BC,GAAQuC,kBACfvC,EAAQuC,iBAAiBP,KAAKnC,EAAaE,EAAWoC,GAGtDnC,EAAQE,YACRiB,EAAEgB,OAAOjB,GAAG,QAAS,SAAUC,GAC3BqB,WAAW,WACPpD,EAAE,IAAI+B,EAAEgB,OAAO9B,GAAK,QAAQoC,QAAQ,IAAItB,EAAEgB,OAAO9B,IAAIqC,IAAI,MAAO,GAAGA,IAAI,WAAY,UACpF,SAQnBzC,EAAI0C,IAAI,QAAS,2BAA2BzB,GAAG,QAAS,0BAA2B,SAAUC,GACzFA,EAAEC,gBACF,IAAIwB,GAAsBxD,EAAEgD,MAAMS,QAAQ,6BAC1C,IAAIC,QAAQ,8CAA+C,CACvD,GAAIC,GAAcH,EAAoBnC,KAAK,UAAUY,MACjD0B,GAAc,EACd3D,EAAEgD,MAAMK,QAAQ,UAAUO,SAE1BC,IAAIC,MAAM,oCAKtBjD,EAAI0C,IAAI,QAAS,wBAAwBzB,GAAG,QAAS,uBAAwB,SAAUC,GACnFA,EAAEC,gBACF,IAAIwB,GAAsBxD,EAAEgD,MAAMS,QAAQ,8BACtCM,EAAQP,EAAoBnC,KAAK,UAAU2C,QAAQD,QACnDnC,EAAS1B,EAAQgB,WAAW,WAC5BW,EAAkB3B,EAAQgB,WAAW,WACzC6C,GAAM1C,KAAK,kBAAkBC,KAAK,KAAMM,GACxCmC,EAAM1C,KAAK,mBAAmBC,KAAK,kBAAmBM,GAAQN,KAAK,KAAMO,GACzEkC,EAAM1C,KAAK,kBAAkBC,KAAK,OAAQ,IAAMO,GAAiBC,GAAG,QAAS,SAAUC,GACnFA,EAAEC,mBAENwB,EAAoBnC,KAAK,+BAA+BkB,OAAOwB,GAC/DA,EAAM1C,KAAK,+DAA+DG,KAAK,WAC3E,GAAIuB,GAAS/C,EAAEgD,MAAMC,SAASrC,EAAQsC,iBAAiBH,MACvDA,GAAOjB,GAAG,gBAAiB,SAAUC,GACjC5B,EAAK,oBAAqBQ,GAEc,kBAA7BC,GAAQuC,kBACfvC,EAAQuC,iBAAiBP,KAAKnC,EAAaE,EAAWoC,GAGtDnC,EAAQE,YACRiB,EAAEgB,OAAOjB,GAAG,QAAS,SAAUC,GAC3BqB,WAAW,WACPpD,EAAE,IAAI+B,EAAEgB,OAAO9B,GAAK,QAAQoC,QAAQ,IAAItB,EAAEgB,OAAO9B,IAAIqC,IAAI,MAAO,GAAGA,IAAI,WAAY,UACpF,YAQ3BW,WAAY,SAAUtD,EAAWT,GAC7B,GAAIiB,GAAmBR,EAAUS,SAAS,6BAkB1C,OAjBAD,GAAiBE,KAAK,+BAA+BG,KAAK,WACtD,GAAI0C,GAAIlE,EAAEgD,MAAMV,MAChBtC,GAAEgD,MAAMmB,YAAY,2BAA6BD,EAAI,YAET,QAA5CvD,EAAUW,KAAK,2BACfH,EAAiBE,KAAK,UAAUG,KAAK,WACjC,GAAI4C,GAAapE,EAAEgD,MAAM3B,KAAK,oBAC1BgD,EAAgBrE,EAAEgD,MAAM3B,KAAK,kBACjCgD,GAAcC,SAAS,YAAYhD,KAAK,gBAAiB,SAASmB,YAAY,MAC9E2B,EAAWE,SAAS,aAAahD,KAAK,gBAAiB,WAG/DH,EAAiBE,KAAK,uCAAuCiD,SAAS,QACtEnD,EAAiBE,KAAK,qBAAqBkD,WAAW,mBACtDpD,EAAiBE,KAAK,mBAAmBG,KAAK,WAC3CxB,EAAEgD,MAAMM,IAAI,UAAW,QAAQlB,KAAKpC,EAAEgD,MAAMZ,UAExCjB,EAAiBmB,QAG5BkC,QAAS,SAAU7D,EAAWT,GAC1BC,EAAK,2BAA4BQ,EAEjC,IAAIM,GAAKN,EAAUU,KAAK,8BAA8BC,KAAK,MACvDyB,EAAS0B,SAASC,UAAUzD,EAC5B8B,IACAA,EAAOyB,WAGfG,gBAAiB,SAAUC,EAAM1E,GAG7B,MAFAC,GAAK,4BAA6ByE,GAE3B5E,EAAE6E,MACLC,IAAK,0DACLC,KAAM,MACNC,SAAU,OACVC,QAAS,SAAUC,GACfN,EAAKtC,KAAK4C,GAEVN,EAAKvD,KAAK,iBAAiBS,GAAG,QAAS,WACnC,GAAIqD,GAAOjF,EAAQkF,qBACnBD,GAAK7D,KAAK,yBAA0B0B,KAAKqC,WAG7CT,EAAKvD,KAAK,eAAeS,GAAG,SAAU,SAAUC,GAC5C,GAAIoD,GAAOjF,EAAQkF,sBACfE,EAAMH,EAAK7D,KAAK,qBAAuB,eAC3C6D,GAAK7D,KAAK,mBAAoB0B,KAAKuC,OACnCJ,EAAK9D,KAAK,UAAUoB,YAAY6C,GAAKhB,SAAStB,KAAKuC,SAGvDvF,EAAEwF,aAAa,uEACfxF,EAAEyF,cAAc,iFAAkF,WAC9FzF,EAAEyF,cAAc,oEAAqE,WACjFb,EAAKvD,KAAK,2CAA2CqE,YACjDC,QAAS,cACTC,KAAM,GACNC,KAAM,EACNC,UAAW,SAGflB,EAAKvD,KAAK,uBAAuBS,GAAG,SAAU,SAAUC,GACpD,GAAIpB,GAAYT,EAAQkF,qBACxBzE,GAAUW,KAAK,sBAAuBS,EAAEgE,MACxCpF,EAAUU,KAAK,uBAAuBG,KAAK,WACvCwB,KAAKgD,UAAY,yBAA0BjE,EAAEgE,SAIrDnB,EAAKvD,KAAK,sBAAsBS,GAAG,SAAU,SAAUC,GACnD,GAAIpB,GAAYT,EAAQkF,qBACxBzE,GAAUW,KAAK,qBAAsBS,EAAEgE,MACvCpF,EAAUU,KAAK,sBAAsBG,KAAK,WACtCwB,KAAKgD,UAAY,wBAAyBjE,EAAEgE,iBAUxEE,gBAAiB,SAAUrB,EAAMjE,EAAWT,GACxCC,EAAK,wCACL,IAAI+F,GAAiBhG,EAAQiG,kBAAkBxF,GAAY,cAAc,EAEzEiE,GAAKvD,KAAK,iBAAiBqB,KAAK,UAAuD,QAA5C/B,EAAUW,KAAK,2BAC1DsD,EAAKvD,KAAK,eAAe+E,IAAIzF,EAAUW,KAAK,qBAE5CtB,EAAEyF,cAAc,iFAAkF,WAC9FzF,EAAEyF,cAAc,oEAAqE,WACjF,GAAIY,GAAgBH,EAAe,wBAA0B,aAC7DtB,GAAKvD,KAAK,uBAAuBA,KAAK,KAAKC,KAAK,QAAS,MAAQ+E,GAAeC,MAAMjF,KAAK,SAAS+E,IAAIC,EACxG,IAAIE,GAAeL,EAAe,uBAAyB,eAC3DtB,GAAKvD,KAAK,sBAAsBA,KAAK,KAAKC,KAAK,QAAS,MAAQiF,GAAcD,MAAMjF,KAAK,SAAS+E,IAAIG,UAKvHC","file":"keditor-component-accordion-0.0.0.min.js","sourcesContent":["(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n\r\n    KEditor.components['accordion'] = {\r\n        settingEnabled: true,\r\n        settingTitle: 'Accordion Settings',\r\n\r\n        init: function (contentArea, container, component, keditor) {\r\n            var options = keditor.options;\r\n            var doc = options.iframeMode ? keditor.iframeDoc : $(document);\r\n            var id = keditor.generateId('accordion');\r\n            var componentContent = component.children('.keditor-component-content');\r\n            componentContent.find('.accordionWrap .panel-group').attr('id', id);\r\n            componentContent.find('.accordionWrap a[data-toggle]').attr('data-parent', '#' + id);\r\n\r\n\r\n            var panels = componentContent.find('.panel');\r\n            panels.each(function (index, item) {\r\n                var p = $(item);\r\n                var itemId = keditor.generateId('heading' + index);\r\n                var panelCollapseId = keditor.generateId('collapse' + index);\r\n                p.find('.panel-heading').attr('id', itemId);\r\n                p.find('.panel-collapse').attr('aria-labelledby', itemId).attr('id', panelCollapseId);\r\n                p.find('a[data-toggle]').attr('href', '#' + panelCollapseId).attr('aria-controls', '#' + panelCollapseId).on('click', function (e) {\r\n                    e.preventDefault();\r\n                });\r\n\r\n                // backward compatibility\r\n                if (!p.find('a[data-toggle]').find('.accHeadingText').length){\r\n                    var headingText = $('<div class=\"accHeadingText\" style=\"display: inline-block; width: 90%\"></div>');\r\n                    var headingIcon = $('<div style=\"display: inline-block; width: 5%; float: right; text-align: right\"><i class=\"fa fa-angle-double-down panelIconCollapsed\"></i><i class=\"fa panelIconExpanded fa-angle-double-up\"></i></div>')\r\n                    var text = p.find('a[data-toggle]').text().trim();\r\n                    headingText.text(text);\r\n                    p.find('a[data-toggle]').html('').append(headingText).append(headingIcon);\r\n                }\r\n            });\r\n\r\n            componentContent.find('.accordionWrap .panel-collapse').collapse('show');\r\n            componentContent.find('.panel-footer, .btnAddAccordionItem').removeClass('hide');\r\n            componentContent.find('.panel-title a .accHeadingText').prop('contenteditable', true);\r\n            componentContent.find('.panel-collapse .panel-body').prop('contenteditable', true);\r\n\r\n            componentContent.find('.panel-title a .accHeadingText, .panel-collapse .panel-body').on('input', function (e) {\r\n                if (typeof options.onComponentChanged === 'function') {\r\n                    options.onComponentChanged.call(keditor, e, component, contentArea);\r\n                }\r\n                \r\n                if (typeof options.onContainerChanged === 'function') {\r\n                    options.onContainerChanged.call(keditor, e, container, contentArea);\r\n                }\r\n                \r\n                if (typeof options.onContentChanged === 'function') {\r\n                    options.onContentChanged.call(keditor, e, contentArea);\r\n                }\r\n            });\r\n            componentContent.find('.panel-title a .accHeadingText, .panel-collapse .panel-body').each(function () {\r\n                var editor = $(this).ckeditor(options.ckeditorOptions).editor;\r\n                editor.on('instanceReady', function (e) {\r\n                    flog('CKEditor is ready', component);\r\n\r\n                    if (typeof options.onComponentReady === 'function') {\r\n                        options.onComponentReady.call(contentArea, component, editor);\r\n                    }\r\n\r\n                    if (options.iframeMode){\r\n                        e.editor.on('focus', function (e) {\r\n                            setTimeout(function () {\r\n                                $('#'+e.editor.id + '_top').parents('.'+e.editor.id).css('top', 0).css('position', 'fixed');\r\n                            }, 0);\r\n                        });\r\n                    }\r\n                });\r\n            })\r\n\r\n\r\n\r\n            doc.off('click', '.btnDeleteAccordionItem').on('click', '.btnDeleteAccordionItem', function (e) {\r\n                e.preventDefault();\r\n                var componentContentNow = $(this).closest('.keditor-component-content');\r\n                if (confirm('Are you sure you want to delete this item?')) {\r\n                    var panelsCount = componentContentNow.find('.panel').length;\r\n                    if (panelsCount > 1) {\r\n                        $(this).parents('.panel').remove();\r\n                    } else {\r\n                        Msg.error('You cant delete the last item');\r\n                    }\r\n                }\r\n            });\r\n\r\n            doc.off('click', '.btnAddAccordionItem').on('click', '.btnAddAccordionItem', function (e) {\r\n                e.preventDefault();\r\n                var componentContentNow = $(this).closest('.keditor-component-content');\r\n                var clone = componentContentNow.find('.panel').first().clone();\r\n                var itemId = keditor.generateId('heading');\r\n                var panelCollapseId = keditor.generateId('collapse');\r\n                clone.find('.panel-heading').attr('id', itemId);\r\n                clone.find('.panel-collapse').attr('aria-labelledby', itemId).attr('id', panelCollapseId);\r\n                clone.find('a[data-toggle]').attr('href', '#' + panelCollapseId).on('click', function (e) {\r\n                    e.preventDefault();\r\n                });\r\n                componentContentNow.find('.accordionWrap .panel-group').append(clone);\r\n                clone.find('.panel-title a .accHeadingText, .panel-collapse .panel-body').each(function () {\r\n                    var editor = $(this).ckeditor(options.ckeditorOptions).editor;\r\n                    editor.on('instanceReady', function (e) {\r\n                        flog('CKEditor is ready', component);\r\n\r\n                        if (typeof options.onComponentReady === 'function') {\r\n                            options.onComponentReady.call(contentArea, component, editor);\r\n                        }\r\n\r\n                        if (options.iframeMode){\r\n                            e.editor.on('focus', function (e) {\r\n                                setTimeout(function () {\r\n                                    $('#'+e.editor.id + '_top').parents('.'+e.editor.id).css('top', 0).css('position', 'fixed');\r\n                                }, 0);\r\n                            });\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n        },\r\n\r\n        getContent: function (component, keditor) {\r\n            var componentContent = component.children('.keditor-component-content');\r\n            componentContent.find('.panel-collapse .panel-body').each(function () {\r\n                var h = $(this).html();\r\n                $(this).replaceWith('<div class=\"panel-body\">' + h + '</div>');\r\n            });\r\n            if (component.attr('data-initial-collapsed') == 'true'){\r\n                componentContent.find('.panel').each(function () {\r\n                    var panelTitle = $(this).find('.panel-heading a');\r\n                    var panelCollapse = $(this).find('.panel-collapse');\r\n                    panelCollapse.addClass('collapse').attr('aria-expanded', 'false').removeClass('in');\r\n                    panelTitle.addClass('collapsed').attr('aria-expanded', 'false');\r\n                });\r\n            }\r\n            componentContent.find('.panel-footer, .btnAddAccordionItem').addClass('hide');\r\n            componentContent.find('[contenteditable]').removeAttr('contenteditable');\r\n            componentContent.find('.accHeadingText').each(function () {\r\n               $(this).css('outline', 'none').text($(this).text());\r\n            });\r\n            return componentContent.html();\r\n        },\r\n\r\n        destroy: function (component, keditor) {\r\n            flog('destroy \"text\" component', component);\r\n\r\n            var id = component.find('.keditor-component-content').attr('id');\r\n            var editor = CKEDITOR.instances[id];\r\n            if (editor) {\r\n                editor.destroy();\r\n            }\r\n        },\r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"accordion\" settings', form);\r\n\r\n            return $.ajax({\r\n                url: '/theme/apps/keditor-lib/componentAccordionSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n\r\n                    form.find('.collapsedAll').on('click', function () {\r\n                        var comp = keditor.getSettingComponent();\r\n                        comp.attr('data-initial-collapsed', this.checked);\r\n                    });\r\n\r\n                    form.find('.panelStyle').on('change', function (e) {\r\n                        var comp = keditor.getSettingComponent();\r\n                        var old = comp.attr('data-panel-style') || 'panel-default';\r\n                        comp.attr('data-panel-style', this.value);\r\n                        comp.find('.panel').removeClass(old).addClass(this.value);\r\n                    });\r\n                    \r\n                    $.getStyleOnce('/static/bootstrap-iconpicker/1.7.0/css/bootstrap-iconpicker.min.css');\r\n                    $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/iconset/iconset-fontawesome-4.2.0.min.js', function () {\r\n                        $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/bootstrap-iconpicker.min.js', function () {\r\n                            form.find('.btn-collapsed-icon, .btn-expanded-icon').iconpicker({\r\n                                iconset: 'fontawesome',\r\n                                cols: 10,\r\n                                rows: 4,\r\n                                placement: 'left'\r\n                            });\r\n                            \r\n                            form.find('.btn-collapsed-icon').on('change', function (e) {\r\n                                var component = keditor.getSettingComponent();\r\n                                component.attr('data-collapsed-icon', e.icon);\r\n                                component.find('.panelIconCollapsed').each(function () {\r\n                                    this.className = \"panelIconCollapsed fa \"+ e.icon;\r\n                                })\r\n                            });\r\n                            \r\n                            form.find('.btn-expanded-icon').on('change', function (e) {\r\n                                var component = keditor.getSettingComponent();\r\n                                component.attr('data-expanded-icon', e.icon);\r\n                                component.find('.panelIconExpanded').each(function () {\r\n                                    this.className = \"panelIconExpanded fa \"+ e.icon;\r\n                                })\r\n                            });\r\n                        });\r\n                    });\r\n                            \r\n                }\r\n            });\r\n        },\r\n\r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"Accordion\" component');\r\n            var dataAttributes = keditor.getDataAttributes(component, ['data-type'], false);\r\n            \r\n            form.find('.collapsedAll').prop('checked', component.attr('data-initial-collapsed') == 'true');\r\n            form.find('.panelStyle').val(component.attr('data-panel-style'));\r\n            \r\n            $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/iconset/iconset-fontawesome-4.2.0.min.js', function () {\r\n                $.getScriptOnce('/static/bootstrap-iconpicker/1.7.0/js/bootstrap-iconpicker.min.js', function () {\r\n                    var iconCollapsed = dataAttributes['data-collapsed-icon'] || 'fa-caret-up';\r\n                    form.find('.btn-collapsed-icon').find('i').attr('class', 'fa ' + iconCollapsed).end().find('input').val(iconCollapsed);\r\n                    var iconExpanded = dataAttributes['data-expanded-icon'] || 'fa-caret-down';\r\n                    form.find('.btn-expanded-icon').find('i').attr('class', 'fa ' + iconExpanded).end().find('input').val(iconExpanded);\r\n                });\r\n            });\r\n        }\r\n    };\r\n})(jQuery);\r\n\r\n"]}