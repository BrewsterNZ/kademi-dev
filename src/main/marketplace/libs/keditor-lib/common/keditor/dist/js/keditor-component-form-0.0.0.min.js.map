{"version":3,"sources":["keditor-component-form-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","initFormBuilder","component","self","this","getScriptOnce","formBuilderArea","find","formData","formContent","prepend","btnEditForm","btnPreviewForm","formBuilder","disableInjectedStyle","showActionButtons","dataType","html","disableFields","disabledAttrs","typeUserDisabledAttrs","checkbox-group","on","e","preventDefault","hasClass","show","hide","addClass","removeClass","renderForm","data","formRender","actions","getData","children","each","div","dataGrid","attr","split","wrap","label","input","subDiv","length","init","contentArea","container","componentContent","append","getContent","remove","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","success","resp","getSettingComponent","value","css","showSettingForm","layout","val","jQuery"],"mappings":"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","file":"keditor-component-form-0.0.0.min.js","sourcesContent":["(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['form'] = {\r\n        initFormBuilder: function (component) {\r\n            var self = this;\r\n            \r\n            $.getScriptOnce('/static/formBuilder/2.5.3/form-builder.min.js', function () {\r\n                $.getScriptOnce('/static/formBuilder/2.5.3/form-render.min.js', function () {\r\n                    var formBuilderArea = component.find('.form-builder-area');\r\n                    var formData = component.find('.form-data');\r\n                    var formContent = component.find('.form-content');\r\n                    \r\n                    component.find('.keditor-component-content').prepend(\r\n                        '<p class=\"form-builder-tools\" style=\"text-align: right;\">' +\r\n                        '    <a href=\"#\" class=\"btn btn-primary btn-preview-form\">Preview form</a> ' +\r\n                        '    <a href=\"#\" class=\"btn btn-info btn-edit-form disabled\">Edit form</a>' +\r\n                        '</p>'\r\n                    );\r\n                    \r\n                    var btnEditForm = component.find('.btn-edit-form');\r\n                    var btnPreviewForm = component.find('.btn-preview-form');\r\n                    \r\n                    formBuilderArea.formBuilder({\r\n                        disableInjectedStyle: true,\r\n                        showActionButtons: false,\r\n                        dataType: 'json',\r\n                        formData: formData.html(),\r\n                        disableFields: [\r\n                            'autocomplete',\r\n                            'paragraph',\r\n                            'header'\r\n                        ],\r\n                        disabledAttrs: ['access'],\r\n                        \r\n                        typeUserDisabledAttrs: {\r\n                            'checkbox-group': [\r\n                                'toggle',\r\n                                'inline'\r\n                            ]\r\n                        }\r\n                    });\r\n                    \r\n                    btnEditForm.on('click', function (e) {\r\n                        e.preventDefault();\r\n                        \r\n                        if (!btnEditForm.hasClass('disabled')) {\r\n                            formBuilderArea.show();\r\n                            formContent.hide();\r\n                            btnEditForm.addClass('disabled');\r\n                            btnPreviewForm.removeClass('disabled');\r\n                        }\r\n                    });\r\n                    \r\n                    btnPreviewForm.on('click', function (e) {\r\n                        e.preventDefault();\r\n                        \r\n                        if (!btnPreviewForm.hasClass('disabled')) {\r\n                            self.renderForm(component);\r\n                            \r\n                            formBuilderArea.hide();\r\n                            formContent.show();\r\n                            btnEditForm.removeClass('disabled');\r\n                            btnPreviewForm.addClass('disabled');\r\n                        }\r\n                    });\r\n                })\r\n            });\r\n        },\r\n        \r\n        renderForm: function (component, formBuilder) {\r\n            var formContent = component.find('.form-content');\r\n            \r\n            if (!formBuilder) {\r\n                var formBuilderArea = component.find('.form-builder-area');\r\n                formBuilder = formBuilderArea.data('formBuilder');\r\n            }\r\n            \r\n            formContent.formRender({\r\n                dataType: 'json',\r\n                formData: formBuilder.actions.getData('json')\r\n            });\r\n            \r\n            if (formContent.hasClass('form-horizontal')) {\r\n                formContent.children('div').each(function () {\r\n                    var div = $(this);\r\n                    var dataGrid = formContent.attr('data-grid') || '4-8';\r\n                    dataGrid = dataGrid.split('-');\r\n                    \r\n                    if (div.attr('class')) {\r\n                        if (div.hasClass('fb-button')) {\r\n                            div.find('button').wrap('<div class=\"col-sm-' + dataGrid[1] + ' col-sm-offset-' + dataGrid[0] + '\"></div>');\r\n                        } else {\r\n                            var label = div.children('label');\r\n                            var input = div.children('input, select, textarea');\r\n                            var subDiv = div.children('div');\r\n                            \r\n                            label.addClass('control-label col-sm-' + dataGrid[0]);\r\n                            \r\n                            if (subDiv.length > 0) {\r\n                                subDiv.addClass('col-sm-' + dataGrid[1]);\r\n                            } else {\r\n                                input.addClass('form-control').wrap('<div class=\"col-sm-' + dataGrid[1] + '\"></div>');\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        },\r\n        \r\n        init: function (contentArea, container, component, keditor) {\r\n            flog('init \"form\" component', component);\r\n            \r\n            var componentContent = component.find('.keditor-component-content');\r\n            var formBuilder = component.find('.form-builder-area');\r\n            var formContent = component.find('.form-content');\r\n            var formData = component.find('.form-data');\r\n            \r\n            if (formData.length === 0) {\r\n                componentContent.append('<div class=\"form-data\" style=\"display: none !important;\"></div>')\r\n            }\r\n            \r\n            if (formContent.length === 0) {\r\n                componentContent.append('<form class=\"form-content\" style=\"display: none !important;\"></form>')\r\n            } else {\r\n                formContent.hide()\r\n            }\r\n            \r\n            if (formBuilder.length === 0) {\r\n                formBuilder = $('<div class=\"form-builder-area clearfix\"></div>');\r\n                componentContent.append(formBuilder);\r\n            }\r\n            \r\n            this.initFormBuilder(component);\r\n        },\r\n        \r\n        getContent: function (component, keditor) {\r\n            flog('getContent \"form\" component', component);\r\n            \r\n            var self = this;\r\n            var componentContent = component.find('.keditor-component-content');\r\n            var formData = component.find('.form-data');\r\n            var formBuilderArea = $('#' + component.attr('id')).find('.form-builder-area');\r\n            var formBuilder = formBuilderArea.data('formBuilder');\r\n            \r\n            self.renderForm(component, formBuilder);\r\n            formData.html(formBuilder.actions.getData('json'));\r\n            component.find('.form-builder-area, .form-builder-tools').remove();\r\n            component.find('.form-content').show();\r\n            \r\n            return componentContent.html();\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'Form Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('initSettingForm \"form\" component');\r\n            \r\n            var self = this;\r\n            \r\n            return $.ajax({\r\n                url: '/static/keditor/componentFormSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                    \r\n                    form.find('.txt-form-action').on('change', function () {\r\n                        var component = keditor.getSettingComponent();\r\n                        var formContent = component.find('.form-content');\r\n                        \r\n                        formContent.attr('action', this.value);\r\n                    });\r\n                    \r\n                    form.find('.select-method').on('change', function () {\r\n                        var component = keditor.getSettingComponent();\r\n                        var formContent = component.find('.form-content');\r\n                        \r\n                        formContent.attr('action', this.value);\r\n                    });\r\n                    \r\n                    form.find('.select-enctype').on('change', function () {\r\n                        var component = keditor.getSettingComponent();\r\n                        var formContent = component.find('.form-content');\r\n                        \r\n                        formContent.attr('enctype', this.value);\r\n                    });\r\n                    \r\n                    form.find('.select-layout').on('change', function () {\r\n                        var component = keditor.getSettingComponent();\r\n                        var formContent = component.find('.form-content');\r\n                        \r\n                        formContent.removeClass('form-inline form-horizontal');\r\n                        if (this.value) {\r\n                            formContent.addClass(this.value);\r\n                        }\r\n                        self.renderForm(component);\r\n                        form.find('.select-grid-wrapper').css('display', this.value === 'form-horizontal' ? 'block' : 'none');\r\n                    });\r\n                    \r\n                    form.find('.select-grid').on('change', function () {\r\n                        var component = keditor.getSettingComponent();\r\n                        var formContent = component.find('.form-content');\r\n                        \r\n                        formContent.attr('data-grid', this.value);\r\n                        self.renderForm(component);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        \r\n        showSettingForm: function (form, component, keditor) {\r\n            flog('showSettingForm \"form\" component', component);\r\n            var formContent = component.find('.form-content');\r\n            \r\n            var layout = '';\r\n            if (formContent.hasClass('form-inline')) {\r\n                layout = 'form-inline';\r\n            } else if (formContent.hasClass('form-horizontal')) {\r\n                layout = 'form-horizontal';\r\n            }\r\n            \r\n            form.find('.txt-form-action').val(formContent.attr('action') || '');\r\n            form.find('.select-method').val(formContent.attr('method') || 'get');\r\n            form.find('.select-enctype').val(formContent.attr('enctype'));\r\n            form.find('.select-layout').val(layout);\r\n            form.find('.select-grid-wrapper').css('display', layout === 'form-horizontal' ? 'block' : 'none');\r\n            form.find('.select-grid').val(formContent.attr('data-grid') || '4-8');\r\n        }\r\n    };\r\n    \r\n})(jQuery);\r\n"]}