{"version":3,"sources":["keditor-component-ksvgmap-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","script","find","length","remove","attr","css","getScriptOnce","vectorMap","map","backgroundColor","zoomButtons","focusOn","x","y","scale","regionStyle","initial","fill","hover","onRegionTipShow","e","el","code","html","i","setInterval","updateSize","clearInterval","getContent","componentContent","children","arr","document","body","insertBefore","insertAfter","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","getSettingComponent","on","val","this","value","currentState","showSettingForm","height","defaultState","jQuery"],"mappings":"CAAA,SAAWA,GACP,GAAIC,GAAUD,EAAEE,QACZC,EAAOF,EAAQG,GAEnBH,GAAQI,WAAoB,SACxBC,KAAM,SAAUC,EAAaC,EAAWC,EAAWP,GAC/C,GAAIQ,GAASD,EAAUE,KAAK,SACxBD,GAAOE,QACPF,EAAOG,SAEPJ,EAAUK,KAAK,gBACfL,EAAUE,KAAK,YAAYI,IAAI,UAAWN,EAAUK,KAAK,gBAE7Dd,EAAEgB,cAAc,2DAA4D,WACxEhB,EAAEgB,cAAc,yDAA0D,WACtEP,EAAUE,KAAK,YAAYM,WACvBC,IAAK,UACLC,gBAAiB,OACjBC,aAAa,EACbC,SACIC,EAAG,GACHC,EAAG,GACHC,MAAO,GAEXC,aACIC,SACIC,KAAM,WAEVC,OACID,KAAM,YAGdE,gBAAiB,SAAUC,EAAGC,EAAIC,GAC1BvB,EAAUK,KAAK,QAAUkB,IACzBD,EAAGE,KAAKF,EAAGE,OAAS,MAAQxB,EAAUK,KAAK,QAAUkB,MAGjE,IAAIE,GAAIC,YAAY,WAChB,IACI,GAAIjB,GAAMT,EAAUE,KAAK,YAAYM,UAAU,MAAO,YACtDC,GAAIkB,aACJC,cAAcH,GAChB,MAAOJ,GACL3B,EAAK,qCAEV,SAIfmC,WAAY,SAAU7B,EAAWP,GAC7BC,EAAK,gCAAiCM,EACtC,IAAI8B,GAAmB9B,EAAU+B,SAAS,8BACtC9B,EAAS,8wBACTK,EAAM,sFACVN,GAAUE,KAAK,yBAAyBE,QACxC,IAAI4B,GAAMzC,EAAE0C,SAASC,MAAMhC,KAAK,wDAQhC,OAPI8B,GAAI7B,OAAS,GACTZ,EAAEyC,EAAIA,EAAI7B,OAAS,IAAIE,KAAK,QAAUL,EAAUK,KAAK,QACrDd,EAAEe,GAAK6B,aAAanC,EAAUE,KAAK,aACnCX,EAAEU,GAAQmC,YAAYpC,EAAUE,KAAK,cAItC4B,EAAiBN,QAG5Ba,gBAAgB,EAEhBC,aAAc,kBAEdC,gBAAiB,SAAUC,EAAM/C,GAG7B,MAFAC,GAAK,yBAA0B8C,GAExBjD,EAAEkD,MACLC,IAAK,yCACLC,KAAM,MACNC,SAAU,OACVC,QAAS,SAAUC,GACfN,EAAKhB,KAAKsB,EAEV,IAAI9C,GAAYP,EAAQsD,qBACxBP,GAAKtC,KAAK,UAAU8C,GAAG,SAAU,SAAU3B,GACvC,GAAI4B,GAAMjD,EAAUK,KAAK,QAAU6C,KAAKC,MACxCX,GAAKtC,KAAK,iBAAiB+C,IAAIA,KAEnCT,EAAKtC,KAAK,iBAAiB8C,GAAG,SAAU,SAAU3B,GAC9C,GAAI+B,GAAeZ,EAAKtC,KAAK,UAAU+C,KACvCjD,GAAUK,KAAK,QAAU+C,EAAcF,KAAKC,SAEhDX,EAAKtC,KAAK,WAAW8C,GAAG,SAAU,SAAU3B,GACxCrB,EAAUK,KAAK,cAAe6C,KAAKC,OACnCnD,EAAUE,KAAK,YAAYI,IAAI,SAAU4C,KAAKC,MAC9C,IAAI1C,GAAMT,EAAUE,KAAK,YAAYM,UAAU,MAAO,YACtDC,GAAIkB,mBAKpB0B,gBAAiB,SAAUb,EAAMxC,EAAWP,GACxC,GAAI6D,GAAStD,EAAUK,KAAK,eACxBkD,EAAef,EAAKtC,KAAK,UAAU+C,KACvCT,GAAKtC,KAAK,WAAW+C,IAAIK,GACzBd,EAAKtC,KAAK,iBAAiB+C,IAAIjD,EAAUK,KAAK,QAAUkD,OAGjEC","file":"keditor-component-ksvgmap-0.0.0.min.js","sourcesContent":["(function ($) {\r\n    var KEditor = $.keditor;\r\n    var flog = KEditor.log;\r\n    \r\n    KEditor.components['ksvgmap'] = {\r\n        init: function (contentArea, container, component, keditor) {\r\n            var script = component.find('script');\r\n            if (script.length) {\r\n                script.remove();\r\n            }\r\n            if (component.attr('data-height')) {\r\n                component.find('.ksvgmap').css('height', +component.attr('data-height'));\r\n            }\r\n            $.getScriptOnce('/static/jquery-jvectormap/jquery-jvectormap-2.0.3.min.js', function () {\r\n                $.getScriptOnce('/static/jquery-jvectormap/jquery-jvectormap-au-mill.js', function () {\r\n                    component.find('.ksvgmap').vectorMap({\r\n                        map: 'au_mill',\r\n                        backgroundColor: '#fff',\r\n                        zoomButtons: false,\r\n                        focusOn: {\r\n                            x: 0.5,\r\n                            y: 0.5,\r\n                            scale: 1\r\n                        },\r\n                        regionStyle: {\r\n                            initial: {\r\n                                fill: '#efefef'\r\n                            },\r\n                            hover: {\r\n                                fill: \"#00aa90\"\r\n                            }\r\n                        },\r\n                        onRegionTipShow: function (e, el, code) {\r\n                            if (component.attr('data-' + code))\r\n                                el.html(el.html() + ' - ' + component.attr('data-' + code));\r\n                        }\r\n                    });\r\n                    var i = setInterval(function () {\r\n                        try {\r\n                            var map = component.find('.ksvgmap').vectorMap('get', 'mapObject');\r\n                            map.updateSize();\r\n                            clearInterval(i);\r\n                        } catch (e) {\r\n                            flog('trying to get jvectormap object');\r\n                        }\r\n                    }, 50);\r\n                });\r\n            });\r\n        },\r\n        getContent: function (component, keditor) {\r\n            flog('getContent \"svgmap\" component', component);\r\n            var componentContent = component.children('.keditor-component-content');\r\n            var script = '<script>$(function(){$(document.body).hasClass(\"content-editor-page\")||$.getScriptOnce(\"/static/jquery-jvectormap/jquery-jvectormap-2.0.3.min.js\",function(){$.getScriptOnce(\"/static/jquery-jvectormap/jquery-jvectormap-au-mill.js\",function(){$(\".ksvgmap\").each(function(){var a=$(this).parents(\"[data-type=component-ksvgmap]\");a.hasClass(\"ksvgInit\")||(a.addClass(\"ksvgInit\"),$(this).vectorMap({map:\"au_mill\",backgroundColor:\"#fff\",zoomButtons:!1,scale:5,regionStyle:{initial:{fill:\"#efefef\"},hover:{fill:\"#00aa90\"}},onRegionTipShow:function(b,c,d){a.attr(\"data-\"+d)&&c.html(\"<span class=\\'vectormap-tip-region-name\\'>\"+c.html()+\"</span><span class=\\'vectormap-tip-separator\\'> - </span><span class=\\'vectormap-tip-region-data\\'>\"+a.attr(\"data-\"+d)+\"</span>\")}}))})})})});</script>';\r\n            var css = '<link rel=\"stylesheet\" href=\"/static/jquery-jvectormap/jquery-jvectormap-2.0.3.css\">';\r\n            component.find('.jvectormap-container').remove();\r\n            var arr = $(document.body).find('[data-type=\"component-ksvgmap\"]:not(.keditor-snippet)');\r\n            if (arr.length > 0) {\r\n                if ($(arr[arr.length - 1]).attr('id') === component.attr('id')) {\r\n                    $(css).insertBefore(component.find('.ksvgmap'));\r\n                    $(script).insertAfter(component.find('.ksvgmap'));\r\n                }\r\n            }\r\n            \r\n            return componentContent.html();\r\n        },\r\n        \r\n        settingEnabled: true,\r\n        \r\n        settingTitle: 'SVGMap Settings',\r\n        \r\n        initSettingForm: function (form, keditor) {\r\n            flog('init \"svgmap\" settings', form);\r\n            \r\n            return $.ajax({\r\n                url: '/keditor/componentKsvgMapSettings.html',\r\n                type: 'get',\r\n                dataType: 'HTML',\r\n                success: function (resp) {\r\n                    form.html(resp);\r\n                    \r\n                    var component = keditor.getSettingComponent();\r\n                    form.find('.state').on('change', function (e) {\r\n                        var val = component.attr('data-' + this.value);\r\n                        form.find('.stateMessage').val(val);\r\n                    });\r\n                    form.find('.stateMessage').on('change', function (e) {\r\n                        var currentState = form.find('.state').val();\r\n                        component.attr('data-' + currentState, this.value);\r\n                    });\r\n                    form.find('.height').on('change', function (e) {\r\n                        component.attr('data-height', this.value);\r\n                        component.find('.ksvgmap').css('height', this.value);\r\n                        var map = component.find('.ksvgmap').vectorMap('get', 'mapObject');\r\n                        map.updateSize();\r\n                    });\r\n                }\r\n            });\r\n        },\r\n        showSettingForm: function (form, component, keditor) {\r\n            var height = component.attr('data-height');\r\n            var defaultState = form.find('.state').val();\r\n            form.find('.height').val(height);\r\n            form.find('.stateMessage').val(component.attr('data-' + defaultState));\r\n        }\r\n    };\r\n})(jQuery);\r\n"]}