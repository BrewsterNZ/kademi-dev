{"version":3,"sources":["keditor-component-audio-0.0.0.js"],"names":["$","KEditor","keditor","flog","log","components","init","contentArea","container","component","this","img","find","componentId","attr","generateId","parent","hasClass","wrap","src","width","autostart","instance","getScriptOnce","jwplayer","key","buildJWAudioPlayerPreview","getContent","html","settingEnabled","settingTitle","initSettingForm","form","ajax","url","type","dataType","success","resp","showSettingForm","btnAudioFileInput","mselect","contentTypes","bs3Modal","pagePath","options","basePath","onSelectFile","refreshAudioPlayerPreview","autoplayToggle","prop","on","e","checked","audioWidth","val","value","resizeAudioPlayerPreview","playerInstance","setup","file","height","flashplayer","html5player","primary","onReady","load","play","resize","jQuery"],"mappings":"CAAA,SAAWA,GACP,GAAIC,GAAUD,EAAEE,QACZC,EAAOF,EAAQG,GAEnBH,GAAQI,WAAkB,OACtBC,KAAM,SAAUC,EAAaC,EAAWC,EAAWP,GAC/CC,EAAK,yBAA0BM,GAE/BC,KAAKD,UAAYA,CACjB,IAAIE,GAAMF,EAAUG,KAAK,iBACrBC,EAAc,EACbF,GAAIG,KAAK,MAIVD,EAAcF,EAAIG,KAAK,OAHvBD,EAAcX,EAAQa,WAAW,mBACjCJ,EAAIG,KAAK,KAAMD,IAIdF,EAAIK,SAASC,SAAS,kBACvBN,EAAIO,KAAK,qCAEbR,KAAKS,IAAMR,EAAIG,KAAK,YACpBJ,KAAKU,MAAQT,EAAIG,KAAK,cACtBJ,KAAKW,UAA2C,SAA/BV,EAAIG,KAAK,iBAC1B,IAAIQ,GAAWZ,IACfV,GAAEuB,cAAc,oCAAqC,WACjDC,SAASC,IAAM,+CACfH,EAASI,0BAA0Bb,MAK3Cc,WAAY,SAAUlB,EAAWP,GAC7BC,EAAK,+BAAgCM,EAErC,IAAIE,GAAMF,EAAUG,KAAK,iBACrBC,EAAcF,EAAIG,KAAK,MAEvBc,EAAO,0BAA4Bf,EAAc,iEAAmEH,KAAKW,UAAY,iBAAmBX,KAAKU,MAAQ,eAAiBV,KAAKS,IAAM,kBAAoBT,KAAKS,IAAM,MACpO,OAAOS,IAGXC,gBAAgB,EAEhBC,aAAc,iBAEdC,gBAAiB,SAAUC,EAAM9B,GAG7B,MAFAC,GAAK,wBAAyB6B,GAEvBhC,EAAEiC,MACLC,IAAK,uCACLC,KAAM,MACNC,SAAU,OACVC,QAAS,SAAUC,GACfN,EAAKJ,KAAKU,OAKtBC,gBAAiB,SAAUP,EAAMvB,EAAWP,GACxCC,EAAK,oCAAqC6B,EAAMvB,EAEhD,IAAIa,GAAWZ,KACX8B,EAAoBR,EAAKpB,KAAK,sBAClC4B,GAAkBC,SACdC,cAAe,SACfC,UAAU,EACVC,SAAU1C,EAAQ2C,QAAQD,SAC1BE,SAAU5C,EAAQ2C,QAAQC,SAC1BC,aAAc,SAAUb,GACpBZ,EAASH,IAAMe,EACfZ,EAAS0B,8BAIjB,IAAIrC,GAAMF,EAAUG,KAAK,iBACrBC,EAAcF,EAAIG,KAAK,MAEvBmC,EAAiBjB,EAAKpB,KAAK,kBAC3BF,MAAKW,WACL4B,EAAeC,KAAK,WAAW,GAEnCD,EAAeE,GAAG,QAAS,SAAUC,GACjC9B,EAASD,UAAYX,KAAK2C,QAC1B/B,EAASI,0BAA0Bb,IAGvC,IAAIyC,GAAatB,EAAKpB,KAAK,eAC3B0C,GAAWC,IAAI7C,KAAKU,OACpBkC,EAAWH,GAAG,SAAU,WACpB7B,EAASF,MAAQV,KAAK8C,MACtBlC,EAASmC,8BAIjB/B,0BAA2B,SAAUb,GACjC,GAAIO,GAAQV,KAAKU,MACbD,EAAMT,KAAKS,IACXE,EAAYX,KAAKW,UACjBqC,EAAiBlC,SAASX,EAC9B6C,GAAeC,OACXC,KAAMzC,EACNC,MAAOA,EACPyC,OAAQ,GACRxC,UAAWA,EACXyC,YAAa,2CACbC,YAAa,0CACbC,QAAS,UAEbN,EAAeO,QAAQ,WACnB7D,IAAI,iCAIZ4C,0BAA2B,WACvB,GAAI1B,GAAWZ,KACXgD,EAAiBlC,SAASF,EAAST,aACnCM,EAAMG,EAASH,GACnBuC,GAAeQ,OACXN,KAAMzC,KAEVuC,EAAeS,QAGnBV,yBAA0B,WACtB,GAAInC,GAAWZ,KACXgD,EAAiBlC,SAASF,EAAST,aACnCO,EAAQE,EAASF,KAErBsC,GAAeU,OAAOhD,EAAO,OAItCiD","file":"keditor-component-audio-0.0.0.min.js","sourcesContent":["(function ($) {\n    var KEditor = $.keditor;\n    var flog = KEditor.log;\n    \n    KEditor.components['audio'] = {\n        init: function (contentArea, container, component, keditor) {\n            flog('init \"audio\" component', component);\n            \n            this.component = component;\n            var img = component.find('img[data-src]');\n            var componentId = '';\n            if (!img.attr('id')) {\n                componentId = keditor.generateId('component-audio');\n                img.attr('id', componentId);\n            } else {\n                componentId = img.attr('id');\n            }\n            if (!img.parent().hasClass('audio-wrapper')) {\n                img.wrap('<div class=\"audio-wrapper\"></div>');\n            }\n            this.src = img.attr('data-src');\n            this.width = img.attr('data-width');\n            this.autostart = img.attr('data-autostart') === 'true';\n            var instance = this;\n            $.getScriptOnce('/static/jwplayer/6.10/jwplayer.js', function () {\n                jwplayer.key = 'cXefLoB9RQlBo/XvVncatU90OaeJMXMOY/lamKrzOi0=';\n                instance.buildJWAudioPlayerPreview(componentId);\n            });\n            \n        },\n        \n        getContent: function (component, keditor) {\n            flog('getContent \"audio\" component', component);\n            \n            var img = component.find('img[data-src]');\n            var componentId = img.attr('id');\n            \n            var html = '<img data-componentId=\"' + componentId + '\" src=\"/theme/apps/content/preview/audio.png\" data-autostart=\"' + this.autostart + '\" data-width=\"' + this.width + '\" data-src=\"' + this.src + '\" data-kaudio=\"' + this.src + '\" />';\n            return html;\n        },\n        \n        settingEnabled: true,\n        \n        settingTitle: 'Audio settings',\n        \n        initSettingForm: function (form, keditor) {\n            flog('init \"audio\" settings', form);\n            \n            return $.ajax({\n                url: '/keditor/componentAudioSettings.html',\n                type: 'get',\n                dataType: 'HTML',\n                success: function (resp) {\n                    form.html(resp);\n                }\n            });\n        },\n        \n        showSettingForm: function (form, component, keditor) {\n            flog('showSettingForm \"audio\" component', form, component);\n            \n            var instance = this;\n            var btnAudioFileInput = form.find('.btn-audioFileInput');\n            btnAudioFileInput.mselect({\n                contentTypes: ['audio'],\n                bs3Modal: true,\n                pagePath: keditor.options.pagePath,\n                basePath: keditor.options.basePath,\n                onSelectFile: function (url) {\n                    instance.src = url;\n                    instance.refreshAudioPlayerPreview();\n                }\n            });\n            \n            var img = component.find('img[data-src]');\n            var componentId = img.attr('id');\n            \n            var autoplayToggle = form.find('#audio-autoplay');\n            if (this.autostart) {\n                autoplayToggle.prop('checked', true);\n            }\n            autoplayToggle.on('click', function (e) {\n                instance.autostart = this.checked;\n                instance.buildJWAudioPlayerPreview(componentId);\n            });\n            \n            var audioWidth = form.find('#audio-width');\n            audioWidth.val(this.width);\n            audioWidth.on('change', function () {\n                instance.width = this.value;\n                instance.resizeAudioPlayerPreview();\n            });\n        },\n        \n        buildJWAudioPlayerPreview: function (componentId) {\n            var width = this.width;\n            var src = this.src;\n            var autostart = this.autostart;\n            var playerInstance = jwplayer(componentId);\n            playerInstance.setup({\n                file: src,\n                width: width,\n                height: 30,\n                autostart: autostart,\n                flashplayer: \"/static/jwplayer/6.10/jwplayer.flash.swf\",\n                html5player: \"/static/jwplayer/6.10/jwplayer.html5.js\",\n                primary: \"flash\"\n            });\n            playerInstance.onReady(function () {\n                log('jwplayer preview init done');\n            });\n        },\n        \n        refreshAudioPlayerPreview: function () {\n            var instance = this;\n            var playerInstance = jwplayer(instance.componentId);\n            var src = instance.src;\n            playerInstance.load([{\n                file: src\n            }]);\n            playerInstance.play();\n        },\n        \n        resizeAudioPlayerPreview: function () {\n            var instance = this;\n            var playerInstance = jwplayer(instance.componentId);\n            var width = instance.width;\n            \n            playerInstance.resize(width, 30);\n        }\n    };\n    \n})(jQuery);\n"]}