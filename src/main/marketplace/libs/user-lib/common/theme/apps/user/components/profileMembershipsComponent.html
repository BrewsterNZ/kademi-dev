<div class="well well-memberships">
    <h4>Memberships</h4>


    <ul class='list-unstyled memberships' id="profile-memberships">
        #foreach($membership in $profile.primaryMemberships())
        <li>
            Member of the <b>$membership.groupTitle</b> group
            #if( $membership.org.isAdminDomain() )
            #else
            in
            <b>$membership.org.title</b>
            #end

        <acronym title='Remove this membership'>
            <a href='$membership.id' class='membership-remove'><i class="fa fa-times"></i><span>Remove</span></a>
        </acronym>
        </li>
        #end
    </ul>

    <br/>

    #set( $groups = $profile.primaryMemberships().toGroupsList() )
    #foreach( $group in $groups )
    #if( !$group.closedGroup )
    <button class="btn btn-primary" data-toggle="modal" data-target="#profile-add-org-$group.name">
        <i class="fa fa-plus"></i>
        Join $group.title
    </button>
    #end
    #end
</div>

#set( $groups = $profile.primaryMemberships().toGroupsList() )
#foreach( $group in $groups )
<div id="profile-add-org-$group.name" class="modal profile-add-membership" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    #if( !$group.closedGroup )
    <div class="modal-dialog">
        #set( $orgType = "organisation" )
        #set( $orgType = $group.regoOrgType.displayName )

        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">New $group.title membership</h4>
            </div>
            <form method="POST" action="/profile-memberships">
                <input type="hidden" name="groupName" value="$group.name" />
                <input type="hidden" name="orgId" value="" />
                <div class="modal-body modal-overflow"  id="changeOrgModalBody">
                    <p>Please enter the $orgType you want to join</p>
                    <input class="required form-control" type="text" name="orgTitleSearch" autocomplete="off" placeholder="Choose your $orgType" />
                    <br>
                </div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
                    <button class="btn btn-primary btn-save" type="submit">Save changes</button>
                </div>
            </form>
        </div>
    </div>
    #end
</div>
#end

#set( $gmas = $services.userManager.findPendingMembershipApplications($user) )
#if( $gmas.isEmpty() )
#else
<div class="well">

    <h4>Membership applications</h4>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Group</th>
                <th>Organisation</th>
                <th>Status</th>
                <th>Submitted date  </th>
            </tr>
        </thead>
        #foreach( $gma in $gmas )
        <tr>
            <td>$gma.groupEntity.title</td>
            <td>$!gma.withinOrg.formattedName</td>
            <td>
                #if( $gma.applicationResultState )
                $gma.applicationResultState
                #else
                Pending
                #end
            </td>
            <td>$formatter.formatDate($gma.createdDate)</td>
        </tr>
        #end
    </table>
</div>
#end